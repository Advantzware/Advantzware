        1   /*******************************************************************************
        2    *******************************************************************************
        3    **                                                                           **
        4    **                                                                           **
        5    **  Copyright 2003-2012 Tom Bascom, Greenfield Technologies                  **
        6    **  http://www.greenfieldtech.com                                            **
        7    **                                                                           **
        8    **  ProTop is free software; you can redistribute it and/or modify it        **
        9    **  under the terms of the GNU General Public License (GPL) as published     **
       10    **  by the Free Software Foundation; either version 2 of the License, or     **
       11    **  at your option) any later version.                                       **
       12    **                                                                           **
       13    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
       14    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
       15    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
       16    **  for more details.                                                        **
       17    **                                                                           **
       18    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
       19    **  of use and alternative licensing options for this software.              **
       20    **                                                                           **
       21    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
       22    **                                                                           **
       23    **  See http://www.fsf.org for more information about the GPL.               **
       24    **                                                                           **
       25    **                                                                           **
       26    *******************************************************************************
       27    *******************************************************************************
       28    *
       29    * seq.p
       30    *
       31    *
       32    * Sequence activity
       33    *
       34    *
       35    * Author:
       36    *
       37    *      Tom Bascom, Greenfield Technologies
       38    *      http://www.greenfieldtech.com
       39    *      September 5, 2003
       40    *
       41    */
       42   
       43   
       44   /*******************************************************************************
       45    *******************************************************************************
       46    **                                                                           **
       47    **                                                                           **
       48    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
       49    **  http://www.greenfieldtech.com                                            **
       50    **                                                                           **
       51    **  ProTop is free software; you can redistribute it and/or modify it        **
       52    **  under the terms of the GNU General Public License (GPL) as published     **
       53    **  by the Free Software Foundation; either version 2 of the License, or     **
       54    **  at your option) any later version.                                       **
       55    **                                                                           **
       56    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
       57    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
       58    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
       59    **  for more details.                                                        **
       60    **                                                                           **
       61    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
       62    **  of use and alternative licensing options for this software.              **
       63    **                                                                           **
       64    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
       65    **                                                                           **
       66    **  See http://www.fsf.org for more information about the GPL.               **
       67    **                                                                           **
       68    **                                                                           **
       69    *******************************************************************************
       70    *******************************************************************************
       71    *
       72    * protop.i
       73    *
       74    * Header file for protop family of programs
       75    *
       76    *
       77    * Known Bugs & Issues:
       78    *
       79    *
       80    * To Do:
       81    *
       82    *
       83    * Author:
       84    *
       85    *      Tom Bascom, Greenfield Technologies
       86    *      http://www.greenfieldtech.com
       87    *      August 28, 2003
       88    *
       89    */
       90   
       91   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 11.4 &THEN
       92   &global-define  FASTLOCK        true
       93   &ELSE
       94   &global-define  FASTLOCK        false
       95   &ENDIF
       96   
       97   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 11.0 &THEN
       98   &global-define  OE11            "yes"
       99   &global-define  xDEBUGTT        false
      100   &ENDIF
      101   
      102   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.2 AND PROVERSION >= "10.2B" &THEN
      103   &global-define  NOSERIALIZE     serialize-hidden
      104   &ENDIF
      105   
      106   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.1 AND PROVERSION >= "10.1B" &THEN
      107   &global-define  BIGINT          int64
      108   &ELSE
      109   &global-define  BIGINT          decimal
      110   &ENDIF
      111   
      112   
      113   /* lib/v9.i
      114    *
      115    */
      116   
      117   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) < 10.0 &THEN
      118   &global-define  CPYLOB  "no"
      119   &global-define  NOW     substitute( "&1 &2", today, string( time, "hh:mm:ss" ))
      120   &global-define  LNGCR   character
      121   &global-define  DTZ     integer
      122   &global-define  BIGINT  decimal
      123   &ELSE
      124   &global-define  OE10    "yes"
      125   &global-define  NOW     now
      126   &global-define  LNGCR   longchar
      127   &global-define  DTZ     datetime-tz
      128   &global-define  BIGINT  int64
      129   &ENDIF
      130    
      131   
      132   /* use extended _connect fields: -client, -cache*
      133    */
      134   
      135   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.1 AND PROVERSION >= "10.1C" &THEN
      136   &global-define  CONNECTX        "yes"
      137   &ELSE
      138   &global-define  CONNECTX        "no"
      139   &ENDIF
      140   
      141   define stream inStrm.
      142   
      143   define new global shared variable dbgMode as integer no-undo initial 1.
      144   
      145   /* The values for these are defined in etc/protop.cfg and set by lib/protop-cfg.p
      146    *
      147    * someday everyone will have OO and I will replace these with a gsv class
      148    * or something of that ilk
      149    *
      150    */
      151   
      152   define new global shared variable pt_shortname   as character no-undo.
      153   define new global shared variable pt_uniqName    as character no-undo.
      154   define new global shared variable pt_server      as character no-undo.
      155   define new global shared variable pt_resrcType   as character no-undo.
      156   
      157   define new global shared variable pt_tmpdir      as character no-undo initial "/tmp".
      158   define new global shared variable pt_logdir      as character no-undo initial "/tmp".
      159   define new global shared variable pt_rptdir      as character no-undo initial "/tmp".
      160   define new global shared variable pt_logname     as character no-undo initial "&5.&2.&3".
      161   define new global shared variable pt_mailcmd     as character no-undo initial 'mailx "-s &1" '.
      162   
      163   define new global shared variable pt_votrx       as integer   no-undo initial 1800.
      164   define new global shared variable pt_lktbllim    as integer   no-undo initial 0.
      165   define new global shared variable pt_bkupstale   as integer   no-undo initial 26.
      166   define new global shared variable pt_bogomips    as integer   no-undo initial 1000000.
      167   define new global shared variable pt_ioresp      as integer   no-undo initial 100.
      168   define new global shared variable pt_ioFileName  as character no-undo.
      169   define new global shared variable pt_dfCmd       as character no-undo.
      170   
      171   define new global shared variable pt_AICheckInterval   as integer no-undo initial 60.
      172   define new global shared variable pt_PICACheckInterval as integer no-undo initial 60.
      173   define new global shared variable pt_appsrvStuck       as integer no-undo initial 120.
      174   
      175   define new global shared variable pt_bibkupAlert as integer   no-undo.          /* alert on long bi backup phase                */
      176   define new global shared variable pt_bibkupAlarm as integer   no-undo.          /* alarm on long bi backup phase                */
      177   define new global shared variable pt_bibkupPage  as integer   no-undo.          /* page  on long bi backup phase                */
      178   
      179   define new global shared variable pt_bkupAlert   as integer   no-undo.          /* alert on long db backup                      */
      180   define new global shared variable pt_bkupAlarm   as integer   no-undo.          /* alarm on long db backup                      */
      181   define new global shared variable pt_bkupPage    as integer   no-undo.          /* page  on long db backup                      */
      182   
      183   define new global shared variable pt_userLock    as logical   no-undo.          /* enable _userLock  data?                      */
      184   define new global shared variable pt_doZippy     as logical   no-undo.          /* enable "user experience" (aka "zippy")?      */
      185   define new global shared variable pt_useRFUtil   as logical   no-undo.          /* use rfutil to gather after-imaging status?   */
      186   
      187   define new global shared variable pt_updAreaData as integer   no-undo.          /* how often should we report storage area xref details from dbanalys? */
      188   
      189   define new global shared variable pt_zoomTo      as integer no-undo.            /* new zoomed monInt                            */
      190   
      191   define new global shared variable ptDBName     as character no-undo.                    /* the db logical name          */
      192   define new global shared variable rowLimit     as integer   no-undo initial 100.        /* 50?                          */
      193   
      194   /* do-sumSample() manipulates these -- ugly, ugly, ugly... (obsolete?)
      195    * 
      196    */
      197   
      198   define new global shared variable stime as integer no-undo.                     /* start time                           */
      199   define new global shared variable ltime as integer no-undo.                     /* last time                            */
      200   define new global shared variable xtime as integer no-undo.                     /* total time                           */
      201   define new global shared variable itime as integer no-undo.                     /* iteration time                       */
      202   
      203   define new global shared variable chkp-base   as integer no-undo initial ?.     /* cover for the lack of a VST field    */
      204   
      205                                                                                   /* corresponding to base checkpoint#    */
      206   /** Global Shared Temp Table Definitions
      207    **
      208    ** Yup, they're shared.  But this stuff makes no sense across session boundaries anyway.
      209    ** And a shared temp-table is logically the same as a db table so who really cares?
      210    **
      211    **/
      212   
      213   /* cache _File and _Index records so that we don't keep hitting the db to translate
      214    */
      215   
      216   define new global shared temp-table tt_tbl no-undo
      217     field xid      as integer                                             /* _File._File-Num              */
      218     field tstatid  as integer                                             /* _TableStat._TableStat-Id     */
      219     field areaNum  as integer                                             /* _Storage-Object._Area-Number */
      220     field tblPool  as character                                           /* get-bits( _object-attrib, 7, 1 ) = 1 */
      221     field tblname  as character                                           /* _File._File-Name             */
      222     index xid-idx is unique primary xid.
      223   
      224   define new global shared temp-table tt_idx no-undo
      225     field xid      as integer                                             /* _Index._Idx-Num              */
      226     field istatid  as integer                                             /* _IndexStat._IndexStat-Id     */
      227     field idxname  as character                                           /* _Index._Idx-Name             */
      228     field idxnote  as character
      229     field idxRoot  as int64                                           /* _Storage-Object._Object-Root */
      230     field tblnum   as integer                                             /* _File._File-Num              */
      231     field areaNum  as integer                                             /* _Storage-Object._Area-Number */
      232     field idxPool  as character                                           /* get-bits( _object-attrib, 7, 1 ) = 1 */
      233     field tblname  as character                                           /* _File._File-Name             */
      234     index xid-idx is unique primary xid.
      235   
      236   define new global shared temp-table tt_areaExtent no-undo
      237     field areaNum  as integer                                             /* _areaExtent._Area-Number     */
      238     field extNum   as integer                                             /* _areaExtent._Extent-Number   */
      239   
      240     field extSize  as decimal                                             /* _areaExtent._Extent-Size     */
      241     field extType  as integer                                             /* _areaExtent._Extent-Type     */
      242     field extPath  as character                                           /* _areaExtent._Extent-Path     */
      243   
      244     index ae-idx is unique primary areaNum extNum.
      245   
      246   define new global shared temp-table tt_area no-undo
      247     field xid      as integer    format ">>>9"
      248     field SANum    as integer    format ">>>9"        label "#"
      249     field areaPool as character  format "x(2)"        label "BX"
      250   /*field areaStatus-Id as {&BIGINT} format ">>>9"    label "Id" */
      251     field SAName   as character  format "x(30)"       label "Area Name"
      252     field allocGB  as decimal    format ">>>>>9.99"   label "Allocated"
      253     field varGB    as decimal    format ">>>>>9.99"   label "Variable"
      254     field totGB    as decimal    format ">>>>>>9.99"  label "Tot GB"
      255     field hiGB     as decimal    format ">>>>>9.99"   label "Hi Water" serialize-hidden
      256     field freeGB   as decimal    format ">>>>>9.99"   label "Free GB"
      257     field pctAlloc as decimal    format ">>>>>9%"     label "%Alloc"
      258     field pctLastX as decimal    format ">>>>9%"      label "%LastX"
      259   
      260     field blkszkb as integer     format ">>9"         label "BSZ"
      261     field rpb     as integer     format ">>9"         label "RPB"
      262     field clstrsz as integer     format ">>9"         label "CSZ"
      263   
      264     field numTbls as integer     format ">>>>9"       label "#Tbls"
      265     field numIdxs as integer     format ">>>>9"       label "#Idxs"
      266     field numLOBs as integer     format ">>>>9"       label "#LOBs"
      267   
      268     field numExts as integer     format ">>>>9"       label "#Exts"
      269     field hasVar  as logical     format "Yes/No"      label "Var?"
      270   
      271     field xnote   as character   format "x"           label "*"
      272   
      273     field areaMaxPct as decimal  format ">>9.999%"    label "Max%"
      274     field idx3264    as decimal  format ">>9.999%"    label "Bug%"
      275   
      276     index pctAlloc-idx is primary pctAlloc descending
      277     index pctLastX-idx pctLastX pctAlloc descending
      278     index allocGB-idx allocGB descending
      279     index totGB-idx totGB descending
      280     index xid-idx is unique xid
      281     index SANum-idx is unique SANum
      282     index SAName-idx is unique SAName
      283   .
      284   
      285   *** Encrypted Source ***
      286   *** Encrypted Source ***
      287   *** Encrypted Source ***
      288   *** Encrypted Source ***
      289   *** Encrypted Source ***
      290   *** Encrypted Source ***
      291   *** Encrypted Source ***
      292   *** Encrypted Source ***
      293   *** Encrypted Source ***
      294   *** Encrypted Source ***
      295   *** Encrypted Source ***
      296   *** Encrypted Source ***
      297   *** Encrypted Source ***
      298   *** Encrypted Source ***
      299   *** Encrypted Source ***
      300   *** Encrypted Source ***
      301   *** Encrypted Source ***
      302   *** Encrypted Source ***
      303   *** Encrypted Source ***
      304   *** Encrypted Source ***
      305   *** Encrypted Source ***
      306   *** Encrypted Source ***
      307   *** Encrypted Source ***
      308   *** Encrypted Source ***
      309   *** Encrypted Source ***
      310   *** Encrypted Source ***
      311   *** Encrypted Source ***
      312   *** Encrypted Source ***
      313   *** Encrypted Source ***
      314   *** Encrypted Source ***
      315   *** Encrypted Source ***
      316   *** Encrypted Source ***
      317   *** Encrypted Source ***
      318   *** Encrypted Source ***
      319   *** Encrypted Source ***
      320   *** Encrypted Source ***
      321   *** Encrypted Source ***
      322   *** Encrypted Source ***
      323   *** Encrypted Source ***
      324   *** Encrypted Source ***
      325   *** Encrypted Source ***
      326   *** Encrypted Source ***
      327   *** Encrypted Source ***
      328   *** Encrypted Source ***
      329   *** Encrypted Source ***
      330   *** Encrypted Source ***
      331   *** Encrypted Source ***
      332   *** Encrypted Source ***
      333   *** Encrypted Source ***
      334   *** Encrypted Source ***
      335   *** Encrypted Source ***
      336   *** Encrypted Source ***
      337   *** Encrypted Source ***
      338   *** Encrypted Source ***
      339   *** Encrypted Source ***
      340   *** Encrypted Source ***
      341   *** Encrypted Source ***
      342   *** Encrypted Source ***
      343   *** Encrypted Source ***
      344   *** Encrypted Source ***
      345   *** Encrypted Source ***
      346   *** Encrypted Source ***
      347   *** Encrypted Source ***
      348   *** Encrypted Source ***
      349   *** Encrypted Source ***
      350   *** Encrypted Source ***
      351   *** Encrypted Source ***
      352   *** Encrypted Source ***
      353   *** Encrypted Source ***
      354   *** Encrypted Source ***
      355    
      356   
      357   /*******************************************************************************
      358    *******************************************************************************
      359    **                                                                           **
      360    **                                                                           **
      361    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      362    **  http://www.greenfieldtech.com                                            **
      363    **                                                                           **
      364    **  ProTop is free software; you can redistribute it and/or modify it        **
      365    **  under the terms of the GNU General Public License (GPL) as published     **
      366    **  by the Free Software Foundation; either version 2 of the License, or     **
      367    **  at your option) any later version.                                       **
      368    **                                                                           **
      369    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      370    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      371    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      372    **  for more details.                                                        **
      373    **                                                                           **
      374    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      375    **  of use and alternative licensing options for this software.              **
      376    **                                                                           **
      377    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      378    **                                                                           **
      379    **  See http://www.fsf.org for more information about the GPL.               **
      380    **                                                                           **
      381    **                                                                           **
      382    *******************************************************************************
      383    *******************************************************************************
      384    *
      385    * protoplib.i
      386    *
      387    * ProTop infrastructure library definitions
      388    *
      389    */
      390   
      391   function uDateTime returns integer () in super.
      392   function string2uDateTime returns integer( input p_text as character ) in super.
      393   function searchDir returns character ( input xDir as character ) in super.
      394   function unsignMe returns decimal ( input s as decimal, input i as integer ) in super.
      395   function hr returns decimal ( input lr as decimal, input osr as decimal, output hr-str as character, output hr as decimal, output mr as decimal ) in super.
      396   function do-SumSample returns logical ( output p_index as integer, output p_time  as integer ) in super.
      397   function myPID returns character () in super.
      398   function hilite returns logical ( input b as handle, input p_metric as character, input p_value as character, output p_attr as character ) in super.
      399   
      400   /* end protoplib.i */
      401    
      402   
      403   /*******************************************************************************
      404    *******************************************************************************
      405    **                                                                           **
      406    **                                                                           **
      407    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      408    **  http://www.greenfieldtech.com                                            **
      409    **                                                                           **
      410    **  ProTop is free software; you can redistribute it and/or modify it        **
      411    **  under the terms of the GNU General Public License (GPL) as published     **
      412    **  by the Free Software Foundation; either version 2 of the License, or     **
      413    **  at your option) any later version.                                       **
      414    **                                                                           **
      415    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      416    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      417    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      418    **  for more details.                                                        **
      419    **                                                                           **
      420    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      421    **  of use and alternative licensing options for this software.              **
      422    **                                                                           **
      423    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      424    **                                                                           **
      425    **  See http://www.fsf.org for more information about the GPL.               **
      426    **                                                                           **
      427    **                                                                           **
      428    *******************************************************************************
      429    *******************************************************************************
      430    *
      431    * vstlib.i
      432    *
      433    * VST library definitions
      434    *
      435    */
      436   
      437   function aiInfo returns character ( input vAiFile as character, output vAiGenNum as integer ) in super.
      438   function chkai returns integer ( output ai_exts as integer, output ai_full as integer, output ai_empty as integer ) in super.
      439   function chkarea returns integer ( input threshold as decimal, output worst as decimal ) in super.
      440   function chkptNum returns integer ( input-output oldbi as integer ) in super.
      441   
      442   function connectFlags returns character ( input cnxId as integer ) in super.
      443   function connectName returns character ( input cnxId as integer, input cnxFlags as character ) in super.
      444   function lastStatement returns character( input cnxId as integer, output lineNum as integer, output procName as character ) in super.
      445   
      446   function isAIEnabled returns logical () in super.
      447   function isReplSource returns logical () in super.
      448   function isReplTarget returns logical () in super.
      449   function isBackupRunning returns logical () in super.
      450   function isWorkgroup returns logical () in super.
      451   
      452   function getStartupX returns character ( input v as character, input p1 as character, input p2 as character ) in super.
      453   
      454   /* end vstlib.i */
      455    
      456   
      457   function add2ds returns logical ( input h as handle ) in super.
      458   function getTempTableHandle returns handle ( input n as character ) in super.
      459   
      460   /* end protop.i */
      461    
      462   
      463   /*******************************************************************************
      464    *******************************************************************************
      465    **                                                                           **
      466    **                                                                           **
      467    **  Copyright 2003-2012 Tom Bascom, Greenfield Technologies                  **
      468    **  http://www.greenfieldtech.com                                            **
      469    **                                                                           **
      470    **  ProTop is free software; you can redistribute it and/or modify it        **
      471    **  under the terms of the GNU General Public License (GPL) as published     **
      472    **  by the Free Software Foundation; either version 2 of the License, or     **
      473    **  at your option) any later version.                                       **
      474    **                                                                           **
      475    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      476    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      477    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      478    **  for more details.                                                        **
      479    **                                                                           **
      480    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      481    **  of use and alternative licensing options for this software.              **
      482    **                                                                           **
      483    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      484    **                                                                           **
      485    **  See http://www.fsf.org for more information about the GPL.               **
      486    **                                                                           **
      487    **                                                                           **
      488    *******************************************************************************
      489    *******************************************************************************
      490    *
      491    * tick.i
      492    *
      493    *
      494    * common routine to handle "clock ticks"
      495    *
      496    *
      497    * Author:
      498    *
      499    *      Tom Bascom, Greenfield Technologies
      500    *      http://www.greenfieldtech.com
      501    *      January 21, 2012
      502    *
      503    */
      504   
      505   
      506   /* lib/v9.i
      507    *
      508    */
      509   
      510   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) < 10.0 &THEN
      511   &global-define  CPYLOB  "no"
      512   &global-define  NOW     substitute( "&1 &2", today, string( time, "hh:mm:ss" ))
      513   &global-define  LNGCR   character
      514   &global-define  DTZ     integer
      515   &global-define  BIGINT  decimal
      516   &ELSE
      517   &global-define  OE10    "yes"
      518   &global-define  NOW     now
      519   &global-define  LNGCR   longchar
      520   &global-define  DTZ     datetime-tz
      521   &global-define  BIGINT  int64
      522   &ENDIF
      523    
      524   
      525   define new global shared variable rawMode  as integer no-undo initial 5.
      526   define new global shared variable timeMode as integer no-undo initial 2.
      527   
      528   define new global shared variable x as integer no-undo initial 5.
      529   define new global shared variable z as decimal no-undo.
      530   
      531   define variable y as decimal no-undo.
      532   
      533   define variable initTick as integer no-undo.
      534   define variable prevTick as integer no-undo.
      535   
      536   
      537   procedure updTick:
      538   
      539   &IF DEFINED( OE10 ) &THEN
      540     if initTick = 0 then initTick = mtime.
      541     assign
      542       x = rawMode /* ( if rawMode then 4 else 5 ) */
      543       z = mtime - prevTick
      544       z = ( if z >= 0 then z else 86400000 - prevTick + mtime )   /* handle rolling over midnight */
      545       z = z / 1000
      546       y = mtime - initTick
      547       y = y / 1000
      548       prevTick = mtime
      549     .
      550   &ELSE
      551     if initTick = 0 then initTick = etime.
      552     assign
      553       x = rawMode /* ( if rawMode then 4 else 5 ) */
      554       z = etime - prevTick
      555       z = ( if z >= 0 then z else 5000 )   /* etime doesn't rollover at midnite -- but a mistaken etime(yes) somewhere would be bad... */
      556       z = z / 1000
      557       y = etime - initTick
      558       y = y / 1000
      559       prevTick = etime
      560     .
      561   &ENDIF
      562   
      563     /* if rawMode <> 5 then z = 1. */
      564   
      565     if timeMode = 1 then z = 1.
      566   
      567     return.
      568   
      569   end.
      570   
      571   /* end tick.i */
      572    
      573   
      574   define output parameter dcDescription as character no-undo initial "SequenceActivity".
      575   
      576   
      577   /*******************************************************************************
      578    *******************************************************************************
      579    **                                                                           **
      580    **                                                                           **
      581    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      582    **  http://www.greenfieldtech.com                                            **
      583    **                                                                           **
      584    **  ProTop is free software; you can redistribute it and/or modify it        **
      585    **  under the terms of the GNU General Public License (GPL) as published     **
      586    **  by the Free Software Foundation; either version 2 of the License, or     **
      587    **  at your option) any later version.                                       **
      588    **                                                                           **
      589    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      590    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      591    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      592    **  for more details.                                                        **
      593    **                                                                           **
      594    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      595    **  of use and alternative licensing options for this software.              **
      596    **                                                                           **
      597    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      598    **                                                                           **
      599    **  See http://www.fsf.org for more information about the GPL.               **
      600    **                                                                           **
      601    **                                                                           **
      602    *******************************************************************************
      603    *******************************************************************************
      604    *
      605    * tt_xstat.i
      606    *
      607    */
      608   
      609   define variable ratio-calc as integer no-undo.
      610   
      611   define temp-table tt_xstat no-undo
      612     field xid       as integer
      613     field xvalid    as logical
      614     field xname     as character
      615     field misc1     as character
      616     field misc2     as character
      617     field misc3     as character
      618     field misc4     as character
      619     field misc5     as character
      620     field stat1     as decimal extent 5
      621     field stat2     as decimal extent 5
      622     field stat3     as decimal extent 5
      623     field stat4     as decimal extent 5
      624     field stat5     as decimal extent 5
      625     field stat6     as decimal extent 5
      626     field stat-ratio  as decimal
      627     field stat-ratio2 as decimal
      628     index xid-idx is unique primary xid.
      629   
      630   /* this will be called by the including procedure's mon-update procedure
      631    *
      632    */
      633   
      634   procedure update_xstat:
      635   
      636     define input parameter p_xid   as integer   no-undo.
      637     define input parameter p_xname as character no-undo.
      638     define input parameter p_misc1 as character no-undo.
      639     define input parameter p_misc2 as character no-undo.
      640     define input parameter p_misc3 as character no-undo.
      641     define input parameter p_misc4 as character no-undo.
      642     define input parameter p_misc5 as character no-undo.
      643     define input parameter p_this1 as decimal   no-undo.
      644     define input parameter p_this2 as decimal   no-undo.
      645     define input parameter p_this3 as decimal   no-undo.
      646     define input parameter p_this4 as decimal   no-undo.
      647     define input parameter p_this5 as decimal   no-undo.
      648     define input parameter p_this6 as decimal   no-undo.
      649   
      650     find tt_xstat exclusive-lock where tt_xstat.xid = p_xid no-error.
      651   
      652     if not available tt_xstat then
      653       do:
      654   
      655         create tt_xstat.
      656         assign
      657           tt_xstat.xvalid = yes
      658           tt_xstat.xid    = p_xid
      659           tt_xstat.xname  = p_xname
      660           tt_xstat.misc1  = p_misc1
      661           tt_xstat.misc2  = p_misc2
      662           tt_xstat.misc3  = p_misc3
      663           tt_xstat.misc4  = p_misc4
      664           tt_xstat.misc5  = p_misc5
      665           
      666   /*******************************************************************************
      667    *******************************************************************************
      668    **                                                                           **
      669    **                                                                           **
      670    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      671    **  http://www.greenfieldtech.com                                            **
      672    **                                                                           **
      673    **  ProTop is free software; you can redistribute it and/or modify it        **
      674    **  under the terms of the GNU General Public License (GPL) as published     **
      675    **  by the Free Software Foundation; either version 2 of the License, or     **
      676    **  at your option) any later version.                                       **
      677    **                                                                           **
      678    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      679    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      680    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      681    **  for more details.                                                        **
      682    **                                                                           **
      683    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      684    **  of use and alternative licensing options for this software.              **
      685    **                                                                           **
      686    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      687    **                                                                           **
      688    **  See http://www.fsf.org for more information about the GPL.               **
      689    **                                                                           **
      690    **                                                                           **
      691    *******************************************************************************
      692    *******************************************************************************
      693    *
      694    * init-xrec.i
      695    *
      696    * {1} = base field
      697    * {2} = value to initialze array with
      698    *
      699    * [1] = base
      700    * [2] = last (previous cumulative value)
      701    * [3] = this
      702    * [4] = cumulative
      703    * [5] = interval
      704    *
      705    */
      706   
      707   tt_xstat.stat1[1] = p_this1
      708   tt_xstat.stat1[2] = p_this1
      709   tt_xstat.stat1[3] = p_this1
      710    
      711           
      712   /*******************************************************************************
      713    *******************************************************************************
      714    **                                                                           **
      715    **                                                                           **
      716    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      717    **  http://www.greenfieldtech.com                                            **
      718    **                                                                           **
      719    **  ProTop is free software; you can redistribute it and/or modify it        **
      720    **  under the terms of the GNU General Public License (GPL) as published     **
      721    **  by the Free Software Foundation; either version 2 of the License, or     **
      722    **  at your option) any later version.                                       **
      723    **                                                                           **
      724    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      725    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      726    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      727    **  for more details.                                                        **
      728    **                                                                           **
      729    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      730    **  of use and alternative licensing options for this software.              **
      731    **                                                                           **
      732    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      733    **                                                                           **
      734    **  See http://www.fsf.org for more information about the GPL.               **
      735    **                                                                           **
      736    **                                                                           **
      737    *******************************************************************************
      738    *******************************************************************************
      739    *
      740    * init-xrec.i
      741    *
      742    * {1} = base field
      743    * {2} = value to initialze array with
      744    *
      745    * [1] = base
      746    * [2] = last (previous cumulative value)
      747    * [3] = this
      748    * [4] = cumulative
      749    * [5] = interval
      750    *
      751    */
      752   
      753   tt_xstat.stat2[1] = p_this2
      754   tt_xstat.stat2[2] = p_this2
      755   tt_xstat.stat2[3] = p_this2
      756    
      757           
      758   /*******************************************************************************
      759    *******************************************************************************
      760    **                                                                           **
      761    **                                                                           **
      762    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      763    **  http://www.greenfieldtech.com                                            **
      764    **                                                                           **
      765    **  ProTop is free software; you can redistribute it and/or modify it        **
      766    **  under the terms of the GNU General Public License (GPL) as published     **
      767    **  by the Free Software Foundation; either version 2 of the License, or     **
      768    **  at your option) any later version.                                       **
      769    **                                                                           **
      770    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      771    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      772    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      773    **  for more details.                                                        **
      774    **                                                                           **
      775    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      776    **  of use and alternative licensing options for this software.              **
      777    **                                                                           **
      778    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      779    **                                                                           **
      780    **  See http://www.fsf.org for more information about the GPL.               **
      781    **                                                                           **
      782    **                                                                           **
      783    *******************************************************************************
      784    *******************************************************************************
      785    *
      786    * init-xrec.i
      787    *
      788    * {1} = base field
      789    * {2} = value to initialze array with
      790    *
      791    * [1] = base
      792    * [2] = last (previous cumulative value)
      793    * [3] = this
      794    * [4] = cumulative
      795    * [5] = interval
      796    *
      797    */
      798   
      799   tt_xstat.stat3[1] = p_this3
      800   tt_xstat.stat3[2] = p_this3
      801   tt_xstat.stat3[3] = p_this3
      802    
      803           
      804   /*******************************************************************************
      805    *******************************************************************************
      806    **                                                                           **
      807    **                                                                           **
      808    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      809    **  http://www.greenfieldtech.com                                            **
      810    **                                                                           **
      811    **  ProTop is free software; you can redistribute it and/or modify it        **
      812    **  under the terms of the GNU General Public License (GPL) as published     **
      813    **  by the Free Software Foundation; either version 2 of the License, or     **
      814    **  at your option) any later version.                                       **
      815    **                                                                           **
      816    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      817    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      818    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      819    **  for more details.                                                        **
      820    **                                                                           **
      821    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      822    **  of use and alternative licensing options for this software.              **
      823    **                                                                           **
      824    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      825    **                                                                           **
      826    **  See http://www.fsf.org for more information about the GPL.               **
      827    **                                                                           **
      828    **                                                                           **
      829    *******************************************************************************
      830    *******************************************************************************
      831    *
      832    * init-xrec.i
      833    *
      834    * {1} = base field
      835    * {2} = value to initialze array with
      836    *
      837    * [1] = base
      838    * [2] = last (previous cumulative value)
      839    * [3] = this
      840    * [4] = cumulative
      841    * [5] = interval
      842    *
      843    */
      844   
      845   tt_xstat.stat4[1] = p_this4
      846   tt_xstat.stat4[2] = p_this4
      847   tt_xstat.stat4[3] = p_this4
      848    
      849           
      850   /*******************************************************************************
      851    *******************************************************************************
      852    **                                                                           **
      853    **                                                                           **
      854    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      855    **  http://www.greenfieldtech.com                                            **
      856    **                                                                           **
      857    **  ProTop is free software; you can redistribute it and/or modify it        **
      858    **  under the terms of the GNU General Public License (GPL) as published     **
      859    **  by the Free Software Foundation; either version 2 of the License, or     **
      860    **  at your option) any later version.                                       **
      861    **                                                                           **
      862    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      863    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      864    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      865    **  for more details.                                                        **
      866    **                                                                           **
      867    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      868    **  of use and alternative licensing options for this software.              **
      869    **                                                                           **
      870    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      871    **                                                                           **
      872    **  See http://www.fsf.org for more information about the GPL.               **
      873    **                                                                           **
      874    **                                                                           **
      875    *******************************************************************************
      876    *******************************************************************************
      877    *
      878    * init-xrec.i
      879    *
      880    * {1} = base field
      881    * {2} = value to initialze array with
      882    *
      883    * [1] = base
      884    * [2] = last (previous cumulative value)
      885    * [3] = this
      886    * [4] = cumulative
      887    * [5] = interval
      888    *
      889    */
      890   
      891   tt_xstat.stat5[1] = p_this5
      892   tt_xstat.stat5[2] = p_this5
      893   tt_xstat.stat5[3] = p_this5
      894    
      895           
      896   /*******************************************************************************
      897    *******************************************************************************
      898    **                                                                           **
      899    **                                                                           **
      900    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      901    **  http://www.greenfieldtech.com                                            **
      902    **                                                                           **
      903    **  ProTop is free software; you can redistribute it and/or modify it        **
      904    **  under the terms of the GNU General Public License (GPL) as published     **
      905    **  by the Free Software Foundation; either version 2 of the License, or     **
      906    **  at your option) any later version.                                       **
      907    **                                                                           **
      908    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      909    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      910    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      911    **  for more details.                                                        **
      912    **                                                                           **
      913    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      914    **  of use and alternative licensing options for this software.              **
      915    **                                                                           **
      916    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      917    **                                                                           **
      918    **  See http://www.fsf.org for more information about the GPL.               **
      919    **                                                                           **
      920    **                                                                           **
      921    *******************************************************************************
      922    *******************************************************************************
      923    *
      924    * init-xrec.i
      925    *
      926    * {1} = base field
      927    * {2} = value to initialze array with
      928    *
      929    * [1] = base
      930    * [2] = last (previous cumulative value)
      931    * [3] = this
      932    * [4] = cumulative
      933    * [5] = interval
      934    *
      935    */
      936   
      937   tt_xstat.stat6[1] = p_this6
      938   tt_xstat.stat6[2] = p_this6
      939   tt_xstat.stat6[3] = p_this6
      940    
      941         .
      942   
      943       end.
      944      else
      945       do:
      946   
      947         assign
      948           tt_xstat.xvalid   = yes                         /* is this xid active?          */
      949           tt_xstat.xname    = p_xname                     /* reuse of ids is possible...  */
      950           tt_xstat.misc1    = p_misc1
      951           tt_xstat.misc2    = p_misc2
      952           tt_xstat.misc3    = p_misc3
      953           tt_xstat.misc4    = p_misc4
      954           tt_xstat.misc5    = p_misc5
      955           tt_xstat.stat1[3] = p_this1
      956           tt_xstat.stat2[3] = p_this2
      957           tt_xstat.stat3[3] = p_this3
      958           tt_xstat.stat4[3] = p_this4
      959           tt_xstat.stat5[3] = p_this5
      960           tt_xstat.stat6[3] = p_this6
      961         .
      962   
      963         if tt_xstat.stat1[3] < tt_xstat.stat1[3] then     /* detect reuse of an id (stat rolling backwards...)    */
      964           assign
      965             tt_xstat.xname  = p_xname
      966             
      967   /*******************************************************************************
      968    *******************************************************************************
      969    **                                                                           **
      970    **                                                                           **
      971    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      972    **  http://www.greenfieldtech.com                                            **
      973    **                                                                           **
      974    **  ProTop is free software; you can redistribute it and/or modify it        **
      975    **  under the terms of the GNU General Public License (GPL) as published     **
      976    **  by the Free Software Foundation; either version 2 of the License, or     **
      977    **  at your option) any later version.                                       **
      978    **                                                                           **
      979    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      980    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      981    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      982    **  for more details.                                                        **
      983    **                                                                           **
      984    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      985    **  of use and alternative licensing options for this software.              **
      986    **                                                                           **
      987    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      988    **                                                                           **
      989    **  See http://www.fsf.org for more information about the GPL.               **
      990    **                                                                           **
      991    **                                                                           **
      992    *******************************************************************************
      993    *******************************************************************************
      994    *
      995    * init-xrec.i
      996    *
      997    * {1} = base field
      998    * {2} = value to initialze array with
      999    *
     1000    * [1] = base
     1001    * [2] = last (previous cumulative value)
     1002    * [3] = this
     1003    * [4] = cumulative
     1004    * [5] = interval
     1005    *
     1006    */
     1007   
     1008   tt_xstat.stat1[1] = p_this1
     1009   tt_xstat.stat1[2] = p_this1
     1010   tt_xstat.stat1[3] = p_this1
     1011    
     1012             
     1013   /*******************************************************************************
     1014    *******************************************************************************
     1015    **                                                                           **
     1016    **                                                                           **
     1017    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1018    **  http://www.greenfieldtech.com                                            **
     1019    **                                                                           **
     1020    **  ProTop is free software; you can redistribute it and/or modify it        **
     1021    **  under the terms of the GNU General Public License (GPL) as published     **
     1022    **  by the Free Software Foundation; either version 2 of the License, or     **
     1023    **  at your option) any later version.                                       **
     1024    **                                                                           **
     1025    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1026    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1027    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1028    **  for more details.                                                        **
     1029    **                                                                           **
     1030    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1031    **  of use and alternative licensing options for this software.              **
     1032    **                                                                           **
     1033    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1034    **                                                                           **
     1035    **  See http://www.fsf.org for more information about the GPL.               **
     1036    **                                                                           **
     1037    **                                                                           **
     1038    *******************************************************************************
     1039    *******************************************************************************
     1040    *
     1041    * init-xrec.i
     1042    *
     1043    * {1} = base field
     1044    * {2} = value to initialze array with
     1045    *
     1046    * [1] = base
     1047    * [2] = last (previous cumulative value)
     1048    * [3] = this
     1049    * [4] = cumulative
     1050    * [5] = interval
     1051    *
     1052    */
     1053   
     1054   tt_xstat.stat2[1] = p_this2
     1055   tt_xstat.stat2[2] = p_this2
     1056   tt_xstat.stat2[3] = p_this2
     1057    
     1058             
     1059   /*******************************************************************************
     1060    *******************************************************************************
     1061    **                                                                           **
     1062    **                                                                           **
     1063    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1064    **  http://www.greenfieldtech.com                                            **
     1065    **                                                                           **
     1066    **  ProTop is free software; you can redistribute it and/or modify it        **
     1067    **  under the terms of the GNU General Public License (GPL) as published     **
     1068    **  by the Free Software Foundation; either version 2 of the License, or     **
     1069    **  at your option) any later version.                                       **
     1070    **                                                                           **
     1071    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1072    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1073    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1074    **  for more details.                                                        **
     1075    **                                                                           **
     1076    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1077    **  of use and alternative licensing options for this software.              **
     1078    **                                                                           **
     1079    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1080    **                                                                           **
     1081    **  See http://www.fsf.org for more information about the GPL.               **
     1082    **                                                                           **
     1083    **                                                                           **
     1084    *******************************************************************************
     1085    *******************************************************************************
     1086    *
     1087    * init-xrec.i
     1088    *
     1089    * {1} = base field
     1090    * {2} = value to initialze array with
     1091    *
     1092    * [1] = base
     1093    * [2] = last (previous cumulative value)
     1094    * [3] = this
     1095    * [4] = cumulative
     1096    * [5] = interval
     1097    *
     1098    */
     1099   
     1100   tt_xstat.stat3[1] = p_this3
     1101   tt_xstat.stat3[2] = p_this3
     1102   tt_xstat.stat3[3] = p_this3
     1103    
     1104             
     1105   /*******************************************************************************
     1106    *******************************************************************************
     1107    **                                                                           **
     1108    **                                                                           **
     1109    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1110    **  http://www.greenfieldtech.com                                            **
     1111    **                                                                           **
     1112    **  ProTop is free software; you can redistribute it and/or modify it        **
     1113    **  under the terms of the GNU General Public License (GPL) as published     **
     1114    **  by the Free Software Foundation; either version 2 of the License, or     **
     1115    **  at your option) any later version.                                       **
     1116    **                                                                           **
     1117    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1118    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1119    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1120    **  for more details.                                                        **
     1121    **                                                                           **
     1122    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1123    **  of use and alternative licensing options for this software.              **
     1124    **                                                                           **
     1125    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1126    **                                                                           **
     1127    **  See http://www.fsf.org for more information about the GPL.               **
     1128    **                                                                           **
     1129    **                                                                           **
     1130    *******************************************************************************
     1131    *******************************************************************************
     1132    *
     1133    * init-xrec.i
     1134    *
     1135    * {1} = base field
     1136    * {2} = value to initialze array with
     1137    *
     1138    * [1] = base
     1139    * [2] = last (previous cumulative value)
     1140    * [3] = this
     1141    * [4] = cumulative
     1142    * [5] = interval
     1143    *
     1144    */
     1145   
     1146   tt_xstat.stat4[1] = p_this4
     1147   tt_xstat.stat4[2] = p_this4
     1148   tt_xstat.stat4[3] = p_this4
     1149    
     1150             
     1151   /*******************************************************************************
     1152    *******************************************************************************
     1153    **                                                                           **
     1154    **                                                                           **
     1155    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1156    **  http://www.greenfieldtech.com                                            **
     1157    **                                                                           **
     1158    **  ProTop is free software; you can redistribute it and/or modify it        **
     1159    **  under the terms of the GNU General Public License (GPL) as published     **
     1160    **  by the Free Software Foundation; either version 2 of the License, or     **
     1161    **  at your option) any later version.                                       **
     1162    **                                                                           **
     1163    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1164    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1165    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1166    **  for more details.                                                        **
     1167    **                                                                           **
     1168    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1169    **  of use and alternative licensing options for this software.              **
     1170    **                                                                           **
     1171    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1172    **                                                                           **
     1173    **  See http://www.fsf.org for more information about the GPL.               **
     1174    **                                                                           **
     1175    **                                                                           **
     1176    *******************************************************************************
     1177    *******************************************************************************
     1178    *
     1179    * init-xrec.i
     1180    *
     1181    * {1} = base field
     1182    * {2} = value to initialze array with
     1183    *
     1184    * [1] = base
     1185    * [2] = last (previous cumulative value)
     1186    * [3] = this
     1187    * [4] = cumulative
     1188    * [5] = interval
     1189    *
     1190    */
     1191   
     1192   tt_xstat.stat5[1] = p_this5
     1193   tt_xstat.stat5[2] = p_this5
     1194   tt_xstat.stat5[3] = p_this5
     1195    
     1196             
     1197   /*******************************************************************************
     1198    *******************************************************************************
     1199    **                                                                           **
     1200    **                                                                           **
     1201    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1202    **  http://www.greenfieldtech.com                                            **
     1203    **                                                                           **
     1204    **  ProTop is free software; you can redistribute it and/or modify it        **
     1205    **  under the terms of the GNU General Public License (GPL) as published     **
     1206    **  by the Free Software Foundation; either version 2 of the License, or     **
     1207    **  at your option) any later version.                                       **
     1208    **                                                                           **
     1209    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1210    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1211    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1212    **  for more details.                                                        **
     1213    **                                                                           **
     1214    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1215    **  of use and alternative licensing options for this software.              **
     1216    **                                                                           **
     1217    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1218    **                                                                           **
     1219    **  See http://www.fsf.org for more information about the GPL.               **
     1220    **                                                                           **
     1221    **                                                                           **
     1222    *******************************************************************************
     1223    *******************************************************************************
     1224    *
     1225    * init-xrec.i
     1226    *
     1227    * {1} = base field
     1228    * {2} = value to initialze array with
     1229    *
     1230    * [1] = base
     1231    * [2] = last (previous cumulative value)
     1232    * [3] = this
     1233    * [4] = cumulative
     1234    * [5] = interval
     1235    *
     1236    */
     1237   
     1238   tt_xstat.stat6[1] = p_this6
     1239   tt_xstat.stat6[2] = p_this6
     1240   tt_xstat.stat6[3] = p_this6
     1241    
     1242           .
     1243   
     1244       end.
     1245   
     1246     return.
     1247   
     1248   end.
     1249   
     1250   /* this will be called by the including procedure's mon-update procedure
     1251    *
     1252    */
     1253   
     1254   procedure age_xstat:
     1255   
     1256     define variable x as integer   no-undo.
     1257     define variable z as integer   no-undo.
     1258     define variable r as character no-undo case-sensitive initial "r".
     1259     define variable s as character no-undo case-sensitive initial "s".
     1260   
     1261     publish "get-RateRaw" ( output r ).
     1262     publish "get-SumSample" ( output s ).
     1263   
     1264     if s = "S" then
     1265       assign
     1266         x = 4
     1267         z = xtime.
     1268      else
     1269       assign
     1270         x = 5
     1271         z = itime.
     1272   
     1273     for each tt_xstat exclusive-lock:
     1274   
     1275       if tt_xstat.xvalid = no then
     1276         delete tt_xstat.
     1277        else
     1278         do:
     1279           assign
     1280             tt_xstat.xvalid = no
     1281             
     1282   /*******************************************************************************
     1283    *******************************************************************************
     1284    **                                                                           **
     1285    **                                                                           **
     1286    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1287    **  http://www.greenfieldtech.com                                            **
     1288    **                                                                           **
     1289    **  ProTop is free software; you can redistribute it and/or modify it        **
     1290    **  under the terms of the GNU General Public License (GPL) as published     **
     1291    **  by the Free Software Foundation; either version 2 of the License, or     **
     1292    **  at your option) any later version.                                       **
     1293    **                                                                           **
     1294    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1295    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1296    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1297    **  for more details.                                                        **
     1298    **                                                                           **
     1299    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1300    **  of use and alternative licensing options for this software.              **
     1301    **                                                                           **
     1302    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1303    **                                                                           **
     1304    **  See http://www.fsf.org for more information about the GPL.               **
     1305    **                                                                           **
     1306    **                                                                           **
     1307    *******************************************************************************
     1308    *******************************************************************************
     1309    *
     1310    * upd-xrec.i
     1311    *
     1312    * {1} = base field
     1313    * {2} = value to update metrics with
     1314    *
     1315    * [1] = base
     1316    * [2] = last (previous cumulative value)
     1317    * [3] = this
     1318    * [4] = cumulative
     1319    * [5] = interval
     1320    *
     1321    */
     1322   
     1323   tt_xstat.stat1[3] = tt_xstat.stat1[3]
     1324   tt_xstat.stat1[4] = tt_xstat.stat1[3] - tt_xstat.stat1[1]
     1325   tt_xstat.stat1[5] = tt_xstat.stat1[3] - tt_xstat.stat1[2]
     1326   tt_xstat.stat1[2] = tt_xstat.stat1[3]
     1327    
     1328             
     1329   /*******************************************************************************
     1330    *******************************************************************************
     1331    **                                                                           **
     1332    **                                                                           **
     1333    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1334    **  http://www.greenfieldtech.com                                            **
     1335    **                                                                           **
     1336    **  ProTop is free software; you can redistribute it and/or modify it        **
     1337    **  under the terms of the GNU General Public License (GPL) as published     **
     1338    **  by the Free Software Foundation; either version 2 of the License, or     **
     1339    **  at your option) any later version.                                       **
     1340    **                                                                           **
     1341    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1342    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1343    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1344    **  for more details.                                                        **
     1345    **                                                                           **
     1346    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1347    **  of use and alternative licensing options for this software.              **
     1348    **                                                                           **
     1349    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1350    **                                                                           **
     1351    **  See http://www.fsf.org for more information about the GPL.               **
     1352    **                                                                           **
     1353    **                                                                           **
     1354    *******************************************************************************
     1355    *******************************************************************************
     1356    *
     1357    * upd-xrec.i
     1358    *
     1359    * {1} = base field
     1360    * {2} = value to update metrics with
     1361    *
     1362    * [1] = base
     1363    * [2] = last (previous cumulative value)
     1364    * [3] = this
     1365    * [4] = cumulative
     1366    * [5] = interval
     1367    *
     1368    */
     1369   
     1370   tt_xstat.stat2[3] = tt_xstat.stat2[3]
     1371   tt_xstat.stat2[4] = tt_xstat.stat2[3] - tt_xstat.stat2[1]
     1372   tt_xstat.stat2[5] = tt_xstat.stat2[3] - tt_xstat.stat2[2]
     1373   tt_xstat.stat2[2] = tt_xstat.stat2[3]
     1374    
     1375             
     1376   /*******************************************************************************
     1377    *******************************************************************************
     1378    **                                                                           **
     1379    **                                                                           **
     1380    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1381    **  http://www.greenfieldtech.com                                            **
     1382    **                                                                           **
     1383    **  ProTop is free software; you can redistribute it and/or modify it        **
     1384    **  under the terms of the GNU General Public License (GPL) as published     **
     1385    **  by the Free Software Foundation; either version 2 of the License, or     **
     1386    **  at your option) any later version.                                       **
     1387    **                                                                           **
     1388    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1389    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1390    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1391    **  for more details.                                                        **
     1392    **                                                                           **
     1393    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1394    **  of use and alternative licensing options for this software.              **
     1395    **                                                                           **
     1396    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1397    **                                                                           **
     1398    **  See http://www.fsf.org for more information about the GPL.               **
     1399    **                                                                           **
     1400    **                                                                           **
     1401    *******************************************************************************
     1402    *******************************************************************************
     1403    *
     1404    * upd-xrec.i
     1405    *
     1406    * {1} = base field
     1407    * {2} = value to update metrics with
     1408    *
     1409    * [1] = base
     1410    * [2] = last (previous cumulative value)
     1411    * [3] = this
     1412    * [4] = cumulative
     1413    * [5] = interval
     1414    *
     1415    */
     1416   
     1417   tt_xstat.stat3[3] = tt_xstat.stat3[3]
     1418   tt_xstat.stat3[4] = tt_xstat.stat3[3] - tt_xstat.stat3[1]
     1419   tt_xstat.stat3[5] = tt_xstat.stat3[3] - tt_xstat.stat3[2]
     1420   tt_xstat.stat3[2] = tt_xstat.stat3[3]
     1421    
     1422             
     1423   /*******************************************************************************
     1424    *******************************************************************************
     1425    **                                                                           **
     1426    **                                                                           **
     1427    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1428    **  http://www.greenfieldtech.com                                            **
     1429    **                                                                           **
     1430    **  ProTop is free software; you can redistribute it and/or modify it        **
     1431    **  under the terms of the GNU General Public License (GPL) as published     **
     1432    **  by the Free Software Foundation; either version 2 of the License, or     **
     1433    **  at your option) any later version.                                       **
     1434    **                                                                           **
     1435    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1436    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1437    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1438    **  for more details.                                                        **
     1439    **                                                                           **
     1440    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1441    **  of use and alternative licensing options for this software.              **
     1442    **                                                                           **
     1443    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1444    **                                                                           **
     1445    **  See http://www.fsf.org for more information about the GPL.               **
     1446    **                                                                           **
     1447    **                                                                           **
     1448    *******************************************************************************
     1449    *******************************************************************************
     1450    *
     1451    * upd-xrec.i
     1452    *
     1453    * {1} = base field
     1454    * {2} = value to update metrics with
     1455    *
     1456    * [1] = base
     1457    * [2] = last (previous cumulative value)
     1458    * [3] = this
     1459    * [4] = cumulative
     1460    * [5] = interval
     1461    *
     1462    */
     1463   
     1464   tt_xstat.stat4[3] = tt_xstat.stat4[3]
     1465   tt_xstat.stat4[4] = tt_xstat.stat4[3] - tt_xstat.stat4[1]
     1466   tt_xstat.stat4[5] = tt_xstat.stat4[3] - tt_xstat.stat4[2]
     1467   tt_xstat.stat4[2] = tt_xstat.stat4[3]
     1468    
     1469             
     1470   /*******************************************************************************
     1471    *******************************************************************************
     1472    **                                                                           **
     1473    **                                                                           **
     1474    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1475    **  http://www.greenfieldtech.com                                            **
     1476    **                                                                           **
     1477    **  ProTop is free software; you can redistribute it and/or modify it        **
     1478    **  under the terms of the GNU General Public License (GPL) as published     **
     1479    **  by the Free Software Foundation; either version 2 of the License, or     **
     1480    **  at your option) any later version.                                       **
     1481    **                                                                           **
     1482    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1483    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1484    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1485    **  for more details.                                                        **
     1486    **                                                                           **
     1487    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1488    **  of use and alternative licensing options for this software.              **
     1489    **                                                                           **
     1490    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1491    **                                                                           **
     1492    **  See http://www.fsf.org for more information about the GPL.               **
     1493    **                                                                           **
     1494    **                                                                           **
     1495    *******************************************************************************
     1496    *******************************************************************************
     1497    *
     1498    * upd-xrec.i
     1499    *
     1500    * {1} = base field
     1501    * {2} = value to update metrics with
     1502    *
     1503    * [1] = base
     1504    * [2] = last (previous cumulative value)
     1505    * [3] = this
     1506    * [4] = cumulative
     1507    * [5] = interval
     1508    *
     1509    */
     1510   
     1511   tt_xstat.stat5[3] = tt_xstat.stat5[3]
     1512   tt_xstat.stat5[4] = tt_xstat.stat5[3] - tt_xstat.stat5[1]
     1513   tt_xstat.stat5[5] = tt_xstat.stat5[3] - tt_xstat.stat5[2]
     1514   tt_xstat.stat5[2] = tt_xstat.stat5[3]
     1515    
     1516             
     1517   /*******************************************************************************
     1518    *******************************************************************************
     1519    **                                                                           **
     1520    **                                                                           **
     1521    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1522    **  http://www.greenfieldtech.com                                            **
     1523    **                                                                           **
     1524    **  ProTop is free software; you can redistribute it and/or modify it        **
     1525    **  under the terms of the GNU General Public License (GPL) as published     **
     1526    **  by the Free Software Foundation; either version 2 of the License, or     **
     1527    **  at your option) any later version.                                       **
     1528    **                                                                           **
     1529    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1530    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1531    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1532    **  for more details.                                                        **
     1533    **                                                                           **
     1534    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1535    **  of use and alternative licensing options for this software.              **
     1536    **                                                                           **
     1537    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1538    **                                                                           **
     1539    **  See http://www.fsf.org for more information about the GPL.               **
     1540    **                                                                           **
     1541    **                                                                           **
     1542    *******************************************************************************
     1543    *******************************************************************************
     1544    *
     1545    * upd-xrec.i
     1546    *
     1547    * {1} = base field
     1548    * {2} = value to update metrics with
     1549    *
     1550    * [1] = base
     1551    * [2] = last (previous cumulative value)
     1552    * [3] = this
     1553    * [4] = cumulative
     1554    * [5] = interval
     1555    *
     1556    */
     1557   
     1558   tt_xstat.stat6[3] = tt_xstat.stat6[3]
     1559   tt_xstat.stat6[4] = tt_xstat.stat6[3] - tt_xstat.stat6[1]
     1560   tt_xstat.stat6[5] = tt_xstat.stat6[3] - tt_xstat.stat6[2]
     1561   tt_xstat.stat6[2] = tt_xstat.stat6[3]
     1562    
     1563           .
     1564   
     1565           if ratio-calc = 0 then
     1566             assign
     1567               tt_xstat.stat-ratio  = 100 * (( tt_xstat.stat1[x] - tt_xstat.stat2[x] ) / tt_xstat.stat1[x] )
     1568               tt_xstat.stat-ratio  = ( if tt_xstat.stat-ratio = ? then 0 else tt_xstat.stat-ratio )
     1569               tt_xstat.stat-ratio2  = 100 * (( tt_xstat.stat3[x] - tt_xstat.stat4[x] ) / tt_xstat.stat3[x] )
     1570               tt_xstat.stat-ratio2  = ( if tt_xstat.stat-ratio2 = ? then 0 else tt_xstat.stat-ratio2 )
     1571             .
     1572            else if ratio-calc = 1 then
     1573             assign
     1574               tt_xstat.stat-ratio  = 100 * ( tt_xstat.stat1[x] / tt_xstat.stat2[x] )
     1575               tt_xstat.stat-ratio  = ( if tt_xstat.stat-ratio = ? then 0 else tt_xstat.stat-ratio )
     1576               tt_xstat.stat-ratio2  = 100 * ( tt_xstat.stat3[x] / tt_xstat.stat4[x] )
     1577               tt_xstat.stat-ratio2  = ( if tt_xstat.stat-ratio2 = ? then 0 else tt_xstat.stat-ratio2 )
     1578             .
     1579         end.
     1580   
     1581     end.
     1582   
     1583     return.
     1584   
     1585   end.
     1586    
     1587   
     1588   define temp-table tt_seqAct no-undo
     1589     field xid       as integer   format "->>>>9"               label "Id"
     1590     field seqName   as character format "x(32)"                label "Name"
     1591     field seqCycle  as logical   format "Yes/No"               label "Cycle"
     1592     field seqInit   as int64 format "->>>>>>>>9"           label "Initial"
     1593     field seqIncr   as int64 format "->>>>>>>>9"           label "Increment"
     1594     field seqMin    as int64 format "->>>>>>>>>>>>>>9"     label "Minimum"
     1595     field seqMax    as int64 format "->>>>>>>>>>>>>>>>>>9" label "Maximum"
     1596     field seqCurr   as int64 format "->>>>>>>>>>>>>>>>>>9" label "Current"
     1597     field seqPctMax as decimal   format "->>>9.99%"            label "PctMax"
     1598     field seqPct32  as decimal   format "->>>>>>9.99%"         label "PctMax32"
     1599     field seqAct    as decimal   format ">>>>>>>>9.99"         label "Activity"
     1600   
     1601     index xid-idx       is unique xid
     1602     index seqName-idx   seqName
     1603     index seqAct-idx    seqAct descending
     1604   .
     1605   
     1606   
     1607   /* lib/dumpTT.i
     1608    *
     1609    * simplified to a single line -- include should be eliminated.
     1610    *
     1611    */
     1612   
     1613   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.1 &THEN
     1614   /*** +++
     1615   file-info:file-name = "./ptdefs".
     1616   if file-info:full-pathname <> ? and index( file-info:file-type, "d" ) > 0 and index( file-info:file-type, "w" ) > 0 then
     1617     do:
     1618   
     1619       file-info:file-name = "./ptdefs/{1}.xsd".
     1620   
     1621       if true /* file-info:full-pathname = ? or file-info:file-size = 0 */ then
     1622         do:
     1623   
     1624           temp-table {1}:write-xmlschema(
     1625             "file",
     1626   /*        substitute( "ptdefs/&1.xsd", "{1}" ), */
     1627   /*        "./ptdefs/{1}.xsd", */
     1628             ( if opsys = "unix" then "./ptdefs/{1}.xsd" else ".~\ptdefs~\{1}.xsd" ),
     1629             true
     1630   
     1631         &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.2
     1632         &THEN
     1633             , ?, ?, ?
     1634         &ENDIF
     1635   
     1636       ).
     1637   
     1638       end.
     1639   
     1640     end.
     1641    +++ ***/
     1642   &ENDIF
     1643    
     1644   
     1645   define variable maxInt   as int64 no-undo.
     1646   define variable maxInt32 as integer   no-undo.
     1647   
     1648   maxInt32 = exp( 2, 31 ) - 1.
     1649   
     1650   if "int64" <> "int64" then
     1651     maxInt = maxInt32.
     1652    else
     1653     maxInt = ( exp( 2, 63 ) - 1 ).
     1654   
     1655   procedure mon-init:
     1656   
     1657     empty temp-table tt_xstat.
     1658   
     1659     run updTick.
     1660   
     1661     return.
     1662   
     1663   end.
     1664   
     1665   
     1666   procedure mon-update:
     1667   
     1668     define input parameter argList as character no-undo.
     1669   
     1670     run updTick.
     1671   
     1672     find first dictdb._Db no-lock.
     1673   
     1674     for each dictdb._Sequence no-lock where _Sequence._Db-Recid = recid( dictdb._Db ):
     1675   
     1676       find tt_seqAct where tt_seqAct.seqName = _sequence._seq-name no-error.
     1677       if not available( tt_seqAct ) then
     1678         do:
     1679           create tt_seqAct.
     1680           create tt_xstat.
     1681           assign
     1682             tt_seqAct.seqName   = _seq-name
     1683             tt_seqAct.xId       = _seq-num
     1684             tt_seqAct.seqCycle  = _cycle-ok
     1685             tt_seqAct.seqInit   = _seq-init
     1686             tt_seqAct.seqIncr   = _seq-incr
     1687             tt_seqAct.seqMin    = _seq-min
     1688             tt_seqAct.seqMax    = ( if _seq-max = ? then maxInt else _seq-max )
     1689             tt_xstat.xid        = _seq-num
     1690           no-error.
     1691         end.
     1692   
     1693   &IF DEFINED( OE10 ) &THEN
     1694       tt_seqAct.seqCurr  = dynamic-current-value( _seq-name, ldbname(1)).
     1695   &ENDIF
     1696   
     1697       tt_seqAct.seqPctMax = ( 1 - (( tt_seqAct.seqMax - tt_seqAct.seqCurr ) / tt_seqAct.seqMax )) * 100.
     1698       tt_seqAct.seqPct32  = ( 1 - (( maxInt32 - tt_seqAct.seqCurr ) / maxInt32 )) * 100.
     1699   
     1700       run update_xstat (
     1701         input _Seq-num,
     1702         input _Seq-name,
     1703         input "m1",
     1704         input "m2",
     1705         input "m3",
     1706         input "m4",
     1707         input "m5",
     1708         input tt_seqAct.seqCurr,
     1709         input 0,
     1710         input 0,
     1711         input 0,
     1712         input 0,
     1713         input 0
     1714       ).
     1715   
     1716     end.
     1717   
     1718     run age_xstat.
     1719   
     1720     for each tt_seqAct no-lock:
     1721       find tt_xstat where tt_xstat.xid = tt_seqAct.xid no-error.    
     1722       tt_seqAct.seqAct  = tt_xstat.stat1[x] / z.
     1723     end.
     1724   
     1725     add2ds( temp-table tt_seqAct:default-buffer-handle ).
     1726   
     1727     return.
     1728   
     1729   end.
     1730   
     1731   return.
