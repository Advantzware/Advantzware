        1   /*******************************************************************************
        2    *******************************************************************************
        3    **                                                                           **
        4    **                                                                           **
        5    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
        6    **  http://www.greenfieldtech.com                                            **
        7    **                                                                           **
        8    **  ProTop is free software; you can redistribute it and/or modify it        **
        9    **  under the terms of the GNU General Public License (GPL) as published     **
       10    **  by the Free Software Foundation; either version 2 of the License, or     **
       11    **  at your option) any later version.                                       **
       12    **                                                                           **
       13    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
       14    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
       15    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
       16    **  for more details.                                                        **
       17    **                                                                           **
       18    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
       19    **  of use and alternative licensing options for this software.              **
       20    **                                                                           **
       21    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
       22    **                                                                           **
       23    **  See http://www.fsf.org for more information about the GPL.               **
       24    **                                                                           **
       25    **                                                                           **
       26    *******************************************************************************
       27    *******************************************************************************
       28    *
       29    * txe.p
       30    *
       31    *
       32    * TXE Waits.
       33    *
       34    *
       35    * Author:
       36    *
       37    *      Tom Bascom, Greenfield Technologies
       38    *      http://www.greenfieldtech.com
       39    *      January 8, 2007
       40    *
       41    */
       42   
       43   
       44   /*******************************************************************************
       45    *******************************************************************************
       46    **                                                                           **
       47    **                                                                           **
       48    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
       49    **  http://www.greenfieldtech.com                                            **
       50    **                                                                           **
       51    **  ProTop is free software; you can redistribute it and/or modify it        **
       52    **  under the terms of the GNU General Public License (GPL) as published     **
       53    **  by the Free Software Foundation; either version 2 of the License, or     **
       54    **  at your option) any later version.                                       **
       55    **                                                                           **
       56    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
       57    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
       58    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
       59    **  for more details.                                                        **
       60    **                                                                           **
       61    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
       62    **  of use and alternative licensing options for this software.              **
       63    **                                                                           **
       64    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
       65    **                                                                           **
       66    **  See http://www.fsf.org for more information about the GPL.               **
       67    **                                                                           **
       68    **                                                                           **
       69    *******************************************************************************
       70    *******************************************************************************
       71    *
       72    * protop.i
       73    *
       74    * Header file for protop family of programs
       75    *
       76    *
       77    * Known Bugs & Issues:
       78    *
       79    *
       80    * To Do:
       81    *
       82    *
       83    * Author:
       84    *
       85    *      Tom Bascom, Greenfield Technologies
       86    *      http://www.greenfieldtech.com
       87    *      August 28, 2003
       88    *
       89    */
       90   
       91   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 11.4 &THEN
       92   &global-define  FASTLOCK        true
       93   &ELSE
       94   &global-define  FASTLOCK        false
       95   &ENDIF
       96   
       97   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 11.0 &THEN
       98   &global-define  OE11            "yes"
       99   &global-define  xDEBUGTT        false
      100   &ENDIF
      101   
      102   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.2 AND PROVERSION >= "10.2B" &THEN
      103   &global-define  NOSERIALIZE     serialize-hidden
      104   &ENDIF
      105   
      106   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.1 AND PROVERSION >= "10.1B" &THEN
      107   &global-define  BIGINT          int64
      108   &ELSE
      109   &global-define  BIGINT          decimal
      110   &ENDIF
      111   
      112   
      113   /* lib/v9.i
      114    *
      115    */
      116   
      117   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) < 10.0 &THEN
      118   &global-define  CPYLOB  "no"
      119   &global-define  NOW     substitute( "&1 &2", today, string( time, "hh:mm:ss" ))
      120   &global-define  LNGCR   character
      121   &global-define  DTZ     integer
      122   &global-define  BIGINT  decimal
      123   &ELSE
      124   &global-define  OE10    "yes"
      125   &global-define  NOW     now
      126   &global-define  LNGCR   longchar
      127   &global-define  DTZ     datetime-tz
      128   &global-define  BIGINT  int64
      129   &ENDIF
      130    
      131   
      132   /* use extended _connect fields: -client, -cache*
      133    */
      134   
      135   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.1 AND PROVERSION >= "10.1C" &THEN
      136   &global-define  CONNECTX        "yes"
      137   &ELSE
      138   &global-define  CONNECTX        "no"
      139   &ENDIF
      140   
      141   define stream inStrm.
      142   
      143   define new global shared variable dbgMode as integer no-undo initial 1.
      144   
      145   /* The values for these are defined in etc/protop.cfg and set by lib/protop-cfg.p
      146    *
      147    * someday everyone will have OO and I will replace these with a gsv class
      148    * or something of that ilk
      149    *
      150    */
      151   
      152   define new global shared variable pt_shortname   as character no-undo.
      153   define new global shared variable pt_uniqName    as character no-undo.
      154   define new global shared variable pt_server      as character no-undo.
      155   define new global shared variable pt_resrcType   as character no-undo.
      156   
      157   define new global shared variable pt_tmpdir      as character no-undo initial "/tmp".
      158   define new global shared variable pt_logdir      as character no-undo initial "/tmp".
      159   define new global shared variable pt_rptdir      as character no-undo initial "/tmp".
      160   define new global shared variable pt_logname     as character no-undo initial "&5.&2.&3".
      161   define new global shared variable pt_mailcmd     as character no-undo initial 'mailx "-s &1" '.
      162   
      163   define new global shared variable pt_votrx       as integer   no-undo initial 1800.
      164   define new global shared variable pt_lktbllim    as integer   no-undo initial 0.
      165   define new global shared variable pt_bkupstale   as integer   no-undo initial 26.
      166   define new global shared variable pt_bogomips    as integer   no-undo initial 1000000.
      167   define new global shared variable pt_ioresp      as integer   no-undo initial 100.
      168   define new global shared variable pt_ioFileName  as character no-undo.
      169   define new global shared variable pt_dfCmd       as character no-undo.
      170   
      171   define new global shared variable pt_AICheckInterval   as integer no-undo initial 60.
      172   define new global shared variable pt_PICACheckInterval as integer no-undo initial 60.
      173   define new global shared variable pt_appsrvStuck       as integer no-undo initial 120.
      174   
      175   define new global shared variable pt_bibkupAlert as integer   no-undo.          /* alert on long bi backup phase                */
      176   define new global shared variable pt_bibkupAlarm as integer   no-undo.          /* alarm on long bi backup phase                */
      177   define new global shared variable pt_bibkupPage  as integer   no-undo.          /* page  on long bi backup phase                */
      178   
      179   define new global shared variable pt_bkupAlert   as integer   no-undo.          /* alert on long db backup                      */
      180   define new global shared variable pt_bkupAlarm   as integer   no-undo.          /* alarm on long db backup                      */
      181   define new global shared variable pt_bkupPage    as integer   no-undo.          /* page  on long db backup                      */
      182   
      183   define new global shared variable pt_userLock    as logical   no-undo.          /* enable _userLock  data?                      */
      184   define new global shared variable pt_doZippy     as logical   no-undo.          /* enable "user experience" (aka "zippy")?      */
      185   define new global shared variable pt_useRFUtil   as logical   no-undo.          /* use rfutil to gather after-imaging status?   */
      186   
      187   define new global shared variable pt_updAreaData as integer   no-undo.          /* how often should we report storage area xref details from dbanalys? */
      188   
      189   define new global shared variable pt_zoomTo      as integer no-undo.            /* new zoomed monInt                            */
      190   
      191   define new global shared variable ptDBName     as character no-undo.                    /* the db logical name          */
      192   define new global shared variable rowLimit     as integer   no-undo initial 100.        /* 50?                          */
      193   
      194   /* do-sumSample() manipulates these -- ugly, ugly, ugly... (obsolete?)
      195    * 
      196    */
      197   
      198   define new global shared variable stime as integer no-undo.                     /* start time                           */
      199   define new global shared variable ltime as integer no-undo.                     /* last time                            */
      200   define new global shared variable xtime as integer no-undo.                     /* total time                           */
      201   define new global shared variable itime as integer no-undo.                     /* iteration time                       */
      202   
      203   define new global shared variable chkp-base   as integer no-undo initial ?.     /* cover for the lack of a VST field    */
      204   
      205                                                                                   /* corresponding to base checkpoint#    */
      206   /** Global Shared Temp Table Definitions
      207    **
      208    ** Yup, they're shared.  But this stuff makes no sense across session boundaries anyway.
      209    ** And a shared temp-table is logically the same as a db table so who really cares?
      210    **
      211    **/
      212   
      213   /* cache _File and _Index records so that we don't keep hitting the db to translate
      214    */
      215   
      216   define new global shared temp-table tt_tbl no-undo
      217     field xid      as integer                                             /* _File._File-Num              */
      218     field tstatid  as integer                                             /* _TableStat._TableStat-Id     */
      219     field areaNum  as integer                                             /* _Storage-Object._Area-Number */
      220     field tblPool  as character                                           /* get-bits( _object-attrib, 7, 1 ) = 1 */
      221     field tblname  as character                                           /* _File._File-Name             */
      222     index xid-idx is unique primary xid.
      223   
      224   define new global shared temp-table tt_idx no-undo
      225     field xid      as integer                                             /* _Index._Idx-Num              */
      226     field istatid  as integer                                             /* _IndexStat._IndexStat-Id     */
      227     field idxname  as character                                           /* _Index._Idx-Name             */
      228     field idxnote  as character
      229     field idxRoot  as int64                                           /* _Storage-Object._Object-Root */
      230     field tblnum   as integer                                             /* _File._File-Num              */
      231     field areaNum  as integer                                             /* _Storage-Object._Area-Number */
      232     field idxPool  as character                                           /* get-bits( _object-attrib, 7, 1 ) = 1 */
      233     field tblname  as character                                           /* _File._File-Name             */
      234     index xid-idx is unique primary xid.
      235   
      236   define new global shared temp-table tt_areaExtent no-undo
      237     field areaNum  as integer                                             /* _areaExtent._Area-Number     */
      238     field extNum   as integer                                             /* _areaExtent._Extent-Number   */
      239   
      240     field extSize  as decimal                                             /* _areaExtent._Extent-Size     */
      241     field extType  as integer                                             /* _areaExtent._Extent-Type     */
      242     field extPath  as character                                           /* _areaExtent._Extent-Path     */
      243   
      244     index ae-idx is unique primary areaNum extNum.
      245   
      246   define new global shared temp-table tt_area no-undo
      247     field xid      as integer    format ">>>9"
      248     field SANum    as integer    format ">>>9"        label "#"
      249     field areaPool as character  format "x(2)"        label "BX"
      250   /*field areaStatus-Id as {&BIGINT} format ">>>9"    label "Id" */
      251     field SAName   as character  format "x(30)"       label "Area Name"
      252     field allocGB  as decimal    format ">>>>>9.99"   label "Allocated"
      253     field varGB    as decimal    format ">>>>>9.99"   label "Variable"
      254     field totGB    as decimal    format ">>>>>>9.99"  label "Tot GB"
      255     field hiGB     as decimal    format ">>>>>9.99"   label "Hi Water" serialize-hidden
      256     field freeGB   as decimal    format ">>>>>9.99"   label "Free GB"
      257     field pctAlloc as decimal    format ">>>>>9%"     label "%Alloc"
      258     field pctLastX as decimal    format ">>>>9%"      label "%LastX"
      259   
      260     field blkszkb as integer     format ">>9"         label "BSZ"
      261     field rpb     as integer     format ">>9"         label "RPB"
      262     field clstrsz as integer     format ">>9"         label "CSZ"
      263   
      264     field numTbls as integer     format ">>>>9"       label "#Tbls"
      265     field numIdxs as integer     format ">>>>9"       label "#Idxs"
      266     field numLOBs as integer     format ">>>>9"       label "#LOBs"
      267   
      268     field numExts as integer     format ">>>>9"       label "#Exts"
      269     field hasVar  as logical     format "Yes/No"      label "Var?"
      270   
      271     field xnote   as character   format "x"           label "*"
      272   
      273     field areaMaxPct as decimal  format ">>9.999%"    label "Max%"
      274     field idx3264    as decimal  format ">>9.999%"    label "Bug%"
      275   
      276     index pctAlloc-idx is primary pctAlloc descending
      277     index pctLastX-idx pctLastX pctAlloc descending
      278     index allocGB-idx allocGB descending
      279     index totGB-idx totGB descending
      280     index xid-idx is unique xid
      281     index SANum-idx is unique SANum
      282     index SAName-idx is unique SAName
      283   .
      284   
      285   *** Encrypted Source ***
      286   *** Encrypted Source ***
      287   *** Encrypted Source ***
      288   *** Encrypted Source ***
      289   *** Encrypted Source ***
      290   *** Encrypted Source ***
      291   *** Encrypted Source ***
      292   *** Encrypted Source ***
      293   *** Encrypted Source ***
      294   *** Encrypted Source ***
      295   *** Encrypted Source ***
      296   *** Encrypted Source ***
      297   *** Encrypted Source ***
      298   *** Encrypted Source ***
      299   *** Encrypted Source ***
      300   *** Encrypted Source ***
      301   *** Encrypted Source ***
      302   *** Encrypted Source ***
      303   *** Encrypted Source ***
      304   *** Encrypted Source ***
      305   *** Encrypted Source ***
      306   *** Encrypted Source ***
      307   *** Encrypted Source ***
      308   *** Encrypted Source ***
      309   *** Encrypted Source ***
      310   *** Encrypted Source ***
      311   *** Encrypted Source ***
      312   *** Encrypted Source ***
      313   *** Encrypted Source ***
      314   *** Encrypted Source ***
      315   *** Encrypted Source ***
      316   *** Encrypted Source ***
      317   *** Encrypted Source ***
      318   *** Encrypted Source ***
      319   *** Encrypted Source ***
      320   *** Encrypted Source ***
      321   *** Encrypted Source ***
      322   *** Encrypted Source ***
      323   *** Encrypted Source ***
      324   *** Encrypted Source ***
      325   *** Encrypted Source ***
      326   *** Encrypted Source ***
      327   *** Encrypted Source ***
      328   *** Encrypted Source ***
      329   *** Encrypted Source ***
      330   *** Encrypted Source ***
      331   *** Encrypted Source ***
      332   *** Encrypted Source ***
      333   *** Encrypted Source ***
      334   *** Encrypted Source ***
      335   *** Encrypted Source ***
      336   *** Encrypted Source ***
      337   *** Encrypted Source ***
      338   *** Encrypted Source ***
      339   *** Encrypted Source ***
      340   *** Encrypted Source ***
      341   *** Encrypted Source ***
      342   *** Encrypted Source ***
      343   *** Encrypted Source ***
      344   *** Encrypted Source ***
      345   *** Encrypted Source ***
      346   *** Encrypted Source ***
      347   *** Encrypted Source ***
      348   *** Encrypted Source ***
      349   *** Encrypted Source ***
      350   *** Encrypted Source ***
      351   *** Encrypted Source ***
      352   *** Encrypted Source ***
      353   *** Encrypted Source ***
      354   *** Encrypted Source ***
      355    
      356   
      357   /*******************************************************************************
      358    *******************************************************************************
      359    **                                                                           **
      360    **                                                                           **
      361    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      362    **  http://www.greenfieldtech.com                                            **
      363    **                                                                           **
      364    **  ProTop is free software; you can redistribute it and/or modify it        **
      365    **  under the terms of the GNU General Public License (GPL) as published     **
      366    **  by the Free Software Foundation; either version 2 of the License, or     **
      367    **  at your option) any later version.                                       **
      368    **                                                                           **
      369    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      370    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      371    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      372    **  for more details.                                                        **
      373    **                                                                           **
      374    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      375    **  of use and alternative licensing options for this software.              **
      376    **                                                                           **
      377    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      378    **                                                                           **
      379    **  See http://www.fsf.org for more information about the GPL.               **
      380    **                                                                           **
      381    **                                                                           **
      382    *******************************************************************************
      383    *******************************************************************************
      384    *
      385    * protoplib.i
      386    *
      387    * ProTop infrastructure library definitions
      388    *
      389    */
      390   
      391   function uDateTime returns integer () in super.
      392   function string2uDateTime returns integer( input p_text as character ) in super.
      393   function searchDir returns character ( input xDir as character ) in super.
      394   function unsignMe returns decimal ( input s as decimal, input i as integer ) in super.
      395   function hr returns decimal ( input lr as decimal, input osr as decimal, output hr-str as character, output hr as decimal, output mr as decimal ) in super.
      396   function do-SumSample returns logical ( output p_index as integer, output p_time  as integer ) in super.
      397   function myPID returns character () in super.
      398   function hilite returns logical ( input b as handle, input p_metric as character, input p_value as character, output p_attr as character ) in super.
      399   
      400   /* end protoplib.i */
      401    
      402   
      403   /*******************************************************************************
      404    *******************************************************************************
      405    **                                                                           **
      406    **                                                                           **
      407    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      408    **  http://www.greenfieldtech.com                                            **
      409    **                                                                           **
      410    **  ProTop is free software; you can redistribute it and/or modify it        **
      411    **  under the terms of the GNU General Public License (GPL) as published     **
      412    **  by the Free Software Foundation; either version 2 of the License, or     **
      413    **  at your option) any later version.                                       **
      414    **                                                                           **
      415    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      416    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      417    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      418    **  for more details.                                                        **
      419    **                                                                           **
      420    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      421    **  of use and alternative licensing options for this software.              **
      422    **                                                                           **
      423    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      424    **                                                                           **
      425    **  See http://www.fsf.org for more information about the GPL.               **
      426    **                                                                           **
      427    **                                                                           **
      428    *******************************************************************************
      429    *******************************************************************************
      430    *
      431    * vstlib.i
      432    *
      433    * VST library definitions
      434    *
      435    */
      436   
      437   function aiInfo returns character ( input vAiFile as character, output vAiGenNum as integer ) in super.
      438   function chkai returns integer ( output ai_exts as integer, output ai_full as integer, output ai_empty as integer ) in super.
      439   function chkarea returns integer ( input threshold as decimal, output worst as decimal ) in super.
      440   function chkptNum returns integer ( input-output oldbi as integer ) in super.
      441   
      442   function connectFlags returns character ( input cnxId as integer ) in super.
      443   function connectName returns character ( input cnxId as integer, input cnxFlags as character ) in super.
      444   function lastStatement returns character( input cnxId as integer, output lineNum as integer, output procName as character ) in super.
      445   
      446   function isAIEnabled returns logical () in super.
      447   function isReplSource returns logical () in super.
      448   function isReplTarget returns logical () in super.
      449   function isBackupRunning returns logical () in super.
      450   function isWorkgroup returns logical () in super.
      451   
      452   function getStartupX returns character ( input v as character, input p1 as character, input p2 as character ) in super.
      453   
      454   /* end vstlib.i */
      455    
      456   
      457   function add2ds returns logical ( input h as handle ) in super.
      458   function getTempTableHandle returns handle ( input n as character ) in super.
      459   
      460   /* end protop.i */
      461    
      462   
      463   /*******************************************************************************
      464    *******************************************************************************
      465    **                                                                           **
      466    **                                                                           **
      467    **  Copyright 2003-2012 Tom Bascom, Greenfield Technologies                  **
      468    **  http://www.greenfieldtech.com                                            **
      469    **                                                                           **
      470    **  ProTop is free software; you can redistribute it and/or modify it        **
      471    **  under the terms of the GNU General Public License (GPL) as published     **
      472    **  by the Free Software Foundation; either version 2 of the License, or     **
      473    **  at your option) any later version.                                       **
      474    **                                                                           **
      475    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      476    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      477    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      478    **  for more details.                                                        **
      479    **                                                                           **
      480    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      481    **  of use and alternative licensing options for this software.              **
      482    **                                                                           **
      483    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      484    **                                                                           **
      485    **  See http://www.fsf.org for more information about the GPL.               **
      486    **                                                                           **
      487    **                                                                           **
      488    *******************************************************************************
      489    *******************************************************************************
      490    *
      491    * tick.i
      492    *
      493    *
      494    * common routine to handle "clock ticks"
      495    *
      496    *
      497    * Author:
      498    *
      499    *      Tom Bascom, Greenfield Technologies
      500    *      http://www.greenfieldtech.com
      501    *      January 21, 2012
      502    *
      503    */
      504   
      505   
      506   /* lib/v9.i
      507    *
      508    */
      509   
      510   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) < 10.0 &THEN
      511   &global-define  CPYLOB  "no"
      512   &global-define  NOW     substitute( "&1 &2", today, string( time, "hh:mm:ss" ))
      513   &global-define  LNGCR   character
      514   &global-define  DTZ     integer
      515   &global-define  BIGINT  decimal
      516   &ELSE
      517   &global-define  OE10    "yes"
      518   &global-define  NOW     now
      519   &global-define  LNGCR   longchar
      520   &global-define  DTZ     datetime-tz
      521   &global-define  BIGINT  int64
      522   &ENDIF
      523    
      524   
      525   define new global shared variable rawMode  as integer no-undo initial 5.
      526   define new global shared variable timeMode as integer no-undo initial 2.
      527   
      528   define new global shared variable x as integer no-undo initial 5.
      529   define new global shared variable z as decimal no-undo.
      530   
      531   define variable y as decimal no-undo.
      532   
      533   define variable initTick as integer no-undo.
      534   define variable prevTick as integer no-undo.
      535   
      536   
      537   procedure updTick:
      538   
      539   &IF DEFINED( OE10 ) &THEN
      540     if initTick = 0 then initTick = mtime.
      541     assign
      542       x = rawMode /* ( if rawMode then 4 else 5 ) */
      543       z = mtime - prevTick
      544       z = ( if z >= 0 then z else 86400000 - prevTick + mtime )   /* handle rolling over midnight */
      545       z = z / 1000
      546       y = mtime - initTick
      547       y = y / 1000
      548       prevTick = mtime
      549     .
      550   &ELSE
      551     if initTick = 0 then initTick = etime.
      552     assign
      553       x = rawMode /* ( if rawMode then 4 else 5 ) */
      554       z = etime - prevTick
      555       z = ( if z >= 0 then z else 5000 )   /* etime doesn't rollover at midnite -- but a mistaken etime(yes) somewhere would be bad... */
      556       z = z / 1000
      557       y = etime - initTick
      558       y = y / 1000
      559       prevTick = etime
      560     .
      561   &ENDIF
      562   
      563     /* if rawMode <> 5 then z = 1. */
      564   
      565     if timeMode = 1 then z = 1.
      566   
      567     return.
      568   
      569   end.
      570   
      571   /* end tick.i */
      572    
      573   
      574   define output parameter dcDescription as character no-undo initial "TXE".
      575   
      576   define variable X_TXE-Type as character no-undo extent 9.
      577   
      578   
      579   /*******************************************************************************
      580    *******************************************************************************
      581    **                                                                           **
      582    **                                                                           **
      583    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      584    **  http://www.greenfieldtech.com                                            **
      585    **                                                                           **
      586    **  ProTop is free software; you can redistribute it and/or modify it        **
      587    **  under the terms of the GNU General Public License (GPL) as published     **
      588    **  by the Free Software Foundation; either version 2 of the License, or     **
      589    **  at your option) any later version.                                       **
      590    **                                                                           **
      591    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      592    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      593    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      594    **  for more details.                                                        **
      595    **                                                                           **
      596    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      597    **  of use and alternative licensing options for this software.              **
      598    **                                                                           **
      599    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      600    **                                                                           **
      601    **  See http://www.fsf.org for more information about the GPL.               **
      602    **                                                                           **
      603    **                                                                           **
      604    *******************************************************************************
      605    *******************************************************************************
      606    *
      607    * tt_xstat.i
      608    *
      609    */
      610   
      611   define variable ratio-calc as integer no-undo.
      612   
      613   define temp-table tt_xstat no-undo
      614     field xid       as integer
      615     field xvalid    as logical
      616     field xname     as character
      617     field misc1     as character
      618     field misc2     as character
      619     field misc3     as character
      620     field misc4     as character
      621     field misc5     as character
      622     field stat1     as decimal extent 5
      623     field stat2     as decimal extent 5
      624     field stat3     as decimal extent 5
      625     field stat4     as decimal extent 5
      626     field stat5     as decimal extent 5
      627     field stat6     as decimal extent 5
      628     field stat-ratio  as decimal
      629     field stat-ratio2 as decimal
      630     index xid-idx is unique primary xid.
      631   
      632   /* this will be called by the including procedure's mon-update procedure
      633    *
      634    */
      635   
      636   procedure update_xstat:
      637   
      638     define input parameter p_xid   as integer   no-undo.
      639     define input parameter p_xname as character no-undo.
      640     define input parameter p_misc1 as character no-undo.
      641     define input parameter p_misc2 as character no-undo.
      642     define input parameter p_misc3 as character no-undo.
      643     define input parameter p_misc4 as character no-undo.
      644     define input parameter p_misc5 as character no-undo.
      645     define input parameter p_this1 as decimal   no-undo.
      646     define input parameter p_this2 as decimal   no-undo.
      647     define input parameter p_this3 as decimal   no-undo.
      648     define input parameter p_this4 as decimal   no-undo.
      649     define input parameter p_this5 as decimal   no-undo.
      650     define input parameter p_this6 as decimal   no-undo.
      651   
      652     find tt_xstat exclusive-lock where tt_xstat.xid = p_xid no-error.
      653   
      654     if not available tt_xstat then
      655       do:
      656   
      657         create tt_xstat.
      658         assign
      659           tt_xstat.xvalid = yes
      660           tt_xstat.xid    = p_xid
      661           tt_xstat.xname  = p_xname
      662           tt_xstat.misc1  = p_misc1
      663           tt_xstat.misc2  = p_misc2
      664           tt_xstat.misc3  = p_misc3
      665           tt_xstat.misc4  = p_misc4
      666           tt_xstat.misc5  = p_misc5
      667           
      668   /*******************************************************************************
      669    *******************************************************************************
      670    **                                                                           **
      671    **                                                                           **
      672    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      673    **  http://www.greenfieldtech.com                                            **
      674    **                                                                           **
      675    **  ProTop is free software; you can redistribute it and/or modify it        **
      676    **  under the terms of the GNU General Public License (GPL) as published     **
      677    **  by the Free Software Foundation; either version 2 of the License, or     **
      678    **  at your option) any later version.                                       **
      679    **                                                                           **
      680    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      681    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      682    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      683    **  for more details.                                                        **
      684    **                                                                           **
      685    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      686    **  of use and alternative licensing options for this software.              **
      687    **                                                                           **
      688    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      689    **                                                                           **
      690    **  See http://www.fsf.org for more information about the GPL.               **
      691    **                                                                           **
      692    **                                                                           **
      693    *******************************************************************************
      694    *******************************************************************************
      695    *
      696    * init-xrec.i
      697    *
      698    * {1} = base field
      699    * {2} = value to initialze array with
      700    *
      701    * [1] = base
      702    * [2] = last (previous cumulative value)
      703    * [3] = this
      704    * [4] = cumulative
      705    * [5] = interval
      706    *
      707    */
      708   
      709   tt_xstat.stat1[1] = p_this1
      710   tt_xstat.stat1[2] = p_this1
      711   tt_xstat.stat1[3] = p_this1
      712    
      713           
      714   /*******************************************************************************
      715    *******************************************************************************
      716    **                                                                           **
      717    **                                                                           **
      718    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      719    **  http://www.greenfieldtech.com                                            **
      720    **                                                                           **
      721    **  ProTop is free software; you can redistribute it and/or modify it        **
      722    **  under the terms of the GNU General Public License (GPL) as published     **
      723    **  by the Free Software Foundation; either version 2 of the License, or     **
      724    **  at your option) any later version.                                       **
      725    **                                                                           **
      726    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      727    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      728    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      729    **  for more details.                                                        **
      730    **                                                                           **
      731    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      732    **  of use and alternative licensing options for this software.              **
      733    **                                                                           **
      734    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      735    **                                                                           **
      736    **  See http://www.fsf.org for more information about the GPL.               **
      737    **                                                                           **
      738    **                                                                           **
      739    *******************************************************************************
      740    *******************************************************************************
      741    *
      742    * init-xrec.i
      743    *
      744    * {1} = base field
      745    * {2} = value to initialze array with
      746    *
      747    * [1] = base
      748    * [2] = last (previous cumulative value)
      749    * [3] = this
      750    * [4] = cumulative
      751    * [5] = interval
      752    *
      753    */
      754   
      755   tt_xstat.stat2[1] = p_this2
      756   tt_xstat.stat2[2] = p_this2
      757   tt_xstat.stat2[3] = p_this2
      758    
      759           
      760   /*******************************************************************************
      761    *******************************************************************************
      762    **                                                                           **
      763    **                                                                           **
      764    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      765    **  http://www.greenfieldtech.com                                            **
      766    **                                                                           **
      767    **  ProTop is free software; you can redistribute it and/or modify it        **
      768    **  under the terms of the GNU General Public License (GPL) as published     **
      769    **  by the Free Software Foundation; either version 2 of the License, or     **
      770    **  at your option) any later version.                                       **
      771    **                                                                           **
      772    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      773    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      774    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      775    **  for more details.                                                        **
      776    **                                                                           **
      777    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      778    **  of use and alternative licensing options for this software.              **
      779    **                                                                           **
      780    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      781    **                                                                           **
      782    **  See http://www.fsf.org for more information about the GPL.               **
      783    **                                                                           **
      784    **                                                                           **
      785    *******************************************************************************
      786    *******************************************************************************
      787    *
      788    * init-xrec.i
      789    *
      790    * {1} = base field
      791    * {2} = value to initialze array with
      792    *
      793    * [1] = base
      794    * [2] = last (previous cumulative value)
      795    * [3] = this
      796    * [4] = cumulative
      797    * [5] = interval
      798    *
      799    */
      800   
      801   tt_xstat.stat3[1] = p_this3
      802   tt_xstat.stat3[2] = p_this3
      803   tt_xstat.stat3[3] = p_this3
      804    
      805           
      806   /*******************************************************************************
      807    *******************************************************************************
      808    **                                                                           **
      809    **                                                                           **
      810    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      811    **  http://www.greenfieldtech.com                                            **
      812    **                                                                           **
      813    **  ProTop is free software; you can redistribute it and/or modify it        **
      814    **  under the terms of the GNU General Public License (GPL) as published     **
      815    **  by the Free Software Foundation; either version 2 of the License, or     **
      816    **  at your option) any later version.                                       **
      817    **                                                                           **
      818    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      819    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      820    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      821    **  for more details.                                                        **
      822    **                                                                           **
      823    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      824    **  of use and alternative licensing options for this software.              **
      825    **                                                                           **
      826    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      827    **                                                                           **
      828    **  See http://www.fsf.org for more information about the GPL.               **
      829    **                                                                           **
      830    **                                                                           **
      831    *******************************************************************************
      832    *******************************************************************************
      833    *
      834    * init-xrec.i
      835    *
      836    * {1} = base field
      837    * {2} = value to initialze array with
      838    *
      839    * [1] = base
      840    * [2] = last (previous cumulative value)
      841    * [3] = this
      842    * [4] = cumulative
      843    * [5] = interval
      844    *
      845    */
      846   
      847   tt_xstat.stat4[1] = p_this4
      848   tt_xstat.stat4[2] = p_this4
      849   tt_xstat.stat4[3] = p_this4
      850    
      851           
      852   /*******************************************************************************
      853    *******************************************************************************
      854    **                                                                           **
      855    **                                                                           **
      856    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      857    **  http://www.greenfieldtech.com                                            **
      858    **                                                                           **
      859    **  ProTop is free software; you can redistribute it and/or modify it        **
      860    **  under the terms of the GNU General Public License (GPL) as published     **
      861    **  by the Free Software Foundation; either version 2 of the License, or     **
      862    **  at your option) any later version.                                       **
      863    **                                                                           **
      864    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      865    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      866    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      867    **  for more details.                                                        **
      868    **                                                                           **
      869    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      870    **  of use and alternative licensing options for this software.              **
      871    **                                                                           **
      872    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      873    **                                                                           **
      874    **  See http://www.fsf.org for more information about the GPL.               **
      875    **                                                                           **
      876    **                                                                           **
      877    *******************************************************************************
      878    *******************************************************************************
      879    *
      880    * init-xrec.i
      881    *
      882    * {1} = base field
      883    * {2} = value to initialze array with
      884    *
      885    * [1] = base
      886    * [2] = last (previous cumulative value)
      887    * [3] = this
      888    * [4] = cumulative
      889    * [5] = interval
      890    *
      891    */
      892   
      893   tt_xstat.stat5[1] = p_this5
      894   tt_xstat.stat5[2] = p_this5
      895   tt_xstat.stat5[3] = p_this5
      896    
      897           
      898   /*******************************************************************************
      899    *******************************************************************************
      900    **                                                                           **
      901    **                                                                           **
      902    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      903    **  http://www.greenfieldtech.com                                            **
      904    **                                                                           **
      905    **  ProTop is free software; you can redistribute it and/or modify it        **
      906    **  under the terms of the GNU General Public License (GPL) as published     **
      907    **  by the Free Software Foundation; either version 2 of the License, or     **
      908    **  at your option) any later version.                                       **
      909    **                                                                           **
      910    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      911    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      912    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      913    **  for more details.                                                        **
      914    **                                                                           **
      915    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      916    **  of use and alternative licensing options for this software.              **
      917    **                                                                           **
      918    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      919    **                                                                           **
      920    **  See http://www.fsf.org for more information about the GPL.               **
      921    **                                                                           **
      922    **                                                                           **
      923    *******************************************************************************
      924    *******************************************************************************
      925    *
      926    * init-xrec.i
      927    *
      928    * {1} = base field
      929    * {2} = value to initialze array with
      930    *
      931    * [1] = base
      932    * [2] = last (previous cumulative value)
      933    * [3] = this
      934    * [4] = cumulative
      935    * [5] = interval
      936    *
      937    */
      938   
      939   tt_xstat.stat6[1] = p_this6
      940   tt_xstat.stat6[2] = p_this6
      941   tt_xstat.stat6[3] = p_this6
      942    
      943         .
      944   
      945       end.
      946      else
      947       do:
      948   
      949         assign
      950           tt_xstat.xvalid   = yes                         /* is this xid active?          */
      951           tt_xstat.xname    = p_xname                     /* reuse of ids is possible...  */
      952           tt_xstat.misc1    = p_misc1
      953           tt_xstat.misc2    = p_misc2
      954           tt_xstat.misc3    = p_misc3
      955           tt_xstat.misc4    = p_misc4
      956           tt_xstat.misc5    = p_misc5
      957           tt_xstat.stat1[3] = p_this1
      958           tt_xstat.stat2[3] = p_this2
      959           tt_xstat.stat3[3] = p_this3
      960           tt_xstat.stat4[3] = p_this4
      961           tt_xstat.stat5[3] = p_this5
      962           tt_xstat.stat6[3] = p_this6
      963         .
      964   
      965         if tt_xstat.stat1[3] < tt_xstat.stat1[3] then     /* detect reuse of an id (stat rolling backwards...)    */
      966           assign
      967             tt_xstat.xname  = p_xname
      968             
      969   /*******************************************************************************
      970    *******************************************************************************
      971    **                                                                           **
      972    **                                                                           **
      973    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      974    **  http://www.greenfieldtech.com                                            **
      975    **                                                                           **
      976    **  ProTop is free software; you can redistribute it and/or modify it        **
      977    **  under the terms of the GNU General Public License (GPL) as published     **
      978    **  by the Free Software Foundation; either version 2 of the License, or     **
      979    **  at your option) any later version.                                       **
      980    **                                                                           **
      981    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      982    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      983    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      984    **  for more details.                                                        **
      985    **                                                                           **
      986    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      987    **  of use and alternative licensing options for this software.              **
      988    **                                                                           **
      989    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      990    **                                                                           **
      991    **  See http://www.fsf.org for more information about the GPL.               **
      992    **                                                                           **
      993    **                                                                           **
      994    *******************************************************************************
      995    *******************************************************************************
      996    *
      997    * init-xrec.i
      998    *
      999    * {1} = base field
     1000    * {2} = value to initialze array with
     1001    *
     1002    * [1] = base
     1003    * [2] = last (previous cumulative value)
     1004    * [3] = this
     1005    * [4] = cumulative
     1006    * [5] = interval
     1007    *
     1008    */
     1009   
     1010   tt_xstat.stat1[1] = p_this1
     1011   tt_xstat.stat1[2] = p_this1
     1012   tt_xstat.stat1[3] = p_this1
     1013    
     1014             
     1015   /*******************************************************************************
     1016    *******************************************************************************
     1017    **                                                                           **
     1018    **                                                                           **
     1019    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1020    **  http://www.greenfieldtech.com                                            **
     1021    **                                                                           **
     1022    **  ProTop is free software; you can redistribute it and/or modify it        **
     1023    **  under the terms of the GNU General Public License (GPL) as published     **
     1024    **  by the Free Software Foundation; either version 2 of the License, or     **
     1025    **  at your option) any later version.                                       **
     1026    **                                                                           **
     1027    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1028    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1029    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1030    **  for more details.                                                        **
     1031    **                                                                           **
     1032    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1033    **  of use and alternative licensing options for this software.              **
     1034    **                                                                           **
     1035    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1036    **                                                                           **
     1037    **  See http://www.fsf.org for more information about the GPL.               **
     1038    **                                                                           **
     1039    **                                                                           **
     1040    *******************************************************************************
     1041    *******************************************************************************
     1042    *
     1043    * init-xrec.i
     1044    *
     1045    * {1} = base field
     1046    * {2} = value to initialze array with
     1047    *
     1048    * [1] = base
     1049    * [2] = last (previous cumulative value)
     1050    * [3] = this
     1051    * [4] = cumulative
     1052    * [5] = interval
     1053    *
     1054    */
     1055   
     1056   tt_xstat.stat2[1] = p_this2
     1057   tt_xstat.stat2[2] = p_this2
     1058   tt_xstat.stat2[3] = p_this2
     1059    
     1060             
     1061   /*******************************************************************************
     1062    *******************************************************************************
     1063    **                                                                           **
     1064    **                                                                           **
     1065    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1066    **  http://www.greenfieldtech.com                                            **
     1067    **                                                                           **
     1068    **  ProTop is free software; you can redistribute it and/or modify it        **
     1069    **  under the terms of the GNU General Public License (GPL) as published     **
     1070    **  by the Free Software Foundation; either version 2 of the License, or     **
     1071    **  at your option) any later version.                                       **
     1072    **                                                                           **
     1073    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1074    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1075    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1076    **  for more details.                                                        **
     1077    **                                                                           **
     1078    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1079    **  of use and alternative licensing options for this software.              **
     1080    **                                                                           **
     1081    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1082    **                                                                           **
     1083    **  See http://www.fsf.org for more information about the GPL.               **
     1084    **                                                                           **
     1085    **                                                                           **
     1086    *******************************************************************************
     1087    *******************************************************************************
     1088    *
     1089    * init-xrec.i
     1090    *
     1091    * {1} = base field
     1092    * {2} = value to initialze array with
     1093    *
     1094    * [1] = base
     1095    * [2] = last (previous cumulative value)
     1096    * [3] = this
     1097    * [4] = cumulative
     1098    * [5] = interval
     1099    *
     1100    */
     1101   
     1102   tt_xstat.stat3[1] = p_this3
     1103   tt_xstat.stat3[2] = p_this3
     1104   tt_xstat.stat3[3] = p_this3
     1105    
     1106             
     1107   /*******************************************************************************
     1108    *******************************************************************************
     1109    **                                                                           **
     1110    **                                                                           **
     1111    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1112    **  http://www.greenfieldtech.com                                            **
     1113    **                                                                           **
     1114    **  ProTop is free software; you can redistribute it and/or modify it        **
     1115    **  under the terms of the GNU General Public License (GPL) as published     **
     1116    **  by the Free Software Foundation; either version 2 of the License, or     **
     1117    **  at your option) any later version.                                       **
     1118    **                                                                           **
     1119    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1120    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1121    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1122    **  for more details.                                                        **
     1123    **                                                                           **
     1124    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1125    **  of use and alternative licensing options for this software.              **
     1126    **                                                                           **
     1127    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1128    **                                                                           **
     1129    **  See http://www.fsf.org for more information about the GPL.               **
     1130    **                                                                           **
     1131    **                                                                           **
     1132    *******************************************************************************
     1133    *******************************************************************************
     1134    *
     1135    * init-xrec.i
     1136    *
     1137    * {1} = base field
     1138    * {2} = value to initialze array with
     1139    *
     1140    * [1] = base
     1141    * [2] = last (previous cumulative value)
     1142    * [3] = this
     1143    * [4] = cumulative
     1144    * [5] = interval
     1145    *
     1146    */
     1147   
     1148   tt_xstat.stat4[1] = p_this4
     1149   tt_xstat.stat4[2] = p_this4
     1150   tt_xstat.stat4[3] = p_this4
     1151    
     1152             
     1153   /*******************************************************************************
     1154    *******************************************************************************
     1155    **                                                                           **
     1156    **                                                                           **
     1157    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1158    **  http://www.greenfieldtech.com                                            **
     1159    **                                                                           **
     1160    **  ProTop is free software; you can redistribute it and/or modify it        **
     1161    **  under the terms of the GNU General Public License (GPL) as published     **
     1162    **  by the Free Software Foundation; either version 2 of the License, or     **
     1163    **  at your option) any later version.                                       **
     1164    **                                                                           **
     1165    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1166    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1167    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1168    **  for more details.                                                        **
     1169    **                                                                           **
     1170    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1171    **  of use and alternative licensing options for this software.              **
     1172    **                                                                           **
     1173    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1174    **                                                                           **
     1175    **  See http://www.fsf.org for more information about the GPL.               **
     1176    **                                                                           **
     1177    **                                                                           **
     1178    *******************************************************************************
     1179    *******************************************************************************
     1180    *
     1181    * init-xrec.i
     1182    *
     1183    * {1} = base field
     1184    * {2} = value to initialze array with
     1185    *
     1186    * [1] = base
     1187    * [2] = last (previous cumulative value)
     1188    * [3] = this
     1189    * [4] = cumulative
     1190    * [5] = interval
     1191    *
     1192    */
     1193   
     1194   tt_xstat.stat5[1] = p_this5
     1195   tt_xstat.stat5[2] = p_this5
     1196   tt_xstat.stat5[3] = p_this5
     1197    
     1198             
     1199   /*******************************************************************************
     1200    *******************************************************************************
     1201    **                                                                           **
     1202    **                                                                           **
     1203    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1204    **  http://www.greenfieldtech.com                                            **
     1205    **                                                                           **
     1206    **  ProTop is free software; you can redistribute it and/or modify it        **
     1207    **  under the terms of the GNU General Public License (GPL) as published     **
     1208    **  by the Free Software Foundation; either version 2 of the License, or     **
     1209    **  at your option) any later version.                                       **
     1210    **                                                                           **
     1211    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1212    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1213    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1214    **  for more details.                                                        **
     1215    **                                                                           **
     1216    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1217    **  of use and alternative licensing options for this software.              **
     1218    **                                                                           **
     1219    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1220    **                                                                           **
     1221    **  See http://www.fsf.org for more information about the GPL.               **
     1222    **                                                                           **
     1223    **                                                                           **
     1224    *******************************************************************************
     1225    *******************************************************************************
     1226    *
     1227    * init-xrec.i
     1228    *
     1229    * {1} = base field
     1230    * {2} = value to initialze array with
     1231    *
     1232    * [1] = base
     1233    * [2] = last (previous cumulative value)
     1234    * [3] = this
     1235    * [4] = cumulative
     1236    * [5] = interval
     1237    *
     1238    */
     1239   
     1240   tt_xstat.stat6[1] = p_this6
     1241   tt_xstat.stat6[2] = p_this6
     1242   tt_xstat.stat6[3] = p_this6
     1243    
     1244           .
     1245   
     1246       end.
     1247   
     1248     return.
     1249   
     1250   end.
     1251   
     1252   /* this will be called by the including procedure's mon-update procedure
     1253    *
     1254    */
     1255   
     1256   procedure age_xstat:
     1257   
     1258     define variable x as integer   no-undo.
     1259     define variable z as integer   no-undo.
     1260     define variable r as character no-undo case-sensitive initial "r".
     1261     define variable s as character no-undo case-sensitive initial "s".
     1262   
     1263     publish "get-RateRaw" ( output r ).
     1264     publish "get-SumSample" ( output s ).
     1265   
     1266     if s = "S" then
     1267       assign
     1268         x = 4
     1269         z = xtime.
     1270      else
     1271       assign
     1272         x = 5
     1273         z = itime.
     1274   
     1275     for each tt_xstat exclusive-lock:
     1276   
     1277       if tt_xstat.xvalid = no then
     1278         delete tt_xstat.
     1279        else
     1280         do:
     1281           assign
     1282             tt_xstat.xvalid = no
     1283             
     1284   /*******************************************************************************
     1285    *******************************************************************************
     1286    **                                                                           **
     1287    **                                                                           **
     1288    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1289    **  http://www.greenfieldtech.com                                            **
     1290    **                                                                           **
     1291    **  ProTop is free software; you can redistribute it and/or modify it        **
     1292    **  under the terms of the GNU General Public License (GPL) as published     **
     1293    **  by the Free Software Foundation; either version 2 of the License, or     **
     1294    **  at your option) any later version.                                       **
     1295    **                                                                           **
     1296    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1297    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1298    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1299    **  for more details.                                                        **
     1300    **                                                                           **
     1301    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1302    **  of use and alternative licensing options for this software.              **
     1303    **                                                                           **
     1304    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1305    **                                                                           **
     1306    **  See http://www.fsf.org for more information about the GPL.               **
     1307    **                                                                           **
     1308    **                                                                           **
     1309    *******************************************************************************
     1310    *******************************************************************************
     1311    *
     1312    * upd-xrec.i
     1313    *
     1314    * {1} = base field
     1315    * {2} = value to update metrics with
     1316    *
     1317    * [1] = base
     1318    * [2] = last (previous cumulative value)
     1319    * [3] = this
     1320    * [4] = cumulative
     1321    * [5] = interval
     1322    *
     1323    */
     1324   
     1325   tt_xstat.stat1[3] = tt_xstat.stat1[3]
     1326   tt_xstat.stat1[4] = tt_xstat.stat1[3] - tt_xstat.stat1[1]
     1327   tt_xstat.stat1[5] = tt_xstat.stat1[3] - tt_xstat.stat1[2]
     1328   tt_xstat.stat1[2] = tt_xstat.stat1[3]
     1329    
     1330             
     1331   /*******************************************************************************
     1332    *******************************************************************************
     1333    **                                                                           **
     1334    **                                                                           **
     1335    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1336    **  http://www.greenfieldtech.com                                            **
     1337    **                                                                           **
     1338    **  ProTop is free software; you can redistribute it and/or modify it        **
     1339    **  under the terms of the GNU General Public License (GPL) as published     **
     1340    **  by the Free Software Foundation; either version 2 of the License, or     **
     1341    **  at your option) any later version.                                       **
     1342    **                                                                           **
     1343    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1344    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1345    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1346    **  for more details.                                                        **
     1347    **                                                                           **
     1348    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1349    **  of use and alternative licensing options for this software.              **
     1350    **                                                                           **
     1351    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1352    **                                                                           **
     1353    **  See http://www.fsf.org for more information about the GPL.               **
     1354    **                                                                           **
     1355    **                                                                           **
     1356    *******************************************************************************
     1357    *******************************************************************************
     1358    *
     1359    * upd-xrec.i
     1360    *
     1361    * {1} = base field
     1362    * {2} = value to update metrics with
     1363    *
     1364    * [1] = base
     1365    * [2] = last (previous cumulative value)
     1366    * [3] = this
     1367    * [4] = cumulative
     1368    * [5] = interval
     1369    *
     1370    */
     1371   
     1372   tt_xstat.stat2[3] = tt_xstat.stat2[3]
     1373   tt_xstat.stat2[4] = tt_xstat.stat2[3] - tt_xstat.stat2[1]
     1374   tt_xstat.stat2[5] = tt_xstat.stat2[3] - tt_xstat.stat2[2]
     1375   tt_xstat.stat2[2] = tt_xstat.stat2[3]
     1376    
     1377             
     1378   /*******************************************************************************
     1379    *******************************************************************************
     1380    **                                                                           **
     1381    **                                                                           **
     1382    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1383    **  http://www.greenfieldtech.com                                            **
     1384    **                                                                           **
     1385    **  ProTop is free software; you can redistribute it and/or modify it        **
     1386    **  under the terms of the GNU General Public License (GPL) as published     **
     1387    **  by the Free Software Foundation; either version 2 of the License, or     **
     1388    **  at your option) any later version.                                       **
     1389    **                                                                           **
     1390    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1391    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1392    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1393    **  for more details.                                                        **
     1394    **                                                                           **
     1395    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1396    **  of use and alternative licensing options for this software.              **
     1397    **                                                                           **
     1398    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1399    **                                                                           **
     1400    **  See http://www.fsf.org for more information about the GPL.               **
     1401    **                                                                           **
     1402    **                                                                           **
     1403    *******************************************************************************
     1404    *******************************************************************************
     1405    *
     1406    * upd-xrec.i
     1407    *
     1408    * {1} = base field
     1409    * {2} = value to update metrics with
     1410    *
     1411    * [1] = base
     1412    * [2] = last (previous cumulative value)
     1413    * [3] = this
     1414    * [4] = cumulative
     1415    * [5] = interval
     1416    *
     1417    */
     1418   
     1419   tt_xstat.stat3[3] = tt_xstat.stat3[3]
     1420   tt_xstat.stat3[4] = tt_xstat.stat3[3] - tt_xstat.stat3[1]
     1421   tt_xstat.stat3[5] = tt_xstat.stat3[3] - tt_xstat.stat3[2]
     1422   tt_xstat.stat3[2] = tt_xstat.stat3[3]
     1423    
     1424             
     1425   /*******************************************************************************
     1426    *******************************************************************************
     1427    **                                                                           **
     1428    **                                                                           **
     1429    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1430    **  http://www.greenfieldtech.com                                            **
     1431    **                                                                           **
     1432    **  ProTop is free software; you can redistribute it and/or modify it        **
     1433    **  under the terms of the GNU General Public License (GPL) as published     **
     1434    **  by the Free Software Foundation; either version 2 of the License, or     **
     1435    **  at your option) any later version.                                       **
     1436    **                                                                           **
     1437    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1438    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1439    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1440    **  for more details.                                                        **
     1441    **                                                                           **
     1442    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1443    **  of use and alternative licensing options for this software.              **
     1444    **                                                                           **
     1445    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1446    **                                                                           **
     1447    **  See http://www.fsf.org for more information about the GPL.               **
     1448    **                                                                           **
     1449    **                                                                           **
     1450    *******************************************************************************
     1451    *******************************************************************************
     1452    *
     1453    * upd-xrec.i
     1454    *
     1455    * {1} = base field
     1456    * {2} = value to update metrics with
     1457    *
     1458    * [1] = base
     1459    * [2] = last (previous cumulative value)
     1460    * [3] = this
     1461    * [4] = cumulative
     1462    * [5] = interval
     1463    *
     1464    */
     1465   
     1466   tt_xstat.stat4[3] = tt_xstat.stat4[3]
     1467   tt_xstat.stat4[4] = tt_xstat.stat4[3] - tt_xstat.stat4[1]
     1468   tt_xstat.stat4[5] = tt_xstat.stat4[3] - tt_xstat.stat4[2]
     1469   tt_xstat.stat4[2] = tt_xstat.stat4[3]
     1470    
     1471             
     1472   /*******************************************************************************
     1473    *******************************************************************************
     1474    **                                                                           **
     1475    **                                                                           **
     1476    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1477    **  http://www.greenfieldtech.com                                            **
     1478    **                                                                           **
     1479    **  ProTop is free software; you can redistribute it and/or modify it        **
     1480    **  under the terms of the GNU General Public License (GPL) as published     **
     1481    **  by the Free Software Foundation; either version 2 of the License, or     **
     1482    **  at your option) any later version.                                       **
     1483    **                                                                           **
     1484    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1485    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1486    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1487    **  for more details.                                                        **
     1488    **                                                                           **
     1489    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1490    **  of use and alternative licensing options for this software.              **
     1491    **                                                                           **
     1492    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1493    **                                                                           **
     1494    **  See http://www.fsf.org for more information about the GPL.               **
     1495    **                                                                           **
     1496    **                                                                           **
     1497    *******************************************************************************
     1498    *******************************************************************************
     1499    *
     1500    * upd-xrec.i
     1501    *
     1502    * {1} = base field
     1503    * {2} = value to update metrics with
     1504    *
     1505    * [1] = base
     1506    * [2] = last (previous cumulative value)
     1507    * [3] = this
     1508    * [4] = cumulative
     1509    * [5] = interval
     1510    *
     1511    */
     1512   
     1513   tt_xstat.stat5[3] = tt_xstat.stat5[3]
     1514   tt_xstat.stat5[4] = tt_xstat.stat5[3] - tt_xstat.stat5[1]
     1515   tt_xstat.stat5[5] = tt_xstat.stat5[3] - tt_xstat.stat5[2]
     1516   tt_xstat.stat5[2] = tt_xstat.stat5[3]
     1517    
     1518             
     1519   /*******************************************************************************
     1520    *******************************************************************************
     1521    **                                                                           **
     1522    **                                                                           **
     1523    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1524    **  http://www.greenfieldtech.com                                            **
     1525    **                                                                           **
     1526    **  ProTop is free software; you can redistribute it and/or modify it        **
     1527    **  under the terms of the GNU General Public License (GPL) as published     **
     1528    **  by the Free Software Foundation; either version 2 of the License, or     **
     1529    **  at your option) any later version.                                       **
     1530    **                                                                           **
     1531    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1532    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1533    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1534    **  for more details.                                                        **
     1535    **                                                                           **
     1536    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1537    **  of use and alternative licensing options for this software.              **
     1538    **                                                                           **
     1539    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1540    **                                                                           **
     1541    **  See http://www.fsf.org for more information about the GPL.               **
     1542    **                                                                           **
     1543    **                                                                           **
     1544    *******************************************************************************
     1545    *******************************************************************************
     1546    *
     1547    * upd-xrec.i
     1548    *
     1549    * {1} = base field
     1550    * {2} = value to update metrics with
     1551    *
     1552    * [1] = base
     1553    * [2] = last (previous cumulative value)
     1554    * [3] = this
     1555    * [4] = cumulative
     1556    * [5] = interval
     1557    *
     1558    */
     1559   
     1560   tt_xstat.stat6[3] = tt_xstat.stat6[3]
     1561   tt_xstat.stat6[4] = tt_xstat.stat6[3] - tt_xstat.stat6[1]
     1562   tt_xstat.stat6[5] = tt_xstat.stat6[3] - tt_xstat.stat6[2]
     1563   tt_xstat.stat6[2] = tt_xstat.stat6[3]
     1564    
     1565           .
     1566   
     1567           if ratio-calc = 0 then
     1568             assign
     1569               tt_xstat.stat-ratio  = 100 * (( tt_xstat.stat1[x] - tt_xstat.stat2[x] ) / tt_xstat.stat1[x] )
     1570               tt_xstat.stat-ratio  = ( if tt_xstat.stat-ratio = ? then 0 else tt_xstat.stat-ratio )
     1571               tt_xstat.stat-ratio2  = 100 * (( tt_xstat.stat3[x] - tt_xstat.stat4[x] ) / tt_xstat.stat3[x] )
     1572               tt_xstat.stat-ratio2  = ( if tt_xstat.stat-ratio2 = ? then 0 else tt_xstat.stat-ratio2 )
     1573             .
     1574            else if ratio-calc = 1 then
     1575             assign
     1576               tt_xstat.stat-ratio  = 100 * ( tt_xstat.stat1[x] / tt_xstat.stat2[x] )
     1577               tt_xstat.stat-ratio  = ( if tt_xstat.stat-ratio = ? then 0 else tt_xstat.stat-ratio )
     1578               tt_xstat.stat-ratio2  = 100 * ( tt_xstat.stat3[x] / tt_xstat.stat4[x] )
     1579               tt_xstat.stat-ratio2  = ( if tt_xstat.stat-ratio2 = ? then 0 else tt_xstat.stat-ratio2 )
     1580             .
     1581         end.
     1582   
     1583     end.
     1584   
     1585     return.
     1586   
     1587   end.
     1588    
     1589   
     1590   /* if changes are made to formatting the column offsets in lib/browser.p may need to change */
     1591   
     1592   define temp-table tt_txe no-undo
     1593   
     1594     field xid          as integer
     1595     field txeType      as character format "x(9)"           label "TXE Type"      /* "x(14)"              */
     1596     field txeLocks     as decimal   format "->>>>>9"        label "Locks"         /* "->>>>>>>>9"         */
     1597     field txeWaits     as decimal   format "->>>>>9"        label "Waits"
     1598     field txeLockPct   as decimal   format "->9.9%"         label "Lock%"         /* "->9.99%"            */
     1599     field concurrLkPct as decimal   format "->9.9%"         label "ConLk%"        /* "->9.99%"            */
     1600     field concurrLk    as decimal   format "->>>>>"         label "ConLk"
     1601     field concurrWt    as decimal   format "->>>>"          label "ConWt"
     1602   
     1603     index xid-idx is unique xid
     1604     index txeWaits-idx is primary txeWaits descending
     1605     index txeLocks-idx txeLocks descending
     1606     index txeLockPct-idx txeLockPct descending
     1607   .
     1608   
     1609   
     1610   /* lib/dumpTT.i
     1611    *
     1612    * simplified to a single line -- include should be eliminated.
     1613    *
     1614    */
     1615   
     1616   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.1 &THEN
     1617   /*** +++
     1618   file-info:file-name = "./ptdefs".
     1619   if file-info:full-pathname <> ? and index( file-info:file-type, "d" ) > 0 and index( file-info:file-type, "w" ) > 0 then
     1620     do:
     1621   
     1622       file-info:file-name = "./ptdefs/{1}.xsd".
     1623   
     1624       if true /* file-info:full-pathname = ? or file-info:file-size = 0 */ then
     1625         do:
     1626   
     1627           temp-table {1}:write-xmlschema(
     1628             "file",
     1629   /*        substitute( "ptdefs/&1.xsd", "{1}" ), */
     1630   /*        "./ptdefs/{1}.xsd", */
     1631             ( if opsys = "unix" then "./ptdefs/{1}.xsd" else ".~\ptdefs~\{1}.xsd" ),
     1632             true
     1633   
     1634         &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.2
     1635         &THEN
     1636             , ?, ?, ?
     1637         &ENDIF
     1638   
     1639       ).
     1640   
     1641       end.
     1642   
     1643     end.
     1644    +++ ***/
     1645   &ENDIF
     1646    
     1647   
     1648   /* initialize
     1649    *
     1650    */
     1651   
     1652   procedure mon-init:
     1653   
     1654     define variable i as integer no-undo.
     1655   
     1656     empty temp-table tt_xstat.
     1657   
     1658     find first _TxeLock no-lock no-error.
     1659   
     1660     do i = 1 to 9:
     1661       create tt_xstat.
     1662       assign
     1663         tt_xstat.xid   = i
     1664         tt_xstat.xname = _TxeLock._Txe-Type[i]
     1665         X_TXE-Type[i]  = _TxeLock._Txe-Type[i]
     1666       .
     1667       if _Txe-Type[i] = "" then X_TXE-Type[i] = "TXE[" + string( i ) + "]".
     1668     end.
     1669   
     1670     run updTick.
     1671   
     1672     return.
     1673   
     1674   end.
     1675   
     1676   /* update
     1677    *
     1678    */
     1679   
     1680   procedure mon-update:
     1681   
     1682     define input parameter argList as character no-undo.
     1683   
     1684     define variable tlist as character no-undo.
     1685     define variable xlist as character no-undo.
     1686     define variable i     as integer   no-undo.
     1687   
     1688     run updTick.
     1689   
     1690     find first _TxeLock no-lock no-error.
     1691   
     1692     do i = 1 to 9:
     1693   
     1694       run update_xstat (
     1695         input i,
     1696         input X_Txe-Type[i],
     1697         input "m1",
     1698         input "m2",
     1699         input "m3",
     1700         input "m4",
     1701         input "m5",
     1702         input _Txe-Locks[i],
     1703         input ( if _Txe-LocksS[i] = ? then 0 else _Txe-LocksS[i] ),
     1704         input _Txe-Waits[i],
     1705         input ( if _Txe-WaitsS[i] = ? then 0 else _Txe-WaitsS[i] ),
     1706         input 0,
     1707         input 0
     1708       ).
     1709   
     1710     end.
     1711   
     1712     run age_xstat.
     1713   
     1714     for each tt_xstat:
     1715   
     1716       find tt_txe where tt_txe.xid = tt_xstat.xid no-error.
     1717       if not available tt_txe then create tt_txe.
     1718       assign
     1719         tt_txe.xid          = tt_xstat.xid
     1720         tt_txe.txeType      = tt_xstat.xname
     1721         tt_txe.txeLocks     = ( tt_xstat.stat1[x] / z )
     1722         tt_txe.txeWaits     = ( tt_xstat.stat3[x] / z )
     1723   /*    tt_txe.txeLockPct   = tt_xstat.stat-ratio */
     1724         tt_txe.txeLockPct   = (( tt_txe.txeLocks - tt_txe.txeWaits ) / tt_txe.txeLocks ) * 100
     1725         tt_txe.concurrLk    = ( tt_xstat.stat2[x] / z )
     1726         tt_txe.concurrWt    = ( tt_xstat.stat4[x] / z )
     1727         tt_txe.concurrLkPct = (( tt_txe.concurrLk - tt_txe.concurrWt ) / tt_txe.concurrLk ) * 100
     1728       .
     1729   
     1730     end.
     1731   
     1732     add2ds( temp-table tt_txe:default-buffer-handle ).
     1733   
     1734     return.
     1735   
     1736   end.
     1737   
     1738   return.
