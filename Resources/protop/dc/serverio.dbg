        1   /*******************************************************************************
        2    *******************************************************************************
        3    **                                                                           **
        4    **                                                                           **
        5    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
        6    **  http://www.greenfieldtech.com                                            **
        7    **                                                                           **
        8    **  ProTop is free software; you can redistribute it and/or modify it        **
        9    **  under the terms of the GNU General Public License (GPL) as published     **
       10    **  by the Free Software Foundation; either version 2 of the License, or     **
       11    **  at your option) any later version.                                       **
       12    **                                                                           **
       13    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
       14    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
       15    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
       16    **  for more details.                                                        **
       17    **                                                                           **
       18    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
       19    **  of use and alternative licensing options for this software.              **
       20    **                                                                           **
       21    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
       22    **                                                                           **
       23    **  See http://www.fsf.org for more information about the GPL.               **
       24    **                                                                           **
       25    **                                                                           **
       26    *******************************************************************************
       27    *******************************************************************************
       28    *
       29    * serverio.p
       30    *
       31    *
       32    * Remote client server activity and IO impact.
       33    *
       34    *
       35    * Author:
       36    *
       37    *      Tom Bascom, Greenfield Technologies
       38    *      http://www.greenfieldtech.com
       39    *      September 21, 2003
       40    *
       41    */
       42   
       43   
       44   /*******************************************************************************
       45    *******************************************************************************
       46    **                                                                           **
       47    **                                                                           **
       48    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
       49    **  http://www.greenfieldtech.com                                            **
       50    **                                                                           **
       51    **  ProTop is free software; you can redistribute it and/or modify it        **
       52    **  under the terms of the GNU General Public License (GPL) as published     **
       53    **  by the Free Software Foundation; either version 2 of the License, or     **
       54    **  at your option) any later version.                                       **
       55    **                                                                           **
       56    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
       57    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
       58    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
       59    **  for more details.                                                        **
       60    **                                                                           **
       61    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
       62    **  of use and alternative licensing options for this software.              **
       63    **                                                                           **
       64    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
       65    **                                                                           **
       66    **  See http://www.fsf.org for more information about the GPL.               **
       67    **                                                                           **
       68    **                                                                           **
       69    *******************************************************************************
       70    *******************************************************************************
       71    *
       72    * protop.i
       73    *
       74    * Header file for protop family of programs
       75    *
       76    *
       77    * Known Bugs & Issues:
       78    *
       79    *
       80    * To Do:
       81    *
       82    *
       83    * Author:
       84    *
       85    *      Tom Bascom, Greenfield Technologies
       86    *      http://www.greenfieldtech.com
       87    *      August 28, 2003
       88    *
       89    */
       90   
       91   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 11.4 &THEN
       92   &global-define  FASTLOCK        true
       93   &ELSE
       94   &global-define  FASTLOCK        false
       95   &ENDIF
       96   
       97   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 11.0 &THEN
       98   &global-define  OE11            "yes"
       99   &global-define  xDEBUGTT        false
      100   &ENDIF
      101   
      102   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.2 AND PROVERSION >= "10.2B" &THEN
      103   &global-define  NOSERIALIZE     serialize-hidden
      104   &ENDIF
      105   
      106   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.1 AND PROVERSION >= "10.1B" &THEN
      107   &global-define  BIGINT          int64
      108   &ELSE
      109   &global-define  BIGINT          decimal
      110   &ENDIF
      111   
      112   
      113   /* lib/v9.i
      114    *
      115    */
      116   
      117   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) < 10.0 &THEN
      118   &global-define  CPYLOB  "no"
      119   &global-define  NOW     substitute( "&1 &2", today, string( time, "hh:mm:ss" ))
      120   &global-define  LNGCR   character
      121   &global-define  DTZ     integer
      122   &global-define  BIGINT  decimal
      123   &ELSE
      124   &global-define  OE10    "yes"
      125   &global-define  NOW     now
      126   &global-define  LNGCR   longchar
      127   &global-define  DTZ     datetime-tz
      128   &global-define  BIGINT  int64
      129   &ENDIF
      130    
      131   
      132   /* use extended _connect fields: -client, -cache*
      133    */
      134   
      135   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.1 AND PROVERSION >= "10.1C" &THEN
      136   &global-define  CONNECTX        "yes"
      137   &ELSE
      138   &global-define  CONNECTX        "no"
      139   &ENDIF
      140   
      141   define stream inStrm.
      142   
      143   define new global shared variable dbgMode as integer no-undo initial 1.
      144   
      145   /* The values for these are defined in etc/protop.cfg and set by lib/protop-cfg.p
      146    *
      147    * someday everyone will have OO and I will replace these with a gsv class
      148    * or something of that ilk
      149    *
      150    */
      151   
      152   define new global shared variable pt_shortname   as character no-undo.
      153   define new global shared variable pt_uniqName    as character no-undo.
      154   define new global shared variable pt_server      as character no-undo.
      155   define new global shared variable pt_resrcType   as character no-undo.
      156   
      157   define new global shared variable pt_tmpdir      as character no-undo initial "/tmp".
      158   define new global shared variable pt_logdir      as character no-undo initial "/tmp".
      159   define new global shared variable pt_rptdir      as character no-undo initial "/tmp".
      160   define new global shared variable pt_logname     as character no-undo initial "&5.&2.&3".
      161   define new global shared variable pt_mailcmd     as character no-undo initial 'mailx "-s &1" '.
      162   
      163   define new global shared variable pt_votrx       as integer   no-undo initial 1800.
      164   define new global shared variable pt_lktbllim    as integer   no-undo initial 0.
      165   define new global shared variable pt_bkupstale   as integer   no-undo initial 26.
      166   define new global shared variable pt_bogomips    as integer   no-undo initial 1000000.
      167   define new global shared variable pt_ioresp      as integer   no-undo initial 100.
      168   define new global shared variable pt_ioFileName  as character no-undo.
      169   define new global shared variable pt_dfCmd       as character no-undo.
      170   
      171   define new global shared variable pt_AICheckInterval   as integer no-undo initial 60.
      172   define new global shared variable pt_PICACheckInterval as integer no-undo initial 60.
      173   define new global shared variable pt_appsrvStuck       as integer no-undo initial 120.
      174   
      175   define new global shared variable pt_bibkupAlert as integer   no-undo.          /* alert on long bi backup phase                */
      176   define new global shared variable pt_bibkupAlarm as integer   no-undo.          /* alarm on long bi backup phase                */
      177   define new global shared variable pt_bibkupPage  as integer   no-undo.          /* page  on long bi backup phase                */
      178   
      179   define new global shared variable pt_bkupAlert   as integer   no-undo.          /* alert on long db backup                      */
      180   define new global shared variable pt_bkupAlarm   as integer   no-undo.          /* alarm on long db backup                      */
      181   define new global shared variable pt_bkupPage    as integer   no-undo.          /* page  on long db backup                      */
      182   
      183   define new global shared variable pt_userLock    as logical   no-undo.          /* enable _userLock  data?                      */
      184   define new global shared variable pt_doZippy     as logical   no-undo.          /* enable "user experience" (aka "zippy")?      */
      185   define new global shared variable pt_useRFUtil   as logical   no-undo.          /* use rfutil to gather after-imaging status?   */
      186   
      187   define new global shared variable pt_updAreaData as integer   no-undo.          /* how often should we report storage area xref details from dbanalys? */
      188   
      189   define new global shared variable pt_zoomTo      as integer no-undo.            /* new zoomed monInt                            */
      190   
      191   define new global shared variable ptDBName     as character no-undo.                    /* the db logical name          */
      192   define new global shared variable rowLimit     as integer   no-undo initial 100.        /* 50?                          */
      193   
      194   /* do-sumSample() manipulates these -- ugly, ugly, ugly... (obsolete?)
      195    * 
      196    */
      197   
      198   define new global shared variable stime as integer no-undo.                     /* start time                           */
      199   define new global shared variable ltime as integer no-undo.                     /* last time                            */
      200   define new global shared variable xtime as integer no-undo.                     /* total time                           */
      201   define new global shared variable itime as integer no-undo.                     /* iteration time                       */
      202   
      203   define new global shared variable chkp-base   as integer no-undo initial ?.     /* cover for the lack of a VST field    */
      204   
      205                                                                                   /* corresponding to base checkpoint#    */
      206   /** Global Shared Temp Table Definitions
      207    **
      208    ** Yup, they're shared.  But this stuff makes no sense across session boundaries anyway.
      209    ** And a shared temp-table is logically the same as a db table so who really cares?
      210    **
      211    **/
      212   
      213   /* cache _File and _Index records so that we don't keep hitting the db to translate
      214    */
      215   
      216   define new global shared temp-table tt_tbl no-undo
      217     field xid      as integer                                             /* _File._File-Num              */
      218     field tstatid  as integer                                             /* _TableStat._TableStat-Id     */
      219     field areaNum  as integer                                             /* _Storage-Object._Area-Number */
      220     field tblPool  as character                                           /* get-bits( _object-attrib, 7, 1 ) = 1 */
      221     field tblname  as character                                           /* _File._File-Name             */
      222     index xid-idx is unique primary xid.
      223   
      224   define new global shared temp-table tt_idx no-undo
      225     field xid      as integer                                             /* _Index._Idx-Num              */
      226     field istatid  as integer                                             /* _IndexStat._IndexStat-Id     */
      227     field idxname  as character                                           /* _Index._Idx-Name             */
      228     field idxnote  as character
      229     field idxRoot  as int64                                           /* _Storage-Object._Object-Root */
      230     field tblnum   as integer                                             /* _File._File-Num              */
      231     field areaNum  as integer                                             /* _Storage-Object._Area-Number */
      232     field idxPool  as character                                           /* get-bits( _object-attrib, 7, 1 ) = 1 */
      233     field tblname  as character                                           /* _File._File-Name             */
      234     index xid-idx is unique primary xid.
      235   
      236   define new global shared temp-table tt_areaExtent no-undo
      237     field areaNum  as integer                                             /* _areaExtent._Area-Number     */
      238     field extNum   as integer                                             /* _areaExtent._Extent-Number   */
      239   
      240     field extSize  as decimal                                             /* _areaExtent._Extent-Size     */
      241     field extType  as integer                                             /* _areaExtent._Extent-Type     */
      242     field extPath  as character                                           /* _areaExtent._Extent-Path     */
      243   
      244     index ae-idx is unique primary areaNum extNum.
      245   
      246   define new global shared temp-table tt_area no-undo
      247     field xid      as integer    format ">>>9"
      248     field SANum    as integer    format ">>>9"        label "#"
      249     field areaPool as character  format "x(2)"        label "BX"
      250   /*field areaStatus-Id as {&BIGINT} format ">>>9"    label "Id" */
      251     field SAName   as character  format "x(30)"       label "Area Name"
      252     field allocGB  as decimal    format ">>>>>9.99"   label "Allocated"
      253     field varGB    as decimal    format ">>>>>9.99"   label "Variable"
      254     field totGB    as decimal    format ">>>>>>9.99"  label "Tot GB"
      255     field hiGB     as decimal    format ">>>>>9.99"   label "Hi Water" serialize-hidden
      256     field freeGB   as decimal    format ">>>>>9.99"   label "Free GB"
      257     field pctAlloc as decimal    format ">>>>>9%"     label "%Alloc"
      258     field pctLastX as decimal    format ">>>>9%"      label "%LastX"
      259   
      260     field blkszkb as integer     format ">>9"         label "BSZ"
      261     field rpb     as integer     format ">>9"         label "RPB"
      262     field clstrsz as integer     format ">>9"         label "CSZ"
      263   
      264     field numTbls as integer     format ">>>>9"       label "#Tbls"
      265     field numIdxs as integer     format ">>>>9"       label "#Idxs"
      266     field numLOBs as integer     format ">>>>9"       label "#LOBs"
      267   
      268     field numExts as integer     format ">>>>9"       label "#Exts"
      269     field hasVar  as logical     format "Yes/No"      label "Var?"
      270   
      271     field xnote   as character   format "x"           label "*"
      272   
      273     field areaMaxPct as decimal  format ">>9.999%"    label "Max%"
      274     field idx3264    as decimal  format ">>9.999%"    label "Bug%"
      275   
      276     index pctAlloc-idx is primary pctAlloc descending
      277     index pctLastX-idx pctLastX pctAlloc descending
      278     index allocGB-idx allocGB descending
      279     index totGB-idx totGB descending
      280     index xid-idx is unique xid
      281     index SANum-idx is unique SANum
      282     index SAName-idx is unique SAName
      283   .
      284   
      285   *** Encrypted Source ***
      286   *** Encrypted Source ***
      287   *** Encrypted Source ***
      288   *** Encrypted Source ***
      289   *** Encrypted Source ***
      290   *** Encrypted Source ***
      291   *** Encrypted Source ***
      292   *** Encrypted Source ***
      293   *** Encrypted Source ***
      294   *** Encrypted Source ***
      295   *** Encrypted Source ***
      296   *** Encrypted Source ***
      297   *** Encrypted Source ***
      298   *** Encrypted Source ***
      299   *** Encrypted Source ***
      300   *** Encrypted Source ***
      301   *** Encrypted Source ***
      302   *** Encrypted Source ***
      303   *** Encrypted Source ***
      304   *** Encrypted Source ***
      305   *** Encrypted Source ***
      306   *** Encrypted Source ***
      307   *** Encrypted Source ***
      308   *** Encrypted Source ***
      309   *** Encrypted Source ***
      310   *** Encrypted Source ***
      311   *** Encrypted Source ***
      312   *** Encrypted Source ***
      313   *** Encrypted Source ***
      314   *** Encrypted Source ***
      315   *** Encrypted Source ***
      316   *** Encrypted Source ***
      317   *** Encrypted Source ***
      318   *** Encrypted Source ***
      319   *** Encrypted Source ***
      320   *** Encrypted Source ***
      321   *** Encrypted Source ***
      322   *** Encrypted Source ***
      323   *** Encrypted Source ***
      324   *** Encrypted Source ***
      325   *** Encrypted Source ***
      326   *** Encrypted Source ***
      327   *** Encrypted Source ***
      328   *** Encrypted Source ***
      329   *** Encrypted Source ***
      330   *** Encrypted Source ***
      331   *** Encrypted Source ***
      332   *** Encrypted Source ***
      333   *** Encrypted Source ***
      334   *** Encrypted Source ***
      335   *** Encrypted Source ***
      336   *** Encrypted Source ***
      337   *** Encrypted Source ***
      338   *** Encrypted Source ***
      339   *** Encrypted Source ***
      340   *** Encrypted Source ***
      341   *** Encrypted Source ***
      342   *** Encrypted Source ***
      343   *** Encrypted Source ***
      344   *** Encrypted Source ***
      345   *** Encrypted Source ***
      346   *** Encrypted Source ***
      347   *** Encrypted Source ***
      348   *** Encrypted Source ***
      349   *** Encrypted Source ***
      350   *** Encrypted Source ***
      351   *** Encrypted Source ***
      352   *** Encrypted Source ***
      353   *** Encrypted Source ***
      354   *** Encrypted Source ***
      355    
      356   
      357   /*******************************************************************************
      358    *******************************************************************************
      359    **                                                                           **
      360    **                                                                           **
      361    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      362    **  http://www.greenfieldtech.com                                            **
      363    **                                                                           **
      364    **  ProTop is free software; you can redistribute it and/or modify it        **
      365    **  under the terms of the GNU General Public License (GPL) as published     **
      366    **  by the Free Software Foundation; either version 2 of the License, or     **
      367    **  at your option) any later version.                                       **
      368    **                                                                           **
      369    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      370    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      371    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      372    **  for more details.                                                        **
      373    **                                                                           **
      374    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      375    **  of use and alternative licensing options for this software.              **
      376    **                                                                           **
      377    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      378    **                                                                           **
      379    **  See http://www.fsf.org for more information about the GPL.               **
      380    **                                                                           **
      381    **                                                                           **
      382    *******************************************************************************
      383    *******************************************************************************
      384    *
      385    * protoplib.i
      386    *
      387    * ProTop infrastructure library definitions
      388    *
      389    */
      390   
      391   function uDateTime returns integer () in super.
      392   function string2uDateTime returns integer( input p_text as character ) in super.
      393   function searchDir returns character ( input xDir as character ) in super.
      394   function unsignMe returns decimal ( input s as decimal, input i as integer ) in super.
      395   function hr returns decimal ( input lr as decimal, input osr as decimal, output hr-str as character, output hr as decimal, output mr as decimal ) in super.
      396   function do-SumSample returns logical ( output p_index as integer, output p_time  as integer ) in super.
      397   function myPID returns character () in super.
      398   function hilite returns logical ( input b as handle, input p_metric as character, input p_value as character, output p_attr as character ) in super.
      399   
      400   /* end protoplib.i */
      401    
      402   
      403   /*******************************************************************************
      404    *******************************************************************************
      405    **                                                                           **
      406    **                                                                           **
      407    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      408    **  http://www.greenfieldtech.com                                            **
      409    **                                                                           **
      410    **  ProTop is free software; you can redistribute it and/or modify it        **
      411    **  under the terms of the GNU General Public License (GPL) as published     **
      412    **  by the Free Software Foundation; either version 2 of the License, or     **
      413    **  at your option) any later version.                                       **
      414    **                                                                           **
      415    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      416    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      417    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      418    **  for more details.                                                        **
      419    **                                                                           **
      420    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      421    **  of use and alternative licensing options for this software.              **
      422    **                                                                           **
      423    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      424    **                                                                           **
      425    **  See http://www.fsf.org for more information about the GPL.               **
      426    **                                                                           **
      427    **                                                                           **
      428    *******************************************************************************
      429    *******************************************************************************
      430    *
      431    * vstlib.i
      432    *
      433    * VST library definitions
      434    *
      435    */
      436   
      437   function aiInfo returns character ( input vAiFile as character, output vAiGenNum as integer ) in super.
      438   function chkai returns integer ( output ai_exts as integer, output ai_full as integer, output ai_empty as integer ) in super.
      439   function chkarea returns integer ( input threshold as decimal, output worst as decimal ) in super.
      440   function chkptNum returns integer ( input-output oldbi as integer ) in super.
      441   
      442   function connectFlags returns character ( input cnxId as integer ) in super.
      443   function connectName returns character ( input cnxId as integer, input cnxFlags as character ) in super.
      444   function lastStatement returns character( input cnxId as integer, output lineNum as integer, output procName as character ) in super.
      445   
      446   function isAIEnabled returns logical () in super.
      447   function isReplSource returns logical () in super.
      448   function isReplTarget returns logical () in super.
      449   function isBackupRunning returns logical () in super.
      450   function isWorkgroup returns logical () in super.
      451   
      452   function getStartupX returns character ( input v as character, input p1 as character, input p2 as character ) in super.
      453   
      454   /* end vstlib.i */
      455    
      456   
      457   function add2ds returns logical ( input h as handle ) in super.
      458   function getTempTableHandle returns handle ( input n as character ) in super.
      459   
      460   /* end protop.i */
      461    
      462   
      463   /*******************************************************************************
      464    *******************************************************************************
      465    **                                                                           **
      466    **                                                                           **
      467    **  Copyright 2003-2012 Tom Bascom, Greenfield Technologies                  **
      468    **  http://www.greenfieldtech.com                                            **
      469    **                                                                           **
      470    **  ProTop is free software; you can redistribute it and/or modify it        **
      471    **  under the terms of the GNU General Public License (GPL) as published     **
      472    **  by the Free Software Foundation; either version 2 of the License, or     **
      473    **  at your option) any later version.                                       **
      474    **                                                                           **
      475    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      476    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      477    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      478    **  for more details.                                                        **
      479    **                                                                           **
      480    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      481    **  of use and alternative licensing options for this software.              **
      482    **                                                                           **
      483    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      484    **                                                                           **
      485    **  See http://www.fsf.org for more information about the GPL.               **
      486    **                                                                           **
      487    **                                                                           **
      488    *******************************************************************************
      489    *******************************************************************************
      490    *
      491    * tick.i
      492    *
      493    *
      494    * common routine to handle "clock ticks"
      495    *
      496    *
      497    * Author:
      498    *
      499    *      Tom Bascom, Greenfield Technologies
      500    *      http://www.greenfieldtech.com
      501    *      January 21, 2012
      502    *
      503    */
      504   
      505   
      506   /* lib/v9.i
      507    *
      508    */
      509   
      510   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) < 10.0 &THEN
      511   &global-define  CPYLOB  "no"
      512   &global-define  NOW     substitute( "&1 &2", today, string( time, "hh:mm:ss" ))
      513   &global-define  LNGCR   character
      514   &global-define  DTZ     integer
      515   &global-define  BIGINT  decimal
      516   &ELSE
      517   &global-define  OE10    "yes"
      518   &global-define  NOW     now
      519   &global-define  LNGCR   longchar
      520   &global-define  DTZ     datetime-tz
      521   &global-define  BIGINT  int64
      522   &ENDIF
      523    
      524   
      525   define new global shared variable rawMode  as integer no-undo initial 5.
      526   define new global shared variable timeMode as integer no-undo initial 2.
      527   
      528   define new global shared variable x as integer no-undo initial 5.
      529   define new global shared variable z as decimal no-undo.
      530   
      531   define variable y as decimal no-undo.
      532   
      533   define variable initTick as integer no-undo.
      534   define variable prevTick as integer no-undo.
      535   
      536   
      537   procedure updTick:
      538   
      539   &IF DEFINED( OE10 ) &THEN
      540     if initTick = 0 then initTick = mtime.
      541     assign
      542       x = rawMode /* ( if rawMode then 4 else 5 ) */
      543       z = mtime - prevTick
      544       z = ( if z >= 0 then z else 86400000 - prevTick + mtime )   /* handle rolling over midnight */
      545       z = z / 1000
      546       y = mtime - initTick
      547       y = y / 1000
      548       prevTick = mtime
      549     .
      550   &ELSE
      551     if initTick = 0 then initTick = etime.
      552     assign
      553       x = rawMode /* ( if rawMode then 4 else 5 ) */
      554       z = etime - prevTick
      555       z = ( if z >= 0 then z else 5000 )   /* etime doesn't rollover at midnite -- but a mistaken etime(yes) somewhere would be bad... */
      556       z = z / 1000
      557       y = etime - initTick
      558       y = y / 1000
      559       prevTick = etime
      560     .
      561   &ENDIF
      562   
      563     /* if rawMode <> 5 then z = 1. */
      564   
      565     if timeMode = 1 then z = 1.
      566   
      567     return.
      568   
      569   end.
      570   
      571   /* end tick.i */
      572    
      573   
      574   define output parameter dcDescription as character no-undo initial "RemoteServerActivity".
      575   
      576   
      577   /*******************************************************************************
      578    *******************************************************************************
      579    **                                                                           **
      580    **                                                                           **
      581    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      582    **  http://www.greenfieldtech.com                                            **
      583    **                                                                           **
      584    **  ProTop is free software; you can redistribute it and/or modify it        **
      585    **  under the terms of the GNU General Public License (GPL) as published     **
      586    **  by the Free Software Foundation; either version 2 of the License, or     **
      587    **  at your option) any later version.                                       **
      588    **                                                                           **
      589    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      590    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      591    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      592    **  for more details.                                                        **
      593    **                                                                           **
      594    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      595    **  of use and alternative licensing options for this software.              **
      596    **                                                                           **
      597    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      598    **                                                                           **
      599    **  See http://www.fsf.org for more information about the GPL.               **
      600    **                                                                           **
      601    **                                                                           **
      602    *******************************************************************************
      603    *******************************************************************************
      604    *
      605    * tt_serverio.i
      606    *
      607    */
      608   
      609   define temp-table tt_serverio no-undo
      610     field xid      as integer
      611     field xvalid   as logical
      612     field srvnum   as integer           format ">>>9"       label "Srv"
      613     field srvtyp   as character         format "x(5)"       label "Type"
      614     field loginPort as integer          format ">>>>9"      label "-S"
      615     field srvport  as integer           format ">>>>9"      label "Port"
      616     field curr-usr as integer           format ">>>9"       label "Cnx"
      617     field max-usr  as integer           format ">>>9"       label "Max"
      618   
      619     field msg-recv as decimal extent 5  format ">>>>>>>>>9" label "MsgRecv"
      620     field msg-sent as decimal extent 5  format ">>>>>>>>>9" label "MsgSent"
      621     field rec-recv as decimal extent 5  format ">>>>>>>>>9" label "RecRecv"
      622     field rec-sent as decimal extent 5  format ">>>>>>>>>9" label "RecSent"
      623     field qry-recv as decimal extent 5  format ">>>>>>>>>9" label "QrySent"
      624     field bytes-sent as decimal extent 5  format ">>>>>>>>>9" label "BytesSent"
      625     field bytes-recv as decimal extent 5  format ">>>>>>>>>9" label "BytesRecv"
      626     field tm-intr  as decimal extent 5  format ">>>>>>>>>9" label "Slice"
      627   
      628     field srv-dba  as decimal extent 5  format ">>>>>>>>>9" label "LogRd"
      629     field srv-dbr  as decimal extent 5  format ">>>>>>>>>9" label "OSRd"
      630     field srv-dbw  as decimal extent 5  format ">>>>>>>>>9" label "OSWr"
      631     field hr       as decimal           format ">>9.99%"    label "HitPct"
      632   
      633     index xid-idx is unique primary xid
      634   .
      635   
      636   procedure update_serverio:
      637   
      638     define input parameter xid      as integer   no-undo.
      639     define input parameter logRd    as decimal   no-undo.
      640     define input parameter OSRd     as decimal   no-undo.
      641     define input parameter OSWr     as decimal   no-undo.
      642   
      643     find dictdb._Servers no-lock where _Servers._Server-id = xid no-error.
      644   
      645     if not available _Servers then
      646       do:
      647         message "_Server disappeared!".
      648         pause.
      649       end.
      650   
      651     find dictdb._ActServer no-lock where _ActServer._Server-Id = _Servers._Server-Id no-error.
      652   
      653     find tt_serverio where tt_serverio.xid = xid no-error.
      654   
      655     if not available tt_serverio then
      656       do:
      657   
      658         create tt_serverio.
      659         assign
      660           tt_serverio.xvalid   = yes
      661           tt_serverio.xid      = _Servers._Server-Id
      662           tt_serverio.srvnum   = _Servers._Server-num
      663           tt_serverio.srvtyp   = _Servers._Server-type
      664           tt_serverio.srvport  = _Servers._Server-portNum
      665           tt_serverio.curr-usr = _Servers._Server-CurrUsers
      666           tt_serverio.max-usr  = _Servers._Server-MaxUsers
      667           
      668   /*******************************************************************************
      669    *******************************************************************************
      670    **                                                                           **
      671    **                                                                           **
      672    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      673    **  http://www.greenfieldtech.com                                            **
      674    **                                                                           **
      675    **  ProTop is free software; you can redistribute it and/or modify it        **
      676    **  under the terms of the GNU General Public License (GPL) as published     **
      677    **  by the Free Software Foundation; either version 2 of the License, or     **
      678    **  at your option) any later version.                                       **
      679    **                                                                           **
      680    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      681    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      682    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      683    **  for more details.                                                        **
      684    **                                                                           **
      685    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      686    **  of use and alternative licensing options for this software.              **
      687    **                                                                           **
      688    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      689    **                                                                           **
      690    **  See http://www.fsf.org for more information about the GPL.               **
      691    **                                                                           **
      692    **                                                                           **
      693    *******************************************************************************
      694    *******************************************************************************
      695    *
      696    * init-xrec.i
      697    *
      698    * {1} = base field
      699    * {2} = value to initialze array with
      700    *
      701    * [1] = base
      702    * [2] = last (previous cumulative value)
      703    * [3] = this
      704    * [4] = cumulative
      705    * [5] = interval
      706    *
      707    */
      708   
      709   tt_serverio.msg-recv[1] = _ActServer._Server-MsgRec
      710   tt_serverio.msg-recv[2] = _ActServer._Server-MsgRec
      711   tt_serverio.msg-recv[3] = _ActServer._Server-MsgRec
      712    
      713           
      714   /*******************************************************************************
      715    *******************************************************************************
      716    **                                                                           **
      717    **                                                                           **
      718    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      719    **  http://www.greenfieldtech.com                                            **
      720    **                                                                           **
      721    **  ProTop is free software; you can redistribute it and/or modify it        **
      722    **  under the terms of the GNU General Public License (GPL) as published     **
      723    **  by the Free Software Foundation; either version 2 of the License, or     **
      724    **  at your option) any later version.                                       **
      725    **                                                                           **
      726    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      727    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      728    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      729    **  for more details.                                                        **
      730    **                                                                           **
      731    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      732    **  of use and alternative licensing options for this software.              **
      733    **                                                                           **
      734    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      735    **                                                                           **
      736    **  See http://www.fsf.org for more information about the GPL.               **
      737    **                                                                           **
      738    **                                                                           **
      739    *******************************************************************************
      740    *******************************************************************************
      741    *
      742    * init-xrec.i
      743    *
      744    * {1} = base field
      745    * {2} = value to initialze array with
      746    *
      747    * [1] = base
      748    * [2] = last (previous cumulative value)
      749    * [3] = this
      750    * [4] = cumulative
      751    * [5] = interval
      752    *
      753    */
      754   
      755   tt_serverio.msg-sent[1] = _ActServer._Server-MsgSent
      756   tt_serverio.msg-sent[2] = _ActServer._Server-MsgSent
      757   tt_serverio.msg-sent[3] = _ActServer._Server-MsgSent
      758    
      759           
      760   /*******************************************************************************
      761    *******************************************************************************
      762    **                                                                           **
      763    **                                                                           **
      764    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      765    **  http://www.greenfieldtech.com                                            **
      766    **                                                                           **
      767    **  ProTop is free software; you can redistribute it and/or modify it        **
      768    **  under the terms of the GNU General Public License (GPL) as published     **
      769    **  by the Free Software Foundation; either version 2 of the License, or     **
      770    **  at your option) any later version.                                       **
      771    **                                                                           **
      772    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      773    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      774    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      775    **  for more details.                                                        **
      776    **                                                                           **
      777    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      778    **  of use and alternative licensing options for this software.              **
      779    **                                                                           **
      780    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      781    **                                                                           **
      782    **  See http://www.fsf.org for more information about the GPL.               **
      783    **                                                                           **
      784    **                                                                           **
      785    *******************************************************************************
      786    *******************************************************************************
      787    *
      788    * init-xrec.i
      789    *
      790    * {1} = base field
      791    * {2} = value to initialze array with
      792    *
      793    * [1] = base
      794    * [2] = last (previous cumulative value)
      795    * [3] = this
      796    * [4] = cumulative
      797    * [5] = interval
      798    *
      799    */
      800   
      801   tt_serverio.rec-recv[1] = _ActServer._Server-RecRec
      802   tt_serverio.rec-recv[2] = _ActServer._Server-RecRec
      803   tt_serverio.rec-recv[3] = _ActServer._Server-RecRec
      804    
      805           
      806   /*******************************************************************************
      807    *******************************************************************************
      808    **                                                                           **
      809    **                                                                           **
      810    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      811    **  http://www.greenfieldtech.com                                            **
      812    **                                                                           **
      813    **  ProTop is free software; you can redistribute it and/or modify it        **
      814    **  under the terms of the GNU General Public License (GPL) as published     **
      815    **  by the Free Software Foundation; either version 2 of the License, or     **
      816    **  at your option) any later version.                                       **
      817    **                                                                           **
      818    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      819    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      820    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      821    **  for more details.                                                        **
      822    **                                                                           **
      823    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      824    **  of use and alternative licensing options for this software.              **
      825    **                                                                           **
      826    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      827    **                                                                           **
      828    **  See http://www.fsf.org for more information about the GPL.               **
      829    **                                                                           **
      830    **                                                                           **
      831    *******************************************************************************
      832    *******************************************************************************
      833    *
      834    * init-xrec.i
      835    *
      836    * {1} = base field
      837    * {2} = value to initialze array with
      838    *
      839    * [1] = base
      840    * [2] = last (previous cumulative value)
      841    * [3] = this
      842    * [4] = cumulative
      843    * [5] = interval
      844    *
      845    */
      846   
      847   tt_serverio.rec-sent[1] = _ActServer._Server-RecSent
      848   tt_serverio.rec-sent[2] = _ActServer._Server-RecSent
      849   tt_serverio.rec-sent[3] = _ActServer._Server-RecSent
      850    
      851           
      852   /*******************************************************************************
      853    *******************************************************************************
      854    **                                                                           **
      855    **                                                                           **
      856    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      857    **  http://www.greenfieldtech.com                                            **
      858    **                                                                           **
      859    **  ProTop is free software; you can redistribute it and/or modify it        **
      860    **  under the terms of the GNU General Public License (GPL) as published     **
      861    **  by the Free Software Foundation; either version 2 of the License, or     **
      862    **  at your option) any later version.                                       **
      863    **                                                                           **
      864    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      865    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      866    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      867    **  for more details.                                                        **
      868    **                                                                           **
      869    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      870    **  of use and alternative licensing options for this software.              **
      871    **                                                                           **
      872    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      873    **                                                                           **
      874    **  See http://www.fsf.org for more information about the GPL.               **
      875    **                                                                           **
      876    **                                                                           **
      877    *******************************************************************************
      878    *******************************************************************************
      879    *
      880    * init-xrec.i
      881    *
      882    * {1} = base field
      883    * {2} = value to initialze array with
      884    *
      885    * [1] = base
      886    * [2] = last (previous cumulative value)
      887    * [3] = this
      888    * [4] = cumulative
      889    * [5] = interval
      890    *
      891    */
      892   
      893   tt_serverio.qry-recv[1] = _ActServer._Server-QryRec
      894   tt_serverio.qry-recv[2] = _ActServer._Server-QryRec
      895   tt_serverio.qry-recv[3] = _ActServer._Server-QryRec
      896    
      897           
      898   /*******************************************************************************
      899    *******************************************************************************
      900    **                                                                           **
      901    **                                                                           **
      902    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      903    **  http://www.greenfieldtech.com                                            **
      904    **                                                                           **
      905    **  ProTop is free software; you can redistribute it and/or modify it        **
      906    **  under the terms of the GNU General Public License (GPL) as published     **
      907    **  by the Free Software Foundation; either version 2 of the License, or     **
      908    **  at your option) any later version.                                       **
      909    **                                                                           **
      910    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      911    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      912    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      913    **  for more details.                                                        **
      914    **                                                                           **
      915    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      916    **  of use and alternative licensing options for this software.              **
      917    **                                                                           **
      918    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      919    **                                                                           **
      920    **  See http://www.fsf.org for more information about the GPL.               **
      921    **                                                                           **
      922    **                                                                           **
      923    *******************************************************************************
      924    *******************************************************************************
      925    *
      926    * init-xrec.i
      927    *
      928    * {1} = base field
      929    * {2} = value to initialze array with
      930    *
      931    * [1] = base
      932    * [2] = last (previous cumulative value)
      933    * [3] = this
      934    * [4] = cumulative
      935    * [5] = interval
      936    *
      937    */
      938   
      939   tt_serverio.tm-intr[1] = _ActServer._Server-TimeSlice
      940   tt_serverio.tm-intr[2] = _ActServer._Server-TimeSlice
      941   tt_serverio.tm-intr[3] = _ActServer._Server-TimeSlice
      942    
      943   
      944           
      945   /*******************************************************************************
      946    *******************************************************************************
      947    **                                                                           **
      948    **                                                                           **
      949    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      950    **  http://www.greenfieldtech.com                                            **
      951    **                                                                           **
      952    **  ProTop is free software; you can redistribute it and/or modify it        **
      953    **  under the terms of the GNU General Public License (GPL) as published     **
      954    **  by the Free Software Foundation; either version 2 of the License, or     **
      955    **  at your option) any later version.                                       **
      956    **                                                                           **
      957    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      958    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      959    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      960    **  for more details.                                                        **
      961    **                                                                           **
      962    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      963    **  of use and alternative licensing options for this software.              **
      964    **                                                                           **
      965    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      966    **                                                                           **
      967    **  See http://www.fsf.org for more information about the GPL.               **
      968    **                                                                           **
      969    **                                                                           **
      970    *******************************************************************************
      971    *******************************************************************************
      972    *
      973    * init-xrec.i
      974    *
      975    * {1} = base field
      976    * {2} = value to initialze array with
      977    *
      978    * [1] = base
      979    * [2] = last (previous cumulative value)
      980    * [3] = this
      981    * [4] = cumulative
      982    * [5] = interval
      983    *
      984    */
      985   
      986   tt_serverio.bytes-recv[1] = _ActServer._Server-ByteRec
      987   tt_serverio.bytes-recv[2] = _ActServer._Server-ByteRec
      988   tt_serverio.bytes-recv[3] = _ActServer._Server-ByteRec
      989    
      990           
      991   /*******************************************************************************
      992    *******************************************************************************
      993    **                                                                           **
      994    **                                                                           **
      995    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      996    **  http://www.greenfieldtech.com                                            **
      997    **                                                                           **
      998    **  ProTop is free software; you can redistribute it and/or modify it        **
      999    **  under the terms of the GNU General Public License (GPL) as published     **
     1000    **  by the Free Software Foundation; either version 2 of the License, or     **
     1001    **  at your option) any later version.                                       **
     1002    **                                                                           **
     1003    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1004    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1005    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1006    **  for more details.                                                        **
     1007    **                                                                           **
     1008    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1009    **  of use and alternative licensing options for this software.              **
     1010    **                                                                           **
     1011    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1012    **                                                                           **
     1013    **  See http://www.fsf.org for more information about the GPL.               **
     1014    **                                                                           **
     1015    **                                                                           **
     1016    *******************************************************************************
     1017    *******************************************************************************
     1018    *
     1019    * init-xrec.i
     1020    *
     1021    * {1} = base field
     1022    * {2} = value to initialze array with
     1023    *
     1024    * [1] = base
     1025    * [2] = last (previous cumulative value)
     1026    * [3] = this
     1027    * [4] = cumulative
     1028    * [5] = interval
     1029    *
     1030    */
     1031   
     1032   tt_serverio.bytes-sent[1] = _ActServer._Server-ByteSent
     1033   tt_serverio.bytes-sent[2] = _ActServer._Server-ByteSent
     1034   tt_serverio.bytes-sent[3] = _ActServer._Server-ByteSent
     1035    
     1036   
     1037           
     1038   /*******************************************************************************
     1039    *******************************************************************************
     1040    **                                                                           **
     1041    **                                                                           **
     1042    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1043    **  http://www.greenfieldtech.com                                            **
     1044    **                                                                           **
     1045    **  ProTop is free software; you can redistribute it and/or modify it        **
     1046    **  under the terms of the GNU General Public License (GPL) as published     **
     1047    **  by the Free Software Foundation; either version 2 of the License, or     **
     1048    **  at your option) any later version.                                       **
     1049    **                                                                           **
     1050    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1051    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1052    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1053    **  for more details.                                                        **
     1054    **                                                                           **
     1055    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1056    **  of use and alternative licensing options for this software.              **
     1057    **                                                                           **
     1058    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1059    **                                                                           **
     1060    **  See http://www.fsf.org for more information about the GPL.               **
     1061    **                                                                           **
     1062    **                                                                           **
     1063    *******************************************************************************
     1064    *******************************************************************************
     1065    *
     1066    * init-xrec.i
     1067    *
     1068    * {1} = base field
     1069    * {2} = value to initialze array with
     1070    *
     1071    * [1] = base
     1072    * [2] = last (previous cumulative value)
     1073    * [3] = this
     1074    * [4] = cumulative
     1075    * [5] = interval
     1076    *
     1077    */
     1078   
     1079   tt_serverio.srv-dba[1] = logRd
     1080   tt_serverio.srv-dba[2] = logRd
     1081   tt_serverio.srv-dba[3] = logRd
     1082    
     1083           
     1084   /*******************************************************************************
     1085    *******************************************************************************
     1086    **                                                                           **
     1087    **                                                                           **
     1088    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1089    **  http://www.greenfieldtech.com                                            **
     1090    **                                                                           **
     1091    **  ProTop is free software; you can redistribute it and/or modify it        **
     1092    **  under the terms of the GNU General Public License (GPL) as published     **
     1093    **  by the Free Software Foundation; either version 2 of the License, or     **
     1094    **  at your option) any later version.                                       **
     1095    **                                                                           **
     1096    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1097    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1098    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1099    **  for more details.                                                        **
     1100    **                                                                           **
     1101    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1102    **  of use and alternative licensing options for this software.              **
     1103    **                                                                           **
     1104    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1105    **                                                                           **
     1106    **  See http://www.fsf.org for more information about the GPL.               **
     1107    **                                                                           **
     1108    **                                                                           **
     1109    *******************************************************************************
     1110    *******************************************************************************
     1111    *
     1112    * init-xrec.i
     1113    *
     1114    * {1} = base field
     1115    * {2} = value to initialze array with
     1116    *
     1117    * [1] = base
     1118    * [2] = last (previous cumulative value)
     1119    * [3] = this
     1120    * [4] = cumulative
     1121    * [5] = interval
     1122    *
     1123    */
     1124   
     1125   tt_serverio.srv-dbr[1] = OSRd
     1126   tt_serverio.srv-dbr[2] = OSRd
     1127   tt_serverio.srv-dbr[3] = OSRd
     1128    
     1129           
     1130   /*******************************************************************************
     1131    *******************************************************************************
     1132    **                                                                           **
     1133    **                                                                           **
     1134    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1135    **  http://www.greenfieldtech.com                                            **
     1136    **                                                                           **
     1137    **  ProTop is free software; you can redistribute it and/or modify it        **
     1138    **  under the terms of the GNU General Public License (GPL) as published     **
     1139    **  by the Free Software Foundation; either version 2 of the License, or     **
     1140    **  at your option) any later version.                                       **
     1141    **                                                                           **
     1142    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1143    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1144    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1145    **  for more details.                                                        **
     1146    **                                                                           **
     1147    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1148    **  of use and alternative licensing options for this software.              **
     1149    **                                                                           **
     1150    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1151    **                                                                           **
     1152    **  See http://www.fsf.org for more information about the GPL.               **
     1153    **                                                                           **
     1154    **                                                                           **
     1155    *******************************************************************************
     1156    *******************************************************************************
     1157    *
     1158    * init-xrec.i
     1159    *
     1160    * {1} = base field
     1161    * {2} = value to initialze array with
     1162    *
     1163    * [1] = base
     1164    * [2] = last (previous cumulative value)
     1165    * [3] = this
     1166    * [4] = cumulative
     1167    * [5] = interval
     1168    *
     1169    */
     1170   
     1171   tt_serverio.srv-dbw[1] = OSWr
     1172   tt_serverio.srv-dbw[2] = OSWr
     1173   tt_serverio.srv-dbw[3] = OSWr
     1174    
     1175         .
     1176   
     1177       end.
     1178   
     1179     assign
     1180       tt_serverio.xvalid = yes
     1181   
     1182       tt_serverio.srvtyp   = _Servers._Server-type
     1183       tt_serverio.srvport  = _Servers._Server-portNum
     1184       tt_serverio.curr-usr = _Servers._Server-CurrUsers
     1185       tt_serverio.max-usr  = _Servers._Server-MaxUsers
     1186   
     1187       
     1188   /*******************************************************************************
     1189    *******************************************************************************
     1190    **                                                                           **
     1191    **                                                                           **
     1192    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1193    **  http://www.greenfieldtech.com                                            **
     1194    **                                                                           **
     1195    **  ProTop is free software; you can redistribute it and/or modify it        **
     1196    **  under the terms of the GNU General Public License (GPL) as published     **
     1197    **  by the Free Software Foundation; either version 2 of the License, or     **
     1198    **  at your option) any later version.                                       **
     1199    **                                                                           **
     1200    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1201    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1202    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1203    **  for more details.                                                        **
     1204    **                                                                           **
     1205    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1206    **  of use and alternative licensing options for this software.              **
     1207    **                                                                           **
     1208    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1209    **                                                                           **
     1210    **  See http://www.fsf.org for more information about the GPL.               **
     1211    **                                                                           **
     1212    **                                                                           **
     1213    *******************************************************************************
     1214    *******************************************************************************
     1215    *
     1216    * upd-xrec.i
     1217    *
     1218    * {1} = base field
     1219    * {2} = value to update metrics with
     1220    *
     1221    * [1] = base
     1222    * [2] = last (previous cumulative value)
     1223    * [3] = this
     1224    * [4] = cumulative
     1225    * [5] = interval
     1226    *
     1227    */
     1228   
     1229   tt_serverio.msg-recv[3] = _ActServer._Server-MsgRec
     1230   tt_serverio.msg-recv[4] = tt_serverio.msg-recv[3] - tt_serverio.msg-recv[1]
     1231   tt_serverio.msg-recv[5] = tt_serverio.msg-recv[3] - tt_serverio.msg-recv[2]
     1232   tt_serverio.msg-recv[2] = tt_serverio.msg-recv[3]
     1233    
     1234       
     1235   /*******************************************************************************
     1236    *******************************************************************************
     1237    **                                                                           **
     1238    **                                                                           **
     1239    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1240    **  http://www.greenfieldtech.com                                            **
     1241    **                                                                           **
     1242    **  ProTop is free software; you can redistribute it and/or modify it        **
     1243    **  under the terms of the GNU General Public License (GPL) as published     **
     1244    **  by the Free Software Foundation; either version 2 of the License, or     **
     1245    **  at your option) any later version.                                       **
     1246    **                                                                           **
     1247    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1248    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1249    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1250    **  for more details.                                                        **
     1251    **                                                                           **
     1252    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1253    **  of use and alternative licensing options for this software.              **
     1254    **                                                                           **
     1255    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1256    **                                                                           **
     1257    **  See http://www.fsf.org for more information about the GPL.               **
     1258    **                                                                           **
     1259    **                                                                           **
     1260    *******************************************************************************
     1261    *******************************************************************************
     1262    *
     1263    * upd-xrec.i
     1264    *
     1265    * {1} = base field
     1266    * {2} = value to update metrics with
     1267    *
     1268    * [1] = base
     1269    * [2] = last (previous cumulative value)
     1270    * [3] = this
     1271    * [4] = cumulative
     1272    * [5] = interval
     1273    *
     1274    */
     1275   
     1276   tt_serverio.msg-sent[3] = _ActServer._Server-MsgSent
     1277   tt_serverio.msg-sent[4] = tt_serverio.msg-sent[3] - tt_serverio.msg-sent[1]
     1278   tt_serverio.msg-sent[5] = tt_serverio.msg-sent[3] - tt_serverio.msg-sent[2]
     1279   tt_serverio.msg-sent[2] = tt_serverio.msg-sent[3]
     1280    
     1281       
     1282   /*******************************************************************************
     1283    *******************************************************************************
     1284    **                                                                           **
     1285    **                                                                           **
     1286    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1287    **  http://www.greenfieldtech.com                                            **
     1288    **                                                                           **
     1289    **  ProTop is free software; you can redistribute it and/or modify it        **
     1290    **  under the terms of the GNU General Public License (GPL) as published     **
     1291    **  by the Free Software Foundation; either version 2 of the License, or     **
     1292    **  at your option) any later version.                                       **
     1293    **                                                                           **
     1294    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1295    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1296    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1297    **  for more details.                                                        **
     1298    **                                                                           **
     1299    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1300    **  of use and alternative licensing options for this software.              **
     1301    **                                                                           **
     1302    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1303    **                                                                           **
     1304    **  See http://www.fsf.org for more information about the GPL.               **
     1305    **                                                                           **
     1306    **                                                                           **
     1307    *******************************************************************************
     1308    *******************************************************************************
     1309    *
     1310    * upd-xrec.i
     1311    *
     1312    * {1} = base field
     1313    * {2} = value to update metrics with
     1314    *
     1315    * [1] = base
     1316    * [2] = last (previous cumulative value)
     1317    * [3] = this
     1318    * [4] = cumulative
     1319    * [5] = interval
     1320    *
     1321    */
     1322   
     1323   tt_serverio.rec-recv[3] = _ActServer._Server-RecRec
     1324   tt_serverio.rec-recv[4] = tt_serverio.rec-recv[3] - tt_serverio.rec-recv[1]
     1325   tt_serverio.rec-recv[5] = tt_serverio.rec-recv[3] - tt_serverio.rec-recv[2]
     1326   tt_serverio.rec-recv[2] = tt_serverio.rec-recv[3]
     1327    
     1328       
     1329   /*******************************************************************************
     1330    *******************************************************************************
     1331    **                                                                           **
     1332    **                                                                           **
     1333    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1334    **  http://www.greenfieldtech.com                                            **
     1335    **                                                                           **
     1336    **  ProTop is free software; you can redistribute it and/or modify it        **
     1337    **  under the terms of the GNU General Public License (GPL) as published     **
     1338    **  by the Free Software Foundation; either version 2 of the License, or     **
     1339    **  at your option) any later version.                                       **
     1340    **                                                                           **
     1341    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1342    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1343    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1344    **  for more details.                                                        **
     1345    **                                                                           **
     1346    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1347    **  of use and alternative licensing options for this software.              **
     1348    **                                                                           **
     1349    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1350    **                                                                           **
     1351    **  See http://www.fsf.org for more information about the GPL.               **
     1352    **                                                                           **
     1353    **                                                                           **
     1354    *******************************************************************************
     1355    *******************************************************************************
     1356    *
     1357    * upd-xrec.i
     1358    *
     1359    * {1} = base field
     1360    * {2} = value to update metrics with
     1361    *
     1362    * [1] = base
     1363    * [2] = last (previous cumulative value)
     1364    * [3] = this
     1365    * [4] = cumulative
     1366    * [5] = interval
     1367    *
     1368    */
     1369   
     1370   tt_serverio.rec-sent[3] = _ActServer._Server-RecSent
     1371   tt_serverio.rec-sent[4] = tt_serverio.rec-sent[3] - tt_serverio.rec-sent[1]
     1372   tt_serverio.rec-sent[5] = tt_serverio.rec-sent[3] - tt_serverio.rec-sent[2]
     1373   tt_serverio.rec-sent[2] = tt_serverio.rec-sent[3]
     1374    
     1375       
     1376   /*******************************************************************************
     1377    *******************************************************************************
     1378    **                                                                           **
     1379    **                                                                           **
     1380    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1381    **  http://www.greenfieldtech.com                                            **
     1382    **                                                                           **
     1383    **  ProTop is free software; you can redistribute it and/or modify it        **
     1384    **  under the terms of the GNU General Public License (GPL) as published     **
     1385    **  by the Free Software Foundation; either version 2 of the License, or     **
     1386    **  at your option) any later version.                                       **
     1387    **                                                                           **
     1388    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1389    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1390    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1391    **  for more details.                                                        **
     1392    **                                                                           **
     1393    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1394    **  of use and alternative licensing options for this software.              **
     1395    **                                                                           **
     1396    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1397    **                                                                           **
     1398    **  See http://www.fsf.org for more information about the GPL.               **
     1399    **                                                                           **
     1400    **                                                                           **
     1401    *******************************************************************************
     1402    *******************************************************************************
     1403    *
     1404    * upd-xrec.i
     1405    *
     1406    * {1} = base field
     1407    * {2} = value to update metrics with
     1408    *
     1409    * [1] = base
     1410    * [2] = last (previous cumulative value)
     1411    * [3] = this
     1412    * [4] = cumulative
     1413    * [5] = interval
     1414    *
     1415    */
     1416   
     1417   tt_serverio.qry-recv[3] = _ActServer._Server-QryRec
     1418   tt_serverio.qry-recv[4] = tt_serverio.qry-recv[3] - tt_serverio.qry-recv[1]
     1419   tt_serverio.qry-recv[5] = tt_serverio.qry-recv[3] - tt_serverio.qry-recv[2]
     1420   tt_serverio.qry-recv[2] = tt_serverio.qry-recv[3]
     1421    
     1422       
     1423   /*******************************************************************************
     1424    *******************************************************************************
     1425    **                                                                           **
     1426    **                                                                           **
     1427    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1428    **  http://www.greenfieldtech.com                                            **
     1429    **                                                                           **
     1430    **  ProTop is free software; you can redistribute it and/or modify it        **
     1431    **  under the terms of the GNU General Public License (GPL) as published     **
     1432    **  by the Free Software Foundation; either version 2 of the License, or     **
     1433    **  at your option) any later version.                                       **
     1434    **                                                                           **
     1435    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1436    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1437    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1438    **  for more details.                                                        **
     1439    **                                                                           **
     1440    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1441    **  of use and alternative licensing options for this software.              **
     1442    **                                                                           **
     1443    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1444    **                                                                           **
     1445    **  See http://www.fsf.org for more information about the GPL.               **
     1446    **                                                                           **
     1447    **                                                                           **
     1448    *******************************************************************************
     1449    *******************************************************************************
     1450    *
     1451    * upd-xrec.i
     1452    *
     1453    * {1} = base field
     1454    * {2} = value to update metrics with
     1455    *
     1456    * [1] = base
     1457    * [2] = last (previous cumulative value)
     1458    * [3] = this
     1459    * [4] = cumulative
     1460    * [5] = interval
     1461    *
     1462    */
     1463   
     1464   tt_serverio.tm-intr[3] = _ActServer._Server-TimeSlice
     1465   tt_serverio.tm-intr[4] = tt_serverio.tm-intr[3] - tt_serverio.tm-intr[1]
     1466   tt_serverio.tm-intr[5] = tt_serverio.tm-intr[3] - tt_serverio.tm-intr[2]
     1467   tt_serverio.tm-intr[2] = tt_serverio.tm-intr[3]
     1468    
     1469   
     1470       
     1471   /*******************************************************************************
     1472    *******************************************************************************
     1473    **                                                                           **
     1474    **                                                                           **
     1475    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1476    **  http://www.greenfieldtech.com                                            **
     1477    **                                                                           **
     1478    **  ProTop is free software; you can redistribute it and/or modify it        **
     1479    **  under the terms of the GNU General Public License (GPL) as published     **
     1480    **  by the Free Software Foundation; either version 2 of the License, or     **
     1481    **  at your option) any later version.                                       **
     1482    **                                                                           **
     1483    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1484    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1485    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1486    **  for more details.                                                        **
     1487    **                                                                           **
     1488    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1489    **  of use and alternative licensing options for this software.              **
     1490    **                                                                           **
     1491    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1492    **                                                                           **
     1493    **  See http://www.fsf.org for more information about the GPL.               **
     1494    **                                                                           **
     1495    **                                                                           **
     1496    *******************************************************************************
     1497    *******************************************************************************
     1498    *
     1499    * upd-xrec.i
     1500    *
     1501    * {1} = base field
     1502    * {2} = value to update metrics with
     1503    *
     1504    * [1] = base
     1505    * [2] = last (previous cumulative value)
     1506    * [3] = this
     1507    * [4] = cumulative
     1508    * [5] = interval
     1509    *
     1510    */
     1511   
     1512   tt_serverio.bytes-recv[3] = _ActServer._Server-ByteRec
     1513   tt_serverio.bytes-recv[4] = tt_serverio.bytes-recv[3] - tt_serverio.bytes-recv[1]
     1514   tt_serverio.bytes-recv[5] = tt_serverio.bytes-recv[3] - tt_serverio.bytes-recv[2]
     1515   tt_serverio.bytes-recv[2] = tt_serverio.bytes-recv[3]
     1516    
     1517       
     1518   /*******************************************************************************
     1519    *******************************************************************************
     1520    **                                                                           **
     1521    **                                                                           **
     1522    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1523    **  http://www.greenfieldtech.com                                            **
     1524    **                                                                           **
     1525    **  ProTop is free software; you can redistribute it and/or modify it        **
     1526    **  under the terms of the GNU General Public License (GPL) as published     **
     1527    **  by the Free Software Foundation; either version 2 of the License, or     **
     1528    **  at your option) any later version.                                       **
     1529    **                                                                           **
     1530    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1531    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1532    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1533    **  for more details.                                                        **
     1534    **                                                                           **
     1535    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1536    **  of use and alternative licensing options for this software.              **
     1537    **                                                                           **
     1538    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1539    **                                                                           **
     1540    **  See http://www.fsf.org for more information about the GPL.               **
     1541    **                                                                           **
     1542    **                                                                           **
     1543    *******************************************************************************
     1544    *******************************************************************************
     1545    *
     1546    * upd-xrec.i
     1547    *
     1548    * {1} = base field
     1549    * {2} = value to update metrics with
     1550    *
     1551    * [1] = base
     1552    * [2] = last (previous cumulative value)
     1553    * [3] = this
     1554    * [4] = cumulative
     1555    * [5] = interval
     1556    *
     1557    */
     1558   
     1559   tt_serverio.bytes-sent[3] = _ActServer._Server-ByteSent
     1560   tt_serverio.bytes-sent[4] = tt_serverio.bytes-sent[3] - tt_serverio.bytes-sent[1]
     1561   tt_serverio.bytes-sent[5] = tt_serverio.bytes-sent[3] - tt_serverio.bytes-sent[2]
     1562   tt_serverio.bytes-sent[2] = tt_serverio.bytes-sent[3]
     1563    
     1564   
     1565       
     1566   /*******************************************************************************
     1567    *******************************************************************************
     1568    **                                                                           **
     1569    **                                                                           **
     1570    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1571    **  http://www.greenfieldtech.com                                            **
     1572    **                                                                           **
     1573    **  ProTop is free software; you can redistribute it and/or modify it        **
     1574    **  under the terms of the GNU General Public License (GPL) as published     **
     1575    **  by the Free Software Foundation; either version 2 of the License, or     **
     1576    **  at your option) any later version.                                       **
     1577    **                                                                           **
     1578    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1579    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1580    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1581    **  for more details.                                                        **
     1582    **                                                                           **
     1583    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1584    **  of use and alternative licensing options for this software.              **
     1585    **                                                                           **
     1586    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1587    **                                                                           **
     1588    **  See http://www.fsf.org for more information about the GPL.               **
     1589    **                                                                           **
     1590    **                                                                           **
     1591    *******************************************************************************
     1592    *******************************************************************************
     1593    *
     1594    * upd-xrec.i
     1595    *
     1596    * {1} = base field
     1597    * {2} = value to update metrics with
     1598    *
     1599    * [1] = base
     1600    * [2] = last (previous cumulative value)
     1601    * [3] = this
     1602    * [4] = cumulative
     1603    * [5] = interval
     1604    *
     1605    */
     1606   
     1607   tt_serverio.srv-dba[3] = logRd
     1608   tt_serverio.srv-dba[4] = tt_serverio.srv-dba[3] - tt_serverio.srv-dba[1]
     1609   tt_serverio.srv-dba[5] = tt_serverio.srv-dba[3] - tt_serverio.srv-dba[2]
     1610   tt_serverio.srv-dba[2] = tt_serverio.srv-dba[3]
     1611    
     1612       
     1613   /*******************************************************************************
     1614    *******************************************************************************
     1615    **                                                                           **
     1616    **                                                                           **
     1617    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1618    **  http://www.greenfieldtech.com                                            **
     1619    **                                                                           **
     1620    **  ProTop is free software; you can redistribute it and/or modify it        **
     1621    **  under the terms of the GNU General Public License (GPL) as published     **
     1622    **  by the Free Software Foundation; either version 2 of the License, or     **
     1623    **  at your option) any later version.                                       **
     1624    **                                                                           **
     1625    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1626    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1627    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1628    **  for more details.                                                        **
     1629    **                                                                           **
     1630    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1631    **  of use and alternative licensing options for this software.              **
     1632    **                                                                           **
     1633    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1634    **                                                                           **
     1635    **  See http://www.fsf.org for more information about the GPL.               **
     1636    **                                                                           **
     1637    **                                                                           **
     1638    *******************************************************************************
     1639    *******************************************************************************
     1640    *
     1641    * upd-xrec.i
     1642    *
     1643    * {1} = base field
     1644    * {2} = value to update metrics with
     1645    *
     1646    * [1] = base
     1647    * [2] = last (previous cumulative value)
     1648    * [3] = this
     1649    * [4] = cumulative
     1650    * [5] = interval
     1651    *
     1652    */
     1653   
     1654   tt_serverio.srv-dbr[3] = OSRd
     1655   tt_serverio.srv-dbr[4] = tt_serverio.srv-dbr[3] - tt_serverio.srv-dbr[1]
     1656   tt_serverio.srv-dbr[5] = tt_serverio.srv-dbr[3] - tt_serverio.srv-dbr[2]
     1657   tt_serverio.srv-dbr[2] = tt_serverio.srv-dbr[3]
     1658    
     1659       
     1660   /*******************************************************************************
     1661    *******************************************************************************
     1662    **                                                                           **
     1663    **                                                                           **
     1664    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1665    **  http://www.greenfieldtech.com                                            **
     1666    **                                                                           **
     1667    **  ProTop is free software; you can redistribute it and/or modify it        **
     1668    **  under the terms of the GNU General Public License (GPL) as published     **
     1669    **  by the Free Software Foundation; either version 2 of the License, or     **
     1670    **  at your option) any later version.                                       **
     1671    **                                                                           **
     1672    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1673    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1674    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1675    **  for more details.                                                        **
     1676    **                                                                           **
     1677    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1678    **  of use and alternative licensing options for this software.              **
     1679    **                                                                           **
     1680    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1681    **                                                                           **
     1682    **  See http://www.fsf.org for more information about the GPL.               **
     1683    **                                                                           **
     1684    **                                                                           **
     1685    *******************************************************************************
     1686    *******************************************************************************
     1687    *
     1688    * upd-xrec.i
     1689    *
     1690    * {1} = base field
     1691    * {2} = value to update metrics with
     1692    *
     1693    * [1] = base
     1694    * [2] = last (previous cumulative value)
     1695    * [3] = this
     1696    * [4] = cumulative
     1697    * [5] = interval
     1698    *
     1699    */
     1700   
     1701   tt_serverio.srv-dbw[3] = OSWr
     1702   tt_serverio.srv-dbw[4] = tt_serverio.srv-dbw[3] - tt_serverio.srv-dbw[1]
     1703   tt_serverio.srv-dbw[5] = tt_serverio.srv-dbw[3] - tt_serverio.srv-dbw[2]
     1704   tt_serverio.srv-dbw[2] = tt_serverio.srv-dbw[3]
     1705    
     1706     .
     1707   
     1708     return.
     1709   
     1710   end.
     1711   
     1712   procedure age_serverio:
     1713   
     1714     for each tt_serverio:
     1715   
     1716       if tt_serverio.xvalid = no then
     1717         delete tt_serverio.
     1718        else
     1719         assign
     1720           tt_serverio.xvalid = no
     1721   /*
     1722           {lib/upd-xrec.i tt_serverio.msg-recv tt_serverio.msg-recv[3]}
     1723           {lib/upd-xrec.i tt_serverio.msg-sent tt_serverio.msg-sent[3]}
     1724           {lib/upd-xrec.i tt_serverio.rec-recv tt_serverio.rec-recv[3]}
     1725           {lib/upd-xrec.i tt_serverio.rec-sent tt_serverio.rec-sent[3]}
     1726           {lib/upd-xrec.i tt_serverio.qry-recv tt_serverio.qry-recv[3]}
     1727           {lib/upd-xrec.i tt_serverio.tm-intr  tt_serverio.tm-intr[3]}
     1728   
     1729           {lib/upd-xrec.i tt_serverio.bytes-recv tt_serverio.bytes-recv[3]}
     1730           {lib/upd-xrec.i tt_serverio.bytes-sent tt_serverio.bytes-sent[3]}
     1731   
     1732           {lib/upd-xrec.i tt_serverio.srv-dba tt_serverio.srv-dba[3]}
     1733           {lib/upd-xrec.i tt_serverio.srv-dbr tt_serverio.srv-dbr[3]}
     1734           {lib/upd-xrec.i tt_serverio.srv-dbw tt_serverio.srv-dbw[3]}
     1735           tt_serverio.hr  = 100 * (( tt_serverio.srv-dba[x] - tt_serverio.srv-dbr[x] ) / tt_serverio.srv-dba[x] )
     1736           tt_serverio.hr  = ( if tt_serverio.hr = ? then 0 else tt_serverio.hr )
     1737    */
     1738         .
     1739   
     1740     end.
     1741   
     1742     return.
     1743   
     1744   end.
     1745    
     1746   
     1747   define temp-table tt_serverioact no-undo
     1748   
     1749     field xid        as integer
     1750     field xvalid     as logical
     1751   
     1752     field srvnum     as integer format ">>>>9"        label "Srv"
     1753     field srvtyp     as character format "x(5)"       label "Type"
     1754     field loginport  as integer format ">>>>9"        label "-S"
     1755     field srvport    as integer format ">>>>9"        label "Port"
     1756     field curr-usr   as integer format ">>>9"         label "Cnx"
     1757     field max-usr    as integer format ">>>9"         label "Max"
     1758   
     1759     field qry-recv   as decimal format ">>>>>>>9"     label "QryRcvd"
     1760     field recs-qry   as decimal format ">>>>>>>>9"    label "recSndQry"
     1761     field bytes-qry  as decimal format ">>>>>>>>9"    label "bytSndQry"
     1762   
     1763     field msg-recv   as decimal format ">>>>>>>>9"    label "MsgRcvd"
     1764     field rec-recv   as decimal format ">>>>>>>>9"    label "RecRcvd"
     1765     field rrec-msg   as decimal format ">>9.99"       label "rr/msg"
     1766   
     1767     field msg-sent   as decimal format ">>>>>>>>9"    label "MsgSent"
     1768     field rec-sent   as decimal format ">>>>>>>>>9"   label "RecSent"
     1769     field srec-msg   as decimal format ">>>9.99"      label "rs/msg"
     1770   
     1771     field bytes-sent as decimal format ">>>>>>9.99"   label "MB Sent"
     1772     field bytes-recv as decimal format ">>>>>9.99"    label "MB Rcvd"
     1773   
     1774     field rmsg-sz    as decimal format ">>>>>>9"      label "RcvdSz"
     1775     field smsg-sz    as decimal format ">>>>>>9"      label "SendSz"
     1776   
     1777     index xid-idx      is unique xid
     1778   
     1779     index bytes-sent-idx  is primary bytes-sent descending xid descending
     1780     index bytes-recv-idx  bytes-recv descending xid descending
     1781   
     1782     index msg-sent-idx msg-sent descending xid descending
     1783     index msg-recv-idx msg-recv descending xid descending
     1784   
     1785     index srvtyp-idx   srvtyp   descending xid descending
     1786     index srvport-idx  srvport  descending xid descending
     1787     index curr-usr-idx curr-usr descending xid descending
     1788     index max-usr-idx  max-usr  descending xid descending
     1789   .
     1790   
     1791   define buffer total_serverioact for tt_serverioact.
     1792   
     1793   
     1794   /* lib/dumpTT.i
     1795    *
     1796    * simplified to a single line -- include should be eliminated.
     1797    *
     1798    */
     1799   
     1800   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.1 &THEN
     1801   /*** +++
     1802   file-info:file-name = "./ptdefs".
     1803   if file-info:full-pathname <> ? and index( file-info:file-type, "d" ) > 0 and index( file-info:file-type, "w" ) > 0 then
     1804     do:
     1805   
     1806       file-info:file-name = "./ptdefs/{1}.xsd".
     1807   
     1808       if true /* file-info:full-pathname = ? or file-info:file-size = 0 */ then
     1809         do:
     1810   
     1811           temp-table {1}:write-xmlschema(
     1812             "file",
     1813   /*        substitute( "ptdefs/&1.xsd", "{1}" ), */
     1814   /*        "./ptdefs/{1}.xsd", */
     1815             ( if opsys = "unix" then "./ptdefs/{1}.xsd" else ".~\ptdefs~\{1}.xsd" ),
     1816             true
     1817   
     1818         &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.2
     1819         &THEN
     1820             , ?, ?, ?
     1821         &ENDIF
     1822   
     1823       ).
     1824   
     1825       end.
     1826   
     1827     end.
     1828    +++ ***/
     1829   &ENDIF
     1830    
     1831   
     1832   define new global shared variable rowLimit as integer no-undo.
     1833   
     1834   define variable mega as integer no-undo.
     1835   mega = 1024 * 1024.
     1836   
     1837   procedure mon-init:
     1838   
     1839     empty temp-table tt_serverio.
     1840     run updTick.
     1841   
     1842     return.
     1843   
     1844   end.
     1845   
     1846   procedure mon-update:
     1847   
     1848     define input parameter argList as character no-undo.
     1849   
     1850     define variable x-dba as decimal no-undo.
     1851     define variable x-dbr as decimal no-undo.
     1852     define variable x-dbw as decimal no-undo.
     1853   
     1854     define variable i as integer no-undo.
     1855     define variable j as integer no-undo.
     1856   
     1857     define variable brokerType as character no-undo.
     1858     define variable loginPort  as integer   no-undo.
     1859   
     1860     define variable qh as handle no-undo.
     1861     define variable bh as handle no-undo.
     1862   
     1863     create buffer bh for table "_servers".
     1864     create query qh.
     1865     qh:set-buffers( bh ).
     1866   
     1867     run updTick.
     1868   
     1869     empty temp-table tt_serverioact.
     1870   
     1871     for each dictdb._Servers no-lock,
     1872         first dictdb._ActServer no-lock where dictdb._ActServer._Server-Id = dictdb._Servers._Server-Id:
     1873   
     1874       if _servers._server-type = "inactive" then next.
     1875   
     1876       run update_serverio( input dictdb._Servers._Server-Id, input x-dba, input x-dbr, input x-dbw ).
     1877   
     1878       brokerType = ?.
     1879       publish "getBrokerType" ( _Servers._Server-Id, output brokerType ).
     1880   
     1881       find tt_serverio where tt_serverio.xid =  _Servers._Server-Id no-error.
     1882       if available tt_serverio and brokerType <> ? then tt_serverio.srvtyp = brokerType.
     1883   
     1884       qh:query-prepare(
     1885         substitute(
     1886           "for each _servers no-lock where _servers._server-broker-pid = &1",
     1887           ( buffer _servers:handle:buffer-field( "_server-broker-pid" ):buffer-value )
     1888         )
     1889       ) no-error.
     1890       if error-status:num-messages = 0 then
     1891         do:
     1892           qh:query-open.
     1893           qh:get-first( no-lock ).
     1894           tt_serverio.loginPort = bh:buffer-field( "_server-portnum" ):buffer-value no-error.
     1895           qh:query-close.
     1896         end.
     1897   
     1898     end.
     1899   
     1900     delete object bh.
     1901     delete object qh.
     1902   
     1903     create total_serverioact.
     1904     assign
     1905       total_serverioact.xid      = 9999
     1906       total_serverioact.xvalid   = yes
     1907       total_serverioact.srvnum   = 9999
     1908       total_serverioact.srvtyp   = "Total"
     1909     .
     1910   
     1911     for each tt_serverio:
     1912   
     1913       i = i + 1.
     1914   
     1915   &IF DEFINED( OE10 ) &THEN
     1916       tt_serverio.srvport = unsignMe( tt_serverio.srvport, 16 ).
     1917   &ENDIF
     1918   
     1919       create tt_serverioact.
     1920       assign
     1921         tt_serverioact.xid      = tt_serverio.xid
     1922         tt_serverioact.srvnum   = tt_serverio.srvnum
     1923         tt_serverioact.srvtyp   = tt_serverio.srvtyp
     1924         tt_serverioact.loginPort = tt_serverio.loginPort
     1925         tt_serverioact.srvport  = tt_serverio.srvport
     1926         tt_serverioact.curr-usr = tt_serverio.curr-usr
     1927         tt_serverioact.max-usr  = tt_serverio.max-usr
     1928   
     1929         tt_serverioact.msg-recv = tt_serverio.msg-recv[x] / z
     1930         tt_serverioact.msg-sent = tt_serverio.msg-sent[x] / z
     1931         tt_serverioact.rec-recv = tt_serverio.rec-recv[x] / z
     1932         tt_serverioact.rec-sent = tt_serverio.rec-sent[x] / z
     1933         tt_serverioact.qry-recv = tt_serverio.qry-recv[x] / z
     1934   
     1935         tt_serverioact.bytes-sent = (( tt_serverio.bytes-sent[x] / z ) / mega )
     1936         tt_serverioact.bytes-recv = (( tt_serverio.bytes-recv[x] / z ) / mega )
     1937   
     1938         tt_serverioact.recs-qry    = ( if tt_serverioact.qry-recv = 0 then 0 else tt_serverioact.rec-sent / tt_serverioact.qry-recv )
     1939         tt_serverioact.bytes-qry   = ( if tt_serverioact.qry-recv = 0 then 0 else ( tt_serverioact.bytes-sent * mega ) / tt_serverioact.qry-recv )
     1940   
     1941         tt_serverioact.rrec-msg   = ( if tt_serverioact.msg-recv = 0 then 0 else tt_serverioact.rec-recv / tt_serverioact.msg-recv )
     1942         tt_serverioact.srec-msg   = ( if tt_serverioact.msg-sent = 0 then 0 else tt_serverioact.rec-sent / tt_serverioact.msg-sent )
     1943   
     1944         tt_serverioact.rmsg-sz    = ( if tt_serverioact.msg-recv = 0 then 0 else ( tt_serverioact.bytes-recv * mega ) / tt_serverioact.msg-recv )
     1945         tt_serverioact.smsg-sz    = ( if tt_serverioact.msg-sent = 0 then 0 else ( tt_serverioact.bytes-sent * mega ) / tt_serverioact.msg-sent )
     1946   
     1947         total_serverioact.curr-usr   = total_serverioact.curr-usr   + tt_serverioact.curr-usr
     1948         total_serverioact.max-usr    = total_serverioact.max-usr    + tt_serverioact.max-usr
     1949         total_serverioact.msg-recv   = total_serverioact.msg-recv   + tt_serverioact.msg-recv
     1950         total_serverioact.msg-sent   = total_serverioact.msg-sent   + tt_serverioact.msg-sent
     1951         total_serverioact.rec-recv   = total_serverioact.rec-recv   + tt_serverioact.rec-recv
     1952         total_serverioact.rec-sent   = total_serverioact.rec-sent   + tt_serverioact.rec-sent
     1953         total_serverioact.bytes-recv = total_serverioact.bytes-recv + tt_serverioact.bytes-recv
     1954         total_serverioact.bytes-sent = total_serverioact.bytes-sent + tt_serverioact.bytes-sent
     1955         total_serverioact.qry-recv   = total_serverioact.qry-recv   + tt_serverioact.qry-recv
     1956   
     1957         total_serverioact.rrec-msg   = total_serverioact.rec-recv / total_serverioact.msg-recv
     1958         total_serverioact.srec-msg   = total_serverioact.rec-sent / total_serverioact.msg-sent
     1959   
     1960       .
     1961   
     1962       /*** if ( rowLimit > 0 ) and ( i >= rowLimit ) then leave. ***/
     1963   
     1964     end.
     1965   
     1966     assign
     1967       total_serverioact.rrec-msg   = total_serverioact.rec-recv   / total_serverioact.msg-recv
     1968       total_serverioact.srec-msg   = total_serverioact.rec-sent   / total_serverioact.msg-sent
     1969       total_serverioact.recs-qry   = ( if total_serverioact.qry-recv = 0 then 0 else total_serverioact.rec-sent   / total_serverioact.qry-recv )
     1970       total_serverioact.bytes-qry  = ( if total_serverioact.qry-recv = 0 then 0 else ( total_serverioact.bytes-sent * mega ) / total_serverioact.qry-recv )
     1971       total_serverioact.rmsg-sz    = ( total_serverioact.bytes-recv * mega ) / total_serverioact.msg-recv
     1972       total_serverioact.smsg-sz    = ( total_serverioact.bytes-sent * mega ) / total_serverioact.msg-sent
     1973     .
     1974   
     1975     release total_serverioact.            /* don't ask... I have no clue */
     1976   
     1977     add2ds( temp-table tt_serverioact:default-buffer-handle ).
     1978   
     1979     return.
     1980   
     1981   end.
     1982   
     1983   return.
