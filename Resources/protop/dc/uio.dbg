        1   /*******************************************************************************
        2    *******************************************************************************
        3    **                                                                           **
        4    **                                                                           **
        5    **  Copyright 2003-2012 Tom Bascom, Greenfield Technologies                  **
        6    **  http://www.greenfieldtech.com                                            **
        7    **                                                                           **
        8    **  ProTop is free software; you can redistribute it and/or modify it        **
        9    **  under the terms of the GNU General Public License (GPL) as published     **
       10    **  by the Free Software Foundation; either version 2 of the License, or     **
       11    **  at your option) any later version.                                       **
       12    **                                                                           **
       13    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
       14    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
       15    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
       16    **  for more details.                                                        **
       17    **                                                                           **
       18    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
       19    **  of use and alternative licensing options for this software.              **
       20    **                                                                           **
       21    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
       22    **                                                                           **
       23    **  See http://www.fsf.org for more information about the GPL.               **
       24    **                                                                           **
       25    **                                                                           **
       26    *******************************************************************************
       27    *******************************************************************************
       28    *
       29    * uio.p
       30    *
       31    *
       32    * UserIO monitoring.
       33    *
       34    *
       35    * Author:
       36    *
       37    *      Tom Bascom, Greenfield Technologies
       38    *      http://www.greenfieldtech.com
       39    *      September 5, 2003
       40    *
       41    */
       42   
       43   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 11.7 &THEN
       44   /* new _userLock fields */
       45   &ELSE
       46   /* lock requests */
       47   &ENDIF
       48   
       49   
       50   /*******************************************************************************
       51    *******************************************************************************
       52    **                                                                           **
       53    **                                                                           **
       54    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
       55    **  http://www.greenfieldtech.com                                            **
       56    **                                                                           **
       57    **  ProTop is free software; you can redistribute it and/or modify it        **
       58    **  under the terms of the GNU General Public License (GPL) as published     **
       59    **  by the Free Software Foundation; either version 2 of the License, or     **
       60    **  at your option) any later version.                                       **
       61    **                                                                           **
       62    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
       63    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
       64    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
       65    **  for more details.                                                        **
       66    **                                                                           **
       67    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
       68    **  of use and alternative licensing options for this software.              **
       69    **                                                                           **
       70    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
       71    **                                                                           **
       72    **  See http://www.fsf.org for more information about the GPL.               **
       73    **                                                                           **
       74    **                                                                           **
       75    *******************************************************************************
       76    *******************************************************************************
       77    *
       78    * protop.i
       79    *
       80    * Header file for protop family of programs
       81    *
       82    *
       83    * Known Bugs & Issues:
       84    *
       85    *
       86    * To Do:
       87    *
       88    *
       89    * Author:
       90    *
       91    *      Tom Bascom, Greenfield Technologies
       92    *      http://www.greenfieldtech.com
       93    *      August 28, 2003
       94    *
       95    */
       96   
       97   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 11.4 &THEN
       98   &global-define  FASTLOCK        true
       99   &ELSE
      100   &global-define  FASTLOCK        false
      101   &ENDIF
      102   
      103   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 11.0 &THEN
      104   &global-define  OE11            "yes"
      105   &global-define  xDEBUGTT        false
      106   &ENDIF
      107   
      108   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.2 AND PROVERSION >= "10.2B" &THEN
      109   &global-define  NOSERIALIZE     serialize-hidden
      110   &ENDIF
      111   
      112   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.1 AND PROVERSION >= "10.1B" &THEN
      113   &global-define  BIGINT          int64
      114   &ELSE
      115   &global-define  BIGINT          decimal
      116   &ENDIF
      117   
      118   
      119   /* lib/v9.i
      120    *
      121    */
      122   
      123   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) < 10.0 &THEN
      124   &global-define  CPYLOB  "no"
      125   &global-define  NOW     substitute( "&1 &2", today, string( time, "hh:mm:ss" ))
      126   &global-define  LNGCR   character
      127   &global-define  DTZ     integer
      128   &global-define  BIGINT  decimal
      129   &ELSE
      130   &global-define  OE10    "yes"
      131   &global-define  NOW     now
      132   &global-define  LNGCR   longchar
      133   &global-define  DTZ     datetime-tz
      134   &global-define  BIGINT  int64
      135   &ENDIF
      136    
      137   
      138   /* use extended _connect fields: -client, -cache*
      139    */
      140   
      141   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.1 AND PROVERSION >= "10.1C" &THEN
      142   &global-define  CONNECTX        "yes"
      143   &ELSE
      144   &global-define  CONNECTX        "no"
      145   &ENDIF
      146   
      147   define stream inStrm.
      148   
      149   define new global shared variable dbgMode as integer no-undo initial 1.
      150   
      151   /* The values for these are defined in etc/protop.cfg and set by lib/protop-cfg.p
      152    *
      153    * someday everyone will have OO and I will replace these with a gsv class
      154    * or something of that ilk
      155    *
      156    */
      157   
      158   define new global shared variable pt_shortname   as character no-undo.
      159   define new global shared variable pt_uniqName    as character no-undo.
      160   define new global shared variable pt_server      as character no-undo.
      161   define new global shared variable pt_resrcType   as character no-undo.
      162   
      163   define new global shared variable pt_tmpdir      as character no-undo initial "/tmp".
      164   define new global shared variable pt_logdir      as character no-undo initial "/tmp".
      165   define new global shared variable pt_rptdir      as character no-undo initial "/tmp".
      166   define new global shared variable pt_logname     as character no-undo initial "&5.&2.&3".
      167   define new global shared variable pt_mailcmd     as character no-undo initial 'mailx "-s &1" '.
      168   
      169   define new global shared variable pt_votrx       as integer   no-undo initial 1800.
      170   define new global shared variable pt_lktbllim    as integer   no-undo initial 0.
      171   define new global shared variable pt_bkupstale   as integer   no-undo initial 26.
      172   define new global shared variable pt_bogomips    as integer   no-undo initial 1000000.
      173   define new global shared variable pt_ioresp      as integer   no-undo initial 100.
      174   define new global shared variable pt_ioFileName  as character no-undo.
      175   define new global shared variable pt_dfCmd       as character no-undo.
      176   
      177   define new global shared variable pt_AICheckInterval   as integer no-undo initial 60.
      178   define new global shared variable pt_PICACheckInterval as integer no-undo initial 60.
      179   define new global shared variable pt_appsrvStuck       as integer no-undo initial 120.
      180   
      181   define new global shared variable pt_bibkupAlert as integer   no-undo.          /* alert on long bi backup phase                */
      182   define new global shared variable pt_bibkupAlarm as integer   no-undo.          /* alarm on long bi backup phase                */
      183   define new global shared variable pt_bibkupPage  as integer   no-undo.          /* page  on long bi backup phase                */
      184   
      185   define new global shared variable pt_bkupAlert   as integer   no-undo.          /* alert on long db backup                      */
      186   define new global shared variable pt_bkupAlarm   as integer   no-undo.          /* alarm on long db backup                      */
      187   define new global shared variable pt_bkupPage    as integer   no-undo.          /* page  on long db backup                      */
      188   
      189   define new global shared variable pt_userLock    as logical   no-undo.          /* enable _userLock  data?                      */
      190   define new global shared variable pt_doZippy     as logical   no-undo.          /* enable "user experience" (aka "zippy")?      */
      191   define new global shared variable pt_useRFUtil   as logical   no-undo.          /* use rfutil to gather after-imaging status?   */
      192   
      193   define new global shared variable pt_updAreaData as integer   no-undo.          /* how often should we report storage area xref details from dbanalys? */
      194   
      195   define new global shared variable pt_zoomTo      as integer no-undo.            /* new zoomed monInt                            */
      196   
      197   define new global shared variable ptDBName     as character no-undo.                    /* the db logical name          */
      198   define new global shared variable rowLimit     as integer   no-undo initial 100.        /* 50?                          */
      199   
      200   /* do-sumSample() manipulates these -- ugly, ugly, ugly... (obsolete?)
      201    * 
      202    */
      203   
      204   define new global shared variable stime as integer no-undo.                     /* start time                           */
      205   define new global shared variable ltime as integer no-undo.                     /* last time                            */
      206   define new global shared variable xtime as integer no-undo.                     /* total time                           */
      207   define new global shared variable itime as integer no-undo.                     /* iteration time                       */
      208   
      209   define new global shared variable chkp-base   as integer no-undo initial ?.     /* cover for the lack of a VST field    */
      210   
      211                                                                                   /* corresponding to base checkpoint#    */
      212   /** Global Shared Temp Table Definitions
      213    **
      214    ** Yup, they're shared.  But this stuff makes no sense across session boundaries anyway.
      215    ** And a shared temp-table is logically the same as a db table so who really cares?
      216    **
      217    **/
      218   
      219   /* cache _File and _Index records so that we don't keep hitting the db to translate
      220    */
      221   
      222   define new global shared temp-table tt_tbl no-undo
      223     field xid      as integer                                             /* _File._File-Num              */
      224     field tstatid  as integer                                             /* _TableStat._TableStat-Id     */
      225     field areaNum  as integer                                             /* _Storage-Object._Area-Number */
      226     field tblPool  as character                                           /* get-bits( _object-attrib, 7, 1 ) = 1 */
      227     field tblname  as character                                           /* _File._File-Name             */
      228     index xid-idx is unique primary xid.
      229   
      230   define new global shared temp-table tt_idx no-undo
      231     field xid      as integer                                             /* _Index._Idx-Num              */
      232     field istatid  as integer                                             /* _IndexStat._IndexStat-Id     */
      233     field idxname  as character                                           /* _Index._Idx-Name             */
      234     field idxnote  as character
      235     field idxRoot  as int64                                           /* _Storage-Object._Object-Root */
      236     field tblnum   as integer                                             /* _File._File-Num              */
      237     field areaNum  as integer                                             /* _Storage-Object._Area-Number */
      238     field idxPool  as character                                           /* get-bits( _object-attrib, 7, 1 ) = 1 */
      239     field tblname  as character                                           /* _File._File-Name             */
      240     index xid-idx is unique primary xid.
      241   
      242   define new global shared temp-table tt_areaExtent no-undo
      243     field areaNum  as integer                                             /* _areaExtent._Area-Number     */
      244     field extNum   as integer                                             /* _areaExtent._Extent-Number   */
      245   
      246     field extSize  as decimal                                             /* _areaExtent._Extent-Size     */
      247     field extType  as integer                                             /* _areaExtent._Extent-Type     */
      248     field extPath  as character                                           /* _areaExtent._Extent-Path     */
      249   
      250     index ae-idx is unique primary areaNum extNum.
      251   
      252   define new global shared temp-table tt_area no-undo
      253     field xid      as integer    format ">>>9"
      254     field SANum    as integer    format ">>>9"        label "#"
      255     field areaPool as character  format "x(2)"        label "BX"
      256   /*field areaStatus-Id as {&BIGINT} format ">>>9"    label "Id" */
      257     field SAName   as character  format "x(30)"       label "Area Name"
      258     field allocGB  as decimal    format ">>>>>9.99"   label "Allocated"
      259     field varGB    as decimal    format ">>>>>9.99"   label "Variable"
      260     field totGB    as decimal    format ">>>>>>9.99"  label "Tot GB"
      261     field hiGB     as decimal    format ">>>>>9.99"   label "Hi Water" serialize-hidden
      262     field freeGB   as decimal    format ">>>>>9.99"   label "Free GB"
      263     field pctAlloc as decimal    format ">>>>>9%"     label "%Alloc"
      264     field pctLastX as decimal    format ">>>>9%"      label "%LastX"
      265   
      266     field blkszkb as integer     format ">>9"         label "BSZ"
      267     field rpb     as integer     format ">>9"         label "RPB"
      268     field clstrsz as integer     format ">>9"         label "CSZ"
      269   
      270     field numTbls as integer     format ">>>>9"       label "#Tbls"
      271     field numIdxs as integer     format ">>>>9"       label "#Idxs"
      272     field numLOBs as integer     format ">>>>9"       label "#LOBs"
      273   
      274     field numExts as integer     format ">>>>9"       label "#Exts"
      275     field hasVar  as logical     format "Yes/No"      label "Var?"
      276   
      277     field xnote   as character   format "x"           label "*"
      278   
      279     field areaMaxPct as decimal  format ">>9.999%"    label "Max%"
      280     field idx3264    as decimal  format ">>9.999%"    label "Bug%"
      281   
      282     index pctAlloc-idx is primary pctAlloc descending
      283     index pctLastX-idx pctLastX pctAlloc descending
      284     index allocGB-idx allocGB descending
      285     index totGB-idx totGB descending
      286     index xid-idx is unique xid
      287     index SANum-idx is unique SANum
      288     index SAName-idx is unique SAName
      289   .
      290   
      291   *** Encrypted Source ***
      292   *** Encrypted Source ***
      293   *** Encrypted Source ***
      294   *** Encrypted Source ***
      295   *** Encrypted Source ***
      296   *** Encrypted Source ***
      297   *** Encrypted Source ***
      298   *** Encrypted Source ***
      299   *** Encrypted Source ***
      300   *** Encrypted Source ***
      301   *** Encrypted Source ***
      302   *** Encrypted Source ***
      303   *** Encrypted Source ***
      304   *** Encrypted Source ***
      305   *** Encrypted Source ***
      306   *** Encrypted Source ***
      307   *** Encrypted Source ***
      308   *** Encrypted Source ***
      309   *** Encrypted Source ***
      310   *** Encrypted Source ***
      311   *** Encrypted Source ***
      312   *** Encrypted Source ***
      313   *** Encrypted Source ***
      314   *** Encrypted Source ***
      315   *** Encrypted Source ***
      316   *** Encrypted Source ***
      317   *** Encrypted Source ***
      318   *** Encrypted Source ***
      319   *** Encrypted Source ***
      320   *** Encrypted Source ***
      321   *** Encrypted Source ***
      322   *** Encrypted Source ***
      323   *** Encrypted Source ***
      324   *** Encrypted Source ***
      325   *** Encrypted Source ***
      326   *** Encrypted Source ***
      327   *** Encrypted Source ***
      328   *** Encrypted Source ***
      329   *** Encrypted Source ***
      330   *** Encrypted Source ***
      331   *** Encrypted Source ***
      332   *** Encrypted Source ***
      333   *** Encrypted Source ***
      334   *** Encrypted Source ***
      335   *** Encrypted Source ***
      336   *** Encrypted Source ***
      337   *** Encrypted Source ***
      338   *** Encrypted Source ***
      339   *** Encrypted Source ***
      340   *** Encrypted Source ***
      341   *** Encrypted Source ***
      342   *** Encrypted Source ***
      343   *** Encrypted Source ***
      344   *** Encrypted Source ***
      345   *** Encrypted Source ***
      346   *** Encrypted Source ***
      347   *** Encrypted Source ***
      348   *** Encrypted Source ***
      349   *** Encrypted Source ***
      350   *** Encrypted Source ***
      351   *** Encrypted Source ***
      352   *** Encrypted Source ***
      353   *** Encrypted Source ***
      354   *** Encrypted Source ***
      355   *** Encrypted Source ***
      356   *** Encrypted Source ***
      357   *** Encrypted Source ***
      358   *** Encrypted Source ***
      359   *** Encrypted Source ***
      360   *** Encrypted Source ***
      361    
      362   
      363   /*******************************************************************************
      364    *******************************************************************************
      365    **                                                                           **
      366    **                                                                           **
      367    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      368    **  http://www.greenfieldtech.com                                            **
      369    **                                                                           **
      370    **  ProTop is free software; you can redistribute it and/or modify it        **
      371    **  under the terms of the GNU General Public License (GPL) as published     **
      372    **  by the Free Software Foundation; either version 2 of the License, or     **
      373    **  at your option) any later version.                                       **
      374    **                                                                           **
      375    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      376    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      377    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      378    **  for more details.                                                        **
      379    **                                                                           **
      380    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      381    **  of use and alternative licensing options for this software.              **
      382    **                                                                           **
      383    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      384    **                                                                           **
      385    **  See http://www.fsf.org for more information about the GPL.               **
      386    **                                                                           **
      387    **                                                                           **
      388    *******************************************************************************
      389    *******************************************************************************
      390    *
      391    * protoplib.i
      392    *
      393    * ProTop infrastructure library definitions
      394    *
      395    */
      396   
      397   function uDateTime returns integer () in super.
      398   function string2uDateTime returns integer( input p_text as character ) in super.
      399   function searchDir returns character ( input xDir as character ) in super.
      400   function unsignMe returns decimal ( input s as decimal, input i as integer ) in super.
      401   function hr returns decimal ( input lr as decimal, input osr as decimal, output hr-str as character, output hr as decimal, output mr as decimal ) in super.
      402   function do-SumSample returns logical ( output p_index as integer, output p_time  as integer ) in super.
      403   function myPID returns character () in super.
      404   function hilite returns logical ( input b as handle, input p_metric as character, input p_value as character, output p_attr as character ) in super.
      405   
      406   /* end protoplib.i */
      407    
      408   
      409   /*******************************************************************************
      410    *******************************************************************************
      411    **                                                                           **
      412    **                                                                           **
      413    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      414    **  http://www.greenfieldtech.com                                            **
      415    **                                                                           **
      416    **  ProTop is free software; you can redistribute it and/or modify it        **
      417    **  under the terms of the GNU General Public License (GPL) as published     **
      418    **  by the Free Software Foundation; either version 2 of the License, or     **
      419    **  at your option) any later version.                                       **
      420    **                                                                           **
      421    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      422    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      423    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      424    **  for more details.                                                        **
      425    **                                                                           **
      426    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      427    **  of use and alternative licensing options for this software.              **
      428    **                                                                           **
      429    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      430    **                                                                           **
      431    **  See http://www.fsf.org for more information about the GPL.               **
      432    **                                                                           **
      433    **                                                                           **
      434    *******************************************************************************
      435    *******************************************************************************
      436    *
      437    * vstlib.i
      438    *
      439    * VST library definitions
      440    *
      441    */
      442   
      443   function aiInfo returns character ( input vAiFile as character, output vAiGenNum as integer ) in super.
      444   function chkai returns integer ( output ai_exts as integer, output ai_full as integer, output ai_empty as integer ) in super.
      445   function chkarea returns integer ( input threshold as decimal, output worst as decimal ) in super.
      446   function chkptNum returns integer ( input-output oldbi as integer ) in super.
      447   
      448   function connectFlags returns character ( input cnxId as integer ) in super.
      449   function connectName returns character ( input cnxId as integer, input cnxFlags as character ) in super.
      450   function lastStatement returns character( input cnxId as integer, output lineNum as integer, output procName as character ) in super.
      451   
      452   function isAIEnabled returns logical () in super.
      453   function isReplSource returns logical () in super.
      454   function isReplTarget returns logical () in super.
      455   function isBackupRunning returns logical () in super.
      456   function isWorkgroup returns logical () in super.
      457   
      458   function getStartupX returns character ( input v as character, input p1 as character, input p2 as character ) in super.
      459   
      460   /* end vstlib.i */
      461    
      462   
      463   function add2ds returns logical ( input h as handle ) in super.
      464   function getTempTableHandle returns handle ( input n as character ) in super.
      465   
      466   /* end protop.i */
      467    
      468   
      469   /*******************************************************************************
      470    *******************************************************************************
      471    **                                                                           **
      472    **                                                                           **
      473    **  Copyright 2003-2012 Tom Bascom, Greenfield Technologies                  **
      474    **  http://www.greenfieldtech.com                                            **
      475    **                                                                           **
      476    **  ProTop is free software; you can redistribute it and/or modify it        **
      477    **  under the terms of the GNU General Public License (GPL) as published     **
      478    **  by the Free Software Foundation; either version 2 of the License, or     **
      479    **  at your option) any later version.                                       **
      480    **                                                                           **
      481    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      482    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      483    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      484    **  for more details.                                                        **
      485    **                                                                           **
      486    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      487    **  of use and alternative licensing options for this software.              **
      488    **                                                                           **
      489    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      490    **                                                                           **
      491    **  See http://www.fsf.org for more information about the GPL.               **
      492    **                                                                           **
      493    **                                                                           **
      494    *******************************************************************************
      495    *******************************************************************************
      496    *
      497    * tick.i
      498    *
      499    *
      500    * common routine to handle "clock ticks"
      501    *
      502    *
      503    * Author:
      504    *
      505    *      Tom Bascom, Greenfield Technologies
      506    *      http://www.greenfieldtech.com
      507    *      January 21, 2012
      508    *
      509    */
      510   
      511   
      512   /* lib/v9.i
      513    *
      514    */
      515   
      516   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) < 10.0 &THEN
      517   &global-define  CPYLOB  "no"
      518   &global-define  NOW     substitute( "&1 &2", today, string( time, "hh:mm:ss" ))
      519   &global-define  LNGCR   character
      520   &global-define  DTZ     integer
      521   &global-define  BIGINT  decimal
      522   &ELSE
      523   &global-define  OE10    "yes"
      524   &global-define  NOW     now
      525   &global-define  LNGCR   longchar
      526   &global-define  DTZ     datetime-tz
      527   &global-define  BIGINT  int64
      528   &ENDIF
      529    
      530   
      531   define new global shared variable rawMode  as integer no-undo initial 5.
      532   define new global shared variable timeMode as integer no-undo initial 2.
      533   
      534   define new global shared variable x as integer no-undo initial 5.
      535   define new global shared variable z as decimal no-undo.
      536   
      537   define variable y as decimal no-undo.
      538   
      539   define variable initTick as integer no-undo.
      540   define variable prevTick as integer no-undo.
      541   
      542   
      543   procedure updTick:
      544   
      545   &IF DEFINED( OE10 ) &THEN
      546     if initTick = 0 then initTick = mtime.
      547     assign
      548       x = rawMode /* ( if rawMode then 4 else 5 ) */
      549       z = mtime - prevTick
      550       z = ( if z >= 0 then z else 86400000 - prevTick + mtime )   /* handle rolling over midnight */
      551       z = z / 1000
      552       y = mtime - initTick
      553       y = y / 1000
      554       prevTick = mtime
      555     .
      556   &ELSE
      557     if initTick = 0 then initTick = etime.
      558     assign
      559       x = rawMode /* ( if rawMode then 4 else 5 ) */
      560       z = etime - prevTick
      561       z = ( if z >= 0 then z else 5000 )   /* etime doesn't rollover at midnite -- but a mistaken etime(yes) somewhere would be bad... */
      562       z = z / 1000
      563       y = etime - initTick
      564       y = y / 1000
      565       prevTick = etime
      566     .
      567   &ENDIF
      568   
      569     /* if rawMode <> 5 then z = 1. */
      570   
      571     if timeMode = 1 then z = 1.
      572   
      573     return.
      574   
      575   end.
      576   
      577   /* end tick.i */
      578    
      579   
      580   define output parameter dcDescription as character no-undo initial "UserIOActivity".
      581   
      582   
      583   /*******************************************************************************
      584    *******************************************************************************
      585    **                                                                           **
      586    **                                                                           **
      587    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      588    **  http://www.greenfieldtech.com                                            **
      589    **                                                                           **
      590    **  ProTop is free software; you can redistribute it and/or modify it        **
      591    **  under the terms of the GNU General Public License (GPL) as published     **
      592    **  by the Free Software Foundation; either version 2 of the License, or     **
      593    **  at your option) any later version.                                       **
      594    **                                                                           **
      595    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      596    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      597    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      598    **  for more details.                                                        **
      599    **                                                                           **
      600    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      601    **  of use and alternative licensing options for this software.              **
      602    **                                                                           **
      603    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      604    **                                                                           **
      605    **  See http://www.fsf.org for more information about the GPL.               **
      606    **                                                                           **
      607    **                                                                           **
      608    *******************************************************************************
      609    *******************************************************************************
      610    *
      611    * tt_xstat.i
      612    *
      613    */
      614   
      615   define variable ratio-calc as integer no-undo.
      616   
      617   define temp-table tt_xstat no-undo
      618     field xid       as integer
      619     field xvalid    as logical
      620     field xname     as character
      621     field misc1     as character
      622     field misc2     as character
      623     field misc3     as character
      624     field misc4     as character
      625     field misc5     as character
      626     field stat1     as decimal extent 5
      627     field stat2     as decimal extent 5
      628     field stat3     as decimal extent 5
      629     field stat4     as decimal extent 5
      630     field stat5     as decimal extent 5
      631     field stat6     as decimal extent 5
      632     field stat-ratio  as decimal
      633     field stat-ratio2 as decimal
      634     index xid-idx is unique primary xid.
      635   
      636   /* this will be called by the including procedure's mon-update procedure
      637    *
      638    */
      639   
      640   procedure update_xstat:
      641   
      642     define input parameter p_xid   as integer   no-undo.
      643     define input parameter p_xname as character no-undo.
      644     define input parameter p_misc1 as character no-undo.
      645     define input parameter p_misc2 as character no-undo.
      646     define input parameter p_misc3 as character no-undo.
      647     define input parameter p_misc4 as character no-undo.
      648     define input parameter p_misc5 as character no-undo.
      649     define input parameter p_this1 as decimal   no-undo.
      650     define input parameter p_this2 as decimal   no-undo.
      651     define input parameter p_this3 as decimal   no-undo.
      652     define input parameter p_this4 as decimal   no-undo.
      653     define input parameter p_this5 as decimal   no-undo.
      654     define input parameter p_this6 as decimal   no-undo.
      655   
      656     find tt_xstat exclusive-lock where tt_xstat.xid = p_xid no-error.
      657   
      658     if not available tt_xstat then
      659       do:
      660   
      661         create tt_xstat.
      662         assign
      663           tt_xstat.xvalid = yes
      664           tt_xstat.xid    = p_xid
      665           tt_xstat.xname  = p_xname
      666           tt_xstat.misc1  = p_misc1
      667           tt_xstat.misc2  = p_misc2
      668           tt_xstat.misc3  = p_misc3
      669           tt_xstat.misc4  = p_misc4
      670           tt_xstat.misc5  = p_misc5
      671           
      672   /*******************************************************************************
      673    *******************************************************************************
      674    **                                                                           **
      675    **                                                                           **
      676    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      677    **  http://www.greenfieldtech.com                                            **
      678    **                                                                           **
      679    **  ProTop is free software; you can redistribute it and/or modify it        **
      680    **  under the terms of the GNU General Public License (GPL) as published     **
      681    **  by the Free Software Foundation; either version 2 of the License, or     **
      682    **  at your option) any later version.                                       **
      683    **                                                                           **
      684    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      685    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      686    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      687    **  for more details.                                                        **
      688    **                                                                           **
      689    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      690    **  of use and alternative licensing options for this software.              **
      691    **                                                                           **
      692    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      693    **                                                                           **
      694    **  See http://www.fsf.org for more information about the GPL.               **
      695    **                                                                           **
      696    **                                                                           **
      697    *******************************************************************************
      698    *******************************************************************************
      699    *
      700    * init-xrec.i
      701    *
      702    * {1} = base field
      703    * {2} = value to initialze array with
      704    *
      705    * [1] = base
      706    * [2] = last (previous cumulative value)
      707    * [3] = this
      708    * [4] = cumulative
      709    * [5] = interval
      710    *
      711    */
      712   
      713   tt_xstat.stat1[1] = p_this1
      714   tt_xstat.stat1[2] = p_this1
      715   tt_xstat.stat1[3] = p_this1
      716    
      717           
      718   /*******************************************************************************
      719    *******************************************************************************
      720    **                                                                           **
      721    **                                                                           **
      722    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      723    **  http://www.greenfieldtech.com                                            **
      724    **                                                                           **
      725    **  ProTop is free software; you can redistribute it and/or modify it        **
      726    **  under the terms of the GNU General Public License (GPL) as published     **
      727    **  by the Free Software Foundation; either version 2 of the License, or     **
      728    **  at your option) any later version.                                       **
      729    **                                                                           **
      730    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      731    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      732    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      733    **  for more details.                                                        **
      734    **                                                                           **
      735    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      736    **  of use and alternative licensing options for this software.              **
      737    **                                                                           **
      738    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      739    **                                                                           **
      740    **  See http://www.fsf.org for more information about the GPL.               **
      741    **                                                                           **
      742    **                                                                           **
      743    *******************************************************************************
      744    *******************************************************************************
      745    *
      746    * init-xrec.i
      747    *
      748    * {1} = base field
      749    * {2} = value to initialze array with
      750    *
      751    * [1] = base
      752    * [2] = last (previous cumulative value)
      753    * [3] = this
      754    * [4] = cumulative
      755    * [5] = interval
      756    *
      757    */
      758   
      759   tt_xstat.stat2[1] = p_this2
      760   tt_xstat.stat2[2] = p_this2
      761   tt_xstat.stat2[3] = p_this2
      762    
      763           
      764   /*******************************************************************************
      765    *******************************************************************************
      766    **                                                                           **
      767    **                                                                           **
      768    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      769    **  http://www.greenfieldtech.com                                            **
      770    **                                                                           **
      771    **  ProTop is free software; you can redistribute it and/or modify it        **
      772    **  under the terms of the GNU General Public License (GPL) as published     **
      773    **  by the Free Software Foundation; either version 2 of the License, or     **
      774    **  at your option) any later version.                                       **
      775    **                                                                           **
      776    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      777    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      778    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      779    **  for more details.                                                        **
      780    **                                                                           **
      781    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      782    **  of use and alternative licensing options for this software.              **
      783    **                                                                           **
      784    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      785    **                                                                           **
      786    **  See http://www.fsf.org for more information about the GPL.               **
      787    **                                                                           **
      788    **                                                                           **
      789    *******************************************************************************
      790    *******************************************************************************
      791    *
      792    * init-xrec.i
      793    *
      794    * {1} = base field
      795    * {2} = value to initialze array with
      796    *
      797    * [1] = base
      798    * [2] = last (previous cumulative value)
      799    * [3] = this
      800    * [4] = cumulative
      801    * [5] = interval
      802    *
      803    */
      804   
      805   tt_xstat.stat3[1] = p_this3
      806   tt_xstat.stat3[2] = p_this3
      807   tt_xstat.stat3[3] = p_this3
      808    
      809           
      810   /*******************************************************************************
      811    *******************************************************************************
      812    **                                                                           **
      813    **                                                                           **
      814    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      815    **  http://www.greenfieldtech.com                                            **
      816    **                                                                           **
      817    **  ProTop is free software; you can redistribute it and/or modify it        **
      818    **  under the terms of the GNU General Public License (GPL) as published     **
      819    **  by the Free Software Foundation; either version 2 of the License, or     **
      820    **  at your option) any later version.                                       **
      821    **                                                                           **
      822    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      823    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      824    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      825    **  for more details.                                                        **
      826    **                                                                           **
      827    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      828    **  of use and alternative licensing options for this software.              **
      829    **                                                                           **
      830    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      831    **                                                                           **
      832    **  See http://www.fsf.org for more information about the GPL.               **
      833    **                                                                           **
      834    **                                                                           **
      835    *******************************************************************************
      836    *******************************************************************************
      837    *
      838    * init-xrec.i
      839    *
      840    * {1} = base field
      841    * {2} = value to initialze array with
      842    *
      843    * [1] = base
      844    * [2] = last (previous cumulative value)
      845    * [3] = this
      846    * [4] = cumulative
      847    * [5] = interval
      848    *
      849    */
      850   
      851   tt_xstat.stat4[1] = p_this4
      852   tt_xstat.stat4[2] = p_this4
      853   tt_xstat.stat4[3] = p_this4
      854    
      855           
      856   /*******************************************************************************
      857    *******************************************************************************
      858    **                                                                           **
      859    **                                                                           **
      860    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      861    **  http://www.greenfieldtech.com                                            **
      862    **                                                                           **
      863    **  ProTop is free software; you can redistribute it and/or modify it        **
      864    **  under the terms of the GNU General Public License (GPL) as published     **
      865    **  by the Free Software Foundation; either version 2 of the License, or     **
      866    **  at your option) any later version.                                       **
      867    **                                                                           **
      868    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      869    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      870    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      871    **  for more details.                                                        **
      872    **                                                                           **
      873    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      874    **  of use and alternative licensing options for this software.              **
      875    **                                                                           **
      876    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      877    **                                                                           **
      878    **  See http://www.fsf.org for more information about the GPL.               **
      879    **                                                                           **
      880    **                                                                           **
      881    *******************************************************************************
      882    *******************************************************************************
      883    *
      884    * init-xrec.i
      885    *
      886    * {1} = base field
      887    * {2} = value to initialze array with
      888    *
      889    * [1] = base
      890    * [2] = last (previous cumulative value)
      891    * [3] = this
      892    * [4] = cumulative
      893    * [5] = interval
      894    *
      895    */
      896   
      897   tt_xstat.stat5[1] = p_this5
      898   tt_xstat.stat5[2] = p_this5
      899   tt_xstat.stat5[3] = p_this5
      900    
      901           
      902   /*******************************************************************************
      903    *******************************************************************************
      904    **                                                                           **
      905    **                                                                           **
      906    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      907    **  http://www.greenfieldtech.com                                            **
      908    **                                                                           **
      909    **  ProTop is free software; you can redistribute it and/or modify it        **
      910    **  under the terms of the GNU General Public License (GPL) as published     **
      911    **  by the Free Software Foundation; either version 2 of the License, or     **
      912    **  at your option) any later version.                                       **
      913    **                                                                           **
      914    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      915    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      916    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      917    **  for more details.                                                        **
      918    **                                                                           **
      919    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      920    **  of use and alternative licensing options for this software.              **
      921    **                                                                           **
      922    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      923    **                                                                           **
      924    **  See http://www.fsf.org for more information about the GPL.               **
      925    **                                                                           **
      926    **                                                                           **
      927    *******************************************************************************
      928    *******************************************************************************
      929    *
      930    * init-xrec.i
      931    *
      932    * {1} = base field
      933    * {2} = value to initialze array with
      934    *
      935    * [1] = base
      936    * [2] = last (previous cumulative value)
      937    * [3] = this
      938    * [4] = cumulative
      939    * [5] = interval
      940    *
      941    */
      942   
      943   tt_xstat.stat6[1] = p_this6
      944   tt_xstat.stat6[2] = p_this6
      945   tt_xstat.stat6[3] = p_this6
      946    
      947         .
      948   
      949       end.
      950      else
      951       do:
      952   
      953         assign
      954           tt_xstat.xvalid   = yes                         /* is this xid active?          */
      955           tt_xstat.xname    = p_xname                     /* reuse of ids is possible...  */
      956           tt_xstat.misc1    = p_misc1
      957           tt_xstat.misc2    = p_misc2
      958           tt_xstat.misc3    = p_misc3
      959           tt_xstat.misc4    = p_misc4
      960           tt_xstat.misc5    = p_misc5
      961           tt_xstat.stat1[3] = p_this1
      962           tt_xstat.stat2[3] = p_this2
      963           tt_xstat.stat3[3] = p_this3
      964           tt_xstat.stat4[3] = p_this4
      965           tt_xstat.stat5[3] = p_this5
      966           tt_xstat.stat6[3] = p_this6
      967         .
      968   
      969         if tt_xstat.stat1[3] < tt_xstat.stat1[3] then     /* detect reuse of an id (stat rolling backwards...)    */
      970           assign
      971             tt_xstat.xname  = p_xname
      972             
      973   /*******************************************************************************
      974    *******************************************************************************
      975    **                                                                           **
      976    **                                                                           **
      977    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
      978    **  http://www.greenfieldtech.com                                            **
      979    **                                                                           **
      980    **  ProTop is free software; you can redistribute it and/or modify it        **
      981    **  under the terms of the GNU General Public License (GPL) as published     **
      982    **  by the Free Software Foundation; either version 2 of the License, or     **
      983    **  at your option) any later version.                                       **
      984    **                                                                           **
      985    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
      986    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
      987    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
      988    **  for more details.                                                        **
      989    **                                                                           **
      990    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
      991    **  of use and alternative licensing options for this software.              **
      992    **                                                                           **
      993    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
      994    **                                                                           **
      995    **  See http://www.fsf.org for more information about the GPL.               **
      996    **                                                                           **
      997    **                                                                           **
      998    *******************************************************************************
      999    *******************************************************************************
     1000    *
     1001    * init-xrec.i
     1002    *
     1003    * {1} = base field
     1004    * {2} = value to initialze array with
     1005    *
     1006    * [1] = base
     1007    * [2] = last (previous cumulative value)
     1008    * [3] = this
     1009    * [4] = cumulative
     1010    * [5] = interval
     1011    *
     1012    */
     1013   
     1014   tt_xstat.stat1[1] = p_this1
     1015   tt_xstat.stat1[2] = p_this1
     1016   tt_xstat.stat1[3] = p_this1
     1017    
     1018             
     1019   /*******************************************************************************
     1020    *******************************************************************************
     1021    **                                                                           **
     1022    **                                                                           **
     1023    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1024    **  http://www.greenfieldtech.com                                            **
     1025    **                                                                           **
     1026    **  ProTop is free software; you can redistribute it and/or modify it        **
     1027    **  under the terms of the GNU General Public License (GPL) as published     **
     1028    **  by the Free Software Foundation; either version 2 of the License, or     **
     1029    **  at your option) any later version.                                       **
     1030    **                                                                           **
     1031    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1032    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1033    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1034    **  for more details.                                                        **
     1035    **                                                                           **
     1036    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1037    **  of use and alternative licensing options for this software.              **
     1038    **                                                                           **
     1039    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1040    **                                                                           **
     1041    **  See http://www.fsf.org for more information about the GPL.               **
     1042    **                                                                           **
     1043    **                                                                           **
     1044    *******************************************************************************
     1045    *******************************************************************************
     1046    *
     1047    * init-xrec.i
     1048    *
     1049    * {1} = base field
     1050    * {2} = value to initialze array with
     1051    *
     1052    * [1] = base
     1053    * [2] = last (previous cumulative value)
     1054    * [3] = this
     1055    * [4] = cumulative
     1056    * [5] = interval
     1057    *
     1058    */
     1059   
     1060   tt_xstat.stat2[1] = p_this2
     1061   tt_xstat.stat2[2] = p_this2
     1062   tt_xstat.stat2[3] = p_this2
     1063    
     1064             
     1065   /*******************************************************************************
     1066    *******************************************************************************
     1067    **                                                                           **
     1068    **                                                                           **
     1069    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1070    **  http://www.greenfieldtech.com                                            **
     1071    **                                                                           **
     1072    **  ProTop is free software; you can redistribute it and/or modify it        **
     1073    **  under the terms of the GNU General Public License (GPL) as published     **
     1074    **  by the Free Software Foundation; either version 2 of the License, or     **
     1075    **  at your option) any later version.                                       **
     1076    **                                                                           **
     1077    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1078    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1079    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1080    **  for more details.                                                        **
     1081    **                                                                           **
     1082    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1083    **  of use and alternative licensing options for this software.              **
     1084    **                                                                           **
     1085    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1086    **                                                                           **
     1087    **  See http://www.fsf.org for more information about the GPL.               **
     1088    **                                                                           **
     1089    **                                                                           **
     1090    *******************************************************************************
     1091    *******************************************************************************
     1092    *
     1093    * init-xrec.i
     1094    *
     1095    * {1} = base field
     1096    * {2} = value to initialze array with
     1097    *
     1098    * [1] = base
     1099    * [2] = last (previous cumulative value)
     1100    * [3] = this
     1101    * [4] = cumulative
     1102    * [5] = interval
     1103    *
     1104    */
     1105   
     1106   tt_xstat.stat3[1] = p_this3
     1107   tt_xstat.stat3[2] = p_this3
     1108   tt_xstat.stat3[3] = p_this3
     1109    
     1110             
     1111   /*******************************************************************************
     1112    *******************************************************************************
     1113    **                                                                           **
     1114    **                                                                           **
     1115    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1116    **  http://www.greenfieldtech.com                                            **
     1117    **                                                                           **
     1118    **  ProTop is free software; you can redistribute it and/or modify it        **
     1119    **  under the terms of the GNU General Public License (GPL) as published     **
     1120    **  by the Free Software Foundation; either version 2 of the License, or     **
     1121    **  at your option) any later version.                                       **
     1122    **                                                                           **
     1123    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1124    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1125    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1126    **  for more details.                                                        **
     1127    **                                                                           **
     1128    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1129    **  of use and alternative licensing options for this software.              **
     1130    **                                                                           **
     1131    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1132    **                                                                           **
     1133    **  See http://www.fsf.org for more information about the GPL.               **
     1134    **                                                                           **
     1135    **                                                                           **
     1136    *******************************************************************************
     1137    *******************************************************************************
     1138    *
     1139    * init-xrec.i
     1140    *
     1141    * {1} = base field
     1142    * {2} = value to initialze array with
     1143    *
     1144    * [1] = base
     1145    * [2] = last (previous cumulative value)
     1146    * [3] = this
     1147    * [4] = cumulative
     1148    * [5] = interval
     1149    *
     1150    */
     1151   
     1152   tt_xstat.stat4[1] = p_this4
     1153   tt_xstat.stat4[2] = p_this4
     1154   tt_xstat.stat4[3] = p_this4
     1155    
     1156             
     1157   /*******************************************************************************
     1158    *******************************************************************************
     1159    **                                                                           **
     1160    **                                                                           **
     1161    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1162    **  http://www.greenfieldtech.com                                            **
     1163    **                                                                           **
     1164    **  ProTop is free software; you can redistribute it and/or modify it        **
     1165    **  under the terms of the GNU General Public License (GPL) as published     **
     1166    **  by the Free Software Foundation; either version 2 of the License, or     **
     1167    **  at your option) any later version.                                       **
     1168    **                                                                           **
     1169    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1170    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1171    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1172    **  for more details.                                                        **
     1173    **                                                                           **
     1174    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1175    **  of use and alternative licensing options for this software.              **
     1176    **                                                                           **
     1177    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1178    **                                                                           **
     1179    **  See http://www.fsf.org for more information about the GPL.               **
     1180    **                                                                           **
     1181    **                                                                           **
     1182    *******************************************************************************
     1183    *******************************************************************************
     1184    *
     1185    * init-xrec.i
     1186    *
     1187    * {1} = base field
     1188    * {2} = value to initialze array with
     1189    *
     1190    * [1] = base
     1191    * [2] = last (previous cumulative value)
     1192    * [3] = this
     1193    * [4] = cumulative
     1194    * [5] = interval
     1195    *
     1196    */
     1197   
     1198   tt_xstat.stat5[1] = p_this5
     1199   tt_xstat.stat5[2] = p_this5
     1200   tt_xstat.stat5[3] = p_this5
     1201    
     1202             
     1203   /*******************************************************************************
     1204    *******************************************************************************
     1205    **                                                                           **
     1206    **                                                                           **
     1207    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1208    **  http://www.greenfieldtech.com                                            **
     1209    **                                                                           **
     1210    **  ProTop is free software; you can redistribute it and/or modify it        **
     1211    **  under the terms of the GNU General Public License (GPL) as published     **
     1212    **  by the Free Software Foundation; either version 2 of the License, or     **
     1213    **  at your option) any later version.                                       **
     1214    **                                                                           **
     1215    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1216    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1217    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1218    **  for more details.                                                        **
     1219    **                                                                           **
     1220    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1221    **  of use and alternative licensing options for this software.              **
     1222    **                                                                           **
     1223    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1224    **                                                                           **
     1225    **  See http://www.fsf.org for more information about the GPL.               **
     1226    **                                                                           **
     1227    **                                                                           **
     1228    *******************************************************************************
     1229    *******************************************************************************
     1230    *
     1231    * init-xrec.i
     1232    *
     1233    * {1} = base field
     1234    * {2} = value to initialze array with
     1235    *
     1236    * [1] = base
     1237    * [2] = last (previous cumulative value)
     1238    * [3] = this
     1239    * [4] = cumulative
     1240    * [5] = interval
     1241    *
     1242    */
     1243   
     1244   tt_xstat.stat6[1] = p_this6
     1245   tt_xstat.stat6[2] = p_this6
     1246   tt_xstat.stat6[3] = p_this6
     1247    
     1248           .
     1249   
     1250       end.
     1251   
     1252     return.
     1253   
     1254   end.
     1255   
     1256   /* this will be called by the including procedure's mon-update procedure
     1257    *
     1258    */
     1259   
     1260   procedure age_xstat:
     1261   
     1262     define variable x as integer   no-undo.
     1263     define variable z as integer   no-undo.
     1264     define variable r as character no-undo case-sensitive initial "r".
     1265     define variable s as character no-undo case-sensitive initial "s".
     1266   
     1267     publish "get-RateRaw" ( output r ).
     1268     publish "get-SumSample" ( output s ).
     1269   
     1270     if s = "S" then
     1271       assign
     1272         x = 4
     1273         z = xtime.
     1274      else
     1275       assign
     1276         x = 5
     1277         z = itime.
     1278   
     1279     for each tt_xstat exclusive-lock:
     1280   
     1281       if tt_xstat.xvalid = no then
     1282         delete tt_xstat.
     1283        else
     1284         do:
     1285           assign
     1286             tt_xstat.xvalid = no
     1287             
     1288   /*******************************************************************************
     1289    *******************************************************************************
     1290    **                                                                           **
     1291    **                                                                           **
     1292    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1293    **  http://www.greenfieldtech.com                                            **
     1294    **                                                                           **
     1295    **  ProTop is free software; you can redistribute it and/or modify it        **
     1296    **  under the terms of the GNU General Public License (GPL) as published     **
     1297    **  by the Free Software Foundation; either version 2 of the License, or     **
     1298    **  at your option) any later version.                                       **
     1299    **                                                                           **
     1300    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1301    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1302    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1303    **  for more details.                                                        **
     1304    **                                                                           **
     1305    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1306    **  of use and alternative licensing options for this software.              **
     1307    **                                                                           **
     1308    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1309    **                                                                           **
     1310    **  See http://www.fsf.org for more information about the GPL.               **
     1311    **                                                                           **
     1312    **                                                                           **
     1313    *******************************************************************************
     1314    *******************************************************************************
     1315    *
     1316    * upd-xrec.i
     1317    *
     1318    * {1} = base field
     1319    * {2} = value to update metrics with
     1320    *
     1321    * [1] = base
     1322    * [2] = last (previous cumulative value)
     1323    * [3] = this
     1324    * [4] = cumulative
     1325    * [5] = interval
     1326    *
     1327    */
     1328   
     1329   tt_xstat.stat1[3] = tt_xstat.stat1[3]
     1330   tt_xstat.stat1[4] = tt_xstat.stat1[3] - tt_xstat.stat1[1]
     1331   tt_xstat.stat1[5] = tt_xstat.stat1[3] - tt_xstat.stat1[2]
     1332   tt_xstat.stat1[2] = tt_xstat.stat1[3]
     1333    
     1334             
     1335   /*******************************************************************************
     1336    *******************************************************************************
     1337    **                                                                           **
     1338    **                                                                           **
     1339    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1340    **  http://www.greenfieldtech.com                                            **
     1341    **                                                                           **
     1342    **  ProTop is free software; you can redistribute it and/or modify it        **
     1343    **  under the terms of the GNU General Public License (GPL) as published     **
     1344    **  by the Free Software Foundation; either version 2 of the License, or     **
     1345    **  at your option) any later version.                                       **
     1346    **                                                                           **
     1347    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1348    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1349    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1350    **  for more details.                                                        **
     1351    **                                                                           **
     1352    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1353    **  of use and alternative licensing options for this software.              **
     1354    **                                                                           **
     1355    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1356    **                                                                           **
     1357    **  See http://www.fsf.org for more information about the GPL.               **
     1358    **                                                                           **
     1359    **                                                                           **
     1360    *******************************************************************************
     1361    *******************************************************************************
     1362    *
     1363    * upd-xrec.i
     1364    *
     1365    * {1} = base field
     1366    * {2} = value to update metrics with
     1367    *
     1368    * [1] = base
     1369    * [2] = last (previous cumulative value)
     1370    * [3] = this
     1371    * [4] = cumulative
     1372    * [5] = interval
     1373    *
     1374    */
     1375   
     1376   tt_xstat.stat2[3] = tt_xstat.stat2[3]
     1377   tt_xstat.stat2[4] = tt_xstat.stat2[3] - tt_xstat.stat2[1]
     1378   tt_xstat.stat2[5] = tt_xstat.stat2[3] - tt_xstat.stat2[2]
     1379   tt_xstat.stat2[2] = tt_xstat.stat2[3]
     1380    
     1381             
     1382   /*******************************************************************************
     1383    *******************************************************************************
     1384    **                                                                           **
     1385    **                                                                           **
     1386    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1387    **  http://www.greenfieldtech.com                                            **
     1388    **                                                                           **
     1389    **  ProTop is free software; you can redistribute it and/or modify it        **
     1390    **  under the terms of the GNU General Public License (GPL) as published     **
     1391    **  by the Free Software Foundation; either version 2 of the License, or     **
     1392    **  at your option) any later version.                                       **
     1393    **                                                                           **
     1394    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1395    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1396    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1397    **  for more details.                                                        **
     1398    **                                                                           **
     1399    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1400    **  of use and alternative licensing options for this software.              **
     1401    **                                                                           **
     1402    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1403    **                                                                           **
     1404    **  See http://www.fsf.org for more information about the GPL.               **
     1405    **                                                                           **
     1406    **                                                                           **
     1407    *******************************************************************************
     1408    *******************************************************************************
     1409    *
     1410    * upd-xrec.i
     1411    *
     1412    * {1} = base field
     1413    * {2} = value to update metrics with
     1414    *
     1415    * [1] = base
     1416    * [2] = last (previous cumulative value)
     1417    * [3] = this
     1418    * [4] = cumulative
     1419    * [5] = interval
     1420    *
     1421    */
     1422   
     1423   tt_xstat.stat3[3] = tt_xstat.stat3[3]
     1424   tt_xstat.stat3[4] = tt_xstat.stat3[3] - tt_xstat.stat3[1]
     1425   tt_xstat.stat3[5] = tt_xstat.stat3[3] - tt_xstat.stat3[2]
     1426   tt_xstat.stat3[2] = tt_xstat.stat3[3]
     1427    
     1428             
     1429   /*******************************************************************************
     1430    *******************************************************************************
     1431    **                                                                           **
     1432    **                                                                           **
     1433    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1434    **  http://www.greenfieldtech.com                                            **
     1435    **                                                                           **
     1436    **  ProTop is free software; you can redistribute it and/or modify it        **
     1437    **  under the terms of the GNU General Public License (GPL) as published     **
     1438    **  by the Free Software Foundation; either version 2 of the License, or     **
     1439    **  at your option) any later version.                                       **
     1440    **                                                                           **
     1441    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1442    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1443    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1444    **  for more details.                                                        **
     1445    **                                                                           **
     1446    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1447    **  of use and alternative licensing options for this software.              **
     1448    **                                                                           **
     1449    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1450    **                                                                           **
     1451    **  See http://www.fsf.org for more information about the GPL.               **
     1452    **                                                                           **
     1453    **                                                                           **
     1454    *******************************************************************************
     1455    *******************************************************************************
     1456    *
     1457    * upd-xrec.i
     1458    *
     1459    * {1} = base field
     1460    * {2} = value to update metrics with
     1461    *
     1462    * [1] = base
     1463    * [2] = last (previous cumulative value)
     1464    * [3] = this
     1465    * [4] = cumulative
     1466    * [5] = interval
     1467    *
     1468    */
     1469   
     1470   tt_xstat.stat4[3] = tt_xstat.stat4[3]
     1471   tt_xstat.stat4[4] = tt_xstat.stat4[3] - tt_xstat.stat4[1]
     1472   tt_xstat.stat4[5] = tt_xstat.stat4[3] - tt_xstat.stat4[2]
     1473   tt_xstat.stat4[2] = tt_xstat.stat4[3]
     1474    
     1475             
     1476   /*******************************************************************************
     1477    *******************************************************************************
     1478    **                                                                           **
     1479    **                                                                           **
     1480    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1481    **  http://www.greenfieldtech.com                                            **
     1482    **                                                                           **
     1483    **  ProTop is free software; you can redistribute it and/or modify it        **
     1484    **  under the terms of the GNU General Public License (GPL) as published     **
     1485    **  by the Free Software Foundation; either version 2 of the License, or     **
     1486    **  at your option) any later version.                                       **
     1487    **                                                                           **
     1488    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1489    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1490    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1491    **  for more details.                                                        **
     1492    **                                                                           **
     1493    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1494    **  of use and alternative licensing options for this software.              **
     1495    **                                                                           **
     1496    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1497    **                                                                           **
     1498    **  See http://www.fsf.org for more information about the GPL.               **
     1499    **                                                                           **
     1500    **                                                                           **
     1501    *******************************************************************************
     1502    *******************************************************************************
     1503    *
     1504    * upd-xrec.i
     1505    *
     1506    * {1} = base field
     1507    * {2} = value to update metrics with
     1508    *
     1509    * [1] = base
     1510    * [2] = last (previous cumulative value)
     1511    * [3] = this
     1512    * [4] = cumulative
     1513    * [5] = interval
     1514    *
     1515    */
     1516   
     1517   tt_xstat.stat5[3] = tt_xstat.stat5[3]
     1518   tt_xstat.stat5[4] = tt_xstat.stat5[3] - tt_xstat.stat5[1]
     1519   tt_xstat.stat5[5] = tt_xstat.stat5[3] - tt_xstat.stat5[2]
     1520   tt_xstat.stat5[2] = tt_xstat.stat5[3]
     1521    
     1522             
     1523   /*******************************************************************************
     1524    *******************************************************************************
     1525    **                                                                           **
     1526    **                                                                           **
     1527    **  Copyright 2003-2006 Tom Bascom, Greenfield Technologies                  **
     1528    **  http://www.greenfieldtech.com                                            **
     1529    **                                                                           **
     1530    **  ProTop is free software; you can redistribute it and/or modify it        **
     1531    **  under the terms of the GNU General Public License (GPL) as published     **
     1532    **  by the Free Software Foundation; either version 2 of the License, or     **
     1533    **  at your option) any later version.                                       **
     1534    **                                                                           **
     1535    **  ProTop is distributed in the hope that it will be useful, but WITHOUT    **
     1536    **  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or    **
     1537    **  FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License     **
     1538    **  for more details.                                                        **
     1539    **                                                                           **
     1540    **  See TERMS.TXT for more information regarding the Terms and Conditions    **
     1541    **  of use and alternative licensing options for this software.              **
     1542    **                                                                           **
     1543    **  A copy of the GPL is in GPL.TXT which was provided with this package.    **
     1544    **                                                                           **
     1545    **  See http://www.fsf.org for more information about the GPL.               **
     1546    **                                                                           **
     1547    **                                                                           **
     1548    *******************************************************************************
     1549    *******************************************************************************
     1550    *
     1551    * upd-xrec.i
     1552    *
     1553    * {1} = base field
     1554    * {2} = value to update metrics with
     1555    *
     1556    * [1] = base
     1557    * [2] = last (previous cumulative value)
     1558    * [3] = this
     1559    * [4] = cumulative
     1560    * [5] = interval
     1561    *
     1562    */
     1563   
     1564   tt_xstat.stat6[3] = tt_xstat.stat6[3]
     1565   tt_xstat.stat6[4] = tt_xstat.stat6[3] - tt_xstat.stat6[1]
     1566   tt_xstat.stat6[5] = tt_xstat.stat6[3] - tt_xstat.stat6[2]
     1567   tt_xstat.stat6[2] = tt_xstat.stat6[3]
     1568    
     1569           .
     1570   
     1571           if ratio-calc = 0 then
     1572             assign
     1573               tt_xstat.stat-ratio  = 100 * (( tt_xstat.stat1[x] - tt_xstat.stat2[x] ) / tt_xstat.stat1[x] )
     1574               tt_xstat.stat-ratio  = ( if tt_xstat.stat-ratio = ? then 0 else tt_xstat.stat-ratio )
     1575               tt_xstat.stat-ratio2  = 100 * (( tt_xstat.stat3[x] - tt_xstat.stat4[x] ) / tt_xstat.stat3[x] )
     1576               tt_xstat.stat-ratio2  = ( if tt_xstat.stat-ratio2 = ? then 0 else tt_xstat.stat-ratio2 )
     1577             .
     1578            else if ratio-calc = 1 then
     1579             assign
     1580               tt_xstat.stat-ratio  = 100 * ( tt_xstat.stat1[x] / tt_xstat.stat2[x] )
     1581               tt_xstat.stat-ratio  = ( if tt_xstat.stat-ratio = ? then 0 else tt_xstat.stat-ratio )
     1582               tt_xstat.stat-ratio2  = 100 * ( tt_xstat.stat3[x] / tt_xstat.stat4[x] )
     1583               tt_xstat.stat-ratio2  = ( if tt_xstat.stat-ratio2 = ? then 0 else tt_xstat.stat-ratio2 )
     1584             .
     1585         end.
     1586   
     1587     end.
     1588   
     1589     return.
     1590   
     1591   end.
     1592    
     1593   
     1594   define temp-table tt_uio no-undo
     1595     field xId       as integer   format ">>>>9"      label "Id"
     1596     field xValid    as logical
     1597     field userNum   as integer   format ">>>>9"      label "Usr#"
     1598   &IF DEFINED( OE11 ) &THEN
     1599     field tId       as integer   format "->>>>9"     label "Tenant"
     1600   &ENDIF
     1601     field userName  as character format "x(15)"      label "Name"
     1602     field userPID   as character format "x(8)"       label "PID"
     1603     field userFlags as character format "x(5)"       label "Flags"
     1604     field dbAccess  as integer   format "->>>>>>9"   label "Blk Acc"
     1605     field osReads   as integer   format "->>>>>>9"   label "OS Rd"
     1606     field osWrites  as integer   format "->>>>>9"    label "OS Wr"
     1607     field hitRatio  as decimal   format "->>>>9.99%" label "Hit%"
     1608     field recLks    as integer   format "->>>>>>9"   label "Rec Lck"
     1609   /*field recWts    as integer   format "->>>>>9"    label "Rec Wts" */
     1610     field lkHWM     as integer   format "->>>>>9"    label "Lk HWM"
     1611     field lineNum   as integer   format "->>>>>"     label "Line#"
     1612   &IF DEFINED( OE11 ) &THEN
     1613     field procName  as character format "x(50)"      label "Program Name"
     1614   &ELSE
     1615     field procName  as character format "x(57)"      label "Program Name"
     1616   &ENDIF
     1617   
     1618     index dbAccess-idx is primary dbAccess descending
     1619     index xId-idx      is unique xid
     1620   
     1621   &IF DEFINED( OE11 ) &THEN
     1622     index tId-idx   tId
     1623   &ENDIF
     1624   
     1625     index userName-idx userName
     1626     index userNum-idx  userNum
     1627   
     1628     index osReads-idx  osReads  descending
     1629     index osWrites-idx osWrites descending
     1630     index hitRatio-idx hitRatio descending
     1631     index recLks-idx   recLks   descending
     1632   /*index recWts-idx   recWts   descending */
     1633     index lkHWM-idx    lkHWM    descending
     1634     index xValid-idx   xValid
     1635   .
     1636   
     1637   
     1638   /* lib/dumpTT.i
     1639    *
     1640    * simplified to a single line -- include should be eliminated.
     1641    *
     1642    */
     1643   
     1644   &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.1 &THEN
     1645   /*** +++
     1646   file-info:file-name = "./ptdefs".
     1647   if file-info:full-pathname <> ? and index( file-info:file-type, "d" ) > 0 and index( file-info:file-type, "w" ) > 0 then
     1648     do:
     1649   
     1650       file-info:file-name = "./ptdefs/{1}.xsd".
     1651   
     1652       if true /* file-info:full-pathname = ? or file-info:file-size = 0 */ then
     1653         do:
     1654   
     1655           temp-table {1}:write-xmlschema(
     1656             "file",
     1657   /*        substitute( "ptdefs/&1.xsd", "{1}" ), */
     1658   /*        "./ptdefs/{1}.xsd", */
     1659             ( if opsys = "unix" then "./ptdefs/{1}.xsd" else ".~\ptdefs~\{1}.xsd" ),
     1660             true
     1661   
     1662         &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 10.2
     1663         &THEN
     1664             , ?, ?, ?
     1665         &ENDIF
     1666   
     1667       ).
     1668   
     1669       end.
     1670   
     1671     end.
     1672    +++ ***/
     1673   &ENDIF
     1674    
     1675   
     1676   define new global shared variable rowLimit as integer no-undo.
     1677   define new global shared variable dbgMode  as integer no-undo initial 1.
     1678   
     1679   define variable pt_trimStack as character no-undo       /* a list of items to automatically remove from the program stack       */
     1680     initial ""
     1681   .
     1682   
     1683   subscribe to "enableCSC" anywhere run-procedure "enableCSC".
     1684   
     1685   procedure enableCSC:
     1686   
     1687     define input parameter userNum as integer no-undo.
     1688     define input parameter howLong as integer no-undo.
     1689   
     1690     publish "info" ( "enableCSC", substitute( "enableCSC: &1 &2 (not yet)", userNum, howLong )).
     1691   
     1692     return.
     1693   
     1694   end.
     1695   
     1696   
     1697   /* initialize
     1698    *
     1699    */
     1700   
     1701   procedure mon-init:
     1702   
     1703     empty temp-table tt_xstat.
     1704   
     1705     run updTick.
     1706   
     1707     return.
     1708   
     1709   end.
     1710   
     1711   /* update
     1712    *
     1713    */
     1714   
     1715   procedure mon-update:
     1716   
     1717     define input parameter argList as character no-undo.
     1718   
     1719     define variable i as integer no-undo.
     1720     define variable j as integer no-undo.
     1721   
     1722     run updTick.
     1723   
     1724     for each tt_uio:
     1725       xvalid = no.
     1726     end.
     1727   
     1728     for each dictdb._UserIO no-lock where _UserIO-usr <> ?:
     1729   
     1730       find tt_uio where tt_uio.xid = _UserIO-Id no-error.
     1731       if not available( tt_uio ) then create tt_uio.
     1732       assign
     1733         tt_uio.xvalid  = yes
     1734         tt_uio.xid     = _UserIO-Id
     1735         tt_uio.userNum = _UserIO-Usr
     1736       .
     1737   
     1738       find dictdb._Connect no-lock where _Connect-Id = _UserIO-Id.
     1739       find dictdb._LockReq no-lock where _LockReq-Id = _UserIO-Id.
     1740   
     1741       assign
     1742         tt_uio.userFlags = connectFlags( _Connect-Id )
     1743         tt_uio.userName  = connectName( _Connect-Id, tt_uio.userFlags )
     1744         tt_uio.userPID   = string( _connect-PID )
     1745       .
     1746   
     1747       lastStatement( _Connect-Id, output tt_uio.lineNum, output tt_uio.procName ).
     1748   
     1749   &IF DEFINED( OE11 ) &THEN
     1750   /*  tt_uio.tId  = _userIO-tenantId. */
     1751   
     1752       tt_uio.tId  = buffer _userIO:handle:buffer-field( "_userIO-tenantId" ):buffer-value no-error.
     1753   &ENDIF
     1754   
     1755       run update_xstat (
     1756         input _UserIO-Id,                         /* unique key           */
     1757         input "",                                 /* u_name               */
     1758         input "",                                 /* u_flags              */
     1759         input "",                                 /* u_pid                */
     1760         input "",                                 /* string( _Connect-CacheLineNumber[1] ) + "," + _Connect-CacheInfo[1] */
     1761         input "",                                 /* _connect-clientType  */
     1762         input "",
     1763         input _UserIO-dbaccess,                   /* stat1                */
     1764         input _UserIO-dbread,                     /* stat2                */
     1765         input _UserIO-dbwrite,                    /* stat3                */
     1766         input 0,
     1767         input _LockReq-RecLock,
     1768         input _LockReq-RecWait
     1769       ).
     1770   
     1771     end.
     1772   
     1773     run age_xstat.
     1774   
     1775     i = 0.
     1776     for each tt_uio where tt_uio.xvalid = yes:
     1777   
     1778       find tt_xstat where tt_xstat.xid = tt_uio.xid no-error.
     1779       if ( not available tt_xstat ) /* or ( tt_xstat.stat1[x] = 0 ) */ then
     1780      /* or (( rowLimit > 0 ) and ( i >= rowLimit )) then */               /* this needs to be within the context of a sort order  */
     1781         do:
     1782           tt_uio.xvalid = no.
     1783           next.
     1784         end.
     1785   
     1786       i = i + 1.
     1787   
     1788       assign
     1789         tt_uio.xvalid    = yes
     1790         tt_uio.dbAccess  = tt_xstat.stat1[x] / z
     1791         tt_uio.OSReads   = tt_xstat.stat2[x] / z
     1792         tt_uio.OSWrites  = tt_xstat.stat3[x] / z
     1793         tt_uio.hitRatio  = tt_xstat.stat-ratio
     1794         tt_uio.recLks    = tt_xstat.stat5[x] / z
     1795   /*    tt_uio.recWts    = tt_xstat.stat6[x] / z */
     1796       .
     1797   
     1798       &IF DECIMAL(SUBSTRING(PROVERSION,1,INDEX(PROVERSION,".") + 1)) >= 11.7 &THEN
     1799   
     1800       if pt_userlock = yes then
     1801         do:
     1802           find _userLock no-lock where _userLock-id =  tt_uio.xid.
     1803           tt_uio.recLks = buffer _userLock:handle:buffer-field( "_userLock-Total" ):buffer-value no-error.
     1804           tt_uio.lkHWM  = buffer _userLock:handle:buffer-field( "_userLock-HWM" ):buffer-value no-error.
     1805         end.
     1806   
     1807       &ENDIF
     1808   
     1809     end.
     1810   
     1811     for each tt_uio where tt_uio.xvalid = no:
     1812       delete tt_uio.
     1813     end.
     1814   
     1815     j = 0.
     1816     for each tt_uio where tt_uio.xvalid = yes:
     1817       j = j + 1.
     1818     end.
     1819   
     1820     /*
     1821      *
     1822     i = 0.
     1823     if rowLimit > 0 then
     1824       for each tt_uio by dbAccess:
     1825         if i < rowLimit then
     1826           i = i + 1.
     1827          else
     1828           delete tt_uio.
     1829       end.
     1830      *
     1831      */
     1832   
     1833     if dbgMode >= 6 then message now "valid tt_uio rows:" j "  sent:" i.
     1834   
     1835     add2ds( temp-table tt_uio:default-buffer-handle ).
     1836   
     1837     return.
     1838   
     1839   end.
     1840   
     1841   *** Encrypted Source ***
     1842   *** Encrypted Source ***
     1843   *** Encrypted Source ***
     1844   *** Encrypted Source ***
     1845   *** Encrypted Source ***
     1846   *** Encrypted Source ***
     1847   *** Encrypted Source ***
     1848   *** Encrypted Source ***
     1849   *** Encrypted Source ***
     1850   *** Encrypted Source ***
     1851   *** Encrypted Source ***
     1852   *** Encrypted Source ***
     1853   *** Encrypted Source ***
     1854   *** Encrypted Source ***
     1855   *** Encrypted Source ***
     1856   *** Encrypted Source ***
     1857   *** Encrypted Source ***
     1858   *** Encrypted Source ***
     1859   *** Encrypted Source ***
     1860   *** Encrypted Source ***
     1861   *** Encrypted Source ***
     1862   *** Encrypted Source ***
     1863   *** Encrypted Source ***
     1864   *** Encrypted Source ***
     1865   *** Encrypted Source ***
     1866   *** Encrypted Source ***
     1867   *** Encrypted Source ***
     1868   *** Encrypted Source ***
     1869   *** Encrypted Source ***
     1870   *** Encrypted Source ***
     1871   *** Encrypted Source ***
     1872   *** Encrypted Source ***
     1873   *** Encrypted Source ***
     1874   *** Encrypted Source ***
     1875   *** Encrypted Source ***
     1876   *** Encrypted Source ***
     1877   *** Encrypted Source ***
     1878   *** Encrypted Source ***
     1879   *** Encrypted Source ***
     1880   *** Encrypted Source ***
     1881   *** Encrypted Source ***
     1882    
     1883   *** Encrypted Source ***
     1884   *** Encrypted Source ***
     1885   *** Encrypted Source ***
     1886   *** Encrypted Source ***
     1887   *** Encrypted Source ***
     1888   *** Encrypted Source ***
     1889   *** Encrypted Source ***
     1890   *** Encrypted Source ***
     1891   *** Encrypted Source ***
     1892   *** Encrypted Source ***
     1893   *** Encrypted Source ***
     1894   *** Encrypted Source ***
     1895   *** Encrypted Source ***
     1896   *** Encrypted Source ***
     1897   *** Encrypted Source ***
     1898   *** Encrypted Source ***
     1899   *** Encrypted Source ***
     1900   *** Encrypted Source ***
     1901   *** Encrypted Source ***
     1902   *** Encrypted Source ***
     1903   *** Encrypted Source ***
     1904   *** Encrypted Source ***
     1905   *** Encrypted Source ***
     1906   *** Encrypted Source ***
     1907   *** Encrypted Source ***
     1908   *** Encrypted Source ***
     1909   *** Encrypted Source ***
     1910   *** Encrypted Source ***
     1911   *** Encrypted Source ***
     1912   *** Encrypted Source ***
     1913   *** Encrypted Source ***
     1914   *** Encrypted Source ***
     1915   *** Encrypted Source ***
     1916   *** Encrypted Source ***
     1917   *** Encrypted Source ***
     1918   *** Encrypted Source ***
     1919   *** Encrypted Source ***
     1920   *** Encrypted Source ***
     1921   *** Encrypted Source ***
     1922   *** Encrypted Source ***
     1923   *** Encrypted Source ***
     1924    
     1925   *** Encrypted Source ***
     1926   *** Encrypted Source ***
     1927   *** Encrypted Source ***
     1928   *** Encrypted Source ***
     1929   *** Encrypted Source ***
     1930   *** Encrypted Source ***
     1931   *** Encrypted Source ***
     1932   *** Encrypted Source ***
     1933   *** Encrypted Source ***
     1934   *** Encrypted Source ***
     1935   *** Encrypted Source ***
     1936   *** Encrypted Source ***
     1937   *** Encrypted Source ***
     1938   *** Encrypted Source ***
     1939   *** Encrypted Source ***
     1940   *** Encrypted Source ***
     1941   *** Encrypted Source ***
     1942   *** Encrypted Source ***
     1943   *** Encrypted Source ***
     1944   *** Encrypted Source ***
     1945   *** Encrypted Source ***
     1946   *** Encrypted Source ***
     1947   *** Encrypted Source ***
     1948   *** Encrypted Source ***
     1949   *** Encrypted Source ***
     1950   *** Encrypted Source ***
     1951   *** Encrypted Source ***
     1952   *** Encrypted Source ***
     1953   *** Encrypted Source ***
     1954   *** Encrypted Source ***
     1955   *** Encrypted Source ***
     1956   *** Encrypted Source ***
     1957   *** Encrypted Source ***
     1958   *** Encrypted Source ***
     1959   *** Encrypted Source ***
     1960   *** Encrypted Source ***
     1961   *** Encrypted Source ***
     1962   *** Encrypted Source ***
     1963   *** Encrypted Source ***
     1964   *** Encrypted Source ***
     1965   *** Encrypted Source ***
     1966    
     1967   
     1968   *** Encrypted Source ***
     1969   *** Encrypted Source ***
     1970   *** Encrypted Source ***
     1971   *** Encrypted Source ***
     1972   *** Encrypted Source ***
     1973   *** Encrypted Source ***
     1974   *** Encrypted Source ***
     1975   *** Encrypted Source ***
     1976   *** Encrypted Source ***
     1977   *** Encrypted Source ***
     1978   *** Encrypted Source ***
     1979   *** Encrypted Source ***
     1980   *** Encrypted Source ***
     1981   *** Encrypted Source ***
     1982   *** Encrypted Source ***
     1983   *** Encrypted Source ***
     1984   *** Encrypted Source ***
     1985   *** Encrypted Source ***
     1986   *** Encrypted Source ***
     1987   *** Encrypted Source ***
     1988   *** Encrypted Source ***
     1989   *** Encrypted Source ***
     1990   *** Encrypted Source ***
     1991   *** Encrypted Source ***
     1992   *** Encrypted Source ***
     1993   *** Encrypted Source ***
     1994   *** Encrypted Source ***
     1995   *** Encrypted Source ***
     1996   *** Encrypted Source ***
     1997   *** Encrypted Source ***
     1998   *** Encrypted Source ***
     1999    
     2000   
     2001   return.
