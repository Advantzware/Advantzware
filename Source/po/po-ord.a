/* ---------------------------------------------------- po/po-ord.a  5/94 RM  */
/* Purchase Order Program Add Statement - P/O Module                          */
/* -------------------------------------------------------------------------- */

do iCount3 = 1 to inExpLimit:
  find first po-ctrl
      where po-ctrl.company eq cocode
      exclusive-lock no-wait no-error.
  if not avail po-ctrl then do:
    if iCount3 eq 1 then message
         " Please wait, the system is searching for the PO CONTROL RECORD.".
    readkey pause 1.
  end.
  if not avail po-ctrl and iCount3 eq inExpLimit then do:
    bell.
    message " The system was unable to obtain the PO CONTROL RECORD.".
    pause 2 no-message.
    loNewFile = no.
    next outers.
  end.
end. /* x = 1 to inExpLimit */

{sys/ref/postatus.i}

RUN sys/ref/asiseq.p (cocode,'po_seq',OUTPUT iCount3) NO-ERROR.
create po-ord.
assign
 po-ord.company        = cocode
 po-ord.po-no          = iCount3
 po-ord.po-date        = today
 po-ord.loc            = locode
 po-ord.buyer          = USERID("NOSWEAT")  /*global-uid*/
 po-ord.under-pct      = 10
 po-ord.over-pct       = 10
 /* po-ctrl.next-po-no    = po-ctrl.next-po-no + 1 */
 po-ord.due-date       = po-ord.po-date + 
                         if weekday(po-ord.po-date) eq 6 then 3 else 1
 po-ord.last-ship-date = po-ord.due-date
 fil_id                = recid (po-ord).
 
 if trim(v-postatus-cha) = "Hold" THEN po-ord.stat = "H".
 
release po-ctrl.
find first po-ctrl where po-ctrl.company eq cocode no-lock.
clear frame po-ord no-pause.

/* End ---------------------------------- Copr. 1994  Advanced Software, Inc. */
