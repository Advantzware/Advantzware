/* jobstack.p - generated 12/02/2005 - 16:52:40 by NoSweat */

/* this program was generated by auditgn1.p and should not be modified */
/* modifications should be made to the auto generation program         */

DEFINE INPUT PARAMETER action AS CHARACTER NO-UNDO.

DEFINE VARIABLE i AS INTEGER NO-UNDO.

{methods/defines/audit.i}
FIND FIRST ttbl_header.

DEFINE WORK-TABLE ttbl_jobstack1 NO-UNDO LIKE jobstack.
DEFINE WORK-TABLE ttbl_jobstack2 NO-UNDO LIKE jobstack.

CREATE ttbl_jobstack1.
IMPORT STREAM s_audit_file ttbl_jobstack1.
CREATE ttbl_jobstack2.
IF action = "UPDATE" THEN
IMPORT STREAM s_audit_file ttbl_jobstack2.

PUT STREAM s-audit-rpt UNFORMATTED
  "Action    User ID/(User Name)            DB.Table/(Database)  Date       Time" SKIP
  "--------- ------------------------------ -------------------- ---------- --------" SKIP
  ttbl_header.v_action AT 1
  ttbl_header.v_userid AT 11
  ttbl_header.v_file AT 42
  ttbl_header.v_date FORMAT "99/99/9999" AT 63
  STRING(ttbl_header.v_time,"HH:MM:SS") AT 74.
FIND users WHERE users.user_id = v_userid NO-LOCK NO-ERROR.
IF AVAILABLE users THEN
PUT STREAM s-audit-rpt UNFORMATTED "(" AT 10 users.user_name ")".
ELSE
PUT STREAM s-audit-rpt UNFORMATTED "(user record does not exist)" AT 10.
PUT STREAM s-audit-rpt UNFORMATTED
  "(" AT 41 ttbl_header.v_db ")" SKIP(1)
  "Label: Value (database field-name)" AT 3.
IF action = "UPDATE" THEN
PUT STREAM s-audit-rpt UNFORMATTED " ( * - denotes field value change )".
PUT STREAM s-audit-rpt UNFORMATTED FILL("-",75) AT 3.
IF NOT v_field_changed OR ttbl_jobstack1.bands NE ttbl_jobstack2.bands OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Bands: " AT 3 ttbl_jobstack1.bands FORMAT ">>9" " (bands)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.bands NE ttbl_jobstack2.bands THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Bands: " AT 3 ttbl_jobstack2.bands FORMAT ">>9".
  END.
END.
IF NOT v_field_changed OR ttbl_jobstack1.blank_number NE ttbl_jobstack2.blank_number OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Blank Number: " AT 3 ttbl_jobstack1.blank_number FORMAT ">9" " (blank_number)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.blank_number NE ttbl_jobstack2.blank_number THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Blank Number: " AT 3 ttbl_jobstack2.blank_number FORMAT ">9".
  END.
END.
IF NOT v_field_changed OR ttbl_jobstack1.bundles NE ttbl_jobstack2.bundles OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Bundles: " AT 3 ttbl_jobstack1.bundles FORMAT ">>9" " (bundles)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.bundles NE ttbl_jobstack2.bundles THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Bundles: " AT 3 ttbl_jobstack2.bundles FORMAT ">>9".
  END.
END.
IF NOT v_field_changed OR ttbl_jobstack1.form_number NE ttbl_jobstack2.form_number OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Form Number: " AT 3 ttbl_jobstack1.form_number FORMAT ">>9" " (form_number)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.form_number NE ttbl_jobstack2.form_number THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Form Number: " AT 3 ttbl_jobstack2.form_number FORMAT ">>9".
  END.
END.
IF NOT v_field_changed OR ttbl_jobstack1.job NE ttbl_jobstack2.job OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Job Number: " AT 3 ttbl_jobstack1.job " (job)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.job NE ttbl_jobstack2.job THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Job Number: " AT 3 ttbl_jobstack2.job.
  END.
END.
IF NOT v_field_changed OR ttbl_jobstack1.layers NE ttbl_jobstack2.layers OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Layers: " AT 3 ttbl_jobstack1.layers FORMAT ">>9" " (layers)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.layers NE ttbl_jobstack2.layers THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Layers: " AT 3 ttbl_jobstack2.layers FORMAT ">>9".
  END.
END.
IF NOT v_field_changed OR ttbl_jobstack1.pattern NE ttbl_jobstack2.pattern OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Stacking Pattern: " AT 3 ttbl_jobstack1.pattern " (pattern)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.pattern NE ttbl_jobstack2.pattern THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Stacking Pattern: " AT 3 ttbl_jobstack2.pattern.
  END.
END.
IF NOT v_field_changed OR ttbl_jobstack1.shipvia NE ttbl_jobstack2.shipvia OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Ship Via: " AT 3 ttbl_jobstack1.shipvia " (shipvia)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.shipvia NE ttbl_jobstack2.shipvia THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Ship Via: " AT 3 ttbl_jobstack2.shipvia.
  END.
END.
IF NOT v_field_changed OR ttbl_jobstack1.shipvia_description NE ttbl_jobstack2.shipvia_description OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Ship Via Description: " AT 3 ttbl_jobstack1.shipvia_description " (shipvia_description)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.shipvia_description NE ttbl_jobstack2.shipvia_description THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Ship Via Description: " AT 3 ttbl_jobstack2.shipvia_description.
  END.
END.
IF NOT v_field_changed OR ttbl_jobstack1.stacks NE ttbl_jobstack2.stacks OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Stacks: " AT 3 ttbl_jobstack1.stacks FORMAT ">9" " (stacks)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.stacks NE ttbl_jobstack2.stacks THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Stacks: " AT 3 ttbl_jobstack2.stacks FORMAT ">9".
  END.
END.
IF NOT v_field_changed OR ttbl_jobstack1.tags NE ttbl_jobstack2.tags OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Tags: " AT 3 ttbl_jobstack1.tags FORMAT ">>>9" " (tags)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.tags NE ttbl_jobstack2.tags THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Tags: " AT 3 ttbl_jobstack2.tags FORMAT ">>>9".
  END.
END.
IF NOT v_field_changed OR ttbl_jobstack1.ties NE ttbl_jobstack2.ties OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Ties: " AT 3 ttbl_jobstack1.ties FORMAT ">>9" " (ties)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.ties NE ttbl_jobstack2.ties THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Ties: " AT 3 ttbl_jobstack2.ties FORMAT ">>9".
  END.
END.
IF NOT v_field_changed OR ttbl_jobstack1.unit_count NE ttbl_jobstack2.unit_count OR action NE "UPDATE" THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Unit Count: " AT 3 ttbl_jobstack1.unit_count FORMAT ">>>>9" " (unit_count)".
  IF action = "UPDATE" THEN
  DO:
    IF ttbl_jobstack1.unit_count NE ttbl_jobstack2.unit_count THEN
    PUT STREAM s-audit-rpt UNFORMATTED "*" AT 1.
    PUT STREAM s-audit-rpt UNFORMATTED "Unit Count: " AT 3 ttbl_jobstack2.unit_count FORMAT ">>>>9".
  END.
END.
IF v_show_index THEN
DO:
  PUT STREAM s-audit-rpt UNFORMATTED "Index Fields - Label: Value (database field-name)" AT 5.
  PUT STREAM s-audit-rpt UNFORMATTED "Job Number: " AT 7.
  IF action = "UPDATE" THEN
  PUT STREAM s-audit-rpt UNFORMATTED ttbl_jobstack2.job " (job)".
  ELSE
  PUT STREAM s-audit-rpt UNFORMATTED ttbl_jobstack1.job " (job)".
  PUT STREAM s-audit-rpt UNFORMATTED "Form Number: " AT 7.
  IF action = "UPDATE" THEN
  PUT STREAM s-audit-rpt UNFORMATTED ttbl_jobstack2.form_number FORMAT ">>9" " (form_number)".
  ELSE
  PUT STREAM s-audit-rpt UNFORMATTED ttbl_jobstack1.form_number FORMAT ">>9" " (form_number)".
  PUT STREAM s-audit-rpt UNFORMATTED "Blank Number: " AT 7.
  IF action = "UPDATE" THEN
  PUT STREAM s-audit-rpt UNFORMATTED ttbl_jobstack2.blank_number FORMAT ">9" " (blank_number)".
  ELSE
  PUT STREAM s-audit-rpt UNFORMATTED ttbl_jobstack1.blank_number FORMAT ">9" " (blank_number)".
END.
PUT STREAM s-audit-rpt UNFORMATTED SKIP(1).
