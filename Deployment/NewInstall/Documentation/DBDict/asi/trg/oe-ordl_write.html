<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: write of oe-ordl</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: write of oe-ordl</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">UPDATE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME oe-ordl
 
<span class="src-keyword">TRIGGER PROCEDURE FOR WRITE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">OLD BUFFER</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">write</span><!--src-keyword-->.i}</span><!--src-prep-->
 
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">FOR</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-inv-line <span class="src-keyword">FOR</span><!--src-keyword--> inv-line.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-job-hdr <span class="src-keyword">FOR</span><!--src-keyword--> job-hdr.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> oe-ordl-q-no <span class="src-keyword">FOR</span><!--src-keyword--> reftable.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> oe-ordl-whs-item <span class="src-keyword">FOR</span><!--src-keyword--> reftable.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> orderpo <span class="src-keyword">FOR</span><!--src-keyword--> reftable.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-prep <span class="src-keyword">FOR</span><!--src-keyword--> prep.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-oe-rel <span class="src-keyword">FOR</span><!--src-keyword--> oe-rel.
 
<span class="src-keyword">DEF VAR</span><!--src-keyword--> li <span class="src-keyword">AS INT NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> lj <span class="src-keyword">AS INT NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ld <span class="src-keyword">AS DEC NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> lv-stat <span class="src-keyword">AS CHAR NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> lv-freight <span class="src-keyword">LIKE</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-freight <span class="src-keyword">NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> xInvQty <span class="src-keyword">LIKE</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.inv-qty <span class="src-keyword">NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> oeDateAuto-log  <span class="src-keyword">AS LOG  NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> oeDateAuto-char <span class="src-keyword">AS CHAR NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF    VAR</span><!--src-keyword-->      cRtnChar  <span class="src-keyword">AS CHAR    NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> lRecFound <span class="src-keyword">AS LOGICAL NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">RUN</span><!--src-keyword--> sys/ref/nk1look.p (<span class="src-keyword">INPUT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company, <span class="src-char">"OEDATEAUTO"</span><!--src-char-->, <span class="src-char">"L"</span><!--src-char--> <span class="src-comment">/* Logical */</span><!--src-comment-->, <span class="src-keyword">NO</span><!--src-keyword--> <span class="src-comment">/* check by cust */</span><!--src-comment-->, 
    <span class="src-keyword">INPUT YES</span><!--src-keyword--> <span class="src-comment">/* use cust not vendor */</span><!--src-comment-->, <span class="src-char">""</span><!--src-char--> <span class="src-comment">/* cust */</span><!--src-comment-->, <span class="src-char">""</span><!--src-char--> <span class="src-comment">/* ship-to*/</span><!--src-comment-->,
    <span class="src-keyword">OUTPUT</span><!--src-keyword--> cRtnChar, <span class="src-keyword">OUTPUT</span><!--src-keyword--> lRecFound).
<span class="src-keyword">IF</span><!--src-keyword--> lRecFound <span class="src-keyword">THEN</span><!--src-keyword-->
    oeDateAuto-log = <span class="src-keyword">LOGICAL</span><!--src-keyword-->(cRtnChar) <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
 
<span class="src-keyword">RUN</span><!--src-keyword--> sys/ref/nk1look.p (<span class="src-keyword">INPUT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company, <span class="src-char">"OEDATEAUTO"</span><!--src-char-->, <span class="src-char">"C"</span><!--src-char--> <span class="src-comment">/* Logical */</span><!--src-comment-->, <span class="src-keyword">NO</span><!--src-keyword--> <span class="src-comment">/* check by cust */</span><!--src-comment-->, 
    <span class="src-keyword">INPUT YES</span><!--src-keyword--> <span class="src-comment">/* use cust not vendor */</span><!--src-comment-->, <span class="src-char">""</span><!--src-char--> <span class="src-comment">/* cust */</span><!--src-comment-->, <span class="src-char">""</span><!--src-char--> <span class="src-comment">/* ship-to*/</span><!--src-comment-->,
    <span class="src-keyword">OUTPUT</span><!--src-keyword--> cRtnChar, <span class="src-keyword">OUTPUT</span><!--src-keyword--> lRecFound).
<span class="src-keyword">IF</span><!--src-keyword--> lRecFound <span class="src-keyword">THEN</span><!--src-keyword-->
    oeDateAuto-char = cRtnChar <span class="src-keyword">NO-ERROR</span><!--src-keyword-->. 
 
<span class="src-prep">{custom/globdefs.i}</span><!--src-prep-->
 
 
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> job-hdr.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> oe-ord.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> oe-ordm.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> oe-rel.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> oe-rell.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> oe-boll.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> inv-line.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> oe-ordl-q-no.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> itemfg.
 
<span class="src-prep">{sys/inc/<span class="src-keyword">var</span><!--src-keyword-->.i <span class="src-keyword">NEW</span><!--src-keyword--> SHARED}</span><!--src-p<span class="src-keyword">SHARED</span><!--src-keyword-->
 
 
<span class="src-keyword">ASSIGN</span><!--src-keyword-->
 cocode = g_company
 locode = g_loc.
 
<span class="src-prep">{sys/inc/notes.i <span class="src-char">"do not need transaction block"</span><!--src-char-->}</span><!--src-prep-->
<span class="src-prep">{sys/inc/oeuserid.i}</span><!--src-prep-->
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> bf-shipto <span class="src-keyword">FOR</span><!--src-keyword--> shipto.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line LT</span><!--src-keyword--> <span class="src-number">1</span><!--src-number--> <span class="src-keyword">OR</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line GE</span><!--src-keyword--> <span class="src-number">99999999</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no = <span class="src-char">""</span><!--src-char-->.
 
<span class="src-comment">/*#PN 2 options to solve for 05281303*/</span><!--src-comment-->
<span class="src-comment">/*#PN 1 Modifying the oe/ordlsqty.p program*/</span><!--src-comment-->
<span class="src-comment">/*#PN Pro - centralized, better calculation for inv-qty*/</span><!--src-comment-->
<span class="src-comment">/*#PN Con - additional processing time for every oe-ordl write*/</span><!--src-comment-->
<span class="src-comment">/*#PN 2 Changing the ordlsqty.p call here so that it doesn't change inv-qty*/</span><!--src-comment-->
<span class="src-comment">/*#PN Pro - No additional processing*/</span><!--src-comment-->
<span class="src-comment">/*#PN Con - inv-qty can get overridden by other calls of ordsqty*/</span><!--src-comment-->
<span class="src-comment">/*#PN Con - inv-qty can get out of whack if invoice deleted*/</span><!--src-comment-->
<span class="src-comment">/* RUN oe/ordlsqty.p (ROWID({&amp;TABLENAME}), OUTPUT xInvQty , OUTPUT {&amp;TABLENAME}.ship-qty). */</span><!--src-comment-->
<span class="src-keyword">RUN</span><!--src-keyword--> oe/ordlsqty.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->), <span class="src-keyword">OUTPUT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.inv-qty, <span class="src-keyword">OUTPUT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ship-qty).
<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-ship-qty = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ship-qty.
 
<span class="src-keyword">RUN</span><!--src-keyword--> oe/rell-qty.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->), <span class="src-keyword">OUTPUT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-rel-qty).
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.po-no-po <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-keyword">FIND FIRST</span><!--src-keyword--> po-ord <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
      <span class="src-keyword">WHERE</span><!--src-keyword--> po-ord.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> po-ord.po-no   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.po-no-po
      <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
  <span class="src-keyword">IF AVAIL</span><!--src-keyword--> po-ord <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.vend-no = po-ord.vend-no.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-ord <span class="src-keyword">OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
  <span class="src-keyword">ASSIGN</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.opened  = oe-ord.opened
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-no = oe-ord.cust-no.
  <span class="src-keyword">LEAVE</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">IF NOT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.opened <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.stat = <span class="src-char">"C"</span><!--src-char-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> b-job-hdr <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
      <span class="src-keyword">WHERE</span><!--src-keyword--> b-job-hdr.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> b-job-hdr.ord-no   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
        <span class="src-keyword">AND</span><!--src-keyword--> b-job-hdr.i-no     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no:
    <span class="src-keyword">FIND</span><!--src-keyword--> job-hdr <span class="src-keyword">WHERE ROWID</span><!--src-keyword-->(job-hdr) <span class="src-keyword">EQ ROWID</span><!--src-keyword-->(b-job-hdr) <span class="src-keyword">EXCLUSIVE NO-ERROR NO-WAIT</span><!--src-keyword-->.
    <span class="src-keyword">IF AVAIL</span><!--src-keyword--> job-hdr <span class="src-keyword">THEN DO</span><!--src-keyword-->:
      job-hdr.due-date = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.req-date.
      <span class="src-keyword">RUN</span><!--src-keyword--> jc/duedates.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(job-hdr)).
    <span class="src-keyword">END</span><!--src-keyword-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  ll = <span class="src-keyword">NOT CAN-FIND</span><!--src-keyword-->(<span class="src-keyword">FIRST</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->
                    <span class="src-keyword">WHERE</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
                      <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
                      <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
                      <span class="src-keyword">AND ROWID</span><!--src-keyword-->(b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)  <span class="src-keyword">NE ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)).
 
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                             <span class="src-keyword">AND</span><!--src-keyword-->
     old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                         <span class="src-keyword">AND</span><!--src-keyword-->
     (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line OR</span><!--src-keyword-->
      <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no <span class="src-keyword">OR</span><!--src-keyword--> ll) <span class="src-keyword">THEN DO</span><!--src-keyword-->:
 
   <span class="src-keyword">RUN</span><!--src-keyword--> oe/lineUpdate.p (<span class="src-keyword">INPUT   ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->),
                     <span class="src-keyword">INPUT</span><!--src-keyword-->   old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no,
                     <span class="src-keyword">INPUT</span><!--src-keyword-->   old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">LINE</span><!--src-keyword-->,
                     <span class="src-keyword">INPUT</span><!--src-keyword-->   ll).
 
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FIND FIRST</span><!--src-keyword--> itemfg
    <span class="src-keyword">WHERE</span><!--src-keyword--> itemfg.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> itemfg.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
    <span class="src-keyword">NO-LOCK NO-ERROR</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->                              <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">"0"</span><!--src-char-->                             <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                                <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.pr-uom <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->                            <span class="src-keyword">AND</span><!--src-keyword-->
   old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->                          <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-keyword">AVAIL</span><!--src-keyword--> itemfg                                         <span class="src-keyword">AND</span><!--src-keyword-->
   (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty      <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty      <span class="src-keyword">OR</span><!--src-keyword-->
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.req-date <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.req-date <span class="src-keyword">OR</span><!--src-keyword-->
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.price    <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.price    <span class="src-keyword">OR</span><!--src-keyword-->
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.pr-uom   <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.pr-uom)     <span class="src-keyword">THEN</span><!--src-keyword-->
 
  <span class="src-keyword">RUN</span><!--src-keyword--> fg/makenote.p (<span class="src-keyword">BUFFER</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->,
                     <span class="src-keyword">BUFFER</span><!--src-keyword--> quoteqty,
                     <span class="src-keyword">BUFFER</span><!--src-keyword--> ar-invl,
                     <span class="src-keyword">NO</span><!--src-keyword-->,
                     itemfg.rec_key).
 
<span class="src-keyword">IF AVAIL</span><!--src-keyword--> itemfg                                         <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.type-code <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">"T"</span><!--src-char-->                        <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.type-code <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.type-code <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-keyword">FIND CURRENT</span><!--src-keyword--> itemfg.
  itemfg.type-code = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.type-code.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF NOT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.is-a-component <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.set-hdr-line = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">OR</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-keyword">FOR EACH</span><!--src-keyword--> b-inv-line
    <span class="src-keyword">WHERE</span><!--src-keyword--> b-inv-line.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> b-inv-line.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
      <span class="src-keyword">AND</span><!--src-keyword--> b-inv-line.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
      <span class="src-keyword">AND</span><!--src-keyword--> b-inv-line.<span class="src-keyword">line    EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->
    <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
 
  <span class="src-keyword">DO</span><!--src-keyword--> lj = <span class="src-number">1</span><!--src-number--> <span class="src-keyword">TO</span><!--src-keyword--> <span class="src-number">100</span><!--src-number-->:
    <span class="src-keyword">FIND</span><!--src-keyword--> inv-line <span class="src-keyword">WHERE ROWID</span><!--src-keyword-->(inv-line) <span class="src-keyword">EQ ROWID</span><!--src-keyword-->(b-inv-line) <span class="src-keyword">EXCLUSIVE-LOCK NO-WAIT NO-ERROR</span><!--src-keyword-->.
 
    <span class="src-keyword">IF AVAIL</span><!--src-keyword--> inv-line <span class="src-keyword">THEN DO</span><!--src-keyword-->:
      <span class="src-keyword">DO</span><!--src-keyword--> li = <span class="src-number">1</span><!--src-number--> <span class="src-keyword">TO EXTENT</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-man):
        <span class="src-keyword">ASSIGN</span><!--src-keyword-->
         inv-line.sman[li]   = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-man[li]
         inv-line.s-comm[li] = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-comm[li]
         inv-line.s-pct[li]  = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-pct[li].
      <span class="src-keyword">END</span><!--src-keyword-->.
 
      <span class="src-keyword">LEAVE</span><!--src-keyword-->.
    <span class="src-keyword">END</span><!--src-keyword-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.req-date <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.req-date <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-rel
      <span class="src-keyword">WHERE</span><!--src-keyword--> oe-rel.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.<span class="src-keyword">line    EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->
      <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
      <span class="src-keyword">BY</span><!--src-keyword--> oe-rel.rel-date:
    <span class="src-keyword">RUN</span><!--src-keyword--> oe/rel-stat.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(oe-rel), <span class="src-keyword">OUTPUT</span><!--src-keyword--> lv-stat).
    <span class="src-keyword">IF INDEX</span><!--src-keyword-->(<span class="src-char">"SLI"</span><!--src-char-->,lv-stat) <span class="src-keyword">GT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
 
      <span class="src-keyword">FIND</span><!--src-keyword--> b-oe-rel <span class="src-keyword">WHERE ROWID</span><!--src-keyword-->(b-oe-rel) <span class="src-keyword">EQ ROWID</span><!--src-keyword-->(oe-rel) <span class="src-keyword">EXCLUSIVE-LOCK NO-ERROR NO-WAIT</span><!--src-keyword-->.
 
      <span class="src-keyword">IF AVAIL</span><!--src-keyword--> b-oe-rel <span class="src-keyword">THEN</span><!--src-keyword-->
      <span class="src-keyword">DO</span><!--src-keyword-->:
          <span class="src-keyword">FIND FIRST</span><!--src-keyword--> oe-ord <span class="src-keyword">WHERE</span><!--src-keyword--> oe-ord.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
           <span class="src-keyword">AND</span><!--src-keyword--> oe-ord.ord-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
           <span class="src-keyword">NO-LOCK NO-ERROR</span><!--src-keyword-->.
 
          <span class="src-keyword">IF  AVAIL</span><!--src-keyword--> oe-ord <span class="src-keyword">AND NOT</span><!--src-keyword--> (oeDateAuto-log <span class="src-keyword">AND</span><!--src-keyword--> oeDateAuto-char = <span class="src-char">"Colonial"</span><!--src-char-->) <span class="src-keyword">THEN DO</span><!--src-keyword-->:
 
             b-oe-rel.rel-date = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.req-date.
             <span class="src-keyword">RELEASE</span><!--src-keyword--> b-oe-rel.
 
         <span class="src-keyword">END</span><!--src-keyword-->.
      <span class="src-keyword">END</span><!--src-keyword-->.
 
      <span class="src-keyword">LEAVE</span><!--src-keyword-->.
    <span class="src-keyword">END</span><!--src-keyword-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.opened <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> job-hdr
      <span class="src-keyword">WHERE</span><!--src-keyword--> job-hdr.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> job-hdr.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no:
 
    <span class="src-keyword">IF</span><!--src-keyword--> job-hdr.i-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no                                   <span class="src-keyword">OR</span><!--src-keyword-->
       (job-hdr.job-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no  <span class="src-keyword">AND</span><!--src-keyword-->
        job-hdr.job-no2 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2 <span class="src-keyword">AND</span><!--src-keyword-->
        <span class="src-keyword">NOT CAN-FIND</span><!--src-keyword-->(<span class="src-keyword">FIRST</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->
                     <span class="src-keyword">WHERE</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
                       <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
                       <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
                       <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
                       <span class="src-keyword">AND ROWID</span><!--src-keyword-->(b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)  <span class="src-keyword">NE ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->))) <span class="src-keyword">THEN</span><!--src-keyword-->
      job-hdr.due-date = oe-ordl.req-date.
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no) <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-keyword">FOR EACH</span><!--src-keyword--> eb <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
    <span class="src-keyword">WHERE</span><!--src-keyword--> eb.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company 
      <span class="src-keyword">AND</span><!--src-keyword--> eb.est-no   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
      <span class="src-keyword">AND</span><!--src-keyword--> eb.stock-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no:
 
  <span class="src-keyword">IF TRIM</span><!--src-keyword-->(eb.die-no) <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> prep <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
      <span class="src-keyword">WHERE</span><!--src-keyword--> prep.company    <span class="src-keyword">EQ</span><!--src-keyword--> eb.company
        <span class="src-keyword">AND</span><!--src-keyword--> prep.<span class="src-keyword">code       EQ</span><!--src-keyword--> eb.die-no
        <span class="src-keyword">AND</span><!--src-keyword--> prep.last-order <span class="src-keyword">LT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no:
    <span class="src-keyword">FIND</span><!--src-keyword--> b-prep <span class="src-keyword">WHERE ROWID</span><!--src-keyword-->(b-prep) <span class="src-keyword">EQ ROWID</span><!--src-keyword-->(prep) <span class="src-keyword">EXCLUSIVE NO-ERROR NO-WAIT</span><!--src-keyword-->.
    <span class="src-comment">/* gdm - 06170905 */</span><!--src-comment-->
    <span class="src-keyword">IF AVAIL</span><!--src-keyword--> b-prep <span class="src-keyword">THEN DO</span><!--src-keyword-->:      
 
      <span class="src-keyword">ASSIGN</span><!--src-keyword--> b-prep.last-order = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
      .
      <span class="src-keyword">RELEASE</span><!--src-keyword--> b-prep.
    <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* if avail b-prep */</span><!--src-comment-->
    <span class="src-comment">/* gdm - 06170905 end. */</span><!--src-comment-->
 
  <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* for each prep */</span><!--src-comment-->
 
  <span class="src-keyword">IF TRIM</span><!--src-keyword-->(eb.plate-no) <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> prep <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
      <span class="src-keyword">WHERE</span><!--src-keyword--> prep.company    <span class="src-keyword">EQ</span><!--src-keyword--> eb.company
        <span class="src-keyword">AND</span><!--src-keyword--> prep.<span class="src-keyword">code       EQ</span><!--src-keyword--> eb.plate-no
        <span class="src-keyword">AND</span><!--src-keyword--> prep.last-order <span class="src-keyword">LT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no:
    <span class="src-keyword">FIND</span><!--src-keyword--> b-prep <span class="src-keyword">WHERE ROWID</span><!--src-keyword-->(b-prep) <span class="src-keyword">EQ ROWID</span><!--src-keyword-->(prep) <span class="src-keyword">EXCLUSIVE NO-ERROR NO-WAIT</span><!--src-keyword-->.
    <span class="src-comment">/* gdm - 06170905 */</span><!--src-comment-->
    <span class="src-keyword">IF AVAIL</span><!--src-keyword--> b-prep <span class="src-keyword">THEN DO</span><!--src-keyword-->:   
      <span class="src-keyword">ASSIGN</span><!--src-keyword--> b-prep.last-order = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
             b-prep.last-job-no    = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
             b-prep.last-job-no2   = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
             . 
      <span class="src-keyword">RELEASE</span><!--src-keyword--> b-prep.
    <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* if avail b-prep */</span><!--src-comment-->
    <span class="src-comment">/* gdm - 06170905 end. */</span><!--src-comment-->
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">LEAVE</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-ord
    <span class="src-keyword">WHERE</span><!--src-keyword--> oe-ord.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> oe-ord.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no:
 
  <span class="src-keyword">IF</span><!--src-keyword--> oeuserid-log                        <span class="src-keyword">AND</span><!--src-keyword-->
     oe-ord.<span class="src-keyword">user-id NE USERID</span><!--src-keyword-->(<span class="src-char">"nosweat"</span><!--src-char-->) <span class="src-keyword">THEN</span><!--src-keyword-->
     oe-ord.<span class="src-keyword">user-id</span><!--src-keyword--> = <span class="src-keyword">USERID</span><!--src-keyword-->(<span class="src-char">"nosweat"</span><!--src-char-->).
 
  <span class="src-keyword">LEAVE</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-comment">/* Clear out any error-status from find with no-error that is false */</span><!--src-comment-->
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll-error <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
ll-error = <span class="src-keyword">YES NO-ERROR</span><!--src-keyword-->.
</div><!--progresscode-->
</body>
</html>
