<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: write of ar-invl</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: write of ar-invl</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">UPDATE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME ar-invl
 
<span class="src-keyword">TRIGGER PROCEDURE FOR WRITE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">OLD BUFFER</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">write</span><!--src-keyword-->.i}</span><!--src-prep-->
 
 
 
<span class="src-prep">{custom/globdefs.i}</span><!--src-prep-->
 
<span class="src-prep">{sys/inc/<span class="src-keyword">var</span><!--src-keyword-->.i <span class="src-keyword">NEW</span><!--src-keyword--> SHARED}</span><!--src-p<span class="src-keyword">SHARED</span><!--src-keyword-->
 
<span class="src-keyword">DEF VAR</span><!--src-keyword--> li <span class="src-keyword">AS INT NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ld <span class="src-keyword">AS DEC NO-UNDO</span><!--src-keyword-->.
 
<span class="src-keyword">DEF TEMP-TABLE</span><!--src-keyword--> w-sman <span class="src-keyword">FIELD</span><!--src-keyword--> w-man <span class="src-keyword">AS CHAR</span><!--src-keyword-->
                      <span class="src-keyword">FIELD</span><!--src-keyword--> w-pct <span class="src-keyword">AS DEC</span><!--src-keyword-->
                      <span class="src-keyword">FIELD</span><!--src-keyword--> w-com <span class="src-keyword">AS DEC</span><!--src-keyword-->
                      <span class="src-keyword">FIELD</span><!--src-keyword--> w-bas <span class="src-keyword">AS CHAR</span><!--src-keyword-->.
 
 
<span class="src-keyword">ASSIGN</span><!--src-keyword-->
 cocode = g_company
 locode = g_loc.
 
<span class="src-prep">{sys/inc/notes.i}</span><!--src-prep-->
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> ar-inv <span class="src-keyword">WHERE</span><!--src-keyword--> ar-inv.x-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.x-no <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
  <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-no = ar-inv.cust-no.
  <span class="src-keyword">LEAVE</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.amt         <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.amt         = <span class="src-number">0</span><!--src-number-->.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cost        <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cost        = <span class="src-number">0</span><!--src-number-->.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-cost      <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-cost      = <span class="src-number">0</span><!--src-number-->.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-freight   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-freight   = <span class="src-number">0</span><!--src-number-->.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-freight-p <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-freight-p = <span class="src-number">0</span><!--src-number-->.
 
<span class="src-keyword">DO</span><!--src-keyword--> li = <span class="src-number">1</span><!--src-number--> <span class="src-keyword">TO EXTENT</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sman):
  <span class="src-keyword">FIND FIRST</span><!--src-keyword--> w-sman <span class="src-keyword">WHERE</span><!--src-keyword--> w-man <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sman[li] <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
 
  <span class="src-keyword">IF NOT AVAIL</span><!--src-keyword--> w-sman <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-keyword">CREATE</span><!--src-keyword--> w-sman.
    w-man = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sman[li].
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  w-pct = w-pct + <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-pct[li].
 
  <span class="src-keyword">IF</span><!--src-keyword--> w-com <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->  <span class="src-keyword">THEN</span><!--src-keyword--> w-com = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-comm[li].
  <span class="src-keyword">IF</span><!--src-keyword--> w-bas <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword--> w-bas = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-commbasis[li].
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-comment">/*FOR EACH w-sman:
  IF w-man EQ "" THEN DELETE w-sman.
  ELSE ld = ld + w-pct.
END.
 
IF ld GT 0 AND ld NE 100 THEN DO:
  FOR EACH w-sman:
    w-pct = ROUND(w-pct * 100 / ld,2).
  END.
 
  ld = 0.
  FOR EACH w-sman:
    ld = ld + w-pct.
  END.
 
  IF ld NE 100 THEN
  FOR EACH w-sman:
    w-pct = w-pct + (100 - ld).
    LEAVE.
  END.
END.*/</span><!--src-comment-->
 
<span class="src-keyword">ASSIGN</span><!--src-keyword-->
 <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sman        = <span class="src-char">""</span><!--src-char-->
 <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-pct       = <span class="src-number">0</span><!--src-number-->
 <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-comm      = <span class="src-number">0</span><!--src-number-->
 <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-commbasis = <span class="src-char">""</span><!--src-char-->.
 
li = <span class="src-number">0</span><!--src-number-->.
<span class="src-keyword">FOR EACH</span><!--src-keyword--> w-sman:
  li = li + <span class="src-number">1</span><!--src-number-->.
  <span class="src-keyword">IF</span><!--src-keyword--> li <span class="src-keyword">GT EXTENT</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sman) <span class="src-keyword">THEN LEAVE</span><!--src-keyword-->.
  <span class="src-keyword">ASSIGN</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sman[li]        = w-man
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-pct[li]       = w-pct
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-comm[li]      = w-com
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-commbasis[li] = w-bas.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FIND FIRST</span><!--src-keyword--> itemfg
    <span class="src-keyword">WHERE</span><!--src-keyword--> itemfg.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> itemfg.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
    <span class="src-keyword">NO-LOCK NO-ERROR</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->                               <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">"0"</span><!--src-char-->                              <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.inv-qty <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                             <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.pr-uom <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->                             <span class="src-keyword">AND</span><!--src-keyword-->
   old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">"0"</span><!--src-char-->                          <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-keyword">AVAIL</span><!--src-keyword--> itemfg                                          <span class="src-keyword">AND</span><!--src-keyword-->
   (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.inv-qty <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.inv-qty <span class="src-keyword">OR</span><!--src-keyword-->
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.unit-pr <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.unit-pr <span class="src-keyword">OR</span><!--src-keyword-->
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.pr-uom  <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.pr-uom)     <span class="src-keyword">THEN</span><!--src-keyword-->
 
  <span class="src-keyword">RUN</span><!--src-keyword--> fg/makenote.p (<span class="src-keyword">BUFFER</span><!--src-keyword--> oe-ordl,
                     <span class="src-keyword">BUFFER</span><!--src-keyword--> quoteqty,
                     <span class="src-keyword">BUFFER</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->,
                     <span class="src-keyword">NO</span><!--src-keyword-->,
                     itemfg.rec_key).
 
<span class="src-keyword">RUN</span><!--src-keyword--> oe/rel-stat-upd.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)).
 
<span class="src-comment">/* Clear out any error-status from find with no-error that is false */</span><!--src-comment-->
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll-error <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
ll-error = <span class="src-keyword">YES NO-ERROR</span><!--src-keyword-->.
 
 
 
</div><!--progresscode-->
</body>
</html>
