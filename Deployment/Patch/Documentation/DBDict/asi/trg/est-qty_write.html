<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: write of est-qty</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: write of est-qty</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">UPDATE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME est-qty
 
<span class="src-keyword">TRIGGER PROCEDURE FOR WRITE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">OLD BUFFER</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">FOR</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-comment">/*DEF TEMP-TABLE tt-qty FIELD tt-qty AS INT INDEX tt-qty tt-qty.
 
DEF VAR li AS INT NO-UNDO.*/</span><!--src-comment-->
 
<span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">write</span><!--src-keyword-->.i}</span><!--src-prep-->
 
 
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> est.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> est-op.
 
<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no = <span class="src-keyword">FILL</span><!--src-keyword-->(<span class="src-char">" "</span><!--src-char-->,<span class="src-number">8</span><!--src-number--> <span class="src-keyword">- LENGTH</span><!--src-keyword-->(<span class="src-keyword">TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no))) +
                      <span class="src-keyword">TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no).
 
<span class="src-keyword">FIND FIRST</span><!--src-keyword--> est
    <span class="src-keyword">WHERE</span><!--src-keyword--> est.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> est.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
    <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
 
<span class="src-keyword">IF AVAIL</span><!--src-keyword--> est <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-keyword">IF</span><!--src-keyword--> est.est-type <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">1</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->
      <span class="src-keyword">WHERE</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company <span class="src-keyword">EQ</span><!--src-keyword--> est.company
        <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> est.est-no
        <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.eqty    <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->
        <span class="src-keyword">AND ROWID</span><!--src-keyword-->(b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)  <span class="src-keyword">NE ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)
      <span class="src-keyword">BREAK BY</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.eqty
            <span class="src-keyword">BY</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rec_key:
    <span class="src-keyword">IF NOT FIRST-OF</span><!--src-keyword-->(b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.eqty) <span class="src-keyword">THEN DELETE</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">ASSIGN</span><!--src-keyword-->
   est.updated-date = <span class="src-keyword">TODAY</span><!--src-keyword-->
   est.updated-id   = <span class="src-keyword">USERID</span><!--src-keyword-->(<span class="src-char">"nosweat"</span><!--src-char-->)
   est.mod-date     = est.updated-date.
 
  <span class="src-keyword">IF</span><!--src-keyword--> (est.est-type <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">1</span><!--src-number--> <span class="src-keyword">OR</span><!--src-keyword--> est.est-type <span class="src-keyword">GE</span><!--src-keyword--> <span class="src-number">5</span><!--src-number-->)                   <span class="src-keyword">AND</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.eqty <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.eqty                 <span class="src-keyword">AND</span><!--src-keyword-->
     old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.eqty <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                                 <span class="src-keyword">AND</span><!--src-keyword-->
     <span class="src-keyword">NOT CAN-FIND</span><!--src-keyword-->(<span class="src-keyword">FIRST</span><!--src-keyword--> est-op
                  <span class="src-keyword">WHERE</span><!--src-keyword--> est-op.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
                    <span class="src-keyword">AND</span><!--src-keyword--> est-op.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
                    <span class="src-keyword">AND</span><!--src-keyword--> est-op.qty     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.eqty)    <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> est-op
      <span class="src-keyword">WHERE</span><!--src-keyword--> est-op.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> est-op.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
        <span class="src-keyword">AND</span><!--src-keyword--> est-op.qty     <span class="src-keyword">EQ</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.eqty:
    est-op.qty = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.eqty.
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-comment">/*
IF AVAIL est AND est.est-type GE 5 AND est.est-type LE 6 THEN DO:
  DO li = 1 TO EXTENT({&amp;TABLENAME}.qty):
    IF {&amp;TABLENAME}.qty[li] GT 0 THEN DO:
      CREATE tt-qty.
      tt-qty = {&amp;TABLENAME}.qty[li].
    END.
  END.
 
  ASSIGN
   {&amp;TABLENAME}.qty = 0
   li               = 0.
 
  FOR EACH tt-qty WHERE tt-qty GT 0 BREAK BY tt-qty:
    IF FIRST-OF(tt-qty) THEN DO:
      li = li + 1.
      IF li LE EXTENT({&amp;TABLENAME}.qty) THEN {&amp;TABLENAME}.qty[li] = tt-qty.
    END.
  END.
 
  ASSIGN
   {&amp;TABLENAME}.eqty = {&amp;TABLENAME}.qty[1]
   est.est-qty[1]    = {&amp;TABLENAME}.qty[1]
   est.est-qty[2]    = {&amp;TABLENAME}.qty[2]
   est.est-qty[3]    = {&amp;TABLENAME}.qty[3]
   est.est-qty[4]    = {&amp;TABLENAME}.qty[4].
 
  FOR EACH eb
      WHERE eb.company EQ {&amp;TABLENAME}.company
        AND eb.est-no  EQ {&amp;TABLENAME}.est-no
        AND eb.eqty    NE {&amp;TABLENAME}.eqty:
    eb.eqty = {&amp;TABLENAME}.eqty.
  END.
 
  FOR EACH ef
      WHERE ef.company EQ {&amp;TABLENAME}.company
        AND ef.est-no  EQ {&amp;TABLENAME}.est-no
        AND ef.eqty    NE {&amp;TABLENAME}.eqty:
    ef.eqty = {&amp;TABLENAME}.eqty.
  END.
END.
*/</span><!--src-comment-->
 
<span class="src-comment">/* Clear out any error-status from find with no-error that is false */</span><!--src-comment-->
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll-error <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
ll-error = <span class="src-keyword">YES NO-ERROR</span><!--src-keyword-->.
</div><!--progresscode-->
</body>
</html>
