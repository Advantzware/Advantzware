<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: delete of probe</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: delete of probe</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">DELETE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME probe
 
<span class="src-keyword">TRIGGER PROCEDURE FOR DELETE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">FOR</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-keyword">DEF VAR</span><!--src-keyword--> li <span class="src-keyword">AS INT NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> tmp-dir <span class="src-keyword">AS CHAR NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> viDirCount <span class="src-keyword">AS INT NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> v-probe-fmt <span class="src-keyword">AS CHAR NO-UNDO</span><!--src-keyword-->.
 
<span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">delete</span><!--src-keyword-->.i}</span><!--src-prep-->
 
<span class="src-keyword">find first</span><!--src-keyword--> sys-ctrl <span class="src-keyword">where</span><!--src-keyword-->
    sys-ctrl.company <span class="src-keyword">eq</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company <span class="src-keyword">AND</span><!--src-keyword-->
    sys-ctrl.<span class="src-keyword">name    eq</span><!--src-keyword--> <span class="src-char">"CEBROWSE"</span><!--src-char-->
    <span class="src-keyword">no-lock no-error</span><!--src-keyword-->.
 
  <span class="src-keyword">if not avail</span><!--src-keyword--> sys-ctrl <span class="src-keyword">then DO TRANSACTION</span><!--src-keyword-->:
        <span class="src-keyword">create</span><!--src-keyword--> sys-ctrl.
        <span class="src-keyword">assign</span><!--src-keyword--> sys-ctrl.company = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
               sys-ctrl.<span class="src-keyword">name</span><!--src-keyword-->    = <span class="src-char">"CEBROWSE"</span><!--src-char-->
               sys-ctrl.descrip = <span class="src-char">"# of Records to be displayed in browser"</span><!--src-char-->
               sys-ctrl.log-fld = <span class="src-keyword">YES</span><!--src-keyword-->
               sys-ctrl.char-fld = <span class="src-char">"CE"</span><!--src-char-->
               sys-ctrl.int-fld = <span class="src-number">30</span><!--src-number-->.
 
  <span class="src-keyword">end</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> sys-ctrl.char-fld <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
   tmp-dir = sys-ctrl.char-fld.
<span class="src-keyword">ELSE</span><!--src-keyword-->
   tmp-dir = <span class="src-char">"users\"</span><!--src-char-->.
 
<span class="src-keyword">IF LOOKUP</span><!--src-keyword-->(<span class="src-keyword">SUBSTRING</span><!--src-keyword-->(tmp-dir,<span class="src-keyword">LENGTH</span><!--src-keyword-->(tmp-dir)),<span class="src-char">"\,/"</span><!--src-char-->) <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
   tmp-dir = tmp-dir + <span class="src-char">"\"</span><!--src-char-->.
 
tmp-dir = <span class="src-keyword">REPLACE</span><!--src-keyword-->(tmp-dir,<span class="src-char">"/"</span><!--src-char-->,<span class="src-char">"\"</span><!--src-char-->).
 
<span class="src-keyword">DO</span><!--src-keyword--> viDirCount = <span class="src-number">1</span><!--src-number--> <span class="src-keyword">TO</span><!--src-keyword--> <span class="src-number">3</span><!--src-number-->:
 
   <span class="src-keyword">IF</span><!--src-keyword--> viDirCount <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">2</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> tmp-dir = <span class="src-char">"users\"</span><!--src-char-->.
   <span class="src-keyword">ELSE IF</span><!--src-keyword--> viDirCount <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">3</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> tmp-dir = <span class="src-char">".\"</span><!--src-char-->.
 
   v-probe-fmt = <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">LINE LT</span><!--src-keyword--> <span class="src-number">100</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-char">"99"</span><!--src-char--> <span class="src-keyword">ELSE</span><!--src-keyword--> <span class="src-char">"999"</span><!--src-char-->.
 
   <span class="src-keyword">IF OPSYS EQ</span><!--src-keyword--> <span class="src-char">"unix"</span><!--src-char--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
      <span class="src-keyword">UNIX SILENT</span><!--src-keyword--> rm <span class="src-keyword">VALUE</span><!--src-keyword-->(tmp-dir + <span class="src-keyword">TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no) + <span class="src-char">"-*.*"</span><!--src-char--> + <span class="src-keyword">STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">LINE</span><!--src-keyword-->,v-probe-fmt)).
      <span class="src-keyword">UNIX SILENT</span><!--src-keyword--> rm <span class="src-keyword">VALUE</span><!--src-keyword-->(tmp-dir + <span class="src-keyword">TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no) +   <span class="src-char">".*"</span><!--src-char--> + <span class="src-keyword">STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">LINE</span><!--src-keyword-->,v-probe-fmt)).
   <span class="src-keyword">END</span><!--src-keyword-->.
   <span class="src-keyword">ELSE DO</span><!--src-keyword-->:
       <span class="src-keyword">if search</span><!--src-keyword-->((tmp-dir + <span class="src-keyword">TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no) + <span class="src-char">"-*.*"</span><!--src-char--> + <span class="src-keyword">STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">LINE</span><!--src-keyword-->,v-probe-fmt))) <span class="src-keyword">&lt;&gt;</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">then</span><!--src-keyword-->   
         <span class="src-keyword">DOS SILENT</span><!--src-keyword--> DEL <span class="src-keyword">VALUE</span><!--src-keyword-->(tmp-dir + <span class="src-keyword">TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no) + <span class="src-char">"-*.*"</span><!--src-char--> + <span class="src-keyword">STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">LINE</span><!--src-keyword-->,v-probe-fmt)).
     <span class="src-keyword">if search</span><!--src-keyword-->((tmp-dir + <span class="src-keyword">TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no) +   <span class="src-char">".*"</span><!--src-char--> + <span class="src-keyword">STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">LINE</span><!--src-keyword-->,v-probe-fmt))) <span class="src-keyword">&lt;&gt;</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">then</span><!--src-keyword-->   
        <span class="src-keyword">DOS SILENT</span><!--src-keyword--> DEL <span class="src-keyword">VALUE</span><!--src-keyword-->(tmp-dir + <span class="src-keyword">TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no) +   <span class="src-char">".*"</span><!--src-char--> + <span class="src-keyword">STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">LINE</span><!--src-keyword-->,v-probe-fmt)).
   <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> probeit
    <span class="src-keyword">WHERE</span><!--src-keyword--> probeit.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> probeit.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
      <span class="src-keyword">AND</span><!--src-keyword--> probeit.<span class="src-keyword">line    EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->
    <span class="src-keyword">USE-INDEX</span><!--src-keyword--> est-no:
  <span class="src-keyword">DELETE</span><!--src-keyword--> probeit.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> est-summ
    <span class="src-keyword">WHERE</span><!--src-keyword--> est-summ.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> est-summ.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
      <span class="src-keyword">AND</span><!--src-keyword--> est-summ.e-num   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->
    <span class="src-keyword">USE-INDEX</span><!--src-keyword--> est-qty:
  <span class="src-keyword">DELETE</span><!--src-keyword--> est-summ.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> reftable <span class="src-prep">{est/probreft.i reftable <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->}:
  <span class="src-keyword">DELETE</span><!--src-keyword--> reftable.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> reftable
    <span class="src-keyword">WHERE</span><!--src-keyword--> reftable.reftable <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"probe-ref"</span><!--src-char-->
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.loc      <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.<span class="src-keyword">code     EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.code2    <span class="src-keyword">EQ STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->,<span class="src-char">"9999999999"</span><!--src-char-->):
  <span class="src-keyword">DELETE</span><!--src-keyword--> reftable.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> estCostHeader
    <span class="src-keyword">WHERE</span><!--src-keyword--> estCostHeader.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
    <span class="src-keyword">AND</span><!--src-keyword--> estCostHeader.estimateNo <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
    <span class="src-keyword">AND</span><!--src-keyword--> estCostHeader.estCostHeaderID <span class="src-keyword">EQ INT64</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.spare-char-2):
    <span class="src-keyword">DELETE</span><!--src-keyword--> estCostHeader.    
<span class="src-keyword">END</span><!--src-keyword-->.
 
 
</div><!--progresscode-->
</body>
</html>
