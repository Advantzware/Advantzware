<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: delete of job</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: delete of job</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">DELETE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME job
 
<span class="src-keyword">TRIGGER PROCEDURE FOR DELETE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
<span class="src-comment">/* not delete if estimate exists */</span><!--src-comment-->
<span class="src-keyword">FIND</span><!--src-keyword--> est <span class="src-keyword">WHERE</span><!--src-keyword--> est.rec_key = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rec_key <span class="src-keyword">NO-LOCK NO-ERROR</span><!--src-keyword-->.
<span class="src-keyword">IF NOT AVAIL</span><!--src-keyword--> est <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">delete</span><!--src-keyword-->.i}</span><!--src-prep-->
<span class="src-keyword">END</span><!--src-keyword-->.
 
 
 
<span class="src-prep">{sys/inc/<span class="src-keyword">var</span><!--src-keyword-->.i <span class="src-keyword">NEW</span><!--src-keyword--> SHARED}</span><!--src-p<span class="src-keyword">SHARED</span><!--src-keyword-->
<span class="src-keyword">ASSIGN</span><!--src-keyword-->
 cocode = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
 locode = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.loc.
 
<span class="src-comment">/* moved to jc/v-{&amp;TABLENAME}.w 
DEF VAR lv-msg AS CHAR NO-UNDO.
 
 
lv-msg = "".
 
IF {&amp;TABLENAME}.stat EQ "A" THEN
  lv-msg = "This job has material allocated".
 
ELSE
IF {&amp;TABLENAME}.stat EQ "W" then
  lv-msg = "This job has work-in-process".
 
ELSE
IF INDEX("CXZ", {&amp;TABLENAME}.stat) GT 0 THEN
  lv-msg = "This job has been closed".
 
ELSE DO:
  FIND FIRST oe-ordl
      WHERE oe-ordl.company EQ {&amp;TABLENAME}.company
        AND oe-ordl.job-no  EQ {&amp;TABLENAME}.job-no
        AND oe-ordl.job-no2 EQ {&amp;TABLENAME}.job-no2
      NO-LOCK NO-ERROR.
  IF AVAIL oe-ordl THEN lv-msg = "An order exists with this Job#".
END.
 
IF lv-msg NE "" THEN DO:
  MESSAGE lv-msg + ", cannot delete..."
          VIEW-AS ALERT-BOX ERROR.
  RETURN ERROR.
END.
*/</span><!--src-comment-->
<span class="src-prep">{jc/jc-dall.i}</span><!--src-prep-->
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> job-hdr
    <span class="src-keyword">WHERE</span><!--src-keyword--> job-hdr.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> job-hdr.job     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job
      <span class="src-keyword">AND</span><!--src-keyword--> job-hdr.job-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
      <span class="src-keyword">AND</span><!--src-keyword--> job-hdr.job-no2 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
    <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->:            
  <span class="src-prep">{util/dljobkey.i}</span><!--src-prep-->
 
  <span class="src-keyword">DELETE</span><!--src-keyword--> job-hdr.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> job-mch
    <span class="src-keyword">WHERE</span><!--src-keyword--> job-mch.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> job-mch.job     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job
      <span class="src-keyword">AND</span><!--src-keyword--> job-mch.job-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
      <span class="src-keyword">AND</span><!--src-keyword--> job-mch.job-no2 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
    <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->:
  <span class="src-keyword">DELETE</span><!--src-keyword--> job-mch.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> job-mat
    <span class="src-keyword">WHERE</span><!--src-keyword--> job-mat.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> job-mat.job     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job
      <span class="src-keyword">AND</span><!--src-keyword--> job-mat.job-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
      <span class="src-keyword">AND</span><!--src-keyword--> job-mat.job-no2 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
    <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->:
  <span class="src-keyword">DELETE</span><!--src-keyword--> job-mat.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> job-prep
    <span class="src-keyword">WHERE</span><!--src-keyword--> job-prep.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> job-prep.job     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job
      <span class="src-keyword">AND</span><!--src-keyword--> job-prep.job-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
      <span class="src-keyword">AND</span><!--src-keyword--> job-prep.job-no2 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
    <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->:
  <span class="src-keyword">DELETE</span><!--src-keyword--> job-prep.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> job-farm-rctd 
    <span class="src-keyword">WHERE</span><!--src-keyword--> job-farm-rctd.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company      
      <span class="src-keyword">AND</span><!--src-keyword--> job-farm-rctd.job-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
      <span class="src-keyword">AND</span><!--src-keyword--> job-farm-rctd.job-no2 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
    <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->:
  <span class="src-keyword">DELETE</span><!--src-keyword--> job-farm-rctd.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> job-farm
      <span class="src-keyword">WHERE</span><!--src-keyword--> job-farm.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company      
      <span class="src-keyword">AND</span><!--src-keyword--> job-farm.job-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
      <span class="src-keyword">AND</span><!--src-keyword--> job-farm.job-no2 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
    <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->:
 
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> reftable
    <span class="src-keyword">WHERE</span><!--src-keyword--> reftable.reftable <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"jc/jc-calc.p"</span><!--src-char-->
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.loc      <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.<span class="src-keyword">code     EQ STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job,<span class="src-char">"999999999"</span><!--src-char-->)
    <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->:
  <span class="src-keyword">DELETE</span><!--src-keyword--> reftable.
<span class="src-keyword">END</span><!--src-keyword-->.
 
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> reftable
    <span class="src-keyword">WHERE</span><!--src-keyword--> reftable.reftable <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"job.create-time"</span><!--src-char-->
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.loc      <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.<span class="src-keyword">code     EQ STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job,<span class="src-char">"9999999999"</span><!--src-char-->)
    <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->:
  <span class="src-keyword">DELETE</span><!--src-keyword--> reftable.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> reftable
    <span class="src-keyword">WHERE</span><!--src-keyword--> reftable.reftable <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"job.qty-changed"</span><!--src-char-->
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.loc      <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->
      <span class="src-keyword">AND</span><!--src-keyword--> reftable.<span class="src-keyword">code     EQ STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job,<span class="src-char">"9999999999"</span><!--src-char-->)
    <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->:
  <span class="src-keyword">DELETE</span><!--src-keyword--> reftable.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.exported <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.stat = <span class="src-char">"X"</span><!--src-char-->.
  <span class="src-prep">{jc/kiwiexp4.i}</span><!--src-prep-->
<span class="src-keyword">END</span><!--src-keyword-->.
</div><!--progresscode-->
</body>
</html>
