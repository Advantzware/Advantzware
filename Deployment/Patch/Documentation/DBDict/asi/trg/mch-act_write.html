<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: write of mch-act</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: write of mch-act</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">UPDATE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME mch-act
 
<span class="src-keyword">TRIGGER PROCEDURE FOR WRITE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">OLD BUFFER</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">write</span><!--src-keyword-->.i}</span><!--src-prep-->
 
<span class="src-keyword">DEF VAR</span><!--src-keyword--> li <span class="src-keyword">AS INT NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
 
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty = <span class="src-number">0</span><!--src-number-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.dept <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->    <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.m-code <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->  <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-keyword">FIND FIRST</span><!--src-keyword--> mach <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
      <span class="src-keyword">WHERE</span><!--src-keyword--> mach.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> mach.m-code  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.m-code
      <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
  <span class="src-keyword">IF AVAIL</span><!--src-keyword--> mach <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-keyword">DO</span><!--src-keyword--> li = <span class="src-number">1</span><!--src-number--> <span class="src-keyword">TO EXTENT</span><!--src-keyword-->(mach.dept):
      <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.dept <span class="src-keyword">EQ</span><!--src-keyword--> mach.dept[li] <span class="src-keyword">THEN DO</span><!--src-keyword-->:
        ll = <span class="src-keyword">YES</span><!--src-keyword-->.
        <span class="src-keyword">LEAVE</span><!--src-keyword-->.
      <span class="src-keyword">END</span><!--src-keyword-->.
    <span class="src-keyword">END</span><!--src-keyword-->.
    <span class="src-keyword">IF NOT</span><!--src-keyword--> ll <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.dept <span class="src-keyword">EQ</span><!--src-keyword--> mach.dept[1].
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-keyword">FOR EACH</span><!--src-keyword--> job-code <span class="src-keyword">WHERE</span><!--src-keyword--> job-code.<span class="src-keyword">code EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">code NO-LOCK</span><!--src-keyword-->,
    <span class="src-keyword">EACH</span><!--src-keyword--> job-mch
    <span class="src-keyword">WHERE</span><!--src-keyword--> job-mch.company   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> job-mch.job       <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job
      <span class="src-keyword">AND</span><!--src-keyword--> job-mch.job-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
      <span class="src-keyword">AND</span><!--src-keyword--> job-mch.job-no2   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
      <span class="src-keyword">AND</span><!--src-keyword--> job-mch.m-code    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.m-code
      <span class="src-keyword">AND</span><!--src-keyword--> job-mch.frm       <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.frm
      <span class="src-keyword">AND</span><!--src-keyword--> job-mch.blank-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.blank-no
      <span class="src-keyword">AND</span><!--src-keyword--> job-mch.pass      <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.pass:
 
  <span class="src-keyword">IF</span><!--src-keyword--> (job-code.cat <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"RUN"</span><!--src-char--> <span class="src-keyword">OR</span><!--src-keyword--> job-code.cat <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"DT"</span><!--src-char-->) <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date <span class="src-keyword">LT</span><!--src-keyword--> job-mch.start-date <span class="src-keyword">OR</span><!--src-keyword-->
       job-mch.start-date <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number-->                    <span class="src-keyword">THEN</span><!--src-keyword-->
      <span class="src-keyword">ASSIGN</span><!--src-keyword-->
       job-mch.start-date = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date
       job-mch.start-time = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">start</span><!--src-keyword-->.
 
    <span class="src-keyword">ELSE</span><!--src-keyword-->
    <span class="src-keyword">IF</span><!--src-keyword--> (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date <span class="src-keyword">EQ</span><!--src-keyword--> job-mch.start-date <span class="src-keyword">AND</span><!--src-keyword-->
        <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">start LT</span><!--src-keyword--> job-mch.start-time)      <span class="src-keyword">OR</span><!--src-keyword-->
       job-mch.start-time <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                         <span class="src-keyword">THEN</span><!--src-keyword-->
      job-mch.start-time = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">start</span><!--src-keyword-->.
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">complete THEN</span><!--src-keyword-->
      <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date <span class="src-keyword">GT</span><!--src-keyword--> job-mch.end-date <span class="src-keyword">OR</span><!--src-keyword-->
         job-mch.end-date <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number-->                    <span class="src-keyword">THEN</span><!--src-keyword-->
        <span class="src-keyword">ASSIGN</span><!--src-keyword-->
         job-mch.end-date = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date
         job-mch.end-time = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.stopp.
 
      <span class="src-keyword">ELSE</span><!--src-keyword-->
      <span class="src-keyword">IF</span><!--src-keyword--> (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date <span class="src-keyword">EQ</span><!--src-keyword--> job-mch.start-date <span class="src-keyword">AND</span><!--src-keyword-->
          <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.stopp <span class="src-keyword">GT</span><!--src-keyword--> job-mch.end-time)       <span class="src-keyword">OR</span><!--src-keyword-->
         job-mch.end-time <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                          <span class="src-keyword">THEN</span><!--src-keyword-->
        job-mch.end-time = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.stopp.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">IF</span><!--src-keyword--> job-code.cat <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"MR"</span><!--src-char--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date <span class="src-keyword">LT</span><!--src-keyword--> job-mch.start-date-su <span class="src-keyword">OR</span><!--src-keyword-->
       job-mch.start-date-su <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number-->                    <span class="src-keyword">THEN</span><!--src-keyword-->
      <span class="src-keyword">ASSIGN</span><!--src-keyword-->
       job-mch.start-date-su = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date
       job-mch.start-time-su = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">start</span><!--src-keyword-->.
 
    <span class="src-keyword">ELSE</span><!--src-keyword-->
    <span class="src-keyword">IF</span><!--src-keyword--> (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date <span class="src-keyword">EQ</span><!--src-keyword--> job-mch.start-date-su <span class="src-keyword">AND</span><!--src-keyword-->
        <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">start LT</span><!--src-keyword--> job-mch.start-time-su)      <span class="src-keyword">OR</span><!--src-keyword-->
       job-mch.start-time-su <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                         <span class="src-keyword">THEN</span><!--src-keyword-->
      job-mch.start-time-su = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">start</span><!--src-keyword-->.
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">complete THEN</span><!--src-keyword-->
      <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date <span class="src-keyword">GT</span><!--src-keyword--> job-mch.end-date-su <span class="src-keyword">OR</span><!--src-keyword-->
         job-mch.end-date-su <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number-->                    <span class="src-keyword">THEN</span><!--src-keyword-->
        <span class="src-keyword">ASSIGN</span><!--src-keyword-->
         job-mch.end-date-su = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date
         job-mch.end-time-su = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.stopp.
 
      <span class="src-keyword">ELSE</span><!--src-keyword-->
      <span class="src-keyword">IF</span><!--src-keyword--> (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-date <span class="src-keyword">EQ</span><!--src-keyword--> job-mch.start-date-su <span class="src-keyword">AND</span><!--src-keyword-->
          <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.stopp <span class="src-keyword">GT</span><!--src-keyword--> job-mch.end-time-su)        <span class="src-keyword">OR</span><!--src-keyword-->
         job-mch.end-time-su <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                           <span class="src-keyword">THEN</span><!--src-keyword-->
        job-mch.end-time-su = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.stopp.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  job-mch.anchored = <span class="src-keyword">YES</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
</div><!--progresscode-->
</body>
</html>
