<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: write of oe-prmtx</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: write of oe-prmtx</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">UPDATE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME oe-prmtx
 
<span class="src-keyword">TRIGGER PROCEDURE FOR WRITE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">OLD BUFFER</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">write</span><!--src-keyword-->.i}</span><!--src-prep-->
 
<span class="src-keyword">DEF VAR</span><!--src-keyword--> li <span class="src-keyword">AS INT NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ldt <span class="src-keyword">AS DATE NO-UNDO</span><!--src-keyword-->.
 
<span class="src-keyword">DEF TEMP-TABLE</span><!--src-keyword--> w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">FIELD</span><!--src-keyword--> qty      <span class="src-keyword">AS DEC</span><!--src-keyword-->
                              <span class="src-keyword">FIELD</span><!--src-keyword--> uom      <span class="src-keyword">AS CHAR</span><!--src-keyword-->
                              <span class="src-keyword">FIELD</span><!--src-keyword--> price    <span class="src-keyword">AS DEC</span><!--src-keyword-->
                              <span class="src-keyword">FIELD</span><!--src-keyword--> discount <span class="src-keyword">AS DEC</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rec_key <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
<span class="src-comment">/*     ldt = DATE(INT(SUBSTR({&amp;TABLENAME}.i-no,105,2)),           */</span><!--src-comment-->
<span class="src-comment">/*                INT(SUBSTR({&amp;TABLENAME}.i-no,107,2)),           */</span><!--src-comment-->
<span class="src-comment">/*                INT(SUBSTR({&amp;TABLENAME}.i-no,101,4))) NO-ERROR. */</span><!--src-comment-->
<span class="src-comment">/*     IF ERROR-STATUS:ERROR OR ldt EQ ? THEN ldt = 01/01/0001.   */</span><!--src-comment-->
<span class="src-comment">/*                                                                */</span><!--src-comment-->
<span class="src-comment">/*     FIND FIRST reftable                                        */</span><!--src-comment-->
<span class="src-comment">/*         WHERE reftable.rec_key  EQ {&amp;TABLENAME}.rec_key        */</span><!--src-comment-->
<span class="src-comment">/*           AND reftable.company  EQ "{&amp;TABLENAME}"              */</span><!--src-comment-->
<span class="src-comment">/*         USE-INDEX rec_key EXCLUSIVE-LOCK NO-ERROR.             */</span><!--src-comment-->
<span class="src-comment">/*                                                                */</span><!--src-comment-->
<span class="src-comment">/*     IF NOT AVAIL reftable THEN DO:                             */</span><!--src-comment-->
<span class="src-comment">/*       CREATE reftable.                                         */</span><!--src-comment-->
<span class="src-comment">/*       ASSIGN                                                   */</span><!--src-comment-->
<span class="src-comment">/*        reftable.rec_key  = {&amp;TABLENAME}.rec_key                */</span><!--src-comment-->
<span class="src-comment">/*        reftable.company  = "{&amp;TABLENAME}".                     */</span><!--src-comment-->
<span class="src-comment">/*     END.                                                       */</span><!--src-comment-->
<span class="src-comment">/*     reftable.code = STRING(ldt,"99/99/9999").                  */</span><!--src-comment-->
<span class="src-comment">/*                                                                */</span><!--src-comment-->
<span class="src-comment">/*     {&amp;TABLENAME}.i-no = STRING({&amp;TABLENAME}.i-no,"x(100)"). */</span><!--src-comment-->
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
      <span class="src-keyword">FIND FIRST</span><!--src-keyword--> itemfg <span class="src-keyword">WHERE</span><!--src-keyword-->
           itemfg.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company <span class="src-keyword">AND</span><!--src-keyword-->
           itemfg.i-no <span class="src-keyword">EQ STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no,<span class="src-char">"x(15)"</span><!--src-char-->)
           <span class="src-keyword">NO-LOCK NO-ERROR</span><!--src-keyword-->.
 
      <span class="src-keyword">IF AVAIL</span><!--src-keyword--> itemfg <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.procat = itemfg.procat.
    <span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-comment">/*     {&amp;TABLENAME}.i-no = STRING({&amp;TABLENAME}.i-no,"x(100)") + */</span><!--src-comment-->
<span class="src-comment">/*                         SUBSTR(reftable.code,7,4)          + */</span><!--src-comment-->
<span class="src-comment">/*                         SUBSTR(reftable.code,1,2)          + */</span><!--src-comment-->
<span class="src-comment">/*                         SUBSTR(reftable.code,4,2).           */</span><!--src-comment-->
<span class="src-comment">/*                                                              */</span><!--src-comment-->
<span class="src-comment">/*                                                              */</span><!--src-comment-->
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
     <span class="src-keyword">FOR EACH</span><!--src-keyword--> cust <span class="src-keyword">OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
         <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.custype = cust.<span class="src-keyword">type</span><!--src-keyword-->.
     <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">DO</span><!--src-keyword--> li = <span class="src-number">1</span><!--src-number--> <span class="src-keyword">TO EXTENT</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty):
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty[li] <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-keyword">CREATE</span><!--src-keyword--> w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
    <span class="src-keyword">ASSIGN</span><!--src-keyword-->
     w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty      = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty[li]
     w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.uom      = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.uom[li]
     w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.price    = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.price[li]
     w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.discount = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.discount[li].
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">ASSIGN</span><!--src-keyword-->
 <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty      = <span class="src-number">0</span><!--src-number-->
 <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.uom      = <span class="src-char">""</span><!--src-char-->
 <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.price    = <span class="src-number">0</span><!--src-number-->
 <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.discount = <span class="src-number">0</span><!--src-number-->
 li                    = <span class="src-number">0</span><!--src-number-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->
    <span class="src-keyword">WHERE</span><!--src-keyword--> w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty <span class="src-keyword">GT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->
    <span class="src-keyword">BREAK BY</span><!--src-keyword--> w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty: 
  li = li + <span class="src-number">1</span><!--src-number-->.
 
  <span class="src-keyword">IF</span><!--src-keyword--> li <span class="src-keyword">LE EXTENT</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty) <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-keyword">ASSIGN</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty[li]      = <span class="src-keyword">IF LAST</span><!--src-keyword-->(w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty) <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-number">99999999</span><!--src-number-->
                                 <span class="src-keyword">ELSE</span><!--src-keyword--> w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.uom[li]      = w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.uom
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.price[li]    = w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.price
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.discount[li] = w-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.discount.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-comment">/* Clear out any error-status from find with no-error that is false */</span><!--src-comment-->
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll-error <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
ll-error = <span class="src-keyword">YES NO-ERROR</span><!--src-keyword-->.
</div><!--progresscode-->
</body>
</html>
