<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: write of oe-boll</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: write of oe-boll</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">UPDATE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME oe-boll
 
<span class="src-keyword">TRIGGER PROCEDURE FOR WRITE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">OLD BUFFER</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">write</span><!--src-keyword-->.i}</span><!--src-prep-->
 
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-oe-ordl <span class="src-keyword">FOR</span><!--src-keyword--> oe-ordl.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">FOR</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-oe-rell <span class="src-keyword">FOR</span><!--src-keyword--> oe-rell.
 
<span class="src-keyword">DEF VAR</span><!--src-keyword--> li <span class="src-keyword">AS INT NO-UNDO</span><!--src-keyword-->.
 
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> oe-rel.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> oe-rell.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> oe-bolh.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> oe-ordl.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> b-oe-ordl.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> itemfg.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> reftable.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-keyword">IF TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-code) <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-code = <span class="src-char">"B"</span><!--src-char-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty-case <span class="src-keyword">LT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty-case = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty-case <span class="src-keyword">*</span><!--src-keyword--> <span class="src-number">-1</span><!--src-number-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty <span class="src-keyword">LT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">AND</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cases <span class="src-keyword">GT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cases = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cases <span class="src-keyword">*</span><!--src-keyword--> <span class="src-number">-1</span><!--src-number-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">ASSIGN</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cases   = <span class="src-number">0</span><!--src-number-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial = <span class="src-number">0</span><!--src-number-->.
 
<span class="src-keyword">ELSE DO</span><!--src-keyword-->:
  <span class="src-keyword">IF</span><!--src-keyword--> (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial <span class="src-keyword">GT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty <span class="src-keyword">AND</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial <span class="src-keyword">GT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->) <span class="src-keyword">OR</span><!--src-keyword-->
     (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial <span class="src-keyword">LT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">AND</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial <span class="src-keyword">LT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty) <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty.
 
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty-case <span class="src-keyword">GT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cases = <span class="src-keyword">TRUNC</span><!--src-keyword-->((<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty <span class="src-keyword">-</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial) / <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty-case,<span class="src-number">0</span><!--src-number-->).
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial <span class="src-keyword">LT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                     <span class="src-keyword">AND</span><!--src-keyword-->
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty <span class="src-keyword">GT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial <span class="src-keyword">*</span><!--src-keyword--> <span class="src-number">-1</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
      <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cases = <span class="src-keyword">TRUNC</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty / <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty-case,<span class="src-number">0</span><!--src-number-->).
 
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty <span class="src-keyword">-</span><!--src-keyword--> 
                           (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cases <span class="src-keyword">*</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty-case).
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty-case <span class="src-keyword">LE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                       <span class="src-keyword">OR</span><!--src-keyword-->
     (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty <span class="src-keyword">LT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty-case <span class="src-keyword">AND</span><!--src-keyword-->
      <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty <span class="src-keyword">GT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->)                          <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-keyword">ASSIGN</span><!--src-keyword-->
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty-case = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial  = <span class="src-number">0</span><!--src-number-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cases   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cases   = <span class="src-number">0</span><!--src-number-->.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial = <span class="src-number">0</span><!--src-number-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.p-c <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.p-c <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-keyword">FOR EACH</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->
    <span class="src-keyword">WHERE</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
      <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no 
      <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line     EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->
      <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rel-no   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rel-no
      <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.b-ord-no <span class="src-keyword">LE</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.b-ord-no
      <span class="src-keyword">AND ROWID</span><!--src-keyword-->(b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)   <span class="src-keyword">NE ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)
    <span class="src-keyword">USE-INDEX</span><!--src-keyword--> ord-no:
  b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.p-c = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.p-c.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-ord
    <span class="src-keyword">WHERE</span><!--src-keyword--> oe-ord.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> oe-ord.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
    <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
 
  <span class="src-keyword">FIND</span><!--src-keyword--> oe-ordl <span class="src-keyword">OF</span><!--src-keyword--> oe-ord
      <span class="src-keyword">WHERE</span><!--src-keyword--> oe-ordl.i-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
      <span class="src-keyword">NO-LOCK NO-ERROR</span><!--src-keyword-->.
  <span class="src-keyword">IF AVAIL</span><!--src-keyword--> oe-ordl <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword--> = oe-ordl.<span class="src-keyword">line</span><!--src-keyword-->.
 
  <span class="src-keyword">LEAVE</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">RELEASE</span><!--src-keyword--> oe-ordl.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-ordl <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
    <span class="src-keyword">WHERE</span><!--src-keyword--> oe-ordl.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> oe-ordl.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
      <span class="src-keyword">AND</span><!--src-keyword--> oe-ordl.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
      <span class="src-keyword">AND</span><!--src-keyword--> oe-ordl.<span class="src-keyword">line    EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->:
 
  <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-code = <span class="src-keyword">IF</span><!--src-keyword--> oe-ordl.is-a-component
                        <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-char">"S"</span><!--src-char-->
                        <span class="src-keyword">ELSE</span><!--src-keyword-->
                        <span class="src-keyword">IF CAN-FIND</span><!--src-keyword-->(<span class="src-keyword">FIRST</span><!--src-keyword--> b-oe-ordl <span class="src-prep">{sys/inc/ordlcomp.i b-oe-ordl oe-ordl}</span><!--src-prep-->)
                        <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-char">"I"</span><!--src-char-->
                        <span class="src-keyword">ELSE</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-code.
 
  <span class="src-keyword">FIND</span><!--src-keyword--> b-oe-ordl <span class="src-keyword">EXCLUSIVE WHERE ROWID</span><!--src-keyword-->(b-oe-ordl) <span class="src-keyword">EQ ROWID</span><!--src-keyword-->(oe-ordl)
      <span class="src-keyword">NO-WAIT NO-ERROR</span><!--src-keyword-->.
 
  <span class="src-keyword">IF AVAIL</span><!--src-keyword--> b-oe-ordl <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-keyword">RUN</span><!--src-keyword--> oe/ordlsqty.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(b-oe-ordl),
                       <span class="src-keyword">OUTPUT</span><!--src-keyword--> b-oe-ordl.inv-qty,
                       <span class="src-keyword">OUTPUT</span><!--src-keyword--> b-oe-ordl.ship-qty).
 
    b-oe-ordl.t-ship-qty = b-oe-ordl.ship-qty.
 
    <span class="src-keyword">RUN</span><!--src-keyword--> oe/rell-qty.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(b-oe-ordl), <span class="src-keyword">OUTPUT</span><!--src-keyword--> b-oe-ordl.t-rel-qty).
 
    <span class="src-keyword">FIND</span><!--src-keyword--> b-oe-ordl <span class="src-keyword">NO-LOCK WHERE ROWID</span><!--src-keyword-->(b-oe-ordl) <span class="src-keyword">EQ ROWID</span><!--src-keyword-->(oe-ordl) <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">LEAVE</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.b-no   <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->  <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->  <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no   <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
 
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.po-no <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.po-no <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-rell
      <span class="src-keyword">WHERE</span><!--src-keyword--> oe-rell.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.ord-no   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.<span class="src-keyword">line     EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.i-no     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.r-no     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.r-no
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.rel-no   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rel-no
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.b-ord-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.b-ord-no
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.po-no    <span class="src-keyword">EQ</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.po-no
        <span class="src-keyword">AND CAN-FIND</span><!--src-keyword-->(<span class="src-keyword">FIRST</span><!--src-keyword--> oe-relh
                     <span class="src-keyword">WHERE</span><!--src-keyword--> oe-relh.r-no   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.r-no
                       <span class="src-keyword">AND</span><!--src-keyword--> oe-relh.posted <span class="src-keyword">EQ YES</span><!--src-keyword-->)
      <span class="src-keyword">USE-INDEX</span><!--src-keyword--> ord-no:
 
    oe-rell.po-no = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.po-no.
 
    <span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-rel
        <span class="src-keyword">WHERE</span><!--src-keyword--> oe-rel.company <span class="src-keyword">EQ</span><!--src-keyword--> oe-rell.company
          <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.r-no    <span class="src-keyword">EQ</span><!--src-keyword--> oe-rell.link-no
          <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> oe-rell.i-no
          <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.<span class="src-keyword">line    EQ</span><!--src-keyword--> oe-rell.<span class="src-keyword">line</span><!--src-keyword-->
          <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.link-no <span class="src-keyword">EQ</span><!--src-keyword--> oe-rell.r-no
        <span class="src-keyword">USE-INDEX</span><!--src-keyword--> link:
      oe-rel.po-no = oe-rell.po-no.    
    <span class="src-keyword">END</span><!--src-keyword-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
 
 
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-bolh <span class="src-keyword">WHERE</span><!--src-keyword--> oe-bolh.b-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.b-no <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
    <span class="src-keyword">ASSIGN</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.bol-no   = oe-bolh.bol-no
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.bol-date = oe-bolh.bol-date.
 
 
    <span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-ordl <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
        <span class="src-keyword">WHERE</span><!--src-keyword--> oe-ordl.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
          <span class="src-keyword">AND</span><!--src-keyword--> oe-ordl.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
          <span class="src-keyword">AND</span><!--src-keyword--> oe-ordl.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
        <span class="src-keyword">BREAK BY</span><!--src-keyword--> oe-ordl.<span class="src-keyword">line DESC</span><!--src-keyword-->:
      <span class="src-keyword">IF LAST</span><!--src-keyword-->(oe-ordl.<span class="src-keyword">line</span><!--src-keyword-->) <span class="src-keyword">OR</span><!--src-keyword--> oe-ordl.<span class="src-keyword">line EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line THEN DO</span><!--src-keyword-->:
        <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword--> = oe-ordl.<span class="src-keyword">line</span><!--src-keyword-->.
        <span class="src-keyword">LEAVE</span><!--src-keyword-->.
      <span class="src-keyword">END</span><!--src-keyword-->.
    <span class="src-keyword">END</span><!--src-keyword-->.
 
    <span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-relh 
        <span class="src-keyword">WHERE</span><!--src-keyword--> oe-relh.company  <span class="src-keyword">EQ</span><!--src-keyword--> oe-bolh.company
          <span class="src-keyword">AND</span><!--src-keyword--> oe-relh.release# <span class="src-keyword">EQ</span><!--src-keyword--> oe-bolh.release#
        <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
       <span class="src-comment">/* Task 04271204 - Was causing extra oe-rell's to be created */</span><!--src-comment-->
      <span class="src-comment">/* {&amp;TABLENAME}.r-no = oe-relh.r-no. */</span><!--src-comment-->
      <span class="src-comment">/* This block was causing invoices to be short
    FOR EACH oe-rell
        WHERE oe-rell.company      EQ {&amp;TABLENAME}.company
          AND oe-rell.ord-no       EQ {&amp;TABLENAME}.ord-no
          AND oe-rell.line         EQ {&amp;TABLENAME}.line
          AND oe-rell.i-no         EQ {&amp;TABLENAME}.i-no
          /* AND oe-rell.r-no         EQ {&amp;TABLENAME}.r-no */
          AND ({&amp;TABLENAME}.rel-no EQ 0 OR
               (oe-rell.rel-no     EQ {&amp;TABLENAME}.rel-no AND
                oe-rell.b-ord-no   EQ {&amp;TABLENAME}.b-ord-no))
          AND oe-rell.po-no        EQ {&amp;TABLENAME}.po-no
        USE-INDEX ord-no:
        IF oe-rell.r-no NE oe-relh.r-no THEN
            oe-rell.r-no = oe-relh.r-no.
    END.
    */</span><!--src-comment-->
      <span class="src-keyword">LEAVE</span><!--src-keyword-->.
    <span class="src-keyword">END</span><!--src-keyword-->.
 
    <span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-rell
        <span class="src-keyword">WHERE</span><!--src-keyword--> oe-rell.company      <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
          <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.ord-no       <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
          <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.<span class="src-keyword">line         EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->
          <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.i-no         <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
          <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.r-no         <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.r-no
          <span class="src-keyword">AND</span><!--src-keyword--> (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rel-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">OR</span><!--src-keyword-->
               (oe-rell.rel-no     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rel-no <span class="src-keyword">AND</span><!--src-keyword-->
                oe-rell.b-ord-no   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.b-ord-no))
          <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.po-no        <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.po-no
        <span class="src-keyword">USE-INDEX</span><!--src-keyword--> ord-no:
      <span class="src-keyword">LEAVE</span><!--src-keyword-->.
    <span class="src-keyword">END</span><!--src-keyword-->.
 
    <span class="src-keyword">IF AVAIL</span><!--src-keyword--> oe-rell <span class="src-keyword">THEN</span><!--src-keyword-->
      <span class="src-keyword">ASSIGN</span><!--src-keyword-->
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rel-no   = oe-rell.rel-no
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.b-ord-no = oe-rell.b-ord-no.
 
    <span class="src-keyword">ELSE DO</span><!--src-keyword-->:
      <span class="src-keyword">CREATE</span><!--src-keyword--> oe-rell.
      <span class="src-keyword">BUFFER-COPY</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">EXCEPT</span><!--src-keyword--> rec_key <span class="src-keyword">TO</span><!--src-keyword--> oe-rell
      <span class="src-keyword">ASSIGN</span><!--src-keyword-->
       oe-rell.rel-no = <span class="src-number">0</span><!--src-number-->
       oe-rell.posted = <span class="src-keyword">YES</span><!--src-keyword-->.
      <span class="src-comment">/* needed because triggers are disabled */</span><!--src-comment-->
      <span class="src-prep">{custom/rec_key.i oe-rell}</span><!--src-prep-->
    <span class="src-keyword">END</span><!--src-keyword-->.
 
    <span class="src-keyword">IF</span><!--src-keyword--> oe-rell.rel-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
      li = <span class="src-number">0</span><!--src-number-->.
 
      <span class="src-keyword">FOR EACH</span><!--src-keyword--> b-oe-rell
          <span class="src-keyword">WHERE</span><!--src-keyword--> b-oe-rell.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
            <span class="src-keyword">AND</span><!--src-keyword--> b-oe-rell.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
            <span class="src-keyword">AND ROWID</span><!--src-keyword-->(b-oe-rell)  <span class="src-keyword">NE ROWID</span><!--src-keyword-->(oe-rell)
          <span class="src-keyword">USE-INDEX</span><!--src-keyword--> ord-no <span class="src-keyword">NO-LOCK</span><!--src-keyword--> 
          <span class="src-keyword">BY</span><!--src-keyword--> b-oe-rell.rel-no <span class="src-keyword">DESC</span><!--src-keyword-->:
        li = b-oe-rell.rel-no.
        <span class="src-keyword">LEAVE</span><!--src-keyword-->.  
      <span class="src-keyword">END</span><!--src-keyword-->.
 
      <span class="src-keyword">ASSIGN</span><!--src-keyword-->
       oe-rell.rel-no      = li + <span class="src-number">1</span><!--src-number-->
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rel-no = oe-rell.rel-no.
      <span class="src-keyword">RUN</span><!--src-keyword--> oe/upschrel.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(oe-rell)).
    <span class="src-keyword">END</span><!--src-keyword-->.
 
    <span class="src-keyword">LEAVE</span><!--src-keyword-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-rel
      <span class="src-keyword">WHERE</span><!--src-keyword--> oe-rel.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.<span class="src-keyword">line    EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.link-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.rel-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.r-no    <span class="src-keyword">GT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->
      <span class="src-keyword">USE-INDEX</span><!--src-keyword--> ord-item,
      <span class="src-keyword">FIRST</span><!--src-keyword--> oe-rell
      <span class="src-keyword">WHERE</span><!--src-keyword--> oe-rell.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.<span class="src-keyword">line    EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.link-no <span class="src-keyword">EQ</span><!--src-keyword--> oe-rel.r-no
        <span class="src-keyword">AND</span><!--src-keyword--> oe-rell.posted  <span class="src-keyword">EQ YES</span><!--src-keyword-->
      <span class="src-keyword">USE-INDEX</span><!--src-keyword--> ord-no <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
 
    <span class="src-keyword">ASSIGN</span><!--src-keyword-->
     oe-rel.link-no  = oe-rell.r-no
     oe-rel.rel-no   = oe-rell.rel-no
     oe-rel.b-ord-no = oe-rell.b-ord-no.
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no    <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->                    <span class="src-keyword">AND</span><!--src-keyword-->
   (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.weight <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">OR</span><!--src-keyword-->
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty    <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty) <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-keyword">FOR EACH</span><!--src-keyword--> itemfg
    <span class="src-keyword">WHERE</span><!--src-keyword--> itemfg.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> itemfg.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no:
  <span class="src-keyword">IF</span><!--src-keyword--> itemfg.weight-100 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> itemfg.weight-100 = <span class="src-number">1</span><!--src-number-->.
  <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.weight = ((((<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cases <span class="src-keyword">*</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.qty-case) +
                            <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.partial) / <span class="src-number">100</span><!--src-number-->) <span class="src-keyword">*</span><!--src-keyword--> itemfg.weight-100).
  <span class="src-keyword">LEAVE</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-bolh <span class="src-keyword">WHERE</span><!--src-keyword--> oe-bolh.b-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.b-no:
 
  <span class="src-keyword">IF PROGRAM-NAME</span><!--src-keyword-->(<span class="src-number">2</span><!--src-number-->) <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">"oe/invpost3.p"</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
     <span class="src-keyword">ASSIGN</span><!--src-keyword-->
       oe-bolh.upd-date = <span class="src-keyword">TODAY</span><!--src-keyword-->
       oe-bolh.upd-time = <span class="src-keyword">TIME</span><!--src-keyword-->
       oe-bolh.<span class="src-keyword">user-id</span><!--src-keyword-->  = <span class="src-keyword">USERID</span><!--src-keyword-->(<span class="src-char">"asi"</span><!--src-char-->).
 
  <span class="src-keyword">RUN</span><!--src-keyword--> oe/bolhtots.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(oe-bolh)).
 
  <span class="src-keyword">LEAVE</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.weight <span class="src-keyword">LT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.weight = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.weight <span class="src-keyword">*</span><!--src-keyword--> <span class="src-number">-1</span><!--src-number-->.
 
<span class="src-comment">/* wfk - This can't run here since it runs from write.trg/oe-rell.p 
  RUN oe/rel-stat-upd.p (ROWID({&amp;TABLENAME})). */</span><!--src-comment-->
 
<span class="src-keyword">IF</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rec_key <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rec_key <span class="src-keyword">AND</span><!--src-keyword-->
   old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rec_key <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->                   <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-keyword">FOR EACH</span><!--src-keyword--> reftable <span class="src-keyword">WHERE</span><!--src-keyword--> reftable.rec_key <span class="src-keyword">EQ</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rec_key:
  reftable.rec_key = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rec_key.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-comment">/* Clear out any error-status from find with no-error that is false */</span><!--src-comment-->
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll-error <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
ll-error = <span class="src-keyword">YES NO-ERROR</span><!--src-keyword-->.
</div><!--progresscode-->
</body>
</html>
