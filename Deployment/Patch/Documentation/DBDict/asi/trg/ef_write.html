<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: write of ef</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: write of ef</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">UPDATE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME ef
 
<span class="src-keyword">TRIGGER PROCEDURE FOR WRITE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">OLD BUFFER</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">write</span><!--src-keyword-->.i}</span><!--src-prep-->
 
<span class="src-prep">{sys/inc/<span class="src-keyword">var</span><!--src-keyword-->.i <span class="src-keyword">NEW</span><!--src-keyword--> SHARED}</span><!--src-p<span class="src-keyword">SHARED</span><!--src-keyword-->
 
<span class="src-keyword">DEF VAR</span><!--src-keyword--> lv-die-in <span class="src-keyword">LIKE</span><!--src-keyword--> ef.die-in <span class="src-keyword">NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> li <span class="src-keyword">AS INT NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> li1 <span class="src-keyword">LIKE</span><!--src-keyword--> li <span class="src-keyword">NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> lv-type <span class="src-keyword">AS CHAR NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> li-line <span class="src-keyword">AS INT NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll-leafed <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll-die-changed <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll-same-layout <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> k_frac <span class="src-keyword">AS DEC INIT</span><!--src-keyword--> <span class="src-number">6</span><!--src-number-->.<span class="src-number">25</span><!--src-number--> <span class="src-keyword">NO-UNDO</span><!--src-keyword-->.
 
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-eb <span class="src-keyword">FOR</span><!--src-keyword--> eb.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">FOR</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> op-lock <span class="src-keyword">FOR</span><!--src-keyword--> reftable.
 
<span class="src-prep">{est/layout.i}</span><!--src-prep-->
 
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> est.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> eb.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> est-flm.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> ef-nsh.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> op-lock.
 
cocode = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company.
 
<span class="src-prep">{sys/inc/f16to32.i}</span><!--src-prep-->
 
<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no = <span class="src-keyword">FILL</span><!--src-keyword-->(<span class="src-char">" "</span><!--src-char-->,<span class="src-number">8</span><!--src-number--> <span class="src-keyword">- LENGTH</span><!--src-keyword-->(<span class="src-keyword">TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no))) +
                      <span class="src-keyword">TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no).
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-type <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">RUN</span><!--src-keyword--> est/resettyp.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->), <span class="src-keyword">OUTPUT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-type).
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-type <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">3</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-type = <span class="src-number">4</span><!--src-number-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-out   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-out   = <span class="src-number">1</span><!--src-number-->.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-out-l <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-out-l = <span class="src-number">1</span><!--src-number-->.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-out-d <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-out-d = <span class="src-number">1</span><!--src-number-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-type <span class="src-keyword">GE</span><!--src-keyword--> <span class="src-number">5</span><!--src-number--> <span class="src-keyword">AND</span><!--src-keyword--> v-cecscrn-char <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">"Decimal"</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">ASSIGN</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-len = <span class="src-keyword">ROUND</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-len <span class="src-keyword">*</span><!--src-keyword--> li-16-32,<span class="src-number">0</span><!--src-number-->)
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-len = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-len / li-16-32
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-wid = <span class="src-keyword">ROUND</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-wid <span class="src-keyword">*</span><!--src-keyword--> li-16-32,<span class="src-number">0</span><!--src-number-->)
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-wid = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-wid / li-16-32
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-dep = <span class="src-keyword">ROUND</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-dep <span class="src-keyword">*</span><!--src-keyword--> li-16-32,<span class="src-number">0</span><!--src-number-->)
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-dep = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-dep / li-16-32
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-len = <span class="src-keyword">ROUND</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-len <span class="src-keyword">*</span><!--src-keyword--> li-16-32,<span class="src-number">0</span><!--src-number-->)
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-len = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-len / li-16-32
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-wid = <span class="src-keyword">ROUND</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-wid <span class="src-keyword">*</span><!--src-keyword--> li-16-32,<span class="src-number">0</span><!--src-number-->)
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-wid = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-wid / li-16-32
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-dep = <span class="src-keyword">ROUND</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-dep <span class="src-keyword">*</span><!--src-keyword--> li-16-32,<span class="src-number">0</span><!--src-number-->)
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-dep = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-dep / li-16-32
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-l  = <span class="src-keyword">ROUND</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-l <span class="src-keyword">*</span><!--src-keyword--> li-16-32,<span class="src-number">0</span><!--src-number-->)
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-l  = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-l / li-16-32
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-w  = <span class="src-keyword">ROUND</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-w <span class="src-keyword">*</span><!--src-keyword--> li-16-32,<span class="src-number">0</span><!--src-number-->)
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-w  = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-w / li-16-32
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-d  = <span class="src-keyword">ROUND</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-d <span class="src-keyword">*</span><!--src-keyword--> li-16-32,<span class="src-number">0</span><!--src-number-->)
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-d  = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-d / li-16-32.
<span class="src-keyword">ELSE</span><!--src-keyword-->
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-cuts <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-cuts = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-out <span class="src-keyword">-</span><!--src-keyword--> <span class="src-number">1</span><!--src-number-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-cuts <span class="src-keyword">LT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-cuts = <span class="src-number">0</span><!--src-number-->.
 
<span class="src-comment">/* 12070513 WaitForApproval
IF {&amp;TABLENAME}.n-out   NE old-{&amp;TABLENAME}.n-out   OR
   {&amp;TABLENAME}.n-out-l NE old-{&amp;TABLENAME}.n-out-l THEN
  RUN est/estopout.p (ROWID({&amp;TABLENAME}),
                      old-{&amp;TABLENAME}.n-out,
                      old-{&amp;TABLENAME}.n-out-l).
*/</span><!--src-comment-->
 
ll-leafed = <span class="src-keyword">NO</span><!--src-keyword-->.
 
<span class="src-keyword">DO</span><!--src-keyword--> li = <span class="src-number">1</span><!--src-number--> <span class="src-keyword">TO EXTENT</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf):
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf[li]      <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf[li]      <span class="src-keyword">OR</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-dscr[li] <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-dscr[li] <span class="src-keyword">OR</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-bnum[li] <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-bnum[li] <span class="src-keyword">OR</span><!--src-keyword--> 
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-w[li]    <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-w[li]    <span class="src-keyword">OR</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-l[li]    <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-l[li]    <span class="src-keyword">THEN</span><!--src-keyword-->
    ll-leafed = <span class="src-keyword">YES</span><!--src-keyword-->.
 
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf[li] <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-keyword">ASSIGN</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-dscr[li] = <span class="src-char">""</span><!--src-char-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-snum[li] = <span class="src-number">0</span><!--src-number-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-bnum[li] = <span class="src-number">0</span><!--src-number-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-w[li]    = <span class="src-number">0</span><!--src-number-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-l[li]    = <span class="src-number">0</span><!--src-number-->.
  <span class="src-keyword">ELSE</span><!--src-keyword-->
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.leaf-snum[li] = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.form-no.
<span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">IF</span><!--src-keyword--> ll-leafed <span class="src-keyword">THEN RUN</span><!--src-keyword--> est/leaf-upd.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)).
 
<span class="src-keyword">RUN</span><!--src-keyword--> est/forminks.p (<span class="src-keyword">BUFFER</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->).
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> eb
    <span class="src-keyword">WHERE</span><!--src-keyword--> eb.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> eb.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
      <span class="src-keyword">AND</span><!--src-keyword--> eb.form-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.form-no
    <span class="src-keyword">BREAK BY</span><!--src-keyword--> eb.blank-no:
 
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-type <span class="src-keyword">GE</span><!--src-keyword--> <span class="src-number">5</span><!--src-number--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.flute <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword--> eb.flute = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.flute.
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.test  <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword--> eb.test  = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.test.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">IF</span><!--src-keyword--> eb.blank-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">1</span><!--src-number--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-col <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                    <span class="src-keyword">OR</span><!--src-keyword-->
       (<span class="src-keyword">FIRST</span><!--src-keyword-->(eb.blank-no) <span class="src-keyword">AND LAST</span><!--src-keyword-->(eb.blank-no)) <span class="src-keyword">THEN</span><!--src-keyword-->
      <span class="src-keyword">ASSIGN</span><!--src-keyword-->
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-col  = eb.i-col
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-pass = eb.i-pass.
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-coat <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                   <span class="src-keyword">OR</span><!--src-keyword-->
       (<span class="src-keyword">FIRST</span><!--src-keyword-->(eb.blank-no) <span class="src-keyword">AND LAST</span><!--src-keyword-->(eb.blank-no)) <span class="src-keyword">THEN</span><!--src-keyword-->
      <span class="src-keyword">ASSIGN</span><!--src-keyword-->
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-coat   = eb.i-coat
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-coat-p = eb.i-coat-p.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  lv-die-in = eb.die-in.
  <span class="src-keyword">RUN</span><!--src-keyword--> est/upddiein.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(eb)).
  <span class="src-keyword">FIND</span><!--src-keyword--> b-eb <span class="src-keyword">WHERE ROWID</span><!--src-keyword-->(b-eb) <span class="src-keyword">EQ ROWID</span><!--src-keyword-->(eb) <span class="src-keyword">NO-LOCK</span><!--src-keyword-->.
  <span class="src-keyword">IF</span><!--src-keyword--> lv-die-in <span class="src-keyword">NE</span><!--src-keyword--> b-eb.die-in <span class="src-keyword">THEN</span><!--src-keyword--> ll-die-changed = <span class="src-keyword">YES</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> ll-die-changed <span class="src-keyword">THEN RUN</span><!--src-keyword--> est/updefdie.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)).
 
<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.blank-qty = <span class="src-number">0</span><!--src-number-->.
<span class="src-keyword">FOR EACH</span><!--src-keyword--> eb
    <span class="src-keyword">WHERE</span><!--src-keyword--> eb.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> eb.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
      <span class="src-keyword">AND</span><!--src-keyword--> eb.form-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.form-no
    <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
  <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.blank-qty = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.blank-qty + <span class="src-number">1</span><!--src-number-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF ROUND</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.die-in,<span class="src-number">0</span><!--src-number-->) <span class="src-keyword">NE ROUND</span><!--src-keyword-->(old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.die-in,<span class="src-number">0</span><!--src-number-->) <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-keyword">FOR EACH</span><!--src-keyword--> est-prep
    <span class="src-keyword">WHERE</span><!--src-keyword--> est-prep.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> est-prep.est-no   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
      <span class="src-keyword">AND</span><!--src-keyword--> est-prep.s-num    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.form-no
      <span class="src-keyword">AND</span><!--src-keyword--> est-prep.mat-type <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"R"</span><!--src-char-->
    <span class="src-keyword">EXCLUSIVE</span><!--src-keyword-->:
 
  est-prep.qty = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.die-in.
 
  <span class="src-keyword">IF</span><!--src-keyword--> est-prep.qty <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN DELETE</span><!--src-keyword--> est-prep.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-type <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">4</span><!--src-number--> <span class="src-keyword">OR</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-type <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">8</span><!--src-number--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-col + <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-coat <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> est-prep
      <span class="src-keyword">WHERE</span><!--src-keyword--> est-prep.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> est-prep.est-no   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
        <span class="src-keyword">AND</span><!--src-keyword--> est-prep.s-num    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.form-no
        <span class="src-keyword">AND</span><!--src-keyword--> est-prep.mat-type <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"P"</span><!--src-char-->,
 
      <span class="src-keyword">FIRST</span><!--src-keyword--> prep
      <span class="src-keyword">WHERE</span><!--src-keyword--> prep.company <span class="src-keyword">EQ</span><!--src-keyword--> est-prep.company
        <span class="src-keyword">AND</span><!--src-keyword--> prep.<span class="src-keyword">code    EQ</span><!--src-keyword--> est-prep.<span class="src-keyword">code</span><!--src-keyword-->
        <span class="src-keyword">AND</span><!--src-keyword--> prep.dfault  <span class="src-keyword">EQ YES</span><!--src-keyword-->
      <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
 
    <span class="src-keyword">DELETE</span><!--src-keyword--> est-prep.  
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-col    <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-col    <span class="src-keyword">OR</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-coat   <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-coat   <span class="src-keyword">OR</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-pass   <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-pass   <span class="src-keyword">OR</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-coat-p <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.f-coat-p <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> est-prep
      <span class="src-keyword">WHERE</span><!--src-keyword--> est-prep.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> est-prep.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
        <span class="src-keyword">AND</span><!--src-keyword--> est-prep.s-num   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.form-no
	    <span class="src-keyword">AND</span><!--src-keyword--> (est-prep.mat-type <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"F"</span><!--src-char--> <span class="src-keyword">OR</span><!--src-keyword-->
             est-prep.mat-type <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"P"</span><!--src-char-->),
 
      <span class="src-keyword">FIRST</span><!--src-keyword--> est
      <span class="src-keyword">WHERE</span><!--src-keyword--> est.company <span class="src-keyword">EQ</span><!--src-keyword--> est-prep.company
        <span class="src-keyword">AND</span><!--src-keyword--> est.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> est-prep.est-no
      <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
      <span class="src-keyword">RUN</span><!--src-keyword--> est/GetPrepQty.p(<span class="src-keyword">INPUT ROWID</span><!--src-keyword-->(est),
                      <span class="src-keyword">INPUT</span><!--src-keyword--> est-prep.mat-type,
                      <span class="src-keyword">INPUT</span><!--src-keyword--> est-prep.s-num,
                      <span class="src-keyword">OUTPUT</span><!--src-keyword--> est-prep.qty).
<span class="src-comment">/*     RUN sys/inc/flm-prep.p (RECID(est), est-prep.s-num, OUTPUT est-prep.qty). */</span><!--src-comment-->
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.board <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-keyword">FOR EACH ITEM NO-LOCK</span><!--src-keyword-->
        <span class="src-keyword">WHERE item</span><!--src-keyword-->.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
          <span class="src-keyword">AND item</span><!--src-keyword-->.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.board:
 
      <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.weight = <span class="src-keyword">item</span><!--src-keyword-->.basis-w.
 
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.brd-dscr <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.brd-dscr = <span class="src-keyword">item</span><!--src-keyword-->.i-name.
 
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-type <span class="src-keyword">LE</span><!--src-keyword--> <span class="src-number">4</span><!--src-number-->                   <span class="src-keyword">AND</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.board <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.board <span class="src-keyword">AND</span><!--src-keyword-->
     <span class="src-keyword">INDEX</span><!--src-keyword-->(<span class="src-keyword">PROGRAM-NAME</span><!--src-keyword-->(<span class="src-number">2</span><!--src-number-->),<span class="src-char">"ce/copyest"</span><!--src-char-->) <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
 
    <span class="src-keyword">ASSIGN</span><!--src-keyword-->
<span class="src-comment">/*      {&amp;TABLENAME}.medium   = "" */</span><!--src-comment-->
<span class="src-comment">/*      {&amp;TABLENAME}.flute    = "" */</span><!--src-comment-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.lam-code = <span class="src-char">""</span><!--src-char-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.adh-code = <span class="src-char">""</span><!--src-char-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.adh-sqin = <span class="src-number">0</span><!--src-number-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-pen = <span class="src-number">0</span><!--src-number-->.
 
    <span class="src-keyword">FOR EACH</span><!--src-keyword--> item-bom
        <span class="src-keyword">WHERE</span><!--src-keyword--> item-bom.company  <span class="src-keyword">EQ item</span><!--src-keyword-->.company
          <span class="src-keyword">AND</span><!--src-keyword--> item-bom.parent-i <span class="src-keyword">EQ item</span><!--src-keyword-->.i-no
          <span class="src-keyword">AND</span><!--src-keyword--> item-bom.line#    <span class="src-keyword">GE</span><!--src-keyword--> <span class="src-number">1</span><!--src-number-->
          <span class="src-keyword">AND</span><!--src-keyword--> item-bom.line#    <span class="src-keyword">LE</span><!--src-keyword--> <span class="src-number">5</span><!--src-number-->
        <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
        <span class="src-keyword">IF</span><!--src-keyword--> item-bom.i-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">''</span><!--src-char--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
            <span class="src-keyword">CASE</span><!--src-keyword--> item-bom.line#:
                <span class="src-keyword">WHEN</span><!--src-keyword--> <span class="src-number">1</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.medium   = item-bom.i-no.
                <span class="src-keyword">WHEN</span><!--src-keyword--> <span class="src-number">2</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.flute    = item-bom.i-no.
                <span class="src-keyword">WHEN</span><!--src-keyword--> <span class="src-number">3</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.lam-code = item-bom.i-no.
                <span class="src-keyword">WHEN</span><!--src-keyword--> <span class="src-number">4</span><!--src-number--> <span class="src-keyword">THEN ASSIGN</span><!--src-keyword-->
                    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.adh-code = item-bom.i-no
                    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.adh-sqin = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-len <span class="src-keyword">*</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-wid.
                <span class="src-keyword">WHEN</span><!--src-keyword--> <span class="src-number">5</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.trim-pen = <span class="src-keyword">INT</span><!--src-keyword-->(item-bom.i-no).
            <span class="src-keyword">END CASE</span><!--src-keyword-->.
        <span class="src-keyword">END</span><!--src-keyword-->.
    <span class="src-keyword">END</span><!--src-keyword-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
  <span class="src-keyword">ELSE</span><!--src-keyword-->
     <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-type <span class="src-keyword">GT</span><!--src-keyword--> <span class="src-number">4</span><!--src-number--> <span class="src-keyword">AND</span><!--src-keyword-->
     (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.board <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.board <span class="src-keyword">OR</span><!--src-keyword-->
      <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-len <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-len <span class="src-keyword">OR</span><!--src-keyword-->
      <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-wid <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-wid) <span class="src-keyword">AND</span><!--src-keyword-->
     <span class="src-keyword">INDEX</span><!--src-keyword-->(<span class="src-keyword">PROGRAM-NAME</span><!--src-keyword-->(<span class="src-number">2</span><!--src-number-->),<span class="src-char">"ce/copyest"</span><!--src-char-->) <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
 
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-len <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-len <span class="src-keyword">OR</span><!--src-keyword-->
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-wid <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-wid <span class="src-keyword">THEN</span><!--src-keyword-->
       <span class="src-keyword">DO</span><!--src-keyword-->:
          <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.adh-sqin = <span class="src-number">0</span><!--src-number-->.
 
          <span class="src-keyword">FOR EACH</span><!--src-keyword--> item-bom
              <span class="src-keyword">WHERE</span><!--src-keyword--> item-bom.company  <span class="src-keyword">EQ item</span><!--src-keyword-->.company
                <span class="src-keyword">AND</span><!--src-keyword--> item-bom.parent-i <span class="src-keyword">EQ item</span><!--src-keyword-->.i-no
                <span class="src-keyword">AND</span><!--src-keyword--> item-bom.line#    <span class="src-keyword">LT</span><!--src-keyword--> <span class="src-number">9</span><!--src-number-->
              <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
 
             <span class="src-keyword">IF</span><!--src-keyword--> item-bom.shrink <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">100</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
                <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.adh-sqin = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.adh-sqin +
                                        (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-wid <span class="src-keyword">*</span><!--src-keyword-->
                                        (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-len / (<span class="src-number">1</span><!--src-number--> <span class="src-keyword">-</span><!--src-keyword--> (item-bom.shrink / <span class="src-number">100</span><!--src-number-->)))).
          <span class="src-keyword">END</span><!--src-keyword-->.
       <span class="src-keyword">END</span><!--src-keyword-->.
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.board <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.board <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-keyword">DO</span><!--src-keyword-->:
       <span class="src-keyword">ASSIGN</span><!--src-keyword-->
          <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.lam-code = <span class="src-char">""</span><!--src-char-->
          <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.adh-code = <span class="src-char">""</span><!--src-char-->.
 
       <span class="src-keyword">FOR EACH</span><!--src-keyword--> item-bom
           <span class="src-keyword">WHERE</span><!--src-keyword--> item-bom.company  <span class="src-keyword">EQ item</span><!--src-keyword-->.company
             <span class="src-keyword">AND</span><!--src-keyword--> item-bom.parent-i <span class="src-keyword">EQ item</span><!--src-keyword-->.i-no
             <span class="src-keyword">AND</span><!--src-keyword--> item-bom.line#    <span class="src-keyword">GE</span><!--src-keyword--> <span class="src-number">9</span><!--src-number-->
             <span class="src-keyword">AND</span><!--src-keyword--> item-bom.line#    <span class="src-keyword">LE</span><!--src-keyword--> <span class="src-number">10</span><!--src-number-->
           <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
         <span class="src-keyword">CASE</span><!--src-keyword--> item-bom.line#:
            <span class="src-keyword">WHEN</span><!--src-keyword--> <span class="src-number">9</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.lam-code = item-bom.i-no.
            <span class="src-keyword">WHEN</span><!--src-keyword--> <span class="src-number">10</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.adh-code = item-bom.i-no.
         <span class="src-keyword">END CASE</span><!--src-keyword-->.
       <span class="src-keyword">END</span><!--src-keyword-->.
    <span class="src-keyword">END</span><!--src-keyword-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">LEAVE</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">DO</span><!--src-keyword--> li = <span class="src-number">1</span><!--src-number--> <span class="src-keyword">TO EXTENT</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.mis-snum):
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.mis-snum[li] <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.mis-snum[li] = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.form-no.
 
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.mis-cost[li] <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-keyword">DO</span><!--src-keyword--> li1 = <span class="src-number">1</span><!--src-number--> <span class="src-keyword">TO</span><!--src-keyword--> <span class="src-number">4</span><!--src-number-->:
      lv-type = <span class="src-keyword">IF</span><!--src-keyword--> li1 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">1</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-char">"MAT-QTY"</span><!--src-char--> <span class="src-keyword">ELSE</span><!--src-keyword-->
                <span class="src-keyword">IF</span><!--src-keyword--> li1 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">2</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-char">"LAB-QTY"</span><!--src-char--> <span class="src-keyword">ELSE</span><!--src-keyword-->
                <span class="src-keyword">IF</span><!--src-keyword--> li1 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">3</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-char">"MAT-CST"</span><!--src-char--> <span class="src-keyword">ELSE</span><!--src-keyword--> <span class="src-char">"LAB-CST"</span><!--src-char-->.
 
      <span class="src-keyword">FOR EACH</span><!--src-keyword--> reftable
          <span class="src-keyword">WHERE</span><!--src-keyword--> reftable.reftable <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"EST-MISC"</span><!--src-char-->
	        <span class="src-keyword">AND</span><!--src-keyword--> reftable.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
	        <span class="src-keyword">AND</span><!--src-keyword--> reftable.loc      <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.loc
	        <span class="src-keyword">AND</span><!--src-keyword--> reftable.<span class="src-keyword">code     EQ TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no) +
                                     <span class="src-keyword">STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.form-no,<span class="src-char">"/99"</span><!--src-char-->)
	        <span class="src-keyword">AND</span><!--src-keyword--> reftable.code2    <span class="src-keyword">EQ</span><!--src-keyword--> lv-type + <span class="src-keyword">STRING</span><!--src-keyword-->(li,<span class="src-char">"99"</span><!--src-char-->)
          <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->:
        <span class="src-keyword">DELETE</span><!--src-keyword--> reftable.
      <span class="src-keyword">END</span><!--src-keyword-->.
    <span class="src-keyword">END</span><!--src-keyword-->.
 
    <span class="src-keyword">ASSIGN</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.mis-snum[li]  = <span class="src-number">0</span><!--src-number-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.mis-bnum[li]  = <span class="src-number">0</span><!--src-number-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.mis-matf[li]  = <span class="src-number">0</span><!--src-number-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.mis-labf[li]  = <span class="src-number">0</span><!--src-number-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.mis-matm[li]  = <span class="src-number">0</span><!--src-number-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.mis-labm[li]  = <span class="src-number">0</span><!--src-number-->           
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.mis-simon[li] = <span class="src-char">""</span><!--src-char-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.mis-mkup[li]  = <span class="src-number">0</span><!--src-number-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->              <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.eqty <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.eqty <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-keyword">FOR EACH</span><!--src-keyword--> ef-nsh <span class="src-keyword">OF</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->:
  ef-nsh.eqty = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.eqty.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF NOT CAN-FIND</span><!--src-keyword-->(<span class="src-keyword">FIRST</span><!--src-keyword--> ef-nsh <span class="src-keyword">OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">WHERE</span><!--src-keyword--> ef-nsh.pass-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">1</span><!--src-number-->) <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-keyword">CREATE</span><!--src-keyword--> ef-nsh.
  <span class="src-keyword">BUFFER-COPY</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">EXCEPT</span><!--src-keyword--> rec_key <span class="src-keyword">TO</span><!--src-keyword--> ef-nsh
  <span class="src-keyword">ASSIGN</span><!--src-keyword-->
   ef-nsh.n-out-l = <span class="src-keyword">TRUNC</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-len / <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-len,<span class="src-number">0</span><!--src-number-->)
   ef-nsh.n-out-w = <span class="src-keyword">TRUNC</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-wid / <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-wid,<span class="src-number">0</span><!--src-number-->)
   ef-nsh.n-out-d = <span class="src-keyword">TRUNC</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-dep / <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-dep,<span class="src-number">0</span><!--src-number-->).
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">ELSE FIND</span><!--src-keyword--> ef-nsh <span class="src-keyword">OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
 
<span class="src-keyword">IF AVAIL</span><!--src-keyword--> ef-nsh <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">ASSIGN</span><!--src-keyword-->
   ef-nsh.pass-no  = <span class="src-number">1</span><!--src-number-->
   ef-nsh.sheet-no = <span class="src-number">1</span><!--src-number-->
   ef-nsh.dept     = <span class="src-char">"RC"</span><!--src-char--> 
   ef-nsh.len-in   = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-len
   ef-nsh.wid-in   = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-wid
   ef-nsh.dep-in   = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.gsh-dep
   ef-nsh.n-out-l  = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-out-l
   ef-nsh.n-out-w  = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-out
   ef-nsh.n-out-d  = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.n-out-d
   ef-nsh.len-out  = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-len
   ef-nsh.wid-out  = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-wid
   ef-nsh.dep-out  = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.nsh-dep.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> reftable
    <span class="src-keyword">WHERE</span><!--src-keyword--> reftable.reftable <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"EST-MISC"</span><!--src-char-->
	  <span class="src-keyword">AND</span><!--src-keyword--> reftable.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
	  <span class="src-keyword">AND</span><!--src-keyword--> reftable.loc      <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.loc
	  <span class="src-keyword">AND</span><!--src-keyword--> reftable.<span class="src-keyword">code     EQ TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no) +
                               <span class="src-keyword">STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.form-no,<span class="src-char">"/99"</span><!--src-char-->)
    <span class="src-keyword">BREAK BY</span><!--src-keyword--> reftable.code2
          <span class="src-keyword">BY RECID</span><!--src-keyword-->(reftable):
  <span class="src-keyword">IF NOT FIRST-OF</span><!--src-keyword-->(reftable.code2) <span class="src-keyword">THEN DELETE</span><!--src-keyword--> reftable.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FIND FIRST</span><!--src-keyword--> est
    <span class="src-keyword">WHERE</span><!--src-keyword--> est.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> est.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
    <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
 
<span class="src-keyword">IF AVAIL</span><!--src-keyword--> est <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-prep">{est/op-lock.i est}</span><!--src-prep-->
 
  <span class="src-keyword">IF NEW</span><!--src-keyword--> op-lock                                      <span class="src-keyword">OR</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company <span class="src-keyword">OR</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-lock <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-lock <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-keyword">ASSIGN</span><!--src-keyword-->
     op-lock.val[1] = <span class="src-keyword">INT</span><!--src-keyword-->(<span class="src-keyword">NOT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.op-lock)
     op-lock.val[2] = op-lock.val[1].
 
  <span class="src-keyword">ASSIGN</span><!--src-keyword-->
   est.updated-date = <span class="src-keyword">TODAY</span><!--src-keyword-->
   est.updated-id   = <span class="src-keyword">USERID</span><!--src-keyword-->(<span class="src-char">"nosweat"</span><!--src-char-->)
   est.mod-date     = est.updated-date.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.rec_key) <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-keyword">BUFFER-COMPARE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">USING</span><!--src-keyword--> xgrain board brd-dscr i-code flute test cost-uom cost-msh weight fr-uom fr-msh nc gsh-wid gsh-len gsh-dep nsh-wid nsh-len nsh-dep trim-w trim-l trim-d n-out n-out-l n-out-d n-cuts die-in adder leaf leaf-dscr leaf-snum leaf-bnum leaf-w leaf-l <span class="src-keyword">TO</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->
      <span class="src-keyword">SAVE RESULT IN</span><!--src-keyword--> ll-same-layout.
 
  <span class="src-keyword">IF NOT</span><!--src-keyword--> ll-same-layout <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-prep">{custom/fibreaud.i}</span><!--src-prep-->
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-comment">/* Clear out any error-status from find with no-error that is false */</span><!--src-comment-->
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll-error <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
ll-error = <span class="src-keyword">YES NO-ERROR</span><!--src-keyword-->.
</div><!--progresscode-->
</body>
</html>
