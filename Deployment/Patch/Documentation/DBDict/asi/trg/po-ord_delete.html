<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: delete of po-ord</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: delete of po-ord</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">DELETE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME po-ord
 
<span class="src-keyword">TRIGGER PROCEDURE FOR DELETE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">delete</span><!--src-keyword-->.i}</span><!--src-prep-->
 
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
 
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.received <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-keyword">MESSAGE</span><!--src-keyword--> <span class="src-char">"You must close PO when receipts have been entered against it, cannot delete..."</span><!--src-char-->
         <span class="src-keyword">VIEW-AS ALERT-BOX ERROR</span><!--src-keyword-->.
  <span class="src-keyword">RETURN ERROR</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
ll = <span class="src-keyword">NO</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> po-ordl
    <span class="src-keyword">WHERE</span><!--src-keyword--> po-ordl.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> po-ordl.po-no   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.po-no
    <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
 
  <span class="src-keyword">IF</span><!--src-keyword--> po-ordl.t-rec-qty <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">OR</span><!--src-keyword--> po-ordl.t-inv-qty <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> ll = <span class="src-keyword">YES</span><!--src-keyword-->.
 
  <span class="src-keyword">IF NOT</span><!--src-keyword--> ll <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> ap-inv
      <span class="src-keyword">WHERE</span><!--src-keyword--> ap-inv.company <span class="src-keyword">EQ</span><!--src-keyword--> po-ordl.company
        <span class="src-keyword">AND</span><!--src-keyword--> ap-inv.posted  <span class="src-keyword">EQ NO</span><!--src-keyword-->
      <span class="src-keyword">NO-LOCK</span><!--src-keyword-->,
      <span class="src-keyword">EACH</span><!--src-keyword--> ap-invl
      <span class="src-keyword">WHERE</span><!--src-keyword--> ap-invl.i-no <span class="src-keyword">EQ</span><!--src-keyword--> ap-inv.i-no
        <span class="src-keyword">AND</span><!--src-keyword--> ap-invl.<span class="src-keyword">line EQ</span><!--src-keyword--> ((po-ordl.po-no <span class="src-keyword">*</span><!--src-keyword--> <span class="src-number">1000</span><!--src-number-->) + po-ordl.<span class="src-keyword">line</span><!--src-keyword-->)
      <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
    ll = <span class="src-keyword">YES</span><!--src-keyword-->.
    <span class="src-keyword">LEAVE</span><!--src-keyword-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">IF NOT</span><!--src-keyword--> ll <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-keyword">IF</span><!--src-keyword--> po-ordl.item-type <span class="src-keyword">THEN</span><!--src-keyword-->
      ll = <span class="src-keyword">CAN-FIND</span><!--src-keyword-->(<span class="src-keyword">FIRST</span><!--src-keyword--> rm-rctd
                    <span class="src-keyword">WHERE</span><!--src-keyword--> rm-rctd.company    <span class="src-keyword">EQ</span><!--src-keyword--> po-ordl.company
                      <span class="src-keyword">AND</span><!--src-keyword--> rm-rctd.rita-code  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"R"</span><!--src-char-->
                      <span class="src-keyword">AND</span><!--src-keyword--> rm-rctd.i-no       <span class="src-keyword">EQ</span><!--src-keyword--> po-ordl.i-no
                      <span class="src-keyword">AND INT</span><!--src-keyword-->(rm-rctd.po-no) <span class="src-keyword">EQ</span><!--src-keyword--> po-ordl.po-no
                    <span class="src-keyword">USE-INDEX</span><!--src-keyword--> rita-code) <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
    <span class="src-keyword">ELSE</span><!--src-keyword-->
      ll = <span class="src-keyword">CAN-FIND</span><!--src-keyword-->(<span class="src-keyword">FIRST</span><!--src-keyword--> fg-rctd
                    <span class="src-keyword">WHERE</span><!--src-keyword--> fg-rctd.company    <span class="src-keyword">EQ</span><!--src-keyword--> po-ordl.company
                      <span class="src-keyword">AND</span><!--src-keyword--> fg-rctd.rita-code  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"R"</span><!--src-char-->
                      <span class="src-keyword">AND</span><!--src-keyword--> fg-rctd.i-no       <span class="src-keyword">EQ</span><!--src-keyword--> po-ordl.i-no
                      <span class="src-keyword">AND INT</span><!--src-keyword-->(fg-rctd.po-no) <span class="src-keyword">EQ</span><!--src-keyword--> po-ordl.po-no
                    <span class="src-keyword">USE-INDEX</span><!--src-keyword--> rita-code) <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
 
  <span class="src-keyword">IF</span><!--src-keyword--> ll <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-keyword">MESSAGE</span><!--src-keyword--> <span class="src-char">"Receipts and/or invoices have been entered against an item, cannot delete..."</span><!--src-char-->
        <span class="src-keyword">VIEW-AS ALERT-BOX ERROR</span><!--src-keyword-->.
    <span class="src-keyword">RETURN ERROR</span><!--src-keyword-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> po-ordl <span class="src-keyword">WHERE</span><!--src-keyword--> po-ordl.company = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
                   <span class="src-keyword">AND</span><!--src-keyword--> po-ordl.po-no = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.po-no:
  <span class="src-keyword">DELETE</span><!--src-keyword--> po-ordl.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">for each</span><!--src-keyword--> oe-ordl <span class="src-keyword">where</span><!--src-keyword--> oe-ordl.company  <span class="src-keyword">eq</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
                   <span class="src-keyword">and</span><!--src-keyword--> oe-ordl.po-no-po <span class="src-keyword">eq</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.po-no
        <span class="src-keyword">use-index</span><!--src-keyword--> po-no-po:
 
      <span class="src-keyword">assign</span><!--src-keyword-->
       oe-ordl.po-no-po = <span class="src-number">0</span><!--src-number-->
       oe-ordl.vend-no  = <span class="src-char">""</span><!--src-char-->.
<span class="src-keyword">end</span><!--src-keyword-->.
 
<span class="src-keyword">find first</span><!--src-keyword--> po-ctrl <span class="src-keyword">WHERE</span><!--src-keyword--> po-ctrl.company = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company <span class="src-keyword">exclusive-lock no-error</span><!--src-keyword-->.
<span class="src-keyword">if avail</span><!--src-keyword--> po-ctrl <span class="src-keyword">and</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.po-no = po-ctrl.next-po-no <span class="src-keyword">-</span><!--src-keyword--> <span class="src-number">1</span><!--src-number--> <span class="src-keyword">then</span><!--src-keyword-->
  po-ctrl.next-po-no = po-ctrl.next-po-no <span class="src-keyword">-</span><!--src-keyword--> <span class="src-number">1</span><!--src-number-->.
 
<span class="src-keyword">FIND FIRST</span><!--src-keyword--> vend <span class="src-keyword">OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">NO-LOCK NO-ERROR</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.opened <span class="src-keyword">AND AVAIL</span><!--src-keyword--> vend <span class="src-keyword">THEN RUN</span><!--src-keyword--> ap/vendobal.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(vend)).
 
<span class="src-comment">/* Clear out any error-status from find with no-error that is false */</span><!--src-comment-->
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll-error <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
ll-error = <span class="src-keyword">YES NO-ERROR</span><!--src-keyword-->.
 
</div><!--progresscode-->
</body>
</html>
