<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: write of oe-ord</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: write of oe-ord</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">UPDATE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME oe-ord
 
<span class="src-keyword">TRIGGER PROCEDURE FOR WRITE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">OLD BUFFER</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">write</span><!--src-keyword-->.i}</span><!--src-prep-->
 
<span class="src-prep">{custom/globdefs.i}</span><!--src-prep-->
 
<span class="src-prep">{sys/inc/<span class="src-keyword">var</span><!--src-keyword-->.i <span class="src-keyword">NEW</span><!--src-keyword--> SHARED}</span><!--src-p<span class="src-keyword">SHARED</span><!--src-keyword-->
 
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">FOR</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-oe-ordl <span class="src-keyword">FOR</span><!--src-keyword--> oe-ordl.
<span class="src-keyword">DEF BUFFER</span><!--src-keyword--> b-oe-rel <span class="src-keyword">FOR</span><!--src-keyword--> oe-rel.
 
<span class="src-keyword">DEF VAR</span><!--src-keyword--> li <span class="src-keyword">AS INT NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> li-next-ordno <span class="src-keyword">AS INT NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> cFreightCalculationValue <span class="src-keyword">AS CHARACTER NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> cRtnChar  <span class="src-keyword">AS CHARACTER NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> lRecFound <span class="src-keyword">AS LOGICAL NO-UNDO</span><!--src-keyword-->.
 
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> oe-rel.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> b-oe-ordl.
 
<span class="src-keyword">ASSIGN</span><!--src-keyword-->
 cocode = g_company
 locode = g_loc.
 
<span class="src-prep">{sys/inc/oeuserid.i}</span><!--src-prep-->
 
<span class="src-keyword">RUN</span><!--src-keyword--> sys/ref/nk1look.p (<span class="src-keyword">INPUT</span><!--src-keyword--> cocode, <span class="src-char">"FreightCalculation"</span><!--src-char-->, <span class="src-char">"C"</span><!--src-char--> <span class="src-comment">/* Logical */</span><!--src-comment-->, <span class="src-keyword">NO</span><!--src-keyword--> <span class="src-comment">/* check by cust */</span><!--src-comment-->, 
    <span class="src-keyword">INPUT YES</span><!--src-keyword--> <span class="src-comment">/* use cust not vendor */</span><!--src-comment-->, <span class="src-char">""</span><!--src-char--> <span class="src-comment">/* cust */</span><!--src-comment-->, <span class="src-char">""</span><!--src-char--> <span class="src-comment">/* ship-to*/</span><!--src-comment-->,
    <span class="src-keyword">OUTPUT</span><!--src-keyword--> cRtnChar, <span class="src-keyword">OUTPUT</span><!--src-keyword--> lRecFound).
<span class="src-keyword">IF</span><!--src-keyword--> lRecFound <span class="src-keyword">THEN</span><!--src-keyword-->
    cFreightCalculationValue = cRtnChar <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">AND USERID</span><!--src-keyword-->(<span class="src-char">"ASI"</span><!--src-char-->) <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"ASI"</span><!--src-char--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-keyword">MESSAGE</span><!--src-keyword--> <span class="src-char">"Internal Error - Please Call ASI"</span><!--src-char--> <span class="src-keyword">SKIP</span><!--src-keyword-->
        <span class="src-char">"An order with order number 0 was created."</span><!--src-char--> <span class="src-keyword">SKIP</span><!--src-keyword-->
        <span class="src-char">"Press OK to continue."</span><!--src-char--> <span class="src-keyword">SKIP</span><!--src-keyword-->
        <span class="src-keyword">VIEW-AS ALERT-BOX INFO BUTTONS OK</span><!--src-keyword-->.
<span class="src-keyword">RUN</span><!--src-keyword--> sys/ref/asiseq.p (<span class="src-keyword">INPUT</span><!--src-keyword--> g_company, 
                      <span class="src-keyword">INPUT</span><!--src-keyword--> <span class="src-char">"order_seq"</span><!--src-char-->, 
                      <span class="src-keyword">OUTPUT</span><!--src-keyword--> li-next-ordno) <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
  <span class="src-keyword">ASSIGN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no  = li-next-ordno
         <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company = cocode.
 
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> cust <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
    <span class="src-keyword">WHERE</span><!--src-keyword--> cust.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> cust.cust-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-no:
 
  <span class="src-keyword">ASSIGN</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-name = cust.<span class="src-keyword">name</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.addr[1]   = cust.addr[1]
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.addr[2]   = cust.addr[2]
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.city      = cust.city
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.state     = cust.state
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.zip       = cust.zip.
 
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> soldto <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
      <span class="src-keyword">WHERE</span><!--src-keyword--> soldto.company <span class="src-keyword">EQ</span><!--src-keyword--> cust.company
        <span class="src-keyword">AND</span><!--src-keyword--> soldto.cust-no <span class="src-keyword">EQ</span><!--src-keyword--> cust.cust-no
        <span class="src-keyword">AND</span><!--src-keyword--> soldto.sold-id <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sold-id
      <span class="src-keyword">USE-INDEX</span><!--src-keyword--> sold-id:
 
    <span class="src-keyword">ASSIGN</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sold-name    = soldto.sold-name
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sold-addr[1] = soldto.sold-addr[1]
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sold-addr[2] = soldto.sold-addr[2]
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sold-city    = soldto.sold-city
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sold-state   = soldto.sold-state
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sold-zip     = soldto.sold-zip.
 
    <span class="src-keyword">LEAVE</span><!--src-keyword-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">LEAVE</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">RUN</span><!--src-keyword--> oe/closkids.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)).
 
 
 
<span class="src-keyword">DO</span><!--src-keyword--> li = <span class="src-number">1</span><!--src-number--> <span class="src-keyword">TO EXTENT</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sman):
  <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sman[li] <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">DO</span><!--src-keyword-->:
    <span class="src-keyword">ASSIGN</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.sname[li]  = <span class="src-char">""</span><!--src-char-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-pct[li]  = <span class="src-number">0</span><!--src-number-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.s-comm[li] = <span class="src-number">0</span><!--src-number-->.
 
    <span class="src-keyword">IF</span><!--src-keyword--> li <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">1</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-fuel = <span class="src-number">0</span><!--src-number-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> b-oe-ordl <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
    <span class="src-keyword">WHERE</span><!--src-keyword--> b-oe-ordl.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> b-oe-ordl.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no:
 
  <span class="src-keyword">FIND</span><!--src-keyword--> oe-ordl <span class="src-keyword">WHERE ROWID</span><!--src-keyword-->(oe-ordl) <span class="src-keyword">EQ ROWID</span><!--src-keyword-->(b-oe-ordl) <span class="src-keyword">EXCLUSIVE NO-ERROR NO-WAIT</span><!--src-keyword-->.
 
  <span class="src-keyword">IF AVAIL</span><!--src-keyword--> oe-ordl <span class="src-keyword">THEN DO</span><!--src-keyword-->:
    <span class="src-keyword">ASSIGN</span><!--src-keyword--> 
        oe-ordl.cust-no = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-no
        oe-ordl.ship-id = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ship-id.
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-freight <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-freight <span class="src-keyword">AND</span><!--src-keyword-->
       old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-freight <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                      <span class="src-keyword">THEN</span><!--src-keyword-->
      oe-ordl.t-freight = oe-ordl.t-freight <span class="src-keyword">*</span><!--src-keyword-->
                          (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-freight / old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-freight).
 
    <span class="src-keyword">IF</span><!--src-keyword--> oe-ordl.t-freight <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> oe-ordl.t-freight = <span class="src-number">0</span><!--src-number-->.
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-freight <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-freight 
  <span class="src-keyword">AND</span><!--src-keyword--> (cFreightCalculationValue <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"ALL"</span><!--src-char--> <span class="src-keyword">OR</span><!--src-keyword--> cFreightCalculationValue <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"Order processing"</span><!--src-char-->) <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">RUN</span><!--src-keyword--> oe/ordfrate.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)).
 
<span class="src-keyword">RUN</span><!--src-keyword--> oe/calcordt.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)).
 
<span class="src-keyword">IF</span><!--src-keyword--> oeuserid-log <span class="src-keyword">THEN</span><!--src-keyword--> 
    <span class="src-keyword">ASSIGN</span><!--src-keyword--> 
        <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">user-id</span><!--src-keyword--> = <span class="src-keyword">USERID</span><!--src-keyword-->(<span class="src-char">"ASI"</span><!--src-char-->)
        .
<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.updated-id = <span class="src-keyword">USERID</span><!--src-keyword-->(<span class="src-char">"ASI"</span><!--src-char-->).
 
<span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-rel
    <span class="src-keyword">WHERE</span><!--src-keyword--> oe-rel.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> oe-rel.ord-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.ord-no
    <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
 
  <span class="src-keyword">FIND</span><!--src-keyword--> b-oe-rel <span class="src-keyword">WHERE ROWID</span><!--src-keyword-->(b-oe-rel) <span class="src-keyword">EQ rowid</span><!--src-keyword-->(oe-rel) <span class="src-keyword">EXCLUSIVE NO-ERROR NO-WAIT</span><!--src-keyword-->.
 
  <span class="src-keyword">IF AVAIL</span><!--src-keyword--> b-oe-rel <span class="src-keyword">THEN</span><!--src-keyword-->
  <span class="src-keyword">DO</span><!--src-keyword-->:
     b-oe-rel.cust-no = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-no.
     <span class="src-keyword">RELEASE</span><!--src-keyword--> b-oe-rel.
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
 
 
<span class="src-comment">/* Clear out any error-status from find with no-error that is false */</span><!--src-comment-->
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ll-error <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
ll-error = <span class="src-keyword">YES NO-ERROR</span><!--src-keyword-->.
</div><!--progresscode-->
</body>
</html>
