<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: write of job-mch</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: write of job-mch</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">UPDATE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME job-mch
 
<span class="src-keyword">TRIGGER PROCEDURE FOR WRITE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">OLD BUFFER</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">write</span><!--src-keyword-->.i}</span><!--src-prep-->
 
<span class="src-keyword">DEFINE BUFFER</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">FOR</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
<span class="src-keyword">DEFINE BUFFER</span><!--src-keyword--> b-job          <span class="src-keyword">FOR</span><!--src-keyword--> job.
 
<span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> ld                <span class="src-keyword">AS DECIMAL   NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> ld-tot            <span class="src-keyword">AS DECIMAL   NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> cocode            <span class="src-keyword">AS CHARACTER NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> lv-format-f       <span class="src-keyword">AS CHARACTER NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> ll-error          <span class="src-keyword">AS LOGICAL   NO-UNDO</span><!--src-keyword-->.
 
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> job-mat.
 
cocode = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company.
<span class="src-keyword">IF</span><!--src-keyword--> cocode <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  <span class="src-prep">{sys/inc/jobcard.i <span class="src-char">"F"</span><!--src-char-->}</span><!--src-prep-->
  lv-format-f = sys-ctrl.char-fld.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-comment">/* rtark - 10.28.2016 */</span><!--src-comment-->
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.spare-char-1 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.spare-char-1 = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.m-code.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date <span class="src-keyword">GT TODAY</span><!--src-keyword--> + <span class="src-number">180</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date = <span class="src-keyword">TODAY</span><!--src-keyword--> + <span class="src-number">180</span><!--src-number-->.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.end-date <span class="src-keyword">GT TODAY</span><!--src-keyword--> + <span class="src-number">180</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.end-date = <span class="src-keyword">TODAY</span><!--src-keyword--> + <span class="src-number">180</span><!--src-number-->.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date-su <span class="src-keyword">GT TODAY</span><!--src-keyword--> + <span class="src-number">180</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date-su = <span class="src-keyword">TODAY</span><!--src-keyword--> + <span class="src-number">180</span><!--src-number-->.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.end-date-su <span class="src-keyword">GT TODAY</span><!--src-keyword--> + <span class="src-number">180</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.end-date-su = <span class="src-keyword">TODAY</span><!--src-keyword--> + <span class="src-number">180</span><!--src-number-->.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date-su <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date    <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">?</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date-su = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date-su <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date <span class="src-keyword">AND</span><!--src-keyword-->
   (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-time <span class="src-keyword">LT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-time-su <span class="src-keyword">OR</span><!--src-keyword-->
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-time-su <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->) <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-time-su = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-time.
<span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date-su <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date-su <span class="src-keyword">OR</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date    <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.start-date    <span class="src-keyword">THEN</span><!--src-keyword-->
<span class="src-keyword">FOR EACH</span><!--src-keyword--> job
    <span class="src-keyword">WHERE</span><!--src-keyword--> job.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
      <span class="src-keyword">AND</span><!--src-keyword--> job.job     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job
      <span class="src-keyword">AND</span><!--src-keyword--> job.job-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
      <span class="src-keyword">AND</span><!--src-keyword--> job.job-no2 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
    <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
    :
  <span class="src-keyword">RUN</span><!--src-keyword--> jc/startdat.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(job)).
  <span class="src-keyword">LEAVE</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">IF</span><!--src-keyword--> lv-format-f <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">"Frankstn"</span><!--src-char--> <span class="src-keyword">AND</span><!--src-keyword-->
   old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.run-qty <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.run-qty <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-keyword">PROGRAM-NAME</span><!--src-keyword-->(<span class="src-number">2</span><!--src-number-->) <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">"jc/shtcalc.p"</span><!--src-char--> <span class="src-keyword">AND</span><!--src-keyword-->
   <span class="src-keyword">NOT CAN-FIND</span><!--src-keyword-->(<span class="src-keyword">FIRST</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->
                <span class="src-keyword">WHERE</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
                  <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job
                  <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
                  <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
                  <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.frm     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.frm
                  <span class="src-keyword">AND</span><!--src-keyword--> b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line    LT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.<span class="src-keyword">line</span><!--src-keyword-->
                  <span class="src-keyword">AND ROWID</span><!--src-keyword-->(b-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)  <span class="src-keyword">NE ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)) <span class="src-keyword">THEN DO</span><!--src-keyword-->:
  ld-tot = <span class="src-number">0</span><!--src-number-->.
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> job-mat <span class="src-keyword">FIELDS</span><!--src-keyword-->(company rm-i-no qty n-up)
      <span class="src-keyword">WHERE</span><!--src-keyword--> job-mat.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> job-mat.job     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job
        <span class="src-keyword">AND</span><!--src-keyword--> job-mat.job-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
        <span class="src-keyword">AND</span><!--src-keyword--> job-mat.job-no2 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
        <span class="src-keyword">AND</span><!--src-keyword--> job-mat.frm     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.frm
        <span class="src-keyword">NO-LOCK</span><!--src-keyword-->,
      <span class="src-keyword">FIRST item NO-LOCK</span><!--src-keyword-->
      <span class="src-keyword">WHERE item</span><!--src-keyword-->.company <span class="src-keyword">EQ</span><!--src-keyword--> job-mat.company
        <span class="src-keyword">AND item</span><!--src-keyword-->.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> job-mat.rm-i-no
        <span class="src-keyword">AND INDEX</span><!--src-keyword-->(<span class="src-char">"1234BPR"</span><!--src-char-->,<span class="src-keyword">item</span><!--src-keyword-->.mat-type) <span class="src-keyword">GT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->
        <span class="src-keyword">AND item</span><!--src-keyword-->.i-code  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"R"</span><!--src-char-->
      :
    ld-tot = ld-tot + (job-mat.qty <span class="src-keyword">*</span><!--src-keyword--> job-mat.n-up).
  <span class="src-keyword">END</span><!--src-keyword-->.
 
  <span class="src-keyword">RELEASE</span><!--src-keyword--> job-mat.
 
  <span class="src-keyword">FOR EACH</span><!--src-keyword--> job-mat
      <span class="src-keyword">WHERE</span><!--src-keyword--> job-mat.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
        <span class="src-keyword">AND</span><!--src-keyword--> job-mat.job     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job
        <span class="src-keyword">AND</span><!--src-keyword--> job-mat.job-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no
        <span class="src-keyword">AND</span><!--src-keyword--> job-mat.job-no2 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2
        <span class="src-keyword">AND</span><!--src-keyword--> job-mat.frm     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.frm,
      <span class="src-keyword">FIRST item NO-LOCK</span><!--src-keyword-->
      <span class="src-keyword">WHERE item</span><!--src-keyword-->.company <span class="src-keyword">EQ</span><!--src-keyword--> job-mat.company
        <span class="src-keyword">AND item</span><!--src-keyword-->.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> job-mat.rm-i-no
        <span class="src-keyword">AND INDEX</span><!--src-keyword-->(<span class="src-char">"1234BPR"</span><!--src-char-->,<span class="src-keyword">item</span><!--src-keyword-->.mat-type) <span class="src-keyword">GT</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->
      :
    ld = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.run-qty <span class="src-keyword">*</span><!--src-keyword--> (<span class="src-keyword">IF item</span><!--src-keyword-->.i-code <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"R"</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
                                   ((job-mat.qty <span class="src-keyword">*</span><!--src-keyword--> job-mat.n-up) / ld-tot)
                                 <span class="src-keyword">ELSE</span><!--src-keyword--> <span class="src-number">1</span><!--src-number-->).
    <span class="src-keyword">IF</span><!--src-keyword--> job-mat.qty-uom <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"EA"</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
      <span class="src-prep">{sys/inc/roundup.i ld}</span><!--src-prep-->
    <span class="src-keyword">ELSE</span><!--src-keyword-->
      <span class="src-keyword">RUN</span><!--src-keyword--> sys/ref/convquom.p(<span class="src-char">"EA"</span><!--src-char-->, job-mat.qty-uom,
                             job-mat.basis-w, job-mat.len, job-mat.wid, <span class="src-keyword">item</span><!--src-keyword-->.s-dep,
                             <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.run-qty, <span class="src-keyword">OUTPUT</span><!--src-keyword--> ld).
 
    <span class="src-keyword">ASSIGN</span><!--src-keyword--> 
     job-mat.std-cost = job-mat.std-cost <span class="src-keyword">*</span><!--src-keyword--> (job-mat.qty / ld).
     job-mat.qty      = ld.
  <span class="src-keyword">END</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->.
 
<span class="src-comment">/* check if run-complete changed from no to yes */</span><!--src-comment-->
<span class="src-keyword">IF</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.run-complete <span class="src-keyword">EQ NO  AND</span><!--src-keyword-->
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.run-complete <span class="src-keyword">EQ YES THEN</span><!--src-keyword-->
<span class="src-keyword">RUN</span><!--src-keyword--> pLastRoutingEmail.
 
<span class="src-keyword">FIND FIRST</span><!--src-keyword--> b-job <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->
     <span class="src-keyword">WHERE</span><!--src-keyword--> b-job.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
       <span class="src-keyword">AND</span><!--src-keyword--> b-job.job     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job
     <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
<span class="src-keyword">IF AVAILABLE</span><!--src-keyword--> b-job <span class="src-keyword">THEN</span><!--src-keyword-->
b-job.<span class="src-keyword">user-id</span><!--src-keyword--> = <span class="src-keyword">USERID</span><!--src-keyword-->(<span class="src-char">"NOSWEAT"</span><!--src-char-->).
 
<span class="src-comment">/* Clear out any error-status from find with no-error that is false */</span><!--src-comment-->
ll-error = <span class="src-keyword">YES NO-ERROR</span><!--src-keyword-->.
 
<span class="src-keyword">PROCEDURE</span><!--src-keyword--> pLastRoutingEmail:
    <span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> cBody             <span class="src-keyword">AS CHARACTER NO-UNDO</span><!--src-keyword-->.
    <span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> cFGItem           <span class="src-keyword">AS CHARACTER NO-UNDO</span><!--src-keyword-->.
    <span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> cJobCompleteEmail <span class="src-keyword">AS CHARACTER NO-UNDO</span><!--src-keyword-->.
    <span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> cMachine          <span class="src-keyword">AS CHARACTER NO-UNDO</span><!--src-keyword-->.
    <span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> cMessage          <span class="src-keyword">AS CHARACTER NO-UNDO</span><!--src-keyword-->.
    <span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> iConfigID         <span class="src-keyword">AS INTEGER   NO-UNDO</span><!--src-keyword-->.
    <span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> lJobCompleteEmail <span class="src-keyword">AS LOGICAL   NO-UNDO</span><!--src-keyword-->.
    <span class="src-keyword">DEFINE VARIABLE</span><!--src-keyword--> lSuccess          <span class="src-keyword">AS LOGICAL   NO-UNDO</span><!--src-keyword-->.
 
    <span class="src-keyword">DEFINE BUFFER</span><!--src-keyword--> bJobMch <span class="src-keyword">FOR</span><!--src-keyword--> job-mch.
 
    <span class="src-comment">/* get last routing record */</span><!--src-comment-->
    <span class="src-keyword">FIND LAST</span><!--src-keyword--> bJobMch <span class="src-keyword">NO-LOCK USE-INDEX</span><!--src-keyword--> line-idx
        <span class="src-keyword">WHERE</span><!--src-keyword--> bJobMch.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
          <span class="src-keyword">AND</span><!--src-keyword--> bJobMch.job     <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job
        <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
    <span class="src-comment">/* only applies if last routing record */</span><!--src-comment-->
    <span class="src-keyword">IF AVAILABLE</span><!--src-keyword--> bJobMch <span class="src-keyword">AND</span><!--src-keyword-->
       <span class="src-keyword">ROWID</span><!--src-keyword-->(bJobMch) <span class="src-keyword">EQ ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->) <span class="src-keyword">THEN DO</span><!--src-keyword-->:
        <span class="src-keyword">RUN</span><!--src-keyword--> sys/ref/nk1look.p (
            cocode,<span class="src-char">"JobCompleteEmail"</span><!--src-char-->,<span class="src-char">"L"</span><!--src-char-->,<span class="src-keyword">NO</span><!--src-keyword-->,<span class="src-keyword">NO</span><!--src-keyword-->,<span class="src-char">""</span><!--src-char-->,<span class="src-char">""</span><!--src-char-->,
            <span class="src-keyword">OUTPUT</span><!--src-keyword--> cJobCompleteEmail,<span class="src-keyword">OUTPUT</span><!--src-keyword--> lJobCompleteEmail
            ).
        <span class="src-keyword">IF</span><!--src-keyword--> lJobCompleteEmail <span class="src-keyword">AND</span><!--src-keyword--> cJobCompleteEmail <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"Yes"</span><!--src-char--> <span class="src-keyword">THEN DO</span><!--src-keyword-->:
            <span class="src-keyword">RUN</span><!--src-keyword--> sys/ref/nk1look.p (
                cocode,<span class="src-char">"JobCompleteEmail"</span><!--src-char-->,<span class="src-char">"I"</span><!--src-char-->,<span class="src-keyword">NO</span><!--src-keyword-->,<span class="src-keyword">NO</span><!--src-keyword-->,<span class="src-char">""</span><!--src-char-->,<span class="src-char">""</span><!--src-char-->,
                <span class="src-keyword">OUTPUT</span><!--src-keyword--> cJobCompleteEmail,<span class="src-keyword">OUTPUT</span><!--src-keyword--> lJobCompleteEmail
                ).
            iConfigID = <span class="src-keyword">INTEGER</span><!--src-keyword-->(cJobCompleteEmail).
            <span class="src-keyword">FIND FIRST</span><!--src-keyword--> mach <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
                 <span class="src-keyword">WHERE</span><!--src-keyword--> mach.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
                   <span class="src-keyword">AND</span><!--src-keyword--> mach.m-code  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.m-code
                 <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
            <span class="src-keyword">IF AVAILABLE</span><!--src-keyword--> mach <span class="src-keyword">THEN</span><!--src-keyword-->
            cMachine = mach.m-dscr.
            <span class="src-keyword">FIND FIRST</span><!--src-keyword--> itemfg <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
                 <span class="src-keyword">WHERE</span><!--src-keyword--> itemfg.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
                   <span class="src-keyword">AND</span><!--src-keyword--> itemfg.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
                 <span class="src-keyword">NO-ERROR</span><!--src-keyword-->.
            <span class="src-keyword">IF AVAILABLE</span><!--src-keyword--> itemfg <span class="src-keyword">THEN</span><!--src-keyword-->
            cFGItem = itemfg.i-name.
            cBody = <span class="src-char">"Job: "</span><!--src-char--> + <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no + <span class="src-char">"-"</span><!--src-char-->
                  + <span class="src-keyword">STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.job-no2)
                  + <span class="src-char">" - Routing: "</span><!--src-char--> + <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.m-code + <span class="src-char">" ("</span><!--src-char-->
                  + cMachine + <span class="src-char">")"</span><!--src-char-->
                  + <span class="src-char">" - FG Item: "</span><!--src-char--> + <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no + <span class="src-char">" ("</span><!--src-char-->
                  + cFGItem + <span class="src-char">")"</span><!--src-char-->
                  .
            <span class="src-keyword">RUN</span><!--src-keyword--> spSendEmail (
                iConfigID,       <span class="src-comment">/* emailConfig.ConfigID */</span><!--src-comment-->
                <span class="src-char">""</span><!--src-char-->,              <span class="src-comment">/* Override for Email RecipientsinTo */</span><!--src-comment-->
                <span class="src-char">""</span><!--src-char-->,              <span class="src-comment">/* Override for Email RecipientsinReplyTo */</span><!--src-comment-->
                <span class="src-char">""</span><!--src-char-->,              <span class="src-comment">/* Override for Email RecipientsinCC */</span><!--src-comment-->
                <span class="src-char">""</span><!--src-char-->,              <span class="src-comment">/* Override for Email RecipientsinBCC */</span><!--src-comment-->
                <span class="src-char">""</span><!--src-char-->,              <span class="src-comment">/* Override for Email Subject */</span><!--src-comment-->
                cBody,           <span class="src-comment">/* Override for Email Body */</span><!--src-comment-->
                <span class="src-char">""</span><!--src-char-->,              <span class="src-comment">/* Email Attachment */</span><!--src-comment-->
                <span class="src-keyword">OUTPUT</span><!--src-keyword--> lSuccess, <span class="src-comment">/* Email success or not */</span><!--src-comment-->
                <span class="src-keyword">OUTPUT</span><!--src-keyword--> cMessage  <span class="src-comment">/* Reason for failure in case email is not sent */</span><!--src-comment-->
                ).
        <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* if ljobcompleteemail */</span><!--src-comment-->
    <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* if avail */</span><!--src-comment-->
 
<span class="src-keyword">END PROCEDURE</span><!--src-keyword-->.
</div><!--progresscode-->
</body>
</html>
