<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="generator" content="HtmlDict.w version 11">
  <meta name="author"    content="Patrick Tingen [patrick at tingen dot nl]">
  <link rel="stylesheet" title="Default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="blue" type="text/css" href="../../blue.css">
  <link rel="alternate stylesheet" title="default" type="text/css" href="../../default.css">
  <link rel="alternate stylesheet" title="green" type="text/css" href="../../green.css">
  <link rel="alternate stylesheet" title="oldstyle" type="text/css" href="../../oldstyle.css">
  <link rel="alternate stylesheet" title="red" type="text/css" href="../../red.css">
  <link rel="shortcut icon" href="../../htmldict.ico">
  <link rel="stylesheet" media="print" type="text/css" href="../../print.css">
  <script src="../../swapstyle.js"    type="text/javascript"></script>
  <script src="../../stylechooser.js" type="text/javascript"></script>
  <script src="../../dbchooser.js"    type="text/javascript"></script>
  <script src="../../htmldict.js"     type="text/javascript"></script>
  <title> Trigger code: write of itemfg</title>
</head>
<body onload="useStyleAgain('HtmlDict');" onunload="rememberStyle('HtmlDict',10);">
<div><a name="top"></a></div>
<table style="width:100%;">
  <tr>
    <td class="navbar" style="width:80%;"><a href="../../../00-index.html"target="_top">DB</a>
 | <a href="../../00-area.html"target="main">Areas</a>
 | <a href="../../00-cross.html"target="main">X-idx</a>
 | <a href="../../00-main.html"target="main">Tables</a>
 | <a href="../../00-sequences.html"target="main">Sequences</a>
</td>
    <td class="navbar" style="width:20%; text-align:right;"><a href="../../htmldict.html"target="_top">HtmlDict 11</a></td>
  </tr>
</table>
 
<h1>Trigger code: write of itemfg</h1>
<div class="progressCode">
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> ACTION <span class="src-keyword">UPDATE</span><!--src-keyword-->
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> <span class="src-keyword">DBNAME</span><!--src-keyword--> ASI
<span class="src-prep">&amp;Scoped-define</span><!--src-prep--> TABLENAME itemfg
 
<span class="src-keyword">TRIGGER PROCEDURE FOR WRITE OF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep--> <span class="src-keyword">OLD BUFFER</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.
 
<span class="src-prep">{methods/<span class="src-keyword">triggers</span><!--src-keyword-->/<span class="src-keyword">write</span><!--src-keyword-->.i}</span><!--src-prep-->
 
<span class="src-prep">{custom/globdefs.i}</span><!--src-prep-->
 
<span class="src-prep">{sys/inc/<span class="src-keyword">VAR</span><!--src-keyword-->.i <span class="src-keyword">NEW</span><!--src-keyword--> SHARED}</span><!--src-p<span class="src-keyword">SHARED</span><!--src-keyword-->
 
<span class="src-keyword">DEF VAR</span><!--src-keyword--> K_FRAC <span class="src-keyword">AS DEC INIT</span><!--src-keyword--> <span class="src-number">6</span><!--src-number-->.<span class="src-number">25</span><!--src-number--> <span class="src-keyword">NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DEF VAR</span><!--src-keyword--> ld-qalloc <span class="src-keyword">AS DEC NO-UNDO</span><!--src-keyword-->.
<span class="src-keyword">DISABLE TRIGGERS FOR LOAD OF</span><!--src-keyword--> eb.
 
<span class="src-keyword">ASSIGN</span><!--src-keyword-->
 cocode = g_company
 locode = g_loc.
 
<span class="src-prep">{ce/msfcalc.i}</span><!--src-prep-->
 
<span class="src-comment">/* Transaction Keyword here */</span><!--src-comment-->
<span class="src-prep">{sys/inc/oereordr.i}</span><!--src-prep-->
 
<span class="src-comment">/* Transaction Keyword here */</span><!--src-comment-->
<span class="src-prep">{sys/inc/f16to32.i}</span><!--src-prep-->
 
<span class="src-keyword">DO TRANSACTION</span><!--src-keyword-->:
 
    <span class="src-keyword">IF TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.type-code) <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.type-code = <span class="src-char">"O"</span><!--src-char-->.
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-code <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"C"</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.prod-uom = <span class="src-char">"M"</span><!--src-char-->.
 
    <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-name = <span class="src-char">""</span><!--src-char-->.
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-keyword">FOR EACH</span><!--src-keyword--> cust <span class="src-keyword">FIELDS</span><!--src-keyword-->(<span class="src-keyword">NAME</span><!--src-keyword-->)
        <span class="src-keyword">WHERE</span><!--src-keyword--> cust.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
          <span class="src-keyword">AND</span><!--src-keyword--> cust.cust-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-no
        <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
      <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-name = cust.<span class="src-keyword">name</span><!--src-keyword-->.
      <span class="src-keyword">LEAVE</span><!--src-keyword-->.
    <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* Each Cust */</span><!--src-comment-->
 
    <span class="src-keyword">IF TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.pur-uom) <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">""</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword-->
      <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.pur-man <span class="src-keyword">THEN DO</span><!--src-keyword-->:
        <span class="src-keyword">FOR EACH</span><!--src-keyword--> po-ordl
            <span class="src-keyword">WHERE</span><!--src-keyword--> po-ordl.company   <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
              <span class="src-keyword">AND</span><!--src-keyword--> po-ordl.i-no      <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
              <span class="src-keyword">AND</span><!--src-keyword--> po-ordl.item-type <span class="src-keyword">EQ NO</span><!--src-keyword-->
            <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
            <span class="src-keyword">BY</span><!--src-keyword--> po-ordl.po-no <span class="src-keyword">DESC</span><!--src-keyword-->:
          <span class="src-keyword">LEAVE</span><!--src-keyword-->.
        <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* Each Po-ordl */</span><!--src-comment-->
 
        <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.pur-uom = <span class="src-keyword">IF AVAIL</span><!--src-keyword--> po-ordl <span class="src-keyword">THEN</span><!--src-keyword--> po-ordl.pr-qty-uom <span class="src-keyword">ELSE</span><!--src-keyword--> <span class="src-char">"EA"</span><!--src-char-->.
      <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* If pur-man */</span><!--src-comment-->
 
      <span class="src-keyword">ELSE</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.pur-uom = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.prod-uom.
 
    <span class="src-keyword">FIND FIRST</span><!--src-keyword--> fg-set <span class="src-keyword">WHERE</span><!--src-keyword--> fg-set.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
                        <span class="src-keyword">AND</span><!--src-keyword--> fg-set.part-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
                      <span class="src-keyword">NO-LOCK NO-ERROR</span><!--src-keyword-->.
    <span class="src-comment">/* Set component q-ono is dependent on the set header */</span><!--src-comment-->
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.isaset <span class="src-keyword">OR NOT AVAIL</span><!--src-keyword-->(fg-set) <span class="src-keyword">THEN</span><!--src-keyword-->
      <span class="src-keyword">RUN</span><!--src-keyword--> fg/calcqono.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->), <span class="src-keyword">OUTPUT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.q-ono).
 
    <span class="src-keyword">RUN</span><!--src-keyword--> fg/calcqa&amp;b.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->), <span class="src-keyword">OUTPUT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.q-alloc,
                                            <span class="src-keyword">OUTPUT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.q-back).
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.weight-100 <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.weight-100 = <span class="src-number">1</span><!--src-number-->.
 
    <span class="src-keyword">ASSIGN</span><!--src-keyword-->
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.q-avail = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.q-onh +
                            (<span class="src-keyword">IF</span><!--src-keyword--> oereordr-cha <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"XOnOrder"</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">ELSE</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.q-ono) <span class="src-keyword">-</span><!--src-keyword-->
                            <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.q-alloc.
     <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no  = <span class="src-keyword">FILL</span><!--src-keyword-->(<span class="src-char">" "</span><!--src-char-->,<span class="src-number">8</span><!--src-number--> <span class="src-keyword">- LENGTH</span><!--src-keyword-->(<span class="src-keyword">TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no))) +
                            <span class="src-keyword">TRIM</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no).
 
    <span class="src-keyword">FOR EACH</span><!--src-keyword--> itemfg-loc <span class="src-keyword">WHERE</span><!--src-keyword--> itemfg-loc.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
                          <span class="src-keyword">AND</span><!--src-keyword--> itemfg-loc.i-no    <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
                        <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->:
      <span class="src-comment">/* Set component q-ono is dependent on the set header */</span><!--src-comment-->
 
      <span class="src-keyword">IF</span><!--src-keyword--> itemfg.isaset <span class="src-keyword">OR NOT AVAIL</span><!--src-keyword-->(fg-set) <span class="src-keyword">THEN</span><!--src-keyword-->
        <span class="src-keyword">RUN</span><!--src-keyword--> fg/calcqool.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(itemfg), itemfg-loc.loc, <span class="src-keyword">OUTPUT</span><!--src-keyword--> itemfg-loc.q-ono).
 
 
      <span class="src-keyword">RUN</span><!--src-keyword--> fg/calcqabl.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(itemfg), itemfg-loc.loc, <span class="src-keyword">OUTPUT</span><!--src-keyword--> itemfg-loc.q-alloc,
                                              <span class="src-keyword">OUTPUT</span><!--src-keyword--> itemfg-loc.q-back).  
 
      <span class="src-keyword">ASSIGN</span><!--src-keyword-->
       itemfg-loc.q-avail = itemfg-loc.q-onh +
                              (<span class="src-keyword">IF</span><!--src-keyword--> oereordr-cha <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"XOnOrder"</span><!--src-char--> <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-number">0</span><!--src-number--> <span class="src-keyword">ELSE</span><!--src-keyword--> itemfg-loc.q-ono) <span class="src-keyword">-</span><!--src-keyword-->
                              itemfg-loc.q-alloc.
    <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* Each Itemfg-loc */</span><!--src-comment-->
 
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-no <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-no <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-keyword">FOR EACH</span><!--src-keyword--> cust
        <span class="src-keyword">WHERE</span><!--src-keyword--> cust.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
          <span class="src-keyword">AND</span><!--src-keyword--> cust.cust-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-no
        <span class="src-keyword">NO-LOCK</span><!--src-keyword-->:
      <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.taxable = <span class="src-keyword">AVAIL</span><!--src-keyword--> cust <span class="src-keyword">AND</span><!--src-keyword--> cust.<span class="src-keyword">sort EQ</span><!--src-keyword--> <span class="src-char">"Y"</span><!--src-char--> <span class="src-keyword">AND</span><!--src-keyword--> cust.tax-gr <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->.
      <span class="src-keyword">LEAVE</span><!--src-keyword-->.
    <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* Each cust */</span><!--src-comment-->
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no        <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->                   <span class="src-keyword">AND</span><!--src-keyword-->
       old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no    <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->                   <span class="src-keyword">AND</span><!--src-keyword-->
       (old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no   <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no <span class="src-keyword">OR</span><!--src-keyword--> 
        old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.procat <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.procat) <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-keyword">FOR EACH</span><!--src-keyword--> oe-prmtx
        <span class="src-keyword">WHERE</span><!--src-keyword--> oe-prmtx.company            <span class="src-keyword">EQ</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
          <span class="src-keyword">AND</span><!--src-keyword--> oe-prmtx.i-no               <span class="src-keyword">BEGINS</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
          <span class="src-keyword">AND SUBSTR</span><!--src-keyword-->(oe-prmtx.i-no,<span class="src-number">1</span><!--src-number-->,<span class="src-number">100</span><!--src-number-->) <span class="src-keyword">EQ</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
        <span class="src-keyword">EXCLUSIVE-LOCK</span><!--src-keyword-->:
 
      <span class="src-keyword">ASSIGN</span><!--src-keyword-->
         <span class="src-keyword">SUBSTR</span><!--src-keyword-->(oe-prmtx.i-no,<span class="src-number">1</span><!--src-number-->,<span class="src-number">100</span><!--src-number-->) = <span class="src-keyword">STRING</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no,<span class="src-char">"X(100)"</span><!--src-char-->)
         oe-prmtx.procat             = <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.procat.
 
    <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* Each oe-prmtx */</span><!--src-comment-->
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.isaset <span class="src-keyword">AND</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.alloc <span class="src-keyword">THEN DO</span><!--src-keyword-->:
        <span class="src-keyword">FOR EACH</span><!--src-keyword--> fg-set
            <span class="src-keyword">WHERE</span><!--src-keyword--> fg-set.company <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
              <span class="src-keyword">AND</span><!--src-keyword--> fg-set.set-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
            <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
            <span class="src-keyword">BREAK BY</span><!--src-keyword--> fg-set.set-no:
 
          <span class="src-keyword">IF FIRST</span><!--src-keyword-->(fg-set.set-no) <span class="src-keyword">AND LAST</span><!--src-keyword-->(fg-set.set-no) <span class="src-keyword">AND</span><!--src-keyword-->
             fg-set.part-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no          <span class="src-keyword">THEN</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.alloc = <span class="src-keyword">NO</span><!--src-keyword-->.
        <span class="src-keyword">END</span><!--src-keyword-->.
        <span class="src-keyword">RUN</span><!--src-keyword--> fg/updsetono.p (<span class="src-keyword">INPUT ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)).
    <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* If isaset... */</span><!--src-comment-->
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->                            <span class="src-keyword">AND</span><!--src-keyword-->
       (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no <span class="src-keyword">OR</span><!--src-keyword-->
        <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-wid  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                       <span class="src-keyword">OR</span><!--src-keyword-->
        <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-len  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                       <span class="src-keyword">OR</span><!--src-keyword-->
        <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-sqin <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->                       <span class="src-keyword">OR</span><!--src-keyword-->
        <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.t-sqft <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->)                           <span class="src-keyword">THEN DO</span><!--src-keyword-->:
 
      <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.isaset <span class="src-keyword">AND</span><!--src-keyword-->
         <span class="src-keyword">CAN-FIND</span><!--src-keyword-->(<span class="src-keyword">FIRST</span><!--src-keyword--> fg-set <span class="src-keyword">WHERE</span><!--src-keyword--> fg-set.company <span class="src-keyword">EQ</span><!--src-keyword--> cocode
                                 <span class="src-keyword">AND</span><!--src-keyword--> fg-set.set-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
                                 <span class="src-keyword">AND</span><!--src-keyword--> fg-set.part-no <span class="src-keyword">NE</span><!--src-keyword--> fg-set.set-no)
      <span class="src-keyword">THEN RUN</span><!--src-keyword--> fg/updsetdm.p (<span class="src-keyword">RECID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)).
 
      <span class="src-keyword">ELSE DO</span><!--src-keyword-->:
        <span class="src-keyword">FIND FIRST</span><!--src-keyword--> est
            <span class="src-keyword">WHERE</span><!--src-keyword--> est.company <span class="src-keyword">EQ</span><!--src-keyword--> cocode
              <span class="src-keyword">AND</span><!--src-keyword--> est.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.est-no
            <span class="src-keyword">NO-LOCK NO-ERROR</span><!--src-keyword-->.
        <span class="src-keyword">IF AVAIL</span><!--src-keyword--> est <span class="src-keyword">THEN</span><!--src-keyword-->
        <span class="src-keyword">FOR EACH</span><!--src-keyword--> eb <span class="src-keyword">NO-LOCK</span><!--src-keyword-->
            <span class="src-keyword">WHERE</span><!--src-keyword--> eb.company  <span class="src-keyword">EQ</span><!--src-keyword--> est.company
              <span class="src-keyword">AND</span><!--src-keyword--> eb.est-no   <span class="src-keyword">EQ</span><!--src-keyword--> est.est-no
              <span class="src-keyword">AND</span><!--src-keyword--> eb.stock-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no
            <span class="src-keyword">BY</span><!--src-keyword--> eb.form-no:
          <span class="src-keyword">LEAVE</span><!--src-keyword-->.
        <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* Each eb */</span><!--src-comment-->
        <span class="src-keyword">IF NOT AVAIL</span><!--src-keyword--> eb                             <span class="src-keyword">AND</span><!--src-keyword-->
           <span class="src-keyword">AVAIL</span><!--src-keyword--> est                                <span class="src-keyword">AND</span><!--src-keyword-->
           (est.est-type <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">1</span><!--src-number--> <span class="src-keyword">OR</span><!--src-keyword--> est.est-type <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-number">5</span><!--src-number-->) <span class="src-keyword">THEN</span><!--src-keyword-->
        <span class="src-keyword">FIND FIRST</span><!--src-keyword--> eb
            <span class="src-keyword">WHERE</span><!--src-keyword--> eb.est-no  <span class="src-keyword">EQ</span><!--src-keyword--> est.est-no
              <span class="src-keyword">AND</span><!--src-keyword--> eb.form-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-number">0</span><!--src-number-->
            <span class="src-keyword">NO-LOCK NO-ERROR</span><!--src-keyword-->.
        <span class="src-keyword">IF AVAIL</span><!--src-keyword--> eb <span class="src-keyword">THEN</span><!--src-keyword-->
        <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.isaset <span class="src-keyword">THEN RUN</span><!--src-keyword--> fg/updsetdm.p (<span class="src-keyword">RECID</span><!--src-keyword-->(eb)).
        <span class="src-keyword">ELSE DO</span><!--src-keyword-->:
          <span class="src-prep">{sys/inc/updfgdim.i eb}</span><!--src-prep-->
        <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* Not isaset */</span><!--src-comment-->
      <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* Not isaset */</span><!--src-comment-->
    <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* est-no gt "" or dimensions not zero */</span><!--src-comment-->
 
    <span class="src-keyword">IF CAN-FIND</span><!--src-keyword-->(<span class="src-keyword">FIRST</span><!--src-keyword--> asi._file <span class="src-keyword">WHERE</span><!--src-keyword--> asi._file._file-name <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-char">"cust-part"</span><!--src-char-->) <span class="src-keyword">THEN</span><!--src-keyword-->
      <span class="src-keyword">RUN</span><!--src-keyword--> custom/updcpart.p (<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company,
                             <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no,
                             <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.cust-no,
                             <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.part-no).
 
    <span class="src-keyword">RUN</span><!--src-keyword--> fg/prodcode.p (<span class="src-keyword">ROWID</span><!--src-keyword-->(<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->)).
 
    <span class="src-comment">/*don't call from IF1*/</span><!--src-comment-->
 
 
 
<span class="src-comment">/*     IF INDEX(PROGRAM-NAME(2),"viewers/itemfg") = 0 and                       */</span><!--src-comment-->
<span class="src-comment">/*        {&amp;TABLENAME}.company NE "" AND                                        */</span><!--src-comment-->
<span class="src-comment">/*        {&amp;TABLENAME}.i-no    NE "" THEN DO:                                   */</span><!--src-comment-->
<span class="src-comment">/*                                                                              */</span><!--src-comment-->
<span class="src-comment">/*       FIND FIRST reftable                                                    */</span><!--src-comment-->
<span class="src-comment">/*           WHERE reftable.reftable EQ "FGSTATUS"                              */</span><!--src-comment-->
<span class="src-comment">/*             AND reftable.company  EQ (IF old-{&amp;TABLENAME}.company NE "" THEN */</span><!--src-comment-->
<span class="src-comment">/*                                         old-{&amp;TABLENAME}.company             */</span><!--src-comment-->
<span class="src-comment">/*                                       ELSE {&amp;TABLENAME}.company)             */</span><!--src-comment-->
<span class="src-comment">/*             AND reftable.loc      EQ ""                                      */</span><!--src-comment-->
<span class="src-comment">/*             AND reftable.code     EQ (IF old-{&amp;TABLENAME}.i-no NE "" THEN    */</span><!--src-comment-->
<span class="src-comment">/*                                         old-{&amp;TABLENAME}.i-no                */</span><!--src-comment-->
<span class="src-comment">/*                                       ELSE {&amp;TABLENAME}.i-no)                */</span><!--src-comment-->
<span class="src-comment">/*           NO-ERROR.                                                          */</span><!--src-comment-->
<span class="src-comment">/*                                                                              */</span><!--src-comment-->
<span class="src-comment">/*       IF NOT AVAIL reftable THEN DO:                                         */</span><!--src-comment-->
<span class="src-comment">/*                                                                              */</span><!--src-comment-->
<span class="src-comment">/*                                                                              */</span><!--src-comment-->
<span class="src-comment">/*         CREATE reftable.                                                     */</span><!--src-comment-->
<span class="src-comment">/*         ASSIGN                                                               */</span><!--src-comment-->
<span class="src-comment">/*          reftable.reftable = "FGSTATUS"                                      */</span><!--src-comment-->
<span class="src-comment">/*          reftable.loc      = ""                                              */</span><!--src-comment-->
<span class="src-comment">/*          reftable.code2    = "A".                                            */</span><!--src-comment-->
<span class="src-comment">/*       END. /* Not Avail Reftable */                                          */</span><!--src-comment-->
<span class="src-comment">/*                                                                              */</span><!--src-comment-->
<span class="src-comment">/*       ASSIGN                                                                 */</span><!--src-comment-->
<span class="src-comment">/*        reftable.company = {&amp;TABLENAME}.company                               */</span><!--src-comment-->
<span class="src-comment">/*        reftable.code    = {&amp;TABLENAME}.i-no.                                 */</span><!--src-comment-->
<span class="src-comment">/*                                                                              */</span><!--src-comment-->
<span class="src-comment">/*     END. /* If not called from views/itemfg */                               */</span><!--src-comment-->
 
    <span class="src-keyword">IF</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.isaset                          <span class="src-keyword">AND</span><!--src-keyword-->
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no <span class="src-keyword">NE</span><!--src-keyword--> <span class="src-char">""</span><!--src-char-->                      <span class="src-keyword">AND</span><!--src-keyword-->
       <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.alloc <span class="src-keyword">NE</span><!--src-keyword--> old-<span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.alloc <span class="src-keyword">THEN</span><!--src-keyword-->
    <span class="src-keyword">FOR EACH</span><!--src-keyword--> eb
        <span class="src-keyword">WHERE</span><!--src-keyword--> eb.company  <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.company
          <span class="src-keyword">AND</span><!--src-keyword--> eb.stock-no <span class="src-keyword">EQ</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.i-no:
      eb.set-is-assembled = <span class="src-keyword">NOT</span><!--src-keyword--> <span class="src-prep">{&amp;TABLENAME}</span><!--src-prep-->.alloc.
    <span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* Each eb */</span><!--src-comment-->
 
    <span class="src-comment">/* Clear out any error-status from find with no-error that is false */</span><!--src-comment-->
    <span class="src-keyword">DEF VAR</span><!--src-keyword--> ll-error <span class="src-keyword">AS LOG NO-UNDO</span><!--src-keyword-->.
    ll-error = <span class="src-keyword">YES NO-ERROR</span><!--src-keyword-->.
<span class="src-keyword">END</span><!--src-keyword-->. <span class="src-comment">/* Do Transaction */</span><!--src-comment-->
 
 
</div><!--progresscode-->
</body>
</html>
